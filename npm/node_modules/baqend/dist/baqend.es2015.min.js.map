{"version":3,"sources":["webpack://Baqend/webpack/bootstrap","webpack://Baqend/./lib/connector/Message.ts","webpack://Baqend/./lib/connector/Connector.ts","webpack://Baqend/./lib/connector/XMLHttpConnector.ts","webpack://Baqend/./lib/connector/IFrameConnector.ts","webpack://Baqend/./lib/util/websocket-browser.ts","webpack://Baqend/./lib/connector/WebSocketConnector.ts","webpack://Baqend/./lib/intersection/Metadata.ts","webpack://Baqend/./lib/intersection/Validator.ts","webpack://Baqend/./lib/intersection/ValidationResult.ts","webpack://Baqend/./lib/intersection/Code.ts","webpack://Baqend/./lib/intersection/Modules.ts","webpack://Baqend/./lib/intersection/Logger.ts","webpack://Baqend/./lib/intersection/PushMessage.ts","webpack://Baqend/./lib/intersection/TokenStorage.ts","webpack://Baqend/./lib/intersection/GlobalStorage.ts","webpack://Baqend/./lib/intersection/WebStorage.ts","webpack://Baqend/./lib/message.ts","webpack://Baqend/./lib/binding/Accessor.ts","webpack://Baqend/./lib/binding/Enhancer.ts","webpack://Baqend/./lib/binding/Factory.ts","webpack://Baqend/./lib/binding/UserFactory.ts","webpack://Baqend/./lib/binding/ManagedFactory.ts","webpack://Baqend/./lib/binding/EntityFactory.ts","webpack://Baqend/./lib/binding/DeviceFactory.ts","webpack://Baqend/./lib/binding/File.ts","webpack://Baqend/./lib/binding/FileFactory.ts","webpack://Baqend/./lib/util/enumerable.ts","webpack://Baqend/./lib/binding/Managed.ts","webpack://Baqend/./lib/binding/Entity.ts","webpack://Baqend/./lib/binding/User.ts","webpack://Baqend/./lib/binding/Role.ts","webpack://Baqend/./lib/util/is-node-browser.ts","webpack://Baqend/./lib/util/atob-browser.ts","webpack://Baqend/./lib/util/hmac-browser.ts","webpack://Baqend/./lib/util/Lockable.ts","webpack://Baqend/./node_modules/uuid/dist/esm-browser/rng.js","webpack://Baqend/./node_modules/uuid/dist/esm-browser/regex.js","webpack://Baqend/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://Baqend/./node_modules/uuid/dist/esm-browser/validate.js","webpack://Baqend/./lib/util/uuid.ts","webpack://Baqend/./node_modules/uuid/dist/esm-browser/v4.js","webpack://Baqend/./lib/util/deprecated.ts","webpack://Baqend/./lib/util/trailingSlashIt.ts","webpack://Baqend/./lib/error/PersistentError.ts","webpack://Baqend/./lib/error/CommunicationError.ts","webpack://Baqend/./lib/error/IllegalEntityError.ts","webpack://Baqend/./lib/error/EntityExistsError.ts","webpack://Baqend/./lib/error/RollbackError.ts","webpack://Baqend/./lib/metamodel/Type.ts","webpack://Baqend/./lib/metamodel/ManagedType.ts","webpack://Baqend/./lib/metamodel/Attribute.ts","webpack://Baqend/./lib/metamodel/BasicType.ts","webpack://Baqend/./lib/metamodel/SingularAttribute.ts","webpack://Baqend/./lib/metamodel/PluralAttribute.ts","webpack://Baqend/./lib/metamodel/EntityType.ts","webpack://Baqend/./lib/metamodel/EmbeddableType.ts","webpack://Baqend/./lib/metamodel/ListAttribute.ts","webpack://Baqend/./lib/metamodel/MapAttribute.ts","webpack://Baqend/./lib/metamodel/SetAttribute.ts","webpack://Baqend/./lib/metamodel/ModelBuilder.ts","webpack://Baqend/./lib/metamodel/DbIndex.ts","webpack://Baqend/./lib/metamodel/Metamodel.ts","webpack://Baqend/./lib/metamodel/CollectionAttribute.ts","webpack://Baqend/./lib/Acl.ts","webpack://Baqend/./lib/GeoPoint.ts","webpack://Baqend/./lib/baqend.ts","webpack://Baqend/./lib/EntityManager.ts","webpack://Baqend/./lib/EntityManagerFactory.ts","webpack://Baqend/./lib/query/Query.ts","webpack://Baqend/./lib/query/Stream.ts","webpack://Baqend/./lib/query/Node.ts","webpack://Baqend/./lib/query/Condition.ts","webpack://Baqend/./lib/query/Filter.ts","webpack://Baqend/./lib/query/Operator.ts","webpack://Baqend/./lib/query/Builder.ts","webpack://Baqend/./lib/partialupdate/UpdateOperation.ts","webpack://Baqend/./lib/partialupdate/PartialUpdateBuilder.ts","webpack://Baqend/./lib/partialupdate/EntityPartialUpdateBuilder.ts","webpack://Baqend/./lib/caching/BloomFilter.ts","webpack://Baqend/./lib/intersection/Permission.ts","webpack://Baqend/./lib/util/observable.ts","webpack://Baqend/external \"rxjs\"","webpack://Baqend/external \"validator\"","webpack://Baqend/./lib/deperecated-exports.ts","webpack://Baqend/./lib/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__rest","e","indexOf","getOwnPropertySymbols","length","propertyIsEnumerable","REVALIDATION_SUPPORTED","navigator","chrome","test","vendor","platform","StatusCode","NOT_MODIFIED","BAD_CREDENTIALS","BUCKET_NOT_FOUND","INVALID_PERMISSION_MODIFICATION","INVALID_TYPE_VALUE","OBJECT_NOT_FOUND","OBJECT_OUT_OF_DATE","PERMISSION_DENIED","QUERY_DISPOSED","QUERY_NOT_SUPPORTED","SCHEMA_NOT_COMPATIBLE","SCHEMA_STILL_EXISTS","SYNTAX_ERROR","TRANSACTION_INACTIVE","TYPE_ALREADY_EXISTS","TYPE_STILL_REFERENCED","SCRIPT_ABORTION","args","this","withCredentials","progressCallback","_tokenStorage","_responseType","index","path","spec","len","dynamic","split","map","encodeURIComponent","join","query","arg","request","method","entity","headers","responseType","specification","parts","forEach","part","push","status","members","props","assign","cls","type","BINARY","undefined","queryIndex","substring","data","requestType","Blob","Buffer","ArrayBuffer","FormData","mimeType","header","contentLength","Number","eTag","formatETag","date","toUTCString","replace","ifMatch","ifNoneMatch","cacheControl","acl","JSON","stringify","customHeaders","accept","callback","sep","keys","tag","response","blob","buffer","stream","arraybuffer","base64","OAuthMessages","Google","createExternal","baseUri","addQueryString","redirect_uri","Facebook","GitHub","LinkedIn","Twitter","Salesforce","host","port","secure","basePath","origin","toUri","gzip","h","b","location","hostname","protocol","DEFAULT_BASE_PATH","matches","exec","Error","HTTP_DOMAIN","url","connection","connections","connectors","ConnectorConstructor","isUsable","uri","message","Promise","resolve","then","prepareRequest","doSend","res","prepareResponse","doReceive","catch","of","toFormat","slice","tokenStorage","signPath","signedPath","token","contentType","etag","update","fromFormat","resultEntity","RESPONSE_HEADERS","XMLHttpRequest","receive","oAuthHandle","localStorage","removeItem","handler","event","newValue","parse","msg","removeEventListener","addEventListener","xhr","onreadystatechange","readyState","responseText","getResponseHeader","upload","progress","onprogress","open","headerNames","headerName","setRequestHeader","send","reader","FileReader","readAsDataURL","reject","onload","onerror","result","match","isBase64","decodeURIComponent","binaryStr","array","Uint8Array","charCodeAt","super","queue","connected","mid","messages","document","locationSecure","locationPort","iframe","createElement","src","setAttribute","style","body","appendChild","onLoad","postMessage","isBinary","load","responseHeaders","strMsg","setTimeout","error","contentWindow","WebSocket","window","observers","socket","websocket","websockets","socketPromise","handleSocketCompletion","isError","firstErr","id","observer","complete","onclose","onmessage","Date","next","onopen","close","jsonMessage","MetadataState","entityManager","decodedKey","state","DIRTY","enabled","version","Acl","db","isEntity","isEmbeddable","managed","_metadata","lastIndexOf","val","bucket","UNAVAILABLE","PERSISTENT","newStateTrackingState","isAvailable","setDirty","FallBachValLib","valLib","Validator","errors","managedType","validationCode","iter","attributes","el","done","attr","fn","Function","argObj","apply","is","errorMessage","argumentList","unshift","toStringValue","isValid","OTHER_VALIDATORS","startsWith","includes","shift","callMethod","ValidationResult","fields","every","json","toJSON","metamodel","entityManagerFactory","str","toString","charAt","signature","code","codeType","asFunction","parseCode","functionToString","compile","stringToFunction","options","doneCallback","failCallback","opt","post","levelIndex","proto","logger","LoggerFunction","log","getOwnPropertyNames","getOwnPropertyDescriptor","init","LEVELS","level","format","pop","Array","isArray","stack","data1","message1","logJSON","toISOString","me","user","String","FORMAT_REGEXP","x","_","isReady","ready","devices","subject","badge","opts","sound","initDevices","Set","iterator","device","add","size","from","TokenStorage","temporary","tokenData","createdAt","parseInt","expireAt","sig","_saveToken","console","saveToken","resource","sign","hmac","hash","warn","tokens","GLOBAL","setItem","getItem","sessionStorage","webStorage","WEB_STORAGE","ListAllResources","ApiVersion","Specification","GetBloomFilter","GetBloomFilterExpirations","DeleteBloomFilter","GetOrestesConfig","UpdateOrestesConfig","Connect","Status","EventsUrl","BannedIp","Banned","Unban","UnbanIp","GetBucketNames","GetBucketIds","ExportBucket","ImportBucket","TruncateBucket","CreateObject","GetObject","ReplaceObject","DeleteObject","GetAllSchemas","UpdateAllSchemas","ReplaceAllSchemas","GetSchema","UpdateSchema","ReplaceSchema","DeleteSchema","AdhocQuery","AdhocQueryPOST","AdhocCountQuery","AdhocCountQueryPOST","ListQueryResources","CreateQuery","ListThisQueryResources","GetQueryCode","RunQuery","GetQueryParameters","NewTransaction","CommitTransaction","UpdatePartially","UpdateField","Login","Register","Me","ValidateUser","Logout","NewPassword","ResetPassword","Verify","ChangeUsername","VerifyUsername","OAuth2","OAuth1","UserToken","RevokeUserToken","GetBaqendCode","SetBaqendCode","DeleteBaqendCode","PostBaqendModule","GetBaqendModule","GetAllModules","ListFiles","ListBuckets","DownloadArchive","UploadPatchArchive","GetFileBucketMetadata","SetFileBucketMetadata","DeleteFileBucket","CreateFile","DownloadFile","UploadFile","GetFileMetadata","UpdateFileMetadata","DeleteFile","CreateManifest","DownloadAsset","RevalidateAssets","GetRevalidationStatus","CancelRevalidation","GetAllRevalidationStatus","CleanUpAssets","ListIndexes","CreateDropIndex","DropAllIndexes","DeviceRegister","DevicePush","DeviceRegistered","VAPIDKeys","VAPIDPublicKey","GCMAKey","UploadAPNSCertificate","Install","SW","Beacon","Accessor","attribute","BAQEND_ID","BAQEND_TYPE","Enhancer","superClass","typeConstructor","identifier","setIdentifier","ref","enhancePrototype","superType","declaredAttributes","isMetadata","enhanceProperty","throwUnloadedPropertyAccess","writable","configurable","Factory","target","extend","getPrototypeOf","properties","j","prop","factory","newInstance","a","LoginOption","arguments","methods","createFactory","instance","fromJsonValue","persisting","getReference","obj","createQueryBuilder","partialUpdate","password","loginOption","register","userObj","fromJSON","username","login","loginWithToken","renew","logout","newPassword","newPasswordWithToken","resetPassword","newUsername","changeUsername","requestAPIToken","revokeAllTokens","DefaultOptions","google","width","height","scope","facebook","github","twitter","linkedin","salesforce","methodName","clientID","toLowerCase","loginWithOAuth","deviceMe","isDeviceRegistered","os","tokenOrSubscription","subscription","registerDevice","pushMessage","pushDevice","_a","FILE_BUCKET_LENGTH","ID","METADATA","DATA","fileOptions","createIdFromOptions","setDataOptions","isFolder","checkAvailable","lastModified","authorize","createURL","uploadOptions","_b","uploadMessage","meta","conditional","addToBlackList","downloadOptions","downloadMessage","ensureCacheHeader","refresh","addToWhiteList","fromHeaders","deleteOptions","deleteMessage","fileId","File","parent","force","ifUnmodifiedSince","metadata","guessMimeType","parseETag","isMetadataLoaded","file","BASE_PERMISSIONS","new","folderOrPath","start","count","folder","propertyKey","descriptor","__decorate","decorators","desc","Reflect","decorate","getBaqendType","constructor","childClass","toJsonValue","attach","save","insert","local","delete","cb","optimisticSave","validate","operations","references","getReferencing","allResults","attrs","qb","terms","equal","or","resultList","all","results","filter","concat","excludeMetadata","currentPassword","users","has","isNode","atob","encoder","TextEncoder","crypto","subtle","importKey","encode","cryptoKey","reduce","padStart","Lockable","isLocked","readyPromise","critical","getRandomValues","msCrypto","rnds8","rng","uuid","byteToHex","substr","arr","offset","TypeError","buf","rnds","random","alreadyWarned","deprecated","alternativeSignature","deprecatedSignature","logWarning","deprecatedDescriptor","set","propertyValue","trailingSlashIt","PersistentError","PersistentErrorConstructor","cause","captureStackTrace","httpMessage","className","reason","stackTrace","fileName","lineNumber","PersistenceType","Type","SyntaxError","_typeConstructor","persistenceType","BASIC","EMBEDDABLE","ENTITY","MAPPED_SUPERCLASS","enhancer","schemaAddPermission","schemaReplacePermission","_validationCode","createProxyClass","enhance","getIdentifier","item","order","getAttribute","initOrder","getDeclaredAttribute","jsonObject","currentObject","onlyMetadata","setJsonValue","getJsonValue","class","schemaAdd","schemaReplace","embedded","embeddedAttributes","isCollection","elementType","hasMetadata","PersistentAttributeType","dateToJson","jsonToDate","currentValue","noResolving","Boolean","Double","parseFloat","Integer","DateTime","Time","GeoPoint","JsonArray","JsonObject","ATTACHED_STATE","ATTACHED_SIZE","isId","isVersion","isAcl","accessor","declaringType","overwriteExistingValue","collection","persistentAttributeType","EMBEDDED","ELEMENT_COLLECTION","getValue","setValue","ONE_TO_MANY","persistedState","attachState","changed","jsonValue","CollectionType","declaredId","declaredVersion","declaredAcl","loadPermission","updatePermission","deletePermission","queryPermission","schemaSubclassPermission","insertPermission","createProxy","entities","referencing","Map","names","classes","typeReferences","currentObjectState","objectState","enable","setPersistent","depth","isInDepth","schemaSubclass","persisted","persistedAcl","permission","oldPermission","newPermission","newKeys","oldKeys","LIST","attachedState","splice","keyType","MAP","attachSize","entries","entry","jsonKey","keyValue","clear","jsonKeys","persistedEntry","SET","values","models","modelDescriptors","typeName","basicType","model","buildModel","modelDescriptor","getModel","buildAttributes","superTypeIdentifier","permissions","field","addAttribute","buildAttribute","flags","singularAttribute","collectionType","trim","valueType","DbIndex","unique","ASC","DESC","isInitialized","embeddables","baseTypes","jsonMetamodel","getRef","baseTypesNames","embeddable","types","isBasic","entityType","withLock","sendUpdate","buildModels","addType","drop","COLLECTION","read","write","copy","isPublicAllowed","setPublicAllowed","userOrRole","isAllowed","isDenied","allowAccess","denyAccess","deleteAccess","latitude","longitude","lat","lng","geolocation","getCurrentPosition","coords","point","EARTH_RADIUS_IN_KILOMETERS","radiansTo","toFixed","EARTH_RADIUS_IN_MILES","to","rad1","DEG_TO_RAD","rad2","dLng","Math","acos","sin","cos","PI","emf","bq","createEntityManager","configure","hostOrApp","connect","EntityManager","List","bloomFilter","cacheWhiteList","cacheBlackList","bloomFilterRefresh","bloomFilterLock","isCachingEnabled","connector","connectData","staleness","_createObjectFactory","_updateDevice","_updateUser","_updateBloomFilter","createObjectFactory","ignoreCredentialError","_logout","entityClass","keyAsStr","keyIndex","setUnavailable","_attach","resultClass","removeReference","resolved","promises","subOptions","getSubEntities","subEntity","oid","resolveDepth","setRemoved","isNew","_save","jsonWithoutVersion","withoutLock","msgFactory","_locklessSave","_optimisticSave","abort","promise","refPromises","isDirty","sendPromise","sub","ensureBloomFilterFreshness","initialEntity","subEntities","getSubEntitiesByPath","attributeName","tmpSubEntities","curEntity","contains","containsById","isAttached","NO_LOGIN","_userRequest","provider","title","timeout","redirect","addRedirectOrigin","windowOptions","isBrowser","URL","openOAuthWindow","req","clearTimeout","targetOrTitle","updateMe","PERSIST_LOGIN","deviceType","devicetype","objectId","noCache","now","getTime","refreshRate","creation","refreshBloomFilter","mustRevalidate","relativePath","_getUserReference","resp","CONNECTED","WS","EntityManagerFactory","createMetamodel","tokenStorageFactory","success","schema","useSharedTokenStorage","em","Query","addOrder","sort","addOffset","limit","addLimit","flatArgs","MAX_URI_SIZE","reconnects","streamObservable","eventProps","matchType","operation","initial","resolveObject","matchTypes","ordered","mapper","parseOptions","observable","subscriber","openStream","closed","subscribe","unsubscribe","cachedObservable","remainingRetries","backoff","subscriptionObserver","verified","normalizeMatchTypes","normalizeOperations","normalizeReconnects","list","normalizeSortedSet","wildcard","itemType","allowedItems","li","lastItem","firstResult","maxResults","onNext","onError","onComplete","eventStream","createEventStream","createRealTimeQuery","resultStream","createResultStream","serializeQuery","serializeSort","createResultList","singleResult","k","v","typedValue","$date","objects","fieldOrSort","Condition","conditions","addFilter","greaterValue","lessValue","divisor","remainder","regExp","reg","RegExp","ignoreCase","global","source","multiline","geoPoint","maxDistance","$geometry","coordinates","$maxDistance","geoPoints","eq","ne","notEqual","lt","lessThan","le","lessThanOrEqualTo","gt","greaterThan","ge","greaterThanOrEqualTo","containsAny","in","currentFilter","fieldFilter","operator","childes","addOperator","where","UpdateOperation","ALLOWED_OPERATIONS","addOperations","addOperation","by","inc","multiplicator","hasOperationOnPath","bitmask","oldPath","newPath","isNaN","isFinite","updateOperation","pathValueDictionary","some","op","increment","decrement","dec","multiply","mul","divide","div","atMost","min","atLeast","max","toNow","currentDate","bytes","bits","hashes","element","getHashes","isSet","pos","floor","bit","hashValues","hash1","murmur3","hash2","seed","c1","c2","h1","h1b","k1","Permission","rules","allRules","optionalRxjsDependency","rxjs","Observable","Subscription","Subscriber","validator","deprecateExports","targetName","newImportSignature","exported","util","Metadata","PushMessage","Code","Modules","Logger","binding","caching","partialupdate","intersection","SetType","MapType","ListType"],"mappings":";uBACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,0eClFjDC,EAAkC,SAAUD,EAAGE,GAC/C,IAAIf,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMG,EAAEC,QAAQJ,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOyB,sBACtB,KAAInC,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOyB,sBAAsBJ,GAAI/B,EAAI8B,EAAEM,OAAQpC,IAC3DiC,EAAEC,QAAQJ,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUS,qBAAqBlC,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAOX,MAAMoB,EAA8C,oBAAdC,WAAgD,oBAAXC,QAA0B,UAAUC,KAAKF,UAAUG,SAAa,aAAaD,KAAKF,UAAUI,UAC1JC,EAAa,CACtBC,aAAc,IACdC,gBAAiB,IACjBC,iBAAkB,IAClBC,gCAAiC,IACjCC,mBAAoB,IACpBC,iBAAkB,IAClBC,mBAAoB,IACpBC,kBAAmB,IACnBC,eAAgB,IAChBC,oBAAqB,IACrBC,sBAAuB,IACvBC,oBAAqB,IACrBC,aAAc,IACdC,qBAAsB,IACtBC,oBAAqB,IACrBC,sBAAuB,IACvBC,gBAAiB,KAEd,MAAM,EAIT,eAAeC,GACXC,KAAKC,iBAAkB,EACvBD,KAAKE,iBAAmB,KACxBF,KAAKG,cAAgB,KACrBH,KAAKI,cAAgB,KACrB,IAAIC,EAAQ,EACRC,EAAON,KAAKO,KAAKD,KAAK,GAC1B,MAAME,EAAMR,KAAKO,KAAKD,KAAKjC,OAC3B,IAAK,IAAIpC,EAAI,EAAGA,EAAIuE,EAAKvE,GAAK,EACtB+D,KAAKO,KAAKE,SAAWD,EAAM,IAAMvE,EACjCqE,GAAQP,EAAKM,GAAOK,MAAM,KAAKC,IAAIC,oBAAoBC,KAAK,KAG5DP,GAAQM,mBAAmBb,EAAKM,IAAUL,KAAKO,KAAKD,KAAKrE,GAE7DoE,GAAS,EAEb,IAAIS,EAAQ,GACZ,IAAK,IAAI7E,EAAI,EAAGA,EAAI+D,KAAKO,KAAKO,MAAMzC,OAAQpC,GAAK,EAAG,CAChD,MAAM8E,EAAMhB,EAAKM,GACjBA,GAAS,EACLU,UACAD,GAAUA,IAAgC,IAAvBR,EAAKnC,QAAQ,KAAe,IAAM,IACrD2C,GAAS,GAAGd,KAAKO,KAAKO,MAAM7E,MAAM2E,mBAAmBG,MAG7Df,KAAKgB,QAAU,CACXC,OAAQjB,KAAKO,KAAKU,OAClBX,KAAMA,EAAOQ,EACbI,OAAQ,KACRC,QAAS,IAETpB,EAAKM,IACLL,KAAKkB,OAAOnB,EAAKM,GAAQ,QAE7BL,KAAKoB,aAAa,QAKtB,WAAa,OAAO,KAKpB,cAAcC,GACV,MAAMC,EAAQD,EAAcf,KAAKI,MAAM,KACjCJ,EAAOgB,EAAM,GAAGZ,MAAM,WACtBI,EAAQ,GACVQ,EAAM,IACNA,EAAM,GAAGZ,MAAM,KAAKa,QAASR,IACzB,MAAMS,EAAOT,EAAIL,MAAM,KACvBI,EAAMW,KAAKD,EAAK,MAGxB,MAAMjB,EAAO,CACTD,OACAQ,QACAY,OAAQL,EAAcK,OACtBT,OAAQI,EAAcJ,OACtBR,SAA8C,IAArCY,EAAcf,KAAKnC,QAAQ,MAExC,OAAO,cAAc,EACjB,WACI,OAAOoC,IAUnB,sBAAsBc,EAAeM,GACjC,MAAM,KAAErB,GAASe,EAAeO,EAAQ3D,EAAOoD,EAAe,CAAC,SACzDd,EAAO5D,OAAOkF,OAAO,CAAEpB,SAAS,EAAOH,KAAM,CAACA,IAASsB,GAIvDE,EAAM,cAAc,EACtB,WACI,OAAOvB,IAIf,OADA5D,OAAOkF,OAAOC,EAAIjE,UAAW8D,GACtBG,EAEX,eACI,OAAQ9B,KAAKgB,QAAQe,MAAQ/B,KAAKgB,QAAQe,QAAQ,EAAQC,QAAWhC,KAAKI,iBAAiB,EAAQ4B,OAEvG,aAAa9E,GACT,YAAc+E,IAAV/E,EACO8C,KAAKG,eAEhBH,KAAKG,cAAgBjD,EACd8C,MAEX,KAAKM,GACD,QAAa2B,IAAT3B,EAAoB,CACpB,MAAM4B,EAAalC,KAAKgB,QAAQV,KAAKnC,QAAQ,KAAO,EAEpD,OADA6B,KAAKgB,QAAQV,KAAOA,GAAQ4B,EAAa,GAAK5B,EAAKnC,QAAQ,MAAQ,EAAI,IAAM,KAAO6B,KAAKgB,QAAQV,KAAK6B,UAAUD,GAAc,IACvHlC,KAEX,OAAOA,KAAKgB,QAAQV,KAExB,OAAO9D,EAAMU,GACT,OAAc,OAAVA,UACO8C,KAAKgB,QAAQG,QAAQ3E,GACrBwD,WAEGiC,IAAV/E,GACA8C,KAAKgB,QAAQG,QAAQ3E,GAAQU,EACtB8C,MAEJA,KAAKgB,QAAQG,QAAQ3E,GAShC,OAAO4F,EAAML,GACT,IAAIM,EAAcN,EA4BlB,OA3BKM,IAGOA,EAFY,iBAATD,EACH,4BAA4B1D,KAAK0D,GACnB,WAGA,OAGG,oBAATE,MAAwBF,aAAgBE,KACtC,OAES,oBAAXC,QAA0BH,aAAgBG,OACxC,SAEc,oBAAhBC,aAA+BJ,aAAgBI,YAC7C,cAEW,oBAAbC,UAA4BL,aAAgBK,SAC1C,OAGA,QAGtBzC,KAAKgB,QAAQe,KAAOM,EACpBrC,KAAKgB,QAAQE,OAASkB,EACfpC,KAEX,SAAS0C,GACL,OAAO1C,KAAK2C,OAAO,eAAgBD,GAEvC,cAAcE,GACV,YAAsBX,IAAlBW,EACO5C,KAAK2C,OAAO,iBAAkB,GAAGC,GAErCC,OAAO7C,KAAK2C,OAAO,mBAE9B,QAAQG,GACJ,OAAO9C,KAAK2C,OAAO,WAAY3C,KAAK+C,WAAWD,IAEnD,YAAYA,GACR,OAAO9C,KAAK2C,OAAO,gBAAiB3C,KAAK+C,WAAWD,IAExD,kBAAkBE,GAEd,OAAOhD,KAAK2C,OAAO,sBAAuBK,GAAQA,EAAKC,cAAcC,QAAQ,MAAO,QAMxF,UAKI,OAJK3E,GACDyB,KAAKmD,QAAQ,IACRC,YAAY,KAEdpD,KAAKqD,aAAa,uBAE7B,aAAanG,GACT,OAAO8C,KAAK2C,OAAO,gBAAiBzF,GAExC,IAAIoG,GACA,OAAOtD,KAAK2C,OAAO,aAAcW,GAAOC,KAAKC,UAAUF,IAE3D,cAAcG,GACV,OAAOzD,KAAK2C,OAAO,wBAAyBc,GAAiBF,KAAKC,UAAUC,IAEhF,OAAOC,GACH,OAAO1D,KAAK2C,OAAO,SAAUe,GAEjC,aAAa3B,GACT,YAAaE,IAATF,GACA/B,KAAKI,cAAgB2B,EACd/B,MAEJA,KAAKI,cAEhB,SAASuD,GACL,YAAiB1B,IAAb0B,GACA3D,KAAKE,iBAAmByD,EACjB3D,MAEJA,KAAKE,iBAUhB,eAAeY,GACX,GAAqB,iBAAVA,EAEP,OADAd,KAAKgB,QAAQV,MAAQQ,EACdd,KAEX,GAAIc,EAAO,CACP,IAAI8C,EAAM5D,KAAKgB,QAAQV,KAAKnC,QAAQ,MAAQ,EAAI,IAAM,IACtDxB,OAAOkH,KAAK/C,GAAOS,QAAS/D,IACxBwC,KAAKgB,QAAQV,MAAQ,GAAGsD,EAAMpG,KAAOoD,mBAAmBE,EAAMtD,MAC9DoG,EAAM,MAGd,OAAO5D,KAEX,WAAW8C,GACP,GAAIA,SAAgD,MAATA,EACvC,OAAOA,EAEX,IAAIgB,EAAM,GAAGhB,EAIb,OAH0B,IAAtBgB,EAAI3F,QAAQ,OACZ2F,EAAM,IAAIA,MAEPA,EAOX,UAAUC,GACN,IAAmD,IAA/C/D,KAAKO,KAAKmB,OAAOvD,QAAQ4F,EAASrC,QAClC,MAAM,IAAI,qBAAmB1B,KAAM+D,IAI/C,EAAQlF,WAAaA,EACrB,EAAQmD,OAAS,CACbgC,MAAM,EACNC,QAAQ,EACRC,QAAQ,EACRC,aAAa,EACb,YAAY,EACZC,QAAQ,GAEL,MAAMC,EAAgB,CACzBC,OAAQ,EAAQC,eAAe,CAC3BtD,OAAQ,QACRX,KAAM,kFACNQ,MAAO,CAAC,YAAa,QAAS,SAC9BY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKyE,eAAe,CAChBC,aAAiBF,EAAH,6BAI1BG,SAAU,EAAQJ,eAAe,CAC7BtD,OAAQ,QACRX,KAAM,gEACNQ,MAAO,CAAC,YAAa,QAAS,SAC9BY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKyE,eAAe,CAChBC,aAAiBF,EAAH,+BAI1BI,OAAQ,EAAQL,eAAe,CAC3BtD,OAAQ,QACRX,KAAM,iFACNQ,MAAO,CAAC,YAAa,QAAS,SAC9BY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKyE,eAAe,CAChBC,aAAiBF,EAAH,6BAI1BK,SAAU,EAAQN,eAAe,CAC7BtD,OAAQ,QACRX,KAAM,qEACNQ,MAAO,CAAC,YAAa,QAAS,SAC9BY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKyE,eAAe,CAChBC,aAAiBF,EAAH,+BAI1BM,QAAS,EAAQP,eAAe,CAC5BtD,OAAQ,QACRX,KAAM,GACNQ,MAAO,GACPY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKgB,QAAQV,KAAUkE,EAAH,6BAG5BO,WAAY,EAAQR,eAAe,CAC/BtD,OAAQ,QACRX,KAAM,GACNQ,MAAO,CAAC,YAAa,QAAS,SAC9BY,OAAQ,CAAC,MACV,CACC,kBAAkB8C,GACdxE,KAAKyE,eAAe,CAChBC,aAAiBF,EAAH,kCChXvB,MAAM,EAOT,YAAYQ,EAAMC,EAAMC,EAAQC,GAC5BnF,KAAKgF,KAAOA,EACZhF,KAAKiF,KAAOA,EACZjF,KAAKkF,OAASA,EACdlF,KAAKmF,SAAWA,EAIhBnF,KAAKoF,OAAS,EAAUC,MAAMrF,KAAKgF,KAAMhF,KAAKiF,KAAMjF,KAAKkF,OAAQ,IAKjElF,KAAKsF,MAAO,EAYhB,gBAAgBN,EAAMC,EAAMC,EAAQC,GAChC,OAAO,EASX,cAAcH,EAAMC,EAAMC,EAAQC,GAC9B,IAAII,EAAIP,EACJjH,EAAIkH,EACJjH,EAAIkH,EACJM,EAAIL,EAeR,GAdwB,oBAAbM,WACFF,IACDA,EAAIE,SAASC,SACb3H,EAAI8E,OAAO4C,SAASR,YAEdhD,IAANjE,IACAA,EAA0B,WAAtByH,SAASE,WAIrB3H,OAAUiE,IAANjE,KAAqBA,OACfiE,IAANuD,IACAA,EAAI,EAAUI,oBAEM,IAApBL,EAAEpH,QAAQ,KAAa,CACvB,MAAM0H,EAAU,wDAAwDC,KAAKP,GAC7E,IAAIM,EAOA,MAAM,IAAIE,MAAM,2BAA2BR,2BAN3CvH,EAAmB,UAAf6H,EAAQ,GACZN,EAAIM,EAAQ,GAAG3C,QAAQ,UAAW,IAClCnF,EAAI8E,OAAOgD,EAAQ,IACnBL,EAAIK,EAAQ,IAAM,OAMX,cAANN,GAAqB,eAAe7G,KAAK6G,KAE9CA,GAAK,EAAUS,aAEdjI,IACDA,EAAIC,EAAI,IAAM,IAElB,MAAMiI,EAAM,EAAUZ,MAAME,EAAGxH,EAAGC,EAAGwH,GACrC,IAAIU,EAAalG,KAAKmG,YAAYF,GAClC,IAAKC,EAAY,CAEb,IAAK,IAAIjK,EAAI+D,KAAKoG,WAAW/H,OAAS,EAAGpC,GAAK,EAAGA,GAAK,EAAG,CACrD,MAAMoK,EAAuBrG,KAAKoG,WAAWnK,GAC7C,GAAIoK,EAAqBC,UAAYD,EAAqBC,SAASf,EAAGxH,EAAGC,EAAGwH,GAAI,CAC5EU,EAAa,IAAIG,EAAqBd,EAAGxH,EAAGC,EAAGwH,GAC/C,OAGR,IAAKU,EACD,MAAM,IAAIH,MAAM,wDAEpB/F,KAAKmG,YAAYF,GAAOC,EAE5B,OAAOA,EAEX,aAAalB,EAAMC,EAAMC,EAAQC,GAC7B,IAAIoB,GAAOrB,EAAS,WAAa,aAAqC,IAAvBF,EAAK7G,QAAQ,KAAc,IAAI6G,KAAUA,GAGxF,OAFAuB,GAASrB,GAAmB,MAATD,IAAmBC,GAAmB,KAATD,EAAgB,IAAIA,EAAS,GAC7EsB,GAAOpB,EACAoB,EAMX,KAAKC,GACD,IAAIzC,EAAW,CAAErC,OAAQ,EAAGP,QAAS,IACrC,OAAOsF,QAAQC,UACVC,KAAK,IAAM3G,KAAK4G,eAAeJ,IAC/BG,KAAK,IAAM,IAAIF,QAASC,IACzB1G,KAAK6G,OAAOL,EAASA,EAAQxF,QAAS0F,MAErCC,KAAMG,IAAU/C,EAAW+C,IAC3BH,KAAK,IAAM3G,KAAK+G,gBAAgBP,EAASzC,IACzC4C,KAAK,KACNH,EAAQQ,UAAUjD,GACXA,IAENkD,MAAO/I,IAER,MADA6F,EAAS7C,OAAS,KACZ,kBAAgBgG,GAAGhJ,KAOjC,eAAesI,GAEX,IADiBA,EAAQ9D,WACV,CACX,MAAM,KAAEX,GAASyE,EAAQxF,QACZ,SAATe,EACAyE,EAAQ9D,SAAS,kCAEH,SAATX,GACLyE,EAAQ9D,SAAS,4BAIzB,IAAIgB,EACJ,OAFA1D,KAAKmH,SAASX,GAENA,EAAQpF,gBACZ,IAAK,OACDsC,EAAS,mBACT,MACJ,IAAK,OACDA,EAAS,SACT,MACJ,QACIA,EAAS,0CAKjB,GAHK8C,EAAQ9C,UACT8C,EAAQ9C,OAAOA,GAEf1D,KAAKsF,KAAM,CACX,MAAMlC,EAAcoD,EAAQpD,cACxBA,GAA+B,OAAhBA,GAAwC,MAAhBA,GACvCoD,EAAQpD,YAAeA,EAAYgE,MAAM,GAAI,GAAzB,WAG5B,MAAMC,EAAeb,EAAQa,eAC7B,GAA6B,aAAzBb,EAAQxF,QAAQV,KAChB,OAAO+G,EAAaC,SAAStH,KAAKmF,SAAWqB,EAAQxF,QAAQV,MACxDqG,KAAMY,IAEPf,EAAQxF,QAAQV,KAAOiH,EAAWpF,UAAUnC,KAAKmF,SAAS9G,QACtDmI,EAAQnD,iBAERmD,EAAQxF,QAAQV,QAAkD,IAAvCkG,EAAQxF,QAAQV,KAAKnC,QAAQ,KAAc,IAAM,KAApD,OAErBqI,IAGf,GAAIa,EAAc,CACd,MAAM,MAAEG,GAAUH,EACdG,GACAhB,EAAQ7D,OAAO,gBAAiB,OAAO6E,GAG/C,OAAOhB,EAOX,gBAAgBA,EAASzC,GAGrB,IAAIhC,EADJgC,EAASrC,OAA6B,OAApBqC,EAASrC,OAAkB,IAAMqC,EAASrC,OAE5D,MAAMP,EAAU4C,EAAS5C,SAAW,GAE9BD,EAA6B,MAApB6C,EAASrC,OAAiB,KAAOqC,EAAS7C,OACzD,GAAIA,IACAa,EAAOyE,EAAQpF,gBACVW,GAAQgC,EAASrC,QAAU,KAAK,CACjC,MAAM+F,EAActG,EAAQ,iBAAmBA,EAAQ,gBACnDsG,GAAeA,EAAYtJ,QAAQ,qBAAuB,IAC1D4D,EAAO,QAIfZ,EAAQuG,OACRvG,EAAQuG,KAAOvG,EAAQuG,KAAKxE,QAAQ,SAAU,KAElD,MAAMmE,EAAeb,EAAQa,eAC7B,GAAIA,EAAc,CACd,MAAMG,EAAQrG,EAAQ,+BAAiCA,EAAQ,8BAC3DqG,GACAH,EAAaM,OAAOH,GAG5B,OAAO,IAAIf,QAASC,IAChBA,EAAQxF,GAAUlB,KAAK4H,WAAW7D,EAAU7C,EAAQa,MACrD4E,KAAMkB,IACL9D,EAAS7C,OAAS2G,GACgC,IAA9CrB,EAAQxF,QAAQV,KAAKnC,QAAQ,aAAsB0J,IACnD7H,KAAKsF,OAASuC,EAAavC,OAE/BpH,IACA,MAAM,IAAI6H,MAAM,0BAA0BhE,MAAS7D,EAAEsI,cAIjE,EAAUZ,kBAAoB,MAC9B,EAAUI,YAAc,kBAIxB,EAAU8B,iBAAmB,CACzB,6BACA,eACA,cACA,aACA,OACA,gBACA,oBACA,yBAKJ,EAAU1B,WAAa,GAIvB,EAAUD,YAAc,G,mBCtPjB,MAAM,UAAyB,EAKlC,gBAAgBnB,EAAMC,EAAMC,EAAQC,GAChC,MAAiC,oBAAnB4C,eAKlB,OAAOvB,EAASxF,EAASgH,GACrB,GAAuB,UAAnBhH,EAAQC,OAAoB,CACxBjB,KAAKiI,aACLjI,KAAKiI,YAAY,CAAEvG,OAAQ,IAAKP,QAAS,GAAID,OAAQ,iDAEzDgH,aAAaC,WAAW,kBACxB,MAAMC,EAAWC,IACK,mBAAdA,EAAM7K,KAA4BwC,KAAKiI,aAAeI,EAAMC,UAC5DtI,KAAKiI,YAAY1E,KAAKgF,MAAMF,EAAMC,YAS1C,OANAtI,KAAKiI,YAAeO,IAChBR,EAAQQ,GACRN,aAAaC,WAAW,kBACxBM,oBAAoB,UAAWL,GAAS,SAE5CM,iBAAiB,UAAWN,GAAS,GAGzC,MAAMO,EAAM,IAAIZ,eACV9B,EAAMjG,KAAKoF,OAASpF,KAAKmF,SAAWnE,EAAQV,KAClDqI,EAAIC,mBAAqB,KAKrB,GAHID,EAAIvH,cAAmC,IAAnBuH,EAAIE,YAAoBF,EAAIjH,QAAU,MAC1DiH,EAAIvH,aAAe,QAEA,IAAnBuH,EAAIE,WAAkB,CACtB,MAAM9E,EAAW,CACb5C,QAAS,GACTO,OAAQiH,EAAIjH,OACZR,OAAQyH,EAAI5E,UAAY4E,EAAIG,cAEhC,EAAUhB,iBAAiBvG,QAAS/E,IAChCuH,EAAS5C,QAAQ3E,GAAQmM,EAAII,kBAAkBvM,IAAS,KAE5DwL,EAAQjE,KAIZ4E,EAAIK,QAAUxC,EAAQyC,aACtBN,EAAIK,OAAOE,WAAa1C,EAAQyC,YAEpCN,EAAIQ,KAAKnI,EAAQC,OAAQgF,GAAK,GAC9B,MAAM,OAAE/E,GAAWF,GACb,QAAEG,GAAYH,EACdoI,EAAczM,OAAOkH,KAAK1C,GAChC,IAAK,IAAIlF,EAAI,EAAGuE,EAAM4I,EAAY/K,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CACvD,MAAMoN,EAAaD,EAAYnN,GAC/B0M,EAAIW,iBAAiBD,EAAYlI,EAAQkI,IAG7C,OADAV,EAAI1I,gBAAkBuG,EAAQvG,gBACtBuG,EAAQpF,gBACZ,IAAK,cACDuH,EAAIvH,aAAe,cACnB,MACJ,IAAK,OACL,IAAK,WACL,IAAK,SACDuH,EAAIvH,aAAe,OAK3BuH,EAAIY,KAAKrI,GAKb,WAAW6C,EAAU7C,EAAQa,GACzB,GAAa,SAATA,EACA,OAAOwB,KAAKgF,MAAMrH,GAEtB,GAAa,aAATa,GAAgC,WAATA,EAAmB,CAC1C,MAAMyH,EAAS,IAAIC,WAEnB,OADAD,EAAOE,cAAcxI,GACd,IAAIuF,QAAQ,CAACC,EAASiD,KACzBH,EAAOI,OAASlD,EAChB8C,EAAOK,QAAUF,IAClBhD,KAAK,KACJ,IAAI,OAAEmD,GAAWN,EAIjB,MAHa,WAATzH,GAAuC,iBAAX+H,IAC5BA,EAASA,EAAO3H,UAAU2H,EAAO3L,QAAQ,KAAO,IAE7C2L,IAGf,OAAO5I,EAKX,SAASsF,GACL,IAAI,KAAEzE,GAASyE,EAAQxF,QACvB,GAAIe,EAAM,CACN,IAAI,OAAEb,GAAWsF,EAAQxF,QACrB0B,EAAW8D,EAAQ9D,WACvB,OAAQX,GACJ,IAAK,OACDW,EAAWA,GAAYxB,EAAOa,KAC9B,MACJ,IAAK,cACL,IAAK,OACD,MACJ,IAAK,WAAY,CACb,MAAMgI,EAAQ7I,EAAO6I,MAAM,+BACrBC,EAAWD,EAAM,GAKvB,GAHA7I,EAAS6I,EAAM,GACfhI,EAAO,OACPW,EAAWA,GAAYqH,EAAM,IACxBC,EAAU,CACX9I,EAAS+I,mBAAmB/I,GAC5B,OAIR,IAAK,SAAU,CACX,MAAMgJ,EAAY,eAAKhJ,GACjBV,EAAM0J,EAAU7L,OAChB8L,EAAQ,IAAIC,WAAW5J,GAC7B,IAAK,IAAIvE,EAAI,EAAGA,EAAIuE,EAAKvE,GAAK,EAC1BkO,EAAMlO,GAAKiO,EAAUG,WAAWpO,GAEpC8F,EAAO,OACPb,EAAS,IAAIoB,KAAK,CAAC6H,GAAQ,CAAEpI,KAAMW,IACnC,MAEJ,IAAK,OACqB,iBAAXxB,IACPA,EAASqC,KAAKC,UAAUtC,IAE5B,MACJ,IAAK,OACD,MACJ,QACI,MAAM,IAAI6E,MAAM,4BAA4BhE,GAEpDyE,EAAQtF,OAAOA,EAAQa,GAAMW,SAASA,KAIlD,EAAU0D,WAAW3E,KAAK,GCxJnB,MAAM,UAAwB,EACjC,YAAYuD,EAAMC,EAAMC,EAAQC,GAC5BmF,MAAMtF,EAAMC,EAAMC,EAAQC,GAC1BnF,KAAKuK,MAAQ,KACbvK,KAAKwK,WAAY,EACjBxK,KAAKyK,IAAM,EACXzK,KAAK0K,SAAW,GAChB1K,KAAKgH,UAAYhH,KAAKgH,UAAUvJ,KAAKuC,MACrC0I,iBAAiB,UAAW1I,KAAKgH,WAAW,GAShD,gBAAgBhC,EAAMC,EAAMC,GAGxB,GAAwB,oBAAbO,UAAgD,oBAAbkF,SAC1C,OAAO,EAEX,MAAMC,EAAuC,WAAtBnF,SAASE,SAC1BkF,EAAepF,SAASR,OAAS2F,EAAiB,IAAM,IAC9D,OAAOnF,SAASC,WAAaV,GAAQ6F,IAAiB5F,GAAQ2F,IAAmB1F,EAErF,KAAK5E,GACDN,KAAK8K,OAASH,SAASI,cAAc,UACrC/K,KAAK8K,OAAOE,IAAMhL,KAAKoF,OAASpF,KAAKmF,SAAW7E,EAChDN,KAAK8K,OAAOG,aAAa,QAAS,EAAgBC,OAClDP,SAASQ,KAAKC,YAAYpL,KAAK8K,QAC/B9K,KAAKuK,MAAQ,GACbvK,KAAK8K,OAAOpC,iBAAiB,OAAQ1I,KAAKqL,OAAO5N,KAAKuC,OAAO,GAEjE,SACI,IAAKA,KAAKuK,MACN,OAEJ,MAAM,MAAEA,GAAUvK,KAClB,IAAK,IAAI/D,EAAI,EAAGA,EAAIsO,EAAMlM,OAAQpC,GAAK,EACnC+D,KAAKsL,YAAYf,EAAMtO,IAE3B+D,KAAKuK,MAAQ,KAKjB,OAAO/D,EAASxF,EAASgH,GAErB,GAAIxB,EAAQ+E,SAER,YADAjB,MAAMzD,OAAOL,EAASxF,EAASgH,GAG9BhI,KAAK8K,SACN9K,KAAKwL,KAAKhF,EAAQxF,QAAQV,MAG1BkG,EAAQxF,QAAQV,KAAO,YAE3B,MAAMkI,EAAM,CACRiC,IAAKzK,KAAKyK,KAAO,EACjBxJ,OAAQD,EAAQC,OAChBX,KAAMU,EAAQV,KACda,QAASH,EAAQG,QACjBD,OAAQF,EAAQE,OAChBuK,gBAAiB,EAAU3D,kBAE/B9H,KAAK0K,SAASlC,EAAIiC,KAAOzC,EACzB,MAAM0D,EAASnI,KAAKC,UAAUgF,GAC1BxI,KAAKuK,MACLvK,KAAKuK,MAAM9I,KAAKiK,GAGhB1L,KAAKsL,YAAYI,GAEhB1L,KAAKwK,WACNmB,WAAW,KACH3L,KAAK0K,SAASlC,EAAIiC,cACXzK,KAAK0K,SAASlC,EAAIiC,KACzBzC,EAAQ,CACJtG,OAAQ,EACRkK,MAAO,IAAI7F,MAAM,uBACjB5E,QAAS,OAGlB,KAGX,YAAYqH,GACRxI,KAAK8K,OAAOe,cAAcP,YAAY9C,EAAKxI,KAAKoF,QAEpD,UAAUiD,GACN,GAAIA,EAAMjD,SAAWpF,KAAKoF,QAA4B,MAAlBiD,EAAMjG,KAAK,GAC3C,OAEJ,MAAMoG,EAAMjF,KAAKgF,MAAMF,EAAMjG,MACvB4F,EAAUhI,KAAK0K,SAASlC,EAAIiC,KAC9BzC,WACOhI,KAAK0K,SAASlC,EAAIiC,KACzBzK,KAAKwK,WAAY,EACjBxC,EAAQ,CACJtG,OAAQ8G,EAAI9G,OACZP,QAASqH,EAAIrH,QACbD,OAAQsH,EAAItH,WAK5B,EAAgBgK,MAAQ,+DACxB,EAAU9E,WAAW3E,KAAK,G,YClHnB,MAAM,UAAEqK,GAAcC,O,YCGtB,MAAM,EAIT,YAAY9F,GACRjG,KAAKgM,UAAY,GACjBhM,KAAKiM,OAAS,KACdjM,KAAKiG,IAAMA,EAMf,cAAcA,GACV,IAAIiG,EAAYlM,KAAKmM,WAAWlG,GAKhC,OAJKiG,IACDA,EAAY,IAAI,EAAmBjG,GACnCjG,KAAKmM,WAAWlG,GAAOiG,GAEpBA,EAEX,OACI,IAAKlM,KAAKiM,OAAQ,CACd,MAAMA,EAAS,IAAIH,EAAU9L,KAAKiG,KAClC,IAAImG,EACJ,MAAMC,EAA0BT,IAE5B,IAAIU,GAAU,EACVtM,KAAKiM,SAAWG,IAChBE,EAAgC,IAAtBL,EAAOpD,WACjB7I,KAAKiM,OAAS,MAElB,IAAIM,EAAW,KAqBf,GApBA5P,OAAOkH,KAAK7D,KAAKgM,WAAWzK,QAASiL,IACjC,MAAMC,EAAWzM,KAAKgM,UAAUQ,GAEhC,UADOxM,KAAKgM,UAAUQ,GACjBC,EAGL,IACQH,EACAG,EAASb,MAAM,IAAI,qBAAmB,KAAMjP,OAAOkF,OAAO,CAAEH,OAAQ,EAAGP,QAAS,IAAOyK,aAAiB7F,OAAS,CAAE6F,YAGnHa,EAASC,WAGjB,MAAOxO,GACEqO,IACDA,EAAWrO,MAInBqO,EACA,MAAMA,GAGdN,EAAOpC,QAAUwC,EACjBJ,EAAOU,QAAUN,EACjBJ,EAAOW,UAAavE,IAChB,MAAM7B,EAAUjD,KAAKgF,MAAMF,EAAMjG,MACjCoE,EAAQxD,KAAO,IAAI6J,KAAKrG,EAAQxD,MAChC,MAAM,GAAEwJ,GAAOhG,EACf,IAAKgG,EAID,YAHqB,UAAjBhG,EAAQzE,MACRsK,EAAuB7F,IAI/B,MAAMiG,EAAWzM,KAAKgM,UAAUQ,GAC5BC,IACqB,UAAjBjG,EAAQzE,KACR0K,EAASb,MAAM,IAAI,qBAAmB,KAAMpF,IAG5CiG,EAASK,KAAKtG,KAI1B4F,EAAgB,IAAI3F,QAASC,IACzBuF,EAAOc,OAASrG,IACjBC,KAAK,IAAMsF,GACdjM,KAAKiM,OAASG,EAElB,OAAOpM,KAAKiM,OAEhB,QACQjM,KAAKiM,SACLjM,KAAKiM,OAAOtF,KAAMsF,IACdA,EAAOe,UAEXhN,KAAKiM,OAAS,MAQtB,WAAW5E,EAAcmF,GACrB,MAAMtI,EAAS,IAAI,IAAYuI,IAC3B,GAAIzM,KAAKgM,UAAUQ,GACf,MAAM,IAAIzG,MAAM,gDAGpB,OADA/F,KAAKgM,UAAUQ,GAAMC,EACd,KAECzM,KAAKgM,UAAUQ,KAAQC,UAChBzM,KAAKgM,UAAUQ,MAYlC,OARA7P,OAAOkF,OAAOqC,EAAQ,CAClBqF,KAAO/C,IACHxG,KAAKmJ,OAAOxC,KAAMsF,IACd,MAAMgB,EAAc1J,KAAKC,UAAU7G,OAAOkF,OAAOlF,OAAOkF,OAAO,CAAE2K,MAAMhG,GAAWa,EAAaG,OAAS,CAAEA,MAAOH,EAAaG,SAC9HyE,EAAO1C,KAAK0D,QAIjB/I,GAMf,EAAmBiI,WAAa,I,6iBC9HrBe,E,sBACX,SAAWA,GACPA,EAAcA,EAA2B,aAAK,GAAK,cACnDA,EAAcA,EAA0B,WAAI,GAAK,aACjDA,EAAcA,EAAqB,MAAI,GAAK,QAHhD,CAIGA,IAAkBA,EAAgB,KAW9B,MAAM,UAAiB,WAI1B,YAAYnL,GACRuI,QACAtK,KAAKmN,cAAgB,KACrBnN,KAAKoN,WAAa,KAClBpN,KAAKwM,GAAK,KACVxM,KAAKqN,MAAQH,EAAcI,MAC3BtN,KAAKuN,SAAU,EACfvN,KAAKwM,GAAK,KACVxM,KAAKwN,QAAU,KACfxN,KAAK+B,KAAOA,EACZ/B,KAAKsD,IAAM,IAAImK,EAAA,EAEnB,cAAc1L,EAAM2L,GAChB,GAAI3L,EAAK4L,SACL,OAAO,IAAI,EAAS5L,GAExB,GAAIA,EAAK6L,aACL,MAAO,CAAE7L,OAAM2L,KAAI,cAEvB,MAAM,IAAI3H,MAAM,gBAAgBhE,GAOpC,WAAW8L,GAEP,OAAOA,EAAQC,UAKnB,SACI,OAAI9N,KAAKmN,gBAGTnN,KAAKmN,cAAgB,EAAQ,GAAaO,IAF/B1N,KAAKmN,cAQpB,OAAOO,GACH,GAAK1N,KAAKmN,cAIN,MAAM,IAAIpH,MAAM,4BAHhB/F,KAAKmN,cAAgBO,EAU7B,aACI,OAAO1N,KAAK+B,KAAKvF,KAMrB,UACI,IAAKwD,KAAKoN,YAAcpN,KAAKwM,GAAI,CAC7B,MAAMnM,EAAQL,KAAKwM,GAAGuB,YAAY,KAClC/N,KAAKoN,WAAanD,mBAAmBjK,KAAKwM,GAAGrK,UAAU9B,EAAQ,IAEnE,OAAOL,KAAKoN,WAKhB,QAAQlQ,GACJ,MAAM8Q,EAAM,GAAG9Q,EACf,GAAI8C,KAAKwM,GACL,MAAM,IAAIzG,MAAM,8BAEpB/F,KAAKwM,GAAK,OAAOxM,KAAKiO,UAAUrN,mBAAmBoN,KACnDhO,KAAKoN,WAAaY,EAQtB,iBACI,QAAShO,KAAKmN,cAOlB,kBACI,OAAOnN,KAAKqN,MAAQH,EAAcgB,YAOtC,mBACI,OAAOlO,KAAKqN,QAAUH,EAAciB,WAOxC,cACI,OAAOnO,KAAKqN,QAAUH,EAAcI,MAOxC,OAAOc,GACHpO,KAAKuN,QAAUa,EAMnB,4BAA4BxQ,GACxB,GAAIoC,KAAKuN,UAAYvN,KAAKqO,YACtB,MAAM,IAAI,kBAAgB,8BAA8BrO,KAAKwM,MAAM5O,iFAO3E,iBACIoC,KAAKqN,MAAQH,EAAcgB,YAS/B,gBACIlO,KAAKqN,MAAQH,EAAciB,WAM/B,WACInO,KAAKqN,MAAQH,EAAcI,MAM/B,aAEQtN,KAAKqO,cACLrO,KAAKsO,WACLtO,KAAKwN,QAAU,O,YCzL3B,MAAMe,EAAiB,GACvB,IAAIC,EAASD,EACb,IAGIC,EAAS,EAAQ,IAErB,MAAOtQ,IAGA,MAAMuQ,EACT,YAAYjR,EAAK0D,GAIblB,KAAK0O,OAAS,GACd1O,KAAKxC,IAAMA,EACXwC,KAAKkB,OAASA,EAQlB,eAAeyN,EAAaC,GACxB,MAAM/K,EAAO,GACPgL,EAAOF,EAAYG,aACzB,IAAK,IAAIC,EAAKF,EAAK/B,QAASiC,EAAGC,KAAMD,EAAKF,EAAK/B,OAAQ,CACnD,MAAMmC,EAAOF,EAAG7R,MAChB2G,EAAKpC,KAAKwN,EAAKzS,MAGnB,MAAM0S,EAAK,IAAIC,YAAYtL,EAAM+K,GACjC,OAAO,SAAoBQ,GACvB,GAAIZ,IAAWD,EACX,MAAM,IAAIxI,MAAM,+HAEpB,MAAMhG,EAAO8D,EAAKlD,IAAKnE,GAAS4S,EAAO5S,IACvC,OAAO0S,EAAGG,MAAM,GAAItP,IAO5B,YACI,OAAOC,KAAKkB,OAAOlB,KAAKxC,KAM5B,cACI,OAA8B,IAAvBwC,KAAK0O,OAAOrQ,OAEvB,GAAGuN,EAAOsD,GACN,OAAItD,aAAiBuD,SACVnP,KAAKsP,GAAG,KAAM1D,KAEM,IAA3BsD,EAAGlP,KAAK9C,MAAOsR,IACfxO,KAAK0O,OAAOjN,KAAKmK,GAEd5L,MAEX,WAAWiB,EAAQsO,EAAcC,GAC7B,MAAMzP,EAAOyP,GAAgB,GAC7B,IACIzP,EAAK0P,QAAQzP,KAAK0P,kBACuB,IAArClB,EAAOvN,GAAQoO,MAAMrP,KAAMD,IAC3BC,KAAK0O,OAAOjN,KAAK8N,GAAgBtO,GAGzC,MAAO/C,GACH8B,KAAK0O,OAAOjN,KAAK8N,GAAgBrR,EAAEsI,SAEvC,OAAOxG,KAEX,gBACI,MAAM,MAAE9C,GAAU8C,KAClB,MAAqB,iBAAV9C,GAAsBA,aAAiB2P,KACvC3P,EAEJqG,KAAKC,UAAUtG,GAE1B,SACI,MAAO,CACHyS,QAAS3P,KAAK2P,QACdjB,OAAQ1O,KAAK0O,SAIzB,MAAMkB,EAAmB,CAAC,WAAY,SAAU,WAChDjT,OAAOkH,KAAK2K,GAAQjN,QAAS/E,KACrBA,EAAKqT,WAAW,OAASD,EAAiBE,SAAStT,MAEnDiS,EAAU5Q,UAAUrB,GAAQ,YAAqBuD,GAC7C,MAAM6L,EAA2B,iBAAZ7L,EAAK,GAAkBA,EAAKgQ,QAAU,KAC3D,OAAO/P,KAAKgQ,WAAWxT,EAAMoP,EAAO7L,OClGzC,MAAMkQ,EACT,cACIjQ,KAAKkQ,OAAS,GAMlB,cACI,OAAOvT,OAAOkH,KAAK7D,KAAKkQ,QAAQC,MAAO3S,GAAQwC,KAAKkQ,OAAO1S,GAAKmS,SAEpE,SACI,MAAMS,EAAO,GAIb,OAHAzT,OAAOkH,KAAK7D,KAAKkQ,QAAQ3O,QAAS/D,IAC9B4S,EAAK5S,GAAOwC,KAAKkQ,OAAO1S,GAAK6S,WAE1BD,G,kBCVR,MAAM,EAKT,YAAYE,EAAWC,GACnBvQ,KAAKsQ,UAAYA,EACjBtQ,KAAKuQ,qBAAuBA,EAOhC,iBAAiBrB,GACb,IAAKA,EACD,MAAO,GAEX,IAAIsB,EAAMtB,EAAGuB,WAQb,OAPAD,EAAMA,EAAIrO,UAAUqO,EAAIrS,QAAQ,KAAO,EAAGqS,EAAIzC,YAAY,MACpC,OAAlByC,EAAIE,OAAO,KACXF,EAAMA,EAAIrO,UAAU,IAEW,OAA/BqO,EAAIE,OAAOF,EAAInS,OAAS,KACxBmS,EAAMA,EAAIrO,UAAU,EAAGqO,EAAInS,OAAS,IAEjCmS,EAQX,iBAAiBG,EAAWC,GAExB,OAAO,IAAIzB,SAASwB,EAA4CC,GAOpE,cACI,MAAMpI,EAAM,IAAIhC,EAAA,cAChB,OAAOxG,KAAKuQ,qBAAqBhH,KAAKf,GACjC7B,KAAM5C,GAAaA,EAAS7C,QAErC,SAASa,EAAM8O,EAAUC,GAAa,GAClC,MAAM7C,EAAyB,iBAATlM,EAAoBA,EAAOA,EAAKvF,KAChDgM,EAAM,IAAIhC,EAAA,cAAsByH,EAAQ4C,GACzCzP,aAAa,QAClB,OAAOpB,KAAKuQ,qBAAqBhH,KAAKf,GACjC7B,KAAM5C,GAAa/D,KAAK+Q,UAAU9C,EAAQ4C,EAAUC,EAAY/M,EAAS7C,QAAUhD,IACpF,GAAIA,EAAEwD,SAAW,aAAWvC,iBACxB,OAAO,KAEX,MAAMjB,IAGd,SAAS6D,EAAM8O,EAAU3B,GACrB,MAAMjB,EAAyB,iBAATlM,EAAoBA,EAAOA,EAAKvF,KAChDgM,EAAM,IAAIhC,EAAA,cAAsByH,EAAQ4C,GACzC3P,OAAOgO,aAAcC,SAAWnP,KAAKgR,iBAAiB9B,GAAMA,EAAI,QAChE9N,aAAa,QAClB,OAAOpB,KAAKuQ,qBAAqBhH,KAAKf,GACjC7B,KAAM5C,GAAa/D,KAAK+Q,UAAU9C,EAAQ4C,EAAU3B,aAAcC,SAAUpL,EAAS7C,SAU9F,WAAWa,EAAM8O,GACb,MAAM5C,EAAyB,iBAATlM,EAAoBA,EAAOA,EAAKvF,KAChDgM,EAAM,IAAIhC,EAAA,iBAAyByH,EAAQ4C,GACjD,OAAO7Q,KAAKuQ,qBAAqBhH,KAAKf,GACjC7B,KAAK,IAAM3G,KAAK+Q,UAAU9C,EAAQ4C,GAAU,EAAO,OAU5D,UAAU5C,EAAQ4C,EAAUC,EAAYF,GACpC,GAAiB,aAAbC,EAAyB,CACzB,MAAM9O,EAAO/B,KAAKsQ,UAAUpP,OAAO+M,GAEnC,OADAlM,EAAK6M,eAA0B,OAATgC,EAAgB,KAAOnC,EAAUwC,QAAQlP,EAAM6O,GAC9DE,EAAa/O,EAAK6M,eAAiBgC,EAE9C,OAAOA,GAAQE,EAAa9Q,KAAKkR,iBAAiB,CAAC,SAAU,WAAYN,GAAQA,GClGlF,MAAM,EAIT,YAAYzD,GACRnN,KAAKmN,cAAgBA,EAgBzB,IAAIc,EAAQnN,EAAOqQ,EAASC,EAAcC,GACtC,GAAIvQ,aAAiBqO,SACjB,OAAOnP,KAAKlD,IAAImR,EAAQ,GAAInN,EAAOqQ,EAASC,GAEhD,GAAID,aAAmBhC,SACnB,OAAOnP,KAAKlD,IAAImR,EAAQnN,EAAO,GAAIqQ,EAASC,GAEhD,MAAME,EAAMH,GAAW,GACjB3I,EAAM,IAAIhC,EAAA,gBAAwByH,GACnCxJ,eAAe3D,GAAS,IACxBM,aAAakQ,EAAIlQ,cAAgB,MACtC,OAAOpB,KAAKuJ,KAAKf,EAAK4I,EAAcC,GAkBxC,KAAKpD,EAAQ9C,EAAMgG,EAASC,EAAcC,GACtC,GAAuB,mBAAZF,EACP,OAAOnR,KAAKuR,KAAKtD,EAAQ9C,EAAM,GAAIgG,EAASC,GAEhD,MAAME,EAAMH,GAAW,GACjB3I,EAAM,IAAIhC,EAAA,iBAAyByH,GACpC/M,OAAOiK,EAAMmG,EAAIjP,aACjBK,SAAS4O,EAAI5O,UAAY,MACzBtB,aAAakQ,EAAIlQ,cAAgB,MACtC,OAAOpB,KAAKuJ,KAAKf,EAAK4I,EAAcC,GAExC,KAAK7I,EAAK4I,EAAcC,GACpB,OAAOrR,KAAKmN,cAAc5D,KAAKf,GAC1B7B,KAAM5C,GAAaA,EAAS7C,QAC5ByF,KAAKyK,EAAcC,IChEzB,MAAM,EACT,cACIrR,KAAKmN,cAAgB,KACrBnN,KAAKwR,WAAa,EAOtB,cAAcrE,GACV,MAAMsE,EAAQzR,KAAKnC,UACb6T,EAAS,MACX,SAASC,KAAkB5R,GACvB0R,EAAMG,IAAIvC,MAAMsC,EAAgB5R,GAKpC,OAHApD,OAAOkV,oBAAoBJ,GAAOlQ,QAAS/D,IACvCb,OAAOC,eAAe+U,EAAgBnU,EAAKb,OAAOmV,yBAAyBL,EAAOjU,MAE/EmU,GAPI,GAUf,OADAD,EAAOK,KAAK5E,GACLuE,EAQX,YACI,OAAO,EAAOM,OAAOhS,KAAKwR,YAM9B,UAAUtU,GACN,MAAMmD,EAAQ,EAAO2R,OAAO7T,QAAQjB,GACpC,IAAe,IAAXmD,EACA,MAAM,IAAI0F,MAAM,yBAAyB7I,GAE7C8C,KAAKwR,WAAanR,EAEtB,OAAON,GACH,MAAMkS,GAA4C,IAApC,EAAOD,OAAO7T,QAAQ4B,EAAK,IAAa,OAASA,EAAKgQ,QACpE,GAAI/P,KAAKwR,WAAa,EAAOQ,OAAO7T,QAAQ8T,GACxC,OAAOxL,QAAQC,QAAQ,MAE3B,IAAIF,EAA6B,iBAAZzG,EAAK,GAAkBC,KAAKkS,OAAOnS,EAAKgQ,QAAShQ,GAAQ,eAC1EqC,EAAO,KACX,GAAIrC,EAAK1B,OAAQ,CACb,MAAM0C,EAAMhB,EAAKoS,MAKjB,GAJA/P,EAAOrB,GACY,iBAARA,GAAoBqR,MAAMC,QAAQtR,MACzCqB,EAAO,CAAEA,KAAMrB,IAEfA,aAAegF,MAAO,CAEtB,MAAM,MAENuM,EAAOlQ,KAAMmQ,EAAO/L,QAASgM,EAAQ,KAAEhW,EAAI,OAAEkF,GAAYX,EACzDqB,EAAO,CACH5F,OACAgK,QAASgM,EACTF,QACA5Q,SACAU,KAAMmQ,IAOlB,OAHIxS,EAAK1B,SACLmI,GAAW,KAAKzG,EAAKc,KAAK,OAEvBb,KAAKyS,QAAQ9V,OAAOkF,OAAO,CAAEmB,MAAM,IAAI6J,MAAO6F,cAAelM,UAChEyL,QACA7P,QAASpC,KAAKmN,cAAcwF,IAAM,CAAEC,KAAM5S,KAAKmN,cAAcwF,GAAGnG,MAExE,OAAOhG,EAASzG,GACZ,GAAoB,IAAhBA,EAAK1B,OACL,OAAOmI,EAyBX,OAvBYqM,OAAOrM,GAAStD,QAAQ,EAAO4P,cAAgBC,IACvD,GAAU,OAANA,EACA,MAAO,IAEX,IAAKhT,EAAK1B,OACN,OAAO0U,EAEX,OAAQA,GACJ,IAAK,KACD,OAAOF,OAAO9S,EAAKgQ,SACvB,IAAK,KACD,OAAO8C,OAAOhQ,OAAO9C,EAAKgQ,UAC9B,IAAK,KACD,IACI,OAAOxM,KAAKC,UAAUzD,EAAKgQ,SAE/B,MAAOiD,GACH,MAAO,aAEf,QACI,OAAOD,KAKvB,KAAK5F,GACDnN,KAAKmN,cAAgBA,EACrBnN,KAAKwR,WAAa,EAClB,EAAOQ,OAAOzQ,QAAS0Q,IACnBjS,KAAKiS,GAASjS,KAAK4R,IAAInU,KAAKuC,KAAMiS,KAG1C,QAAQ7B,GACJ,OAAKpQ,KAAKmN,cAAc8F,QAGjBjT,KAAKmN,cAAc5D,KAAK,IAAI,eAAiB,cAAe6G,IAFxDpQ,KAAKmN,cAAc+F,MAAMlT,KAAKyS,QAAQhV,KAAKuC,KAAMoQ,KAKpE,EAAO4B,OAAS,CAAC,QAAS,QAAS,OAAQ,OAAQ,SACnD,EAAOc,cAAgB,W,WC1HhB,MAAM,EAYT,YAAYK,EAAS3M,EAAS4M,EAASjC,EAASkC,EAAOjR,GACnD,MAAMkR,EAA0B,iBAAZnC,EAAuB,CAAEoC,MAAOpC,EAASkC,QAAOjR,QAAU+O,GAAW,GACzFnR,KAAKmT,QAAU,EAAYK,YAAYL,GACvCnT,KAAKwG,QAAUA,EACfxG,KAAKoT,QAAUA,EACfzW,OAAOkF,OAAO7B,KAAMsT,GAOxB,mBAAmBH,GACf,GAAIA,aAAmBM,IACnB,OAAON,EAEX,GAAIA,aAAmB,SACnB,OAAO,IAAIM,IAAI,CAACN,IAEpB,IAAKA,GAAWA,EAAQnW,OAAO0W,UAC3B,OAAO,IAAID,IAAIN,GAEnB,MAAM,IAAIpN,MAAM,uDAOpB,UAAU4N,GACN3T,KAAKmT,QAAQS,IAAID,GAMrB,SACI,IAAK3T,KAAKmT,UAAYnT,KAAKmT,QAAQU,KAC/B,MAAM,IAAI9N,MAAM,4BAEpB,OAAOpJ,OAAOkF,OAAO,GAAI7B,KAAM,CAC3BmT,QAASf,MAAM0B,KAAK9T,KAAKmT,QAAUQ,GAAWA,EAAOnH,OCxD1D,MAAMuH,EAMT,YAAY3O,EAAQoC,EAAOwM,GACvBhU,KAAKiU,UAAYzM,EAAQuM,EAAaxL,MAAMf,GAAS,KACrDxH,KAAKoF,OAASA,EACdpF,KAAKgU,YAAcA,EAOvB,aAAaxM,GACT,MAAO,CACHwG,IAAKxG,EACL0M,UAAiD,IAAtCC,SAAS3M,EAAMrF,UAAU,EAAG,GAAI,IAC3CiS,SAAiD,IAAvCD,SAAS3M,EAAMrF,UAAU,EAAG,IAAK,IAC3CkS,IAAK7M,EAAMrF,UAAUqF,EAAMnJ,OAAS,IACpC+D,KAAMoF,EAAMrF,UAAU,EAAGqF,EAAMnJ,OAAS,KAOhD,YACI,OAAO2B,KAAKiU,UAAYjU,KAAKiU,UAAUjG,IAAM,KAEjD,cAAc5I,GACV,OAAOqB,QAAQC,QAAQ,IAAIqN,EAAa3O,IAS5C,UAAUA,EAAQoC,EAAOwM,GAEjBhU,KAAKsU,aAAeP,EAAalW,UAAUyW,aAE3CC,QAAQ3C,IAAI,4DAEZ5R,KAAKsU,WAAWlP,EAAQoC,EAAOwM,IAavC,WAAW5O,EAAQoC,EAAOwM,IAK1B,OAAOxM,GACH,MAAMrK,EAAIqK,EAAQuM,EAAaxL,MAAMf,GAAS,KAC1CxH,KAAKiU,WAAa9W,GAAK6C,KAAKiU,UAAUG,SAAWjX,EAAEiX,WAIvDpU,KAAKiU,UAAY9W,EACjB6C,KAAKwU,UAAUxU,KAAKoF,OAAQoC,EAAOxH,KAAKgU,YAS5C,SAASS,EAAUC,GAAO,GACtB,MAAM,UAAET,GAAcjU,KAChB8J,EAASrD,QAAQC,QAAQ+N,EAAS/T,MAAM,KAAKC,IAAIC,oBAAoBC,KAAK,MAChF,OAAKoT,GAAcS,EAGZ5K,EAAOnD,KAAMrG,GAASyT,EAAaY,KAAKrU,EAAO2T,EAAU7R,KAAM6R,EAAUI,KAC3E1N,KAAMiO,GAAS,GAAGtU,SAAY2T,EAAU7R,KAAOwS,MAC/C3N,MAAO/I,IAERqW,QAAQM,KAAK,+HAAiI3W,GACvI4L,IAPAA,GAWnBiK,EAAaY,KAAO,OCjGb,MAAM,UAAsBZ,EAO/B,cAAc3O,GACV,OAAOqB,QAAQC,QAAQ,IAAI,EAActB,EAAQ,EAAc0P,OAAO1P,KAK1E,UAAUA,EAAQoC,EAAOwM,GAChBA,IACGxM,EACA,EAAcsN,OAAO1P,GAAUoC,SAGxB,EAAcsN,OAAO1P,KAK5C,EAAc0P,OAAS,GACvBf,EAAagB,OAAS,ECtBf,MAAM,UAAmBhB,EAC5B,qBACI,IAEI,MAA4B,oBAAjB7L,eAGXA,aAAa8M,QAAQ,qBAAsB,MAC3C9M,aAAaC,WAAW,uBACjB,GAEX,MAAOjK,GACH,OAAO,GASf,cAAckH,GACV,IAAI4O,GAAY,EACZxM,EAAQU,aAAa+M,QAAQ,OAAO7P,GAKxC,OAJKoC,GAAmC,oBAAnB0N,iBACjB1N,EAAQ0N,eAAeD,QAAQ,OAAO7P,GACtC4O,IAAcxM,GAEXf,QAAQC,QAAQ,IAAI,EAAWtB,EAAQoC,EAAOwM,IAKzD,UAAU5O,EAAQoC,EAAOwM,GACrB,MAAMmB,EAAanB,EAAYkB,eAAiBhN,aAC5CV,EACA2N,EAAWH,QAAQ,OAAO5P,EAAUoC,GAGpC2N,EAAWhN,WAAW,OAAO/C,IAIrC,EAAWiJ,gBACX0F,EAAaqB,YAAc,I,6BChD/B,o8IAGO,MAAMC,EAAmB,UAAQ9X,OAAO,CAC3C0D,OAAQ,MACRX,KAAM,IACNoB,OAAQ,CAAC,OAEA4T,EAAa,UAAQ/X,OAAO,CACrC0D,OAAQ,MACRX,KAAM,WACNoB,OAAQ,CAAC,OAEA6T,EAAgB,UAAQhY,OAAO,CACxC0D,OAAQ,MACRX,KAAM,QACNoB,OAAQ,CAAC,OAEA8T,EAAiB,UAAQjY,OAAO,CACzC0D,OAAQ,MACRX,KAAM,2BACNoB,OAAQ,CAAC,OAEA+T,EAA4B,UAAQlY,OAAO,CACpD0D,OAAQ,MACRX,KAAM,2BACNoB,OAAQ,CAAC,OAEAgU,EAAoB,UAAQnY,OAAO,CAC5C0D,OAAQ,SACRX,KAAM,0BACNoB,OAAQ,CAAC,OAEAiU,EAAmB,UAAQpY,OAAO,CAC3C0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAkU,EAAsB,UAAQrY,OAAO,CAC9C0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,CAAC,IAAK,OAELmU,EAAU,UAAQtY,OAAO,CAClC0D,OAAQ,MACRX,KAAM,WACNoB,OAAQ,CAAC,OAEAoU,EAAS,UAAQvY,OAAO,CACjC0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAqU,EAAY,UAAQxY,OAAO,CACpC0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEAsU,EAAW,UAAQzY,OAAO,CACnC0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEAuU,EAAS,UAAQ1Y,OAAO,CACjC0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,KAECwU,EAAQ,UAAQ3Y,OAAO,CAChC0D,OAAQ,SACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAyU,EAAU,UAAQ5Y,OAAO,CAClC0D,OAAQ,SACRX,KAAM,cACNoB,OAAQ,CAAC,OAEA0U,EAAiB,UAAQ7Y,OAAO,CACzC0D,OAAQ,MACRX,KAAM,MACNoB,OAAQ,CAAC,OAEA2U,EAAe,UAAQ9Y,OAAO,CACvC0D,OAAQ,MACRX,KAAM,mCACNoB,OAAQ,CAAC,OAEA4U,EAAe,UAAQ/Y,OAAO,CACvC0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEA6U,EAAe,UAAQhZ,OAAO,CACvC0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEA8U,EAAiB,UAAQjZ,OAAO,CACzC0D,OAAQ,SACRX,KAAM,cACNoB,OAAQ,CAAC,OAEA+U,EAAe,UAAQlZ,OAAO,CACvC0D,OAAQ,OACRX,KAAM,cACNoB,OAAQ,CAAC,IAAK,OAELgV,EAAY,UAAQnZ,OAAO,CACpC0D,OAAQ,MACRX,KAAM,mBACNoB,OAAQ,CAAC,IAAK,OAELiV,EAAgB,UAAQpZ,OAAO,CACxC0D,OAAQ,MACRX,KAAM,mBACNoB,OAAQ,CAAC,IAAK,OAELkV,EAAe,UAAQrZ,OAAO,CACvC0D,OAAQ,SACRX,KAAM,mBACNoB,OAAQ,CAAC,IAAK,OAELmV,EAAgB,UAAQtZ,OAAO,CACxC0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAoV,EAAmB,UAAQvZ,OAAO,CAC3C0D,OAAQ,OACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAqV,EAAoB,UAAQxZ,OAAO,CAC5C0D,OAAQ,MACRX,KAAM,UACNoB,OAAQ,CAAC,OAEAsV,EAAY,UAAQzZ,OAAO,CACpC0D,OAAQ,MACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEAuV,EAAe,UAAQ1Z,OAAO,CACvC0D,OAAQ,OACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEAwV,EAAgB,UAAQ3Z,OAAO,CACxC0D,OAAQ,MACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEAyV,EAAe,UAAQ5Z,OAAO,CACvC0D,OAAQ,SACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEA0V,EAAa,UAAQ7Z,OAAO,CACrC0D,OAAQ,MACRX,KAAM,4DACNoB,OAAQ,CAAC,OAEA2V,EAAiB,UAAQ9Z,OAAO,CACzC0D,OAAQ,OACRX,KAAM,2CACNoB,OAAQ,CAAC,OAEA4V,EAAkB,UAAQ/Z,OAAO,CAC1C0D,OAAQ,MACRX,KAAM,sBACNoB,OAAQ,CAAC,OAEA6V,EAAsB,UAAQha,OAAO,CAC9C0D,OAAQ,OACRX,KAAM,oBACNoB,OAAQ,CAAC,OAEA8V,EAAqB,UAAQja,OAAO,CAC7C0D,OAAQ,MACRX,KAAM,SACNoB,OAAQ,CAAC,OAEA+V,EAAc,UAAQla,OAAO,CACtC0D,OAAQ,OACRX,KAAM,SACNoB,OAAQ,CAAC,OAEAgW,EAAyB,UAAQna,OAAO,CACjD0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEAiW,EAAe,UAAQpa,OAAO,CACvC0D,OAAQ,MACRX,KAAM,qBACNoB,OAAQ,CAAC,OAEAkW,EAAW,UAAQra,OAAO,CACnC0D,OAAQ,MACRX,KAAM,sCACNoB,OAAQ,CAAC,OAEAmW,EAAqB,UAAQta,OAAO,CAC7C0D,OAAQ,MACRX,KAAM,yBACNoB,OAAQ,CAAC,OAEAoW,EAAiB,UAAQva,OAAO,CACzC0D,OAAQ,OACRX,KAAM,eACNoB,OAAQ,CAAC,OAEAqW,EAAoB,UAAQxa,OAAO,CAC5C0D,OAAQ,MACRX,KAAM,8BACNoB,OAAQ,CAAC,OAEAsW,EAAkB,UAAQza,OAAO,CAC1C0D,OAAQ,OACRX,KAAM,mBACNoB,OAAQ,CAAC,OAEAuW,EAAc,UAAQ1a,OAAO,CACtC0D,OAAQ,OACRX,KAAM,0BACNoB,OAAQ,CAAC,OAEAwW,EAAQ,UAAQ3a,OAAO,CAChC0D,OAAQ,OACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAyW,EAAW,UAAQ5a,OAAO,CACnC0D,OAAQ,OACRX,KAAM,oBACNoB,OAAQ,CAAC,IAAK,OAEL0W,EAAK,UAAQ7a,OAAO,CAC7B0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,OAEA2W,EAAe,UAAQ9a,OAAO,CACvC0D,OAAQ,MACRX,KAAM,oBACNoB,OAAQ,CAAC,OAEA4W,EAAS,UAAQ/a,OAAO,CACjC0D,OAAQ,MACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEA6W,GAAc,UAAQhb,OAAO,CACtC0D,OAAQ,OACRX,KAAM,oBACNoB,OAAQ,CAAC,OAEA8W,GAAgB,UAAQjb,OAAO,CACxC0D,OAAQ,OACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEA+W,GAAS,UAAQlb,OAAO,CACjC0D,OAAQ,MACRX,KAAM,yBACNoB,OAAQ,CAAC,OAEAgX,GAAiB,UAAQnb,OAAO,CACzC0D,OAAQ,OACRX,KAAM,0BACNoB,OAAQ,CAAC,OAEAiX,GAAiB,UAAQpb,OAAO,CACzC0D,OAAQ,MACRX,KAAM,iCACNoB,OAAQ,CAAC,OAEAkX,GAAS,UAAQrb,OAAO,CACjC0D,OAAQ,MACRX,KAAM,wFACNoB,OAAQ,CAAC,OAEAmX,GAAS,UAAQtb,OAAO,CACjC0D,OAAQ,MACRX,KAAM,4BACNoB,OAAQ,CAAC,OAEAoX,GAAY,UAAQvb,OAAO,CACpC0D,OAAQ,OACRX,KAAM,sBACNoB,OAAQ,CAAC,OAEAqX,GAAkB,UAAQxb,OAAO,CAC1C0D,OAAQ,SACRX,KAAM,sBACNoB,OAAQ,CAAC,OAEAsX,GAAgB,UAAQzb,OAAO,CACxC0D,OAAQ,MACRX,KAAM,sBACNoB,OAAQ,CAAC,OAEAuX,GAAgB,UAAQ1b,OAAO,CACxC0D,OAAQ,MACRX,KAAM,sBACNoB,OAAQ,CAAC,IAAK,OAELwX,GAAmB,UAAQ3b,OAAO,CAC3C0D,OAAQ,SACRX,KAAM,sBACNoB,OAAQ,CAAC,IAAK,OAELyX,GAAmB,UAAQ5b,OAAO,CAC3C0D,OAAQ,OACRX,KAAM,gBACNoB,OAAQ,CAAC,IAAK,OAEL0X,GAAkB,UAAQ7b,OAAO,CAC1C0D,OAAQ,MACRX,KAAM,gBACNoB,OAAQ,CAAC,IAAK,OAEL2X,GAAgB,UAAQ9b,OAAO,CACxC0D,OAAQ,MACRX,KAAM,QACNoB,OAAQ,CAAC,OAEA4X,GAAY,UAAQ/b,OAAO,CACpC0D,OAAQ,MACRX,KAAM,sDACNoB,OAAQ,CAAC,OAEA6X,GAAc,UAAQhc,OAAO,CACtC0D,OAAQ,MACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEA8X,GAAkB,UAAQjc,OAAO,CAC1C0D,OAAQ,MACRX,KAAM,QACNoB,OAAQ,CAAC,OAEA+X,GAAqB,UAAQlc,OAAO,CAC7C0D,OAAQ,OACRX,KAAM,QACNoB,OAAQ,CAAC,OAEAgY,GAAwB,UAAQnc,OAAO,CAChD0D,OAAQ,MACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEAiY,GAAwB,UAAQpc,OAAO,CAChD0D,OAAQ,MACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEAkY,GAAmB,UAAQrc,OAAO,CAC3C0D,OAAQ,SACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEAmY,GAAa,UAAQtc,OAAO,CACrC0D,OAAQ,OACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEAoY,GAAe,UAAQvc,OAAO,CACvC0D,OAAQ,MACRX,KAAM,qBACNoB,OAAQ,CAAC,IAAK,OAELqY,GAAa,UAAQxc,OAAO,CACrC0D,OAAQ,MACRX,KAAM,qBACNoB,OAAQ,CAAC,OAEAsY,GAAkB,UAAQzc,OAAO,CAC1C0D,OAAQ,OACRX,KAAM,qBACNoB,OAAQ,CAAC,OAEAuY,GAAqB,UAAQ1c,OAAO,CAC7C0D,OAAQ,OACRX,KAAM,qBACNoB,OAAQ,CAAC,OAEAwY,GAAa,UAAQ3c,OAAO,CACrC0D,OAAQ,SACRX,KAAM,qBACNoB,OAAQ,CAAC,IAAK,OAELyY,GAAiB,UAAQ5c,OAAO,CACzC0D,OAAQ,OACRX,KAAM,gBACNoB,OAAQ,CAAC,OAEA0Y,GAAgB,UAAQ7c,OAAO,CACxC0D,OAAQ,MACRX,KAAM,cACNoB,OAAQ,CAAC,IAAK,OAEL2Y,GAAmB,UAAQ9c,OAAO,CAC3C0D,OAAQ,OACRX,KAAM,oBACNoB,OAAQ,CAAC,OAEA4Y,GAAwB,UAAQ/c,OAAO,CAChD0D,OAAQ,MACRX,KAAM,wBACNoB,OAAQ,CAAC,IAAK,OAEL6Y,GAAqB,UAAQhd,OAAO,CAC7C0D,OAAQ,SACRX,KAAM,wBACNoB,OAAQ,CAAC,OAEA8Y,GAA2B,UAAQjd,OAAO,CACnD0D,OAAQ,MACRX,KAAM,2BACNoB,OAAQ,CAAC,OAEA+Y,GAAgB,UAAQld,OAAO,CACxC0D,OAAQ,OACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAgZ,GAAc,UAAQnd,OAAO,CACtC0D,OAAQ,MACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAiZ,GAAkB,UAAQpd,OAAO,CAC1C0D,OAAQ,OACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAkZ,GAAiB,UAAQrd,OAAO,CACzC0D,OAAQ,SACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAmZ,GAAiB,UAAQtd,OAAO,CACzC0D,OAAQ,OACRX,KAAM,sBACNoB,OAAQ,CAAC,OAEAoZ,GAAa,UAAQvd,OAAO,CACrC0D,OAAQ,OACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEAqZ,GAAmB,UAAQxd,OAAO,CAC3C0D,OAAQ,MACRX,KAAM,wBACNoB,OAAQ,CAAC,OAEAsZ,GAAY,UAAQzd,OAAO,CACpC0D,OAAQ,OACRX,KAAM,oBACNoB,OAAQ,CAAC,OAEAuZ,GAAiB,UAAQ1d,OAAO,CACzC0D,OAAQ,MACRX,KAAM,yBACNoB,OAAQ,CAAC,OAEAwZ,GAAU,UAAQ3d,OAAO,CAClC0D,OAAQ,OACRX,KAAM,iBACNoB,OAAQ,CAAC,OAEAyZ,GAAwB,UAAQ5d,OAAO,CAChD0D,OAAQ,OACRX,KAAM,mBACNoB,OAAQ,CAAC,OAEA0Z,GAAU,UAAQ7d,OAAO,CAClC0D,OAAQ,MACRX,KAAM,eACNoB,OAAQ,CAAC,OAEA2Z,GAAK,UAAQ9d,OAAO,CAC7B0D,OAAQ,MACRX,KAAM,kBACNoB,OAAQ,CAAC,OAEA4Z,GAAS,UAAQ/d,OAAO,CACjC0D,OAAQ,OACRX,KAAM,UACNoB,OAAQ,CAAC,Q,2mBC3eN,MAAM6Z,EAMT,SAAS5d,EAAQ6d,GACb,OAAO7d,EAAO6d,EAAUhf,MAO5B,SAASmB,EAAQ6d,EAAWte,GAExBS,EAAO6d,EAAUhf,MAAQU,GChBjC,MAAMue,EAAYze,OAAO,YACnB0e,EAAc1e,OAAO,cACpB,MAAM2e,EAKT,YAAYC,GACR,OAAO,cAAoBA,IAO/B,qBAAqBC,GACjB,OAAOA,EAAgBH,GAM3B,qBAAqBG,GACjB,OAAOA,EAAgBJ,GAM3B,qBAAqBI,EAAiBC,GAClCD,EAAgBJ,GAAaK,EAMjC,QAAQ/Z,EAAM8Z,GACV,GAAIA,EAAgBH,KAAiB3Z,EAArC,CAGA,GAAIpF,OAAOkB,UAAUC,eAAe1B,KAAKyf,EAAiBH,GACtD,MAAM,IAAI3V,MAAM,+CAEpB8V,EAAgBH,GAAe3Z,EAC/B4Z,EAASI,cAAcF,EAAiB9Z,EAAKia,KAC7Chc,KAAKic,iBAAiBJ,EAAgBhe,UAAWkE,IAOrD,iBAAiB0P,EAAO1P,GAChBA,EAAK6L,eAGL6D,EAAMhB,WAAa9T,OAAOkB,UAAU4S,UAEpC9T,OAAOC,eAAe6U,EAAO,WAAY,CACrCvU,MAAO,WACH,OAAO8C,KAAK8N,UAAUtB,IAAMxM,KAAK8N,UAAUG,QAE/CpR,YAAY,IAIhBkF,EAAKma,WAAqC,WAAxBna,EAAKma,UAAU1f,MACjCuF,EAAKma,UAAUC,mBAAmB5a,QAAS0N,IAClCA,EAAKmN,YACNpc,KAAKqc,gBAAgB5K,EAAOxC,KAKxClN,EAAKoa,mBAAmB5a,QAAS0N,IAC7BjP,KAAKqc,gBAAgB5K,EAAOxC,MAOpC,gBAAgBwC,EAAO+J,GACnB,MAAM,KAAEhf,GAASgf,EACjB7e,OAAOC,eAAe6U,EAAOjV,EAAM,CAC/B,MAEI,OADAwD,KAAK8N,UAAUwO,4BAA4B9f,GACpC,MAEX,IAAIU,GACA8C,KAAK8N,UAAUwO,4BAA4B9f,GAC3CG,OAAOC,eAAeoD,KAAMxD,EAAM,CAC9BU,QACAqf,UAAU,EACV1f,YAAY,EACZ2f,cAAc,KAGtBA,cAAc,EACd3f,YAAY,KClGjB,MAAM4f,EACT,cACIzc,KAAK+B,KAAO,KACZ/B,KAAKnC,UAAY,KAErB,cAAc6e,EAAQjL,GACdA,IAAUgL,EAAQ5e,WAClBmC,KAAK2c,OAAOD,EAAQ/f,OAAOigB,eAAenL,IAE9C,MAAMoL,EAAalgB,OAAOkV,oBAAoBJ,GAC9C,IAAK,IAAIqL,EAAI,EAAGtc,EAAMqc,EAAWxe,OAAQye,EAAItc,EAAKsc,GAAK,EAAG,CACtD,MAAMC,EAAOF,EAAWC,GACxBngB,OAAOC,eAAe8f,EAAQK,EAAMpgB,OAAOmV,yBAAyBL,EAAOsL,IAE/E,OAAOL,EAOX,qBAAqB3a,GAEjB,MAAMib,EAAUP,EAAQE,QAAO,YAAgC5c,GAC3D,OAAOid,EAAQC,YAAYld,KAC3BC,KAAKnC,WAIT,OAFAmf,EAAQnf,UAAYkE,EAAKlE,UACzBmf,EAAQjb,KAAOA,EACRib,EAQX,OAAOjd,GACH,OAAOC,KAAKid,YAAYld,GAQ5B,YAAYA,GACR,IAAKA,GAAwB,IAAhBA,EAAK1B,OAEd,OAAO,IAAI2B,KAAK+B,KAKpB,MAAMmb,EAAI,CAAC,MACX9K,MAAMvU,UAAU4D,KAAK4N,MAAM6N,EAAGnd,GAG9B,OAAO,IAFmBoP,SAAStR,UAAUJ,KAAK4R,MAAMrP,KAAK+B,KAAMmb,K,ICxDhEC,E,OCCJ,MAAM,UAAuBV,EAChC,cACInS,SAAS8S,WAMTpd,KAAKqd,QAAU,KAIfrd,KAAK2O,YAAc,KAInB3O,KAAK0N,GAAK,KAOd,cAAciB,EAAajB,GACvB,MAAMsP,EAAUhd,KAAKsd,cAAc3O,EAAYkN,iBAI/C,OAHAmB,EAAQK,QAAUL,EAAQnf,UAC1Bmf,EAAQrO,YAAcA,EACtBqO,EAAQtP,GAAKA,EACNsP,EAOX,SAAS5M,GACL,MAAMmN,EAAWvd,KAAKid,cACtB,OAAOjd,KAAK2O,YAAY6O,cAAc,WAASjgB,OAAOyC,KAAK2O,YAAa3O,KAAK0N,IAAK0C,EAAMmN,EAAU,CAC9FE,YAAY,IAQpB,WAAWJ,GACP1gB,OAAOkF,OAAO7B,KAAKqd,QAASA,GAQhC,UAAU7gB,EAAM0S,GACZlP,KAAKqd,QAAQ7gB,GAAQ0S,GCxDtB,MAAM,UAAsB,EAQ/B,YAAYnP,GACR,MAAMwd,EAAWjT,MAAM2S,YAAYld,GAEnC,OADA,WAASjD,IAAIygB,GAAU7P,GAAK1N,KAAK0N,GAC1B6P,EAeX,KAAK/Q,EAAI2E,EAASC,EAAcC,GAC5B,MAAuB,mBAAZF,EACAnR,KAAKwL,KAAKgB,EAAI,GAAI2E,EAASC,GAE/BpR,KAAK0N,GAAGlC,KAAKxL,KAAK2O,YAAYkN,gBAAiBrP,EAAI2E,GAASxK,KAAKyK,EAAcC,GAO1F,IAAI7E,GACA,OAAOxM,KAAK0N,GAAGgQ,aAAa1d,KAAK2O,YAAYqN,IAAKxP,GAOtD,SAAS4D,GACL,MAAMuN,EAAM3d,KAAK0N,GAAGgQ,aAAa1d,KAAK2O,YAAYqN,IAAK5L,EAAK5D,IAC5D,OAAOxM,KAAK2O,YAAY6O,cAAc,WAAS1gB,IAAI6gB,GAAMvN,EAAMuN,EAAK,CAAEF,YAAY,IAMtF,OACI,OAAOzd,KAAK0N,GAAGkQ,mBAAmB5d,KAAK2O,YAAYkN,iBAQvD,cAAcrP,EAAIqR,GACd,OAAO7d,KAAKgc,IAAIxP,GAAIqR,cAAcA,KF/D1C,SAAWV,GAIPA,EAAYA,EAAsB,UAAK,GAAK,WAI5CA,EAAYA,EAA2B,cAAI,GAAK,gBAIhDA,EAAYA,EAA2B,cAAI,GAAK,gBAZpD,CAaGA,IAAgBA,EAAc,KAI1B,MAAM,UAAoB,EAC7B,kBACI,OAAOA,EAKX,SACI,OAAOnd,KAAK0N,GAAGiF,GAYnB,SAASC,EAAMkL,EAAUC,EAAa3M,EAAcC,GAChD,GAAI0M,aAAuB5O,SACvB,OAAOnP,KAAKge,SAASpL,EAAMkL,GAAU,EAAMC,EAAa3M,GAE5D,MAAM6M,EAA0B,iBAATrL,EAAoB5S,KAAKke,SAAS,CAAEC,SAAUvL,IAAUA,EAC/E,OAAO5S,KAAK0N,GAAGsQ,SAASC,EAASH,OAA0B7b,IAAhB8b,GAAmCA,GACzEpX,KAAKyK,EAAcC,GAY5B,MAAM8M,EAAUL,EAAUC,EAAa3M,EAAcC,GACjD,OAAI0M,aAAuB5O,SAChBnP,KAAKoe,MAAMD,EAAUL,GAAU,EAAMC,EAAa3M,GAEtDpR,KAAK0N,GAAG0Q,MAAMD,EAAUL,OAA0B7b,IAAhB8b,GAAmCA,GACvEpX,KAAKyK,EAAcC,GAW5B,eAAe7J,EAAOuW,EAAa3M,EAAcC,GAC7C,OAAI0M,aAAuB5O,SAChBnP,KAAKqe,eAAe7W,GAAO,EAAMuW,EAAa3M,IAEzDpR,KAAK0N,GAAGlG,MAAQA,EACTxH,KAAK0N,GAAG4Q,MAAMP,GAAapX,KAAKyK,EAAcC,IAQzD,OAAOD,EAAcC,GACjB,OAAOrR,KAAK0N,GAAG6Q,SAAS5X,KAAKyK,EAAcC,GAE/C,eAAetR,GAEX,GAAuB,iBAAZA,EAAK,GAAiB,CAC7B,MAAOoe,EAAUL,EAAUU,EAAapN,EAAcC,GAAgBtR,EACtE,OAAOC,KAAK0N,GAAG8Q,YAAYL,EAAUL,EAAUU,GAAa7X,KAAKyK,EAAcC,GAGnF,IAAK7J,EAAOgX,EAAaT,EAAa3M,EAAcC,GAAgBtR,EAMpE,OALIge,aAAuB5O,WACvBkC,EAAeD,EACfA,EAAe2M,EACfA,GAAc,GAEX/d,KAAK0N,GAAG+Q,qBAAqBjX,EAAOgX,EAAaT,GAAapX,KAAKyK,EAAcC,GAY5F,cAAc8M,EAAU/M,EAAcC,GAClC,OAAOrR,KAAK0N,GAAGgR,cAAcP,GAAUxX,KAAKyK,EAAcC,GAe9D,eAAe8M,EAAUQ,EAAab,EAAU1M,EAAcC,GAC1D,OAAOrR,KAAK0N,GAAGkR,eAAeT,EAAUQ,EAAab,GAAUnX,KAAKyK,EAAcC,GAYtF,gBAAgBuB,EAAMxB,EAAcC,GAChC,OAAOrR,KAAK0N,GAAGmR,gBAAgB7e,KAAK2O,YAAYkN,gBAAiBjJ,GAAMjM,KAAKyK,EAAcC,GAY9F,gBAAgBuB,EAAMxB,EAAcC,GAChC,OAAOrR,KAAK0N,GAAGoR,gBAAgB9e,KAAK2O,YAAYkN,gBAAiBjJ,GAAMjM,KAAKyK,EAAcC,IAYlG,EAAY0N,eAAiB,CACzBC,OAAQ,CACJC,MAAO,IACPC,OAAQ,IACRC,MAAO,SAEXC,SAAU,CACNH,MAAO,KACPC,OAAQ,IACRC,MAAO,SAEXE,OAAQ,CACJJ,MAAO,KACPC,OAAQ,IACRC,MAAO,cAEXG,QAAS,CACLL,MAAO,IACPC,OAAQ,KAEZK,SAAU,CACNN,MAAO,IACPC,OAAQ,IACRC,MAAO,iBAEXK,WAAY,CACRP,MAAO,IACPC,OAAQ,IACRC,MAAO,UAGf,CAAC,SAAU,WAAY,SAAU,UAAW,WAAY,cAAc5d,QAAS/E,IAC3E,MAAMijB,EAAa,YAAYjjB,EAE/B,EAAYqB,UAAU4hB,GAAc,SAAwBC,EAAUvO,EAASC,EAAcC,GACzF,GAAIF,aAAmBhC,SACnB,OAAOnP,KAAKyf,GAAYC,EAAU,GAAIvO,EAASC,GAEnD,MAAME,EAAM3U,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAI,EAAYkd,eAAeviB,EAAKmjB,gBAAiBxO,GAAW,IACxG,OAAOnR,KAAK0N,GAAGkS,eAAepjB,EAAMkjB,EAAUpO,GAAK3K,KAAKyK,EAAcC,M,WG7MvE,MAAM,UAAsB,EAI/B,kBACI,OAAO,cAMX,SACI,OAAOrR,KAAK0N,GAAGmS,SAMnB,mBACI,OAAO7f,KAAK0N,GAAGoS,mBAMnB,iBACI,MAAMtX,EAAM,IAAIhC,EAAA,eAEhB,OADAgC,EAAIpH,aAAa,eACVpB,KAAK0N,GAAGnE,KAAKf,GAAK7B,KAAM5C,GAAaA,EAAS7C,QAEzD,SAAS6e,EAAIC,EAAqBrM,EAAQvC,EAAcC,GACpD,GAAIsC,aAAkBxE,SAClB,OAAOnP,KAAKge,SAAS+B,EAAIC,EAAqB,KAAMrM,EAAQvC,GAEhE,MAAM6O,EAA8C,iBAAxBD,EAAmC,CAAExY,MAAOwY,GAAwBA,EAChG,OAAOhgB,KAAK0N,GAAGwS,eAAeH,EAAIE,EAActM,GAAQhN,KAAKyK,EAAcC,GAS/E,KAAK8O,EAAa/O,EAAcC,GAC5B,OAAOrR,KAAK0N,GAAG0S,WAAWD,GAAaxZ,KAAKyK,EAAcC,I,ICrC9DgP,E,4BAXApiB,EAAkC,SAAUD,EAAGE,GAC/C,IAAIf,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMG,EAAEC,QAAQJ,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOyB,sBACtB,KAAInC,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOyB,sBAAsBJ,GAAI/B,EAAI8B,EAAEM,OAAQpC,IAC3DiC,EAAEC,QAAQJ,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUS,qBAAqBlC,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAQX,MACMmjB,EADc,QACmBjiB,OACjCkiB,EAAKvjB,OAAO,MACZwjB,EAAWxjB,OAAO,YAClByjB,EAAOzjB,OAAO,QA+Cb,MAAM,EAMT,YAAY0jB,GAIR1gB,KAAK0N,GAAK,KACV1N,KAAKqgB,GAAM,KAEX,MAAM/O,EAA6B,iBAAhBoP,EAA2B,CAAElU,GAAIkU,GAAiBA,GAAe,GACpF,GAAIpP,EAAI9E,GAAI,CAGR,IAAuB,IADD8E,EAAI9E,GAAGrO,QAAQ,IAAK,SAASE,SACM,IAA7BiT,EAAI9E,GAAGrO,QAAQ,UACvC,MAAM,IAAI4H,MAAM,0BAA0BuL,EAAI9E,IAElDxM,KAAKugB,GAAMjP,EAAI9E,QAGfxM,KAAKugB,GAAMvgB,KAAK2gB,oBAAoBrP,GAGxCtR,KAAK4gB,eAAetP,GACpBtR,KAAK6gB,SAAkD,MAAvC7gB,KAAKwM,GAAGkE,OAAO1Q,KAAKwM,GAAGnO,OAAS,GAKpD,SACI,OAAO2B,KAAKugB,GAGhB,UACI,MAAM,IAAIxa,MAAM,iFAKpB,WACI,OAAO/F,KAAKwM,GAAGrK,UAAUnC,KAAKwM,GAAGuB,YAAY,IAAK/N,KAAKwM,GAAGnO,OAAS,GAAK,GAK5E,eACI,GAAI2B,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,4BAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAU9d,SAK1B,UAEI,OADA1C,KAAK8gB,iBACE9gB,KAAKwgB,GAAUld,IAM1B,mBACI,GAAItD,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,gCAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAUO,aAM1B,gBACI,GAAI/gB,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,iCAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAUtM,UAK1B,WACI,GAAIlU,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,wBAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAU1d,KAM1B,cACI,GAAI9C,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,kCAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAUrf,QAK1B,WACI,GAAInB,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,wBAGpB,OADA/F,KAAK8gB,iBACE9gB,KAAKwgB,GAAU3M,KAK1B,aACI,OAAO7T,KAAKwM,GAAGrK,UAAUme,EAAqB,EAAGtgB,KAAKwM,GAAGrO,QAAQ,IAAKmiB,EAAqB,IAK/F,UACI,OAAOtgB,KAAKwM,GAAGrK,UAAUnC,KAAKwM,GAAGrO,QAAQ,IAAKmiB,EAAqB,GAAK,GAK5E,WACI,OAAOtgB,KAAKwM,GAAGrK,UAAUme,GAK7B,aACI,OAAOtgB,KAAKwM,GAAGrK,UAAUme,EAAoBtgB,KAAKwM,GAAGuB,YAAY,IAAK/N,KAAKwM,GAAGnO,OAAS,IAK3F,uBACI,QAAS2B,KAAKwgB,GAOlB,iBAAiB1d,GACb,IAAKA,EACD,OAAO,KAEX,MAAMiH,EAAQjH,EAAKiH,MAAM,6BACzB,OAAKA,EAGEA,EAAM,GAFF,KAUf,UAAUiX,GACN,GAAIhhB,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,uCAEpB,OAAO/F,KAAK0N,GAAGuT,UAAUjhB,KAAKwM,GAAyB,kBAAdwU,EAA0BA,EAA4B,QAAhBhhB,KAAKiO,QAYxF,OAAOiT,EAAe9P,EAAcC,GAChC,IAAI8P,EACJ,MAAM7P,EAAM4P,GAAiB,GAC7B,GAAIlhB,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,+BAEpB/F,KAAK4gB,eAAetP,GACpB,MAAM8P,EAAgB,IAAI5a,EAAA,WAAmBxG,KAAKiO,OAAQjO,KAAKxC,KAC1D0D,OAAOlB,KAAKygB,GAAMre,KAA4B,QAArB+e,EAAKnhB,KAAKygB,UAA0B,IAAPU,OAAgB,EAASA,EAAGpf,MACjFsf,EAAOrhB,KAAKwgB,GAUlB,OATIa,IACAD,EAAc9d,IAAI+d,EAAK/d,KACvB8d,EAAcxe,cAAcye,EAAKxN,MACjCuN,EAAc1e,SAAS2e,EAAK3e,UAC5B0e,EAAc3d,cAAc4d,EAAKlgB,UAErCigB,EAAcnY,SAASqI,EAAIrI,UAAY,MACvCjJ,KAAKshB,YAAYF,EAAe9P,GAChCtR,KAAK0N,GAAG6T,eAAevhB,KAAKwM,IACrBxM,KAAK0N,GAAGnE,KAAK6X,GAAeza,KAAM5C,IACrC/D,KAAKygB,GAAQ,KACbzgB,KAAKke,SAASna,EAAS7C,QAChBlB,OACR2G,KAAKyK,EAAcC,GAY1B,SAASmQ,EAAiBpQ,EAAcC,GACpC,MAAMC,EAAMkQ,GAAmB,GAC/B,GAAIxhB,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,iCAEpB,MAAMhE,EAAOuP,EAAIvP,MAAQ,OACnB0f,EAAkB,IAAIjb,EAAA,aAAqBxG,KAAKiO,OAAQjO,KAAKxC,KAC9D4D,aAAaW,GAElB,OADA/B,KAAK0N,GAAGgU,kBAAkB1hB,KAAKwM,GAAIiV,EAAiBnQ,EAAIqQ,SACjD3hB,KAAK0N,GAAGnE,KAAKkY,GAAiB9a,KAAM5C,IACvC/D,KAAK0N,GAAGkU,eAAe5hB,KAAKwM,IAC5BxM,KAAK6hB,YAAY9d,EAAS5C,SACnB4C,EAAS7C,QAChBhD,IACA,GAAIA,EAAEwD,SAAW,aAAWvC,iBACxB,OAAO,KAEX,MAAMjB,IACPyI,KAAKyK,EAAcC,GAW1B,OAAOyQ,EAAe1Q,EAAcC,GAChC,MAAMC,EAAMwQ,GAAiB,GACvBC,EAAgB,IAAIvb,EAAA,WAAmBxG,KAAKiO,OAAQjO,KAAKxC,KAK/D,OAJAwC,KAAKshB,YAAYS,EAAezQ,GAC3BtR,KAAK6gB,UACN7gB,KAAK0N,GAAG6T,eAAevhB,KAAKwM,IAEzBxM,KAAK0N,GAAGnE,KAAKwY,GAAepb,KAAM5C,GAChC/D,KAAK6gB,SAGH9c,EAAS7C,OAAOP,IAAKqhB,GAAW,IAAIhiB,KAAK0N,GAAGuU,KAAKD,IAF7ChiB,MAGZ2G,KAAKyK,EAAcC,GAO1B,oBAAoBqP,GAChB,IAAIS,EACJ,IAAI7gB,EACJ,GAAIogB,EAAYpgB,KACZA,EAAOogB,EAAYpgB,SAElB,CACD,MAAM4hB,EAAS,0BAAgBxB,EAAYwB,QAAU,QACrD,GAAIA,EAAO7jB,OAAS,EAChB,MAAM,IAAI0H,MAAM,wBAAwBmc,GAG5C5hB,EAAO4hB,GADMxB,EAAYlkB,OAA+F,QAArF2kB,EAAKT,aAAiD,EAASA,EAAYte,YAAyB,IAAP+e,OAAgB,EAASA,EAAG3kB,OAAS,kBAQzK,GAJuB,MAAnB8D,EAAKoQ,OAAO,KACZpQ,EAAO,IAAIA,IAGa,IAAxBA,EAAKnC,QAAQ,OAAgBmC,EAAKjC,OAAS,EAC3C,MAAM,IAAI0H,MAAM,iBAAiBzF,GAErC,MAlVY,QAkVSA,EAQzB,YAAYkI,EAAK2I,GACb,GAAIA,EAAQgR,MACR,OAEJ,MAAMd,EAAOrhB,KAAKwgB,GACba,IAAUA,EAAKN,cAAiBM,EAAKve,OAI1C0F,EAAI4Z,kBAAkBf,EAAKN,cAC3BvY,EAAIrF,QAAQke,EAAKve,OAJb0F,EAAIpF,YAAY,KAcxB,aAAa+N,EAASC,EAAcC,GAChC,MAAMC,EAAMH,GAAW,GACvB,GAAInR,KAAK6gB,SACL,MAAM,IAAI9a,MAAM,8BAEpB,MAAMyC,EAAM,IAAIhC,EAAA,gBAAwBxG,KAAKiO,OAAQjO,KAAKxC,KAE1D,OADAwC,KAAK0N,GAAGgU,kBAAkB1hB,KAAKwM,GAAIhE,EAAK8I,EAAIqQ,SACrC3hB,KAAK0N,GAAGnE,KAAKf,GAAK7B,KAAM5C,IAE3B/D,KAAK6hB,YAAY9d,EAAS5C,SACnBnB,MACP9B,IACA,GAAIA,EAAEwD,SAAW,aAAWvC,iBACxB,OAAO,KAEX,MAAMjB,IACPyI,KAAKyK,EAAcC,GAU1B,aAAaF,EAASC,EAAcC,GAChC,MAAMC,EAAMH,GAAW,GACjBf,EAAOpQ,KAAKqQ,SACZ7H,EAAM,IAAIhC,EAAA,mBAA2BxG,KAAKiO,OAAQjO,KAAKxC,KACxD0D,OAAOkP,GAEZ,OADApQ,KAAKshB,YAAY9Y,EAAK8I,GACftR,KAAK0N,GAAGnE,KAAKf,GAAK7B,KAAM5C,IAC3B/D,KAAKke,SAASna,EAAS7C,QAChBlB,OACR2G,KAAKyK,EAAcC,GAO1B,eAAeF,GACX,MAAM,KAAE/O,EAAI,KAAEL,GAASoP,EAASkR,EAAWpkB,EAAOkT,EAAS,CAAC,OAAQ,SACpE,IAAK/O,EACD,OAGJpC,KAAKygB,GAAQ,CAAE1e,OAAMK,QACrB,MAAMM,EAAW1C,KAAKsiB,cAAcnR,SAAYlP,EAChDjC,KAAKke,SAASvhB,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIwgB,GAAW,CAAE3f,cAQ/D,cAAcyO,GACV,MAAM,SAAEzO,GAAayO,EACrB,GAAIzO,EACA,OAAOA,EAEX,GAAoB,oBAATJ,MAAwB6O,EAAQ/O,gBAAgBE,KACvD,OAAO6O,EAAQ/O,KAAKL,KAExB,GAAqB,aAAjBoP,EAAQpP,MAA+C,iBAAjBoP,EAAQ/O,KAAmB,CACjE,MAAM2H,EAAQoH,EAAQ/O,KAAK2H,MAAM,6BACjC,OAAOA,GAASA,EAAM,GAE1B,OAAO,KAKX,YAAY5I,GACRnB,KAAKke,SAAS,CACVpb,KAAM,EAAKyf,UAAUphB,EAAQuG,MAC7BqZ,aAAc5f,EAAQ,iBACtB+S,UAAW/S,EAAQ,qBACnBuB,SAAUvB,EAAQ,gBAClBmC,IAAKnC,EAAQ,eAAiBoC,KAAKgF,MAAMpH,EAAQ,eACjD0S,MAAO1S,EAAQ,eACfA,QAASA,EAAQ,0BAA4BoC,KAAKgF,MAAMpH,EAAQ,4BAUxE,SAASiP,GACL,MAAM,GAAE5D,GAAO4D,EACf,GAAI5D,GAAMxM,KAAKwM,KAAOA,EAClB,MAAM,IAAIzG,MAAM,gBAAgB/F,KAAKwM,uCAAuCA,KAEhF,MAAM6U,EAAOrhB,KAAKwgB,IAAa,GAC/B,IAAIld,EACA8M,EAAK9M,eAAemK,EAAA,EACpBnK,EAAM8M,EAAK9M,KAGXA,EAAM+d,EAAK/d,KAAO,IAAImK,EAAA,EAClB2C,EAAK9M,KACLA,EAAI4a,SAAS9N,EAAK9M,MAI1BtD,KAAKwgB,GAAY7jB,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAI7B,KAAKwgB,IAAY,CAAE9d,SAAU0N,EAAK1N,SAAUqe,aAAe3Q,EAAK2Q,cAAgB,IAAIlU,KAAKuD,EAAK2Q,eAAkBM,EAAKN,aAAc7M,UAAY9D,EAAK8D,WAAa,IAAIrH,KAAKuD,EAAK8D,YAAemN,EAAKnN,UAAWpR,KAAMsN,EAAKtN,MAAQue,EAAKve,KAAMQ,MAAKuQ,KAA2B,iBAAdzD,EAAKyD,KAAoBzD,EAAKyD,KAAOzD,EAAKxN,cAAezB,QAASiP,EAAKjP,SAAWkgB,EAAKlgB,SAAW,KAMrZ,SACI,IAAIggB,EACJnhB,KAAK8gB,iBACL,MAAMO,EAAOrhB,KAAKwgB,GAClB,MAAO,CACHhU,GAAIxM,KAAKwM,GACT9J,SAAU2e,EAAK3e,SACfI,KAAMue,EAAKve,KACXQ,IAAyB,QAAnB6d,EAAKE,EAAK/d,WAAwB,IAAP6d,OAAgB,EAASA,EAAG9Q,SAC7DwD,KAAMwN,EAAKxN,KACXkN,aAAcM,EAAKN,cAAgBM,EAAKN,aAAarO,cACrDwB,UAAWmN,EAAKnN,WAAamN,EAAKnN,UAAUxB,cAC5CvR,QAASkgB,EAAKlgB,SAOtB,iBACI,IAAKnB,KAAKwiB,iBACN,MAAM,IAAI,kBAAgB,wBAAwBxiB,KAAKwM,yBAInE6T,EAAKI,ECtgBE,MAAM,UAAoBhE,EAC7B,cACInS,SAAS8S,WAITpd,KAAK0N,GAAK,KAOd,cAAcA,GACV,MAAMsP,EAAUhd,KAAKsd,cAAc,GAEnC,OADAN,EAAQtP,GAAKA,EACNsP,EAQX,YAAYjd,GACR,MAAMwd,EAAWjT,MAAM2S,YAAYld,GAEnC,OADAwd,EAAS7P,GAAK1N,KAAK0N,GACZ6P,EAOX,SAASnN,GACL,MAAMqS,EAAOziB,KAAKid,YAAY,CAAC7M,EAAK5D,KAEpC,OADAiW,EAAKvE,SAAS9N,GACPqS,EAUX,aAAaxU,EAAQoU,EAAUjR,EAAcC,GACzC,MAAM7I,EAAM,IAAIhC,EAAA,sBAA8ByH,EAAQoU,GACtD,OAAOriB,KAAK0N,GAAGnE,KAAKf,GAAK7B,KAAKyK,EAAcC,GAYhD,aAAapD,EAAQkD,EAASC,EAAcC,GACxC,MAAM7I,EAAM,IAAIhC,EAAA,sBAA8ByH,GAG9C,OAAOjO,KAAK0N,GAAGnE,KAAKf,GAAK7B,KAAM5C,IAC3B,MAAM+F,EAAS,GAIf,OAHA,aAAW4Y,iBAAiBnhB,QAAS/D,IACjCsM,EAAOtM,GAAO,aAAW0gB,SAASna,EAAS7C,OAAO1D,IAAQ,MAEvDsM,GACP5L,IACA,GAAIA,EAAEwD,SAAW,aAAWvC,iBACxB,OAAO,KAEX,MAAMjB,IACPyI,KAAKyK,EAAcC,GAQ1B,YAAYD,EAAcC,GACtB,OAAOrR,KAAK0N,GAAGnE,KAAK,IAAI/C,EAAA,aAAuBG,KAAM5C,GAAcA,EAAS7C,OAAOP,IAAKsN,GAAWjO,KAAK2iB,IAAO1U,EAAH,OAAiBtH,KAAKyK,EAAcC,GAYpJ,UAAUuR,EAAcC,EAAOC,EAAO1R,EAAcC,GAChD,IAAI0R,EACJ,GAA4B,iBAAjBH,EAA2B,CAClC,MAAMtiB,EAAO,0BAAgBsiB,GAC7BG,EAAS/iB,KAAK2iB,IAAI,CAAEriB,cAGpByiB,EAASH,EAEb,MAAMtiB,EAAOyiB,EAAOvlB,KACd,OAAEyQ,GAAW8U,EACnB,OAAO/iB,KAAK0N,GAAGnE,KAAK,IAAI/C,EAAA,UAAkByH,EAAQ3N,EAAMuiB,EAAQA,EAAMrlB,SAAMyE,EAAW6gB,IAAQnc,KAAM5C,GAAcA,EAAS7C,OAAOP,IAAK8hB,GAASziB,KAAK2iB,IAAIF,KAAS9b,KAAKyK,EAAcC,IC9GvL,SAASxU,EAAWK,GACvB,OAAO,SAAkBwf,EAAQsG,EAAaC,GAE1CA,EAAWpmB,WAAaK,GCPhC,IAAIgmB,EAA0C,SAAUC,EAAYzG,EAAQlf,EAAK4lB,GAC7E,IAA2H7mB,EAAvHD,EAAI8gB,UAAU/e,OAAQtB,EAAIT,EAAI,EAAIogB,EAAkB,OAAT0G,EAAgBA,EAAOzmB,OAAOmV,yBAAyB4K,EAAQlf,GAAO4lB,EACrH,GAAuB,iBAAZC,SAAoD,mBAArBA,QAAQC,SAAyBvmB,EAAIsmB,QAAQC,SAASH,EAAYzG,EAAQlf,EAAK4lB,QACpH,IAAK,IAAInnB,EAAIknB,EAAW9kB,OAAS,EAAGpC,GAAK,EAAGA,KAASM,EAAI4mB,EAAWlnB,MAAIc,GAAKT,EAAI,EAAIC,EAAEQ,GAAKT,EAAI,EAAIC,EAAEmgB,EAAQlf,EAAKT,GAAKR,EAAEmgB,EAAQlf,KAAST,GAChJ,OAAOT,EAAI,GAAKS,GAAKJ,OAAOC,eAAe8f,EAAQlf,EAAKT,GAAIA,GAKzD,MAAM,EAMT,YAAYwgB,EAAUV,GAClB,MAAM9a,EAAO4Z,EAAS4H,cAAchG,EAASiG,aACzCzhB,EAAK4L,UACLhR,OAAOC,eAAe2gB,EAAU,YAAa,CACzCrgB,MAAO,WAASK,OAAOwE,GACvBya,cAAc,IAGlBK,GACAlgB,OAAOkF,OAAO0b,EAAUV,GAQhC,cAAc4G,GAWV,OATAA,EAAW5lB,UAAYlB,OAAOY,OAAOyC,KAAKnC,UAAW,CACjD2lB,YAAa,CACTtmB,MAAOumB,EACPjH,cAAc,EACdD,UAAU,KAIlBkH,EAAW9G,OAAS,EAAQA,OACrB8G,EAMX,YAAY5G,GACR,EAAQ9K,KAAK/R,KAAM6c,GAMvB,WAEI,OADalB,EAAS4H,cAAcvjB,KAAKwjB,aAC7BxH,IAOhB,SACI,MAAMja,EAAO4Z,EAAS4H,cAAcvjB,KAAKwjB,aACzC,OAAOzhB,EAAK2hB,YAAY,WAASnmB,OAAOwE,GAAO/B,KAAM,CAAEyd,YAAY,KAG3EyF,EAAW,CACPrmB,GAAW,IACZ,EAAQgB,UAAW,WAAY,MAClCqlB,EAAW,CACPrmB,GAAW,IACZ,EAAQgB,UAAW,SAAU,M,YC3E5B,EAA0C,SAAUslB,EAAYzG,EAAQlf,EAAK4lB,GAC7E,IAA2H7mB,EAAvHD,EAAI8gB,UAAU/e,OAAQtB,EAAIT,EAAI,EAAIogB,EAAkB,OAAT0G,EAAgBA,EAAOzmB,OAAOmV,yBAAyB4K,EAAQlf,GAAO4lB,EACrH,GAAuB,iBAAZC,SAAoD,mBAArBA,QAAQC,SAAyBvmB,EAAIsmB,QAAQC,SAASH,EAAYzG,EAAQlf,EAAK4lB,QACpH,IAAK,IAAInnB,EAAIknB,EAAW9kB,OAAS,EAAGpC,GAAK,EAAGA,KAASM,EAAI4mB,EAAWlnB,MAAIc,GAAKT,EAAI,EAAIC,EAAEQ,GAAKT,EAAI,EAAIC,EAAEmgB,EAAQlf,EAAKT,GAAKR,EAAEmgB,EAAQlf,KAAST,GAChJ,OAAOT,EAAI,GAAKS,GAAKJ,OAAOC,eAAe8f,EAAQlf,EAAKT,GAAIA,GAOzD,MAAM,UAAe,EASxB,SACI,OAAOiD,KAAK8N,UAAUtB,GAE1B,OAAOtP,GACH,GAAI8C,KAAK8N,UAAUtB,GACf,MAAM,IAAIzG,MAAM,8BAA8B7I,GAGG,KADzC,GAAGA,GACPiB,QAAQ,OAAO6B,KAAK8N,UAAUG,WAClCjO,KAAK8N,UAAUtB,GAAKtP,EAGpB8C,KAAKxC,IAAMN,EAQnB,UACI,OAAO8C,KAAK8N,UAAUtQ,IAE1B,QAAQN,GACJ8C,KAAK8N,UAAUtQ,IAAMN,EAOzB,cACI,OAAO8C,KAAK8N,UAAUN,QAO1B,UAEI,OADAxN,KAAK8N,UAAUwO,4BAA4B,OACpCtc,KAAK8N,UAAUxK,IAO1B,OAAOoK,GACHA,EAAGiW,OAAO3jB,MAEd,MAAMoR,GACF,OAAOpR,KAAK8N,UAAUoF,QAAQvM,KAAK,IAAM3G,MAAM2G,KAAKyK,GAaxD,KAAKD,EAASC,EAAcC,GACxB,MAAuB,mBAAZF,EACAnR,KAAK4jB,KAAK,GAAIzS,EAASC,GAE3BpR,KAAK8N,UAAUJ,GAAGkW,KAAK5jB,KAAMmR,GAASxK,KAAKyK,EAAcC,GAapE,OAAOF,EAASC,EAAcC,GAC1B,MAAuB,mBAAZF,EACAnR,KAAK6jB,OAAO,GAAI1S,EAASC,GAE7BpR,KAAK8N,UAAUJ,GAAGmW,OAAO7jB,KAAMmR,GAASxK,KAAKyK,EAAcC,GAkBtE,OAAOF,EAASC,EAAcC,GAC1B,MAAuB,mBAAZF,EACAnR,KAAK2H,OAAO,GAAIwJ,EAASC,GAE7BpR,KAAK8N,UAAUJ,GAAG/F,OAAO3H,KAAMmR,GAASxK,KAAKyK,EAAcC,GAiBtE,KAAKF,EAASC,EAAcC,GACxB,GAAuB,mBAAZF,EACP,OAAOnR,KAAKwL,KAAK,GAAI2F,EAASC,GAElC,MAAME,EAAM3U,OAAOkF,OAAO,CAAEiiB,OAAO,GAAQ3S,GAC3C,GAAgB,OAAZnR,KAAKwM,GACL,MAAM,IAAI,kBAAgB,oDAE9B,OAAOxM,KAAK8N,UAAUJ,GAAGlC,KAAKxL,KAAKwM,QAAIvK,EAAWqP,GAAK3K,KAAKyK,EAAcC,GAc9E,OAAOF,EAASC,EAAcC,GAC1B,MAAuB,mBAAZF,EACAnR,KAAK+jB,OAAO,GAAI5S,EAASC,GAE7BpR,KAAK8N,UAAUJ,GAAGqW,OAAO/jB,KAAMmR,GAASxK,KAAKyK,EAAcC,GActE,eAAe2S,EAAI5S,EAAcC,GAC7B,OAAOrR,KAAK8N,UAAUJ,GAAGuW,eAAejkB,KAAMgkB,GAAIrd,KAAKyK,EAAcC,GAEzE,OACI,MAAM,IAAItL,MAAM,gCAQpB,WACI,OAAO/F,KAAK8N,UAAUJ,GAAGwW,SAASlkB,MAQtC,cAAcmkB,GACV,OAAO,IAAI,6BAA2BnkB,KAAMmkB,GAUhD,eAAehT,GACX,MAAM,GAAEzD,GAAO1N,KAAK8N,UACdsW,EAAapkB,KAAK8N,UAAU/L,KAAKsiB,eAAe3W,EAAIyD,GAEpDmT,EAAalS,MAAM0B,KAAKsQ,GAAYzjB,IAAI,EAAEqb,EAAKuI,MAEjD,MAAMC,EAAK9W,EAAGkQ,mBAAmB5B,EAAIH,iBAE/B4I,EAAQ,GACdF,EAAMhjB,QAAS0N,IACXwV,EAAMhjB,KAAK+iB,EAAGE,MAAMzV,EAAMjP,SAI9B,OAD+B,IAAjBykB,EAAMpmB,OAAeomB,EAAM,GAAKD,EAAGG,GAAGF,IACvCG,eAEjB,OAAOne,QAAQoe,IAAIP,GAAY3d,KAAMme,GAErCA,EAAQC,OAAQjb,KAAaA,EAAOzL,SAAUsI,KAAMme,GAEpD1S,MAAMvU,UAAUmnB,OAAO3V,MAAM,GAAIyV,IAMrC,WACI,MAAM/iB,EAAO4Z,EAAS4H,cAAcvjB,KAAKwjB,aACzC,OAAOxjB,KAAKwM,IAAMzK,EAAKia,IAU3B,OAAO7K,GAGH,IAAIG,EAAMH,EACS,kBAARG,IACPA,EAAM,CACF2T,gBAAiB3T,IAGN,iBAARA,IACPA,EAAM,IAEV,MAAMjE,EAAQrN,KAAK8N,UACnB,OAAOT,EAAMtL,KAAK2hB,YAAYrW,EAAOrN,KAAMsR,IAGnD,EAAW,CACPzU,GAAW,IACZ,EAAOgB,UAAW,KAAM,MAC3B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,MAAO,MAC5B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,UAAW,MAChC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,MAAO,MAC5B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,SAAU,MAC/B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,QAAS,MAC9B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,OAAQ,MAC7B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,SAAU,MAC/B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,SAAU,MAC/B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,OAAQ,MAC7B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,SAAU,MAC/B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,iBAAkB,MACvC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,OAAQ,MAC7B,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,WAAY,MACjC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,gBAAiB,MACtC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,iBAAkB,MACvC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,WAAY,MACjC,EAAW,CACPhB,GAAW,IACZ,EAAOgB,UAAW,SAAU,MCpU/B,IAAI,EAA0C,SAAUslB,EAAYzG,EAAQlf,EAAK4lB,GAC7E,IAA2H7mB,EAAvHD,EAAI8gB,UAAU/e,OAAQtB,EAAIT,EAAI,EAAIogB,EAAkB,OAAT0G,EAAgBA,EAAOzmB,OAAOmV,yBAAyB4K,EAAQlf,GAAO4lB,EACrH,GAAuB,iBAAZC,SAAoD,mBAArBA,QAAQC,SAAyBvmB,EAAIsmB,QAAQC,SAASH,EAAYzG,EAAQlf,EAAK4lB,QACpH,IAAK,IAAInnB,EAAIknB,EAAW9kB,OAAS,EAAGpC,GAAK,EAAGA,KAASM,EAAI4mB,EAAWlnB,MAAIc,GAAKT,EAAI,EAAIC,EAAEQ,GAAKT,EAAI,EAAIC,EAAEmgB,EAAQlf,EAAKT,GAAKR,EAAEmgB,EAAQlf,KAAST,GAChJ,OAAOT,EAAI,GAAKS,GAAKJ,OAAOC,eAAe8f,EAAQlf,EAAKT,GAAIA,GAIzD,MAAM,UAAa,EAUtB,YAAYmoB,EAAiBpH,EAAU1M,EAAcC,GACjD,OAAOrR,KAAK8N,UAAUJ,GAAG8Q,YAAYxe,KAAKme,SAAU+G,EAAiBpH,GAAUnX,KAAKyK,EAAcC,GAWtG,eAAesN,EAAab,EAAU1M,EAAcC,GAChD,OAAOrR,KAAK8N,UAAUJ,GAAGkR,eAAe5e,KAAKme,SAAUQ,EAAab,GAAUnX,KAAKyK,EAAcC,GAWrG,gBAAgBD,EAAcC,GAC1B,OAAOrR,KAAK8N,UAAUJ,GAAGmR,gBAAgB7e,KAAKwjB,YAAaxjB,MACtD2G,KAAKyK,EAAcC,IAGhC,EAAW,CACPxU,GAAW,IACZ,EAAKgB,UAAW,cAAe,MAClC,EAAW,CACPhB,GAAW,IACZ,EAAKgB,UAAW,iBAAkB,MACrC,EAAW,CACPhB,GAAW,IACZ,EAAKgB,UAAW,kBAAmB,MCvDtC,IAAI,EAA0C,SAAUslB,EAAYzG,EAAQlf,EAAK4lB,GAC7E,IAA2H7mB,EAAvHD,EAAI8gB,UAAU/e,OAAQtB,EAAIT,EAAI,EAAIogB,EAAkB,OAAT0G,EAAgBA,EAAOzmB,OAAOmV,yBAAyB4K,EAAQlf,GAAO4lB,EACrH,GAAuB,iBAAZC,SAAoD,mBAArBA,QAAQC,SAAyBvmB,EAAIsmB,QAAQC,SAASH,EAAYzG,EAAQlf,EAAK4lB,QACpH,IAAK,IAAInnB,EAAIknB,EAAW9kB,OAAS,EAAGpC,GAAK,EAAGA,KAASM,EAAI4mB,EAAWlnB,MAAIc,GAAKT,EAAI,EAAIC,EAAEQ,GAAKT,EAAI,EAAIC,EAAEmgB,EAAQlf,EAAKT,GAAKR,EAAEmgB,EAAQlf,KAAST,GAChJ,OAAOT,EAAI,GAAKS,GAAKJ,OAAOC,eAAe8f,EAAQlf,EAAKT,GAAIA,GAKzD,MAAM,UAAa,EACtB,cACIuN,SAAS8S,WAITpd,KAAKmlB,MAAQ,KAIbnlB,KAAKxD,KAAO,KAQhB,QAAQoW,GACJ,QAAS5S,KAAKmlB,OAASnlB,KAAKmlB,MAAMC,IAAIxS,GAM1C,QAAQA,GACJ,KAAIA,aAAgB,GAOhB,MAAM,IAAI7M,MAAM,+CANX/F,KAAKmlB,QACNnlB,KAAKmlB,MAAQ,IAAI1R,KAErBzT,KAAKmlB,MAAMvR,IAAIhB,GAUvB,WAAWA,GACP,KAAIA,aAAgB,GAMhB,MAAM,IAAI7M,MAAM,mDALZ/F,KAAKmlB,OACLnlB,KAAKmlB,MAAMpB,OAAOnR,IAQlC,EAAW,CACP/V,GAAW,IACZ,EAAKgB,UAAW,UAAW,MAC9B,EAAW,CACPhB,GAAW,IACZ,EAAKgB,UAAW,UAAW,MAC9B,EAAW,CACPhB,GAAW,IACZ,EAAKgB,UAAW,aAAc,O,8TCpE1B,MAAMwnB,GAAS,ECATC,EAAOvZ,OAAOuZ,KAAK7nB,KAAKsO,QCA9B,SAAS4I,EAAKnO,EAAShJ,GAC1B,MAAM+nB,EAAU,IAAIC,YACpB,OAAO/e,QAAQC,QAAQ+e,OAAOC,OAAOC,UAAU,MAC/CJ,EAAQK,OAAOpoB,GAAM,CACjBhB,KAAM,OACNoY,KAAM,CAAEpY,KAAM,WACf,EACH,CAAC,OAAQ,YACJmK,KAAMkf,GAAcJ,OAAOC,OAAOhR,KAAK,OAAQmR,EAAWN,EAAQK,OAAOpf,KACzEG,KAAMgK,GACW,IAAIvG,WAAWuG,GAChBmV,OAAO,CAACte,EAAOuL,IAAMvL,EAAQuL,EAAEtC,SAAS,IAAIsV,SAAS,EAAG,KAAM,KCRhF,MAAMC,EACT,cAMIhmB,KAAKimB,UAAW,EAMhBjmB,KAAKkmB,aAAezf,QAAQC,QAAQ1G,MAMxC,cACI,OAAQA,KAAKimB,SAWjB,MAAM7U,EAAcC,GAChB,OAAOrR,KAAKkmB,aAAavf,KAAKyK,EAAcC,GAWhD,SAAS1N,EAAUwiB,GAAW,GAC1B,GAAInmB,KAAKimB,SACL,MAAM,IAAIlgB,MAAM,4CAEpB,IACI/F,KAAKimB,UAAW,EAChB,MAAMnc,EAASnG,IAAWgD,KAAMG,IAC5B9G,KAAKimB,UAAW,EACTnf,GACP5I,IAIA,MAHKioB,IACDnmB,KAAKimB,UAAW,GAEd/nB,IAQV,OANA8B,KAAKkmB,aAAepc,EAAOnD,KAAK,IAAM3G,KAAO9B,IACzC,IAAKioB,EACD,OAAOnmB,KAEX,MAAM9B,IAEH4L,EAEX,MAAO5L,GAOH,MANIioB,EACAnmB,KAAKkmB,aAAezf,QAAQkD,OAAOzL,GAGnC8B,KAAKimB,UAAW,EAEd/nB,ICvElB,IAAIkoB,EAAoC,oBAAXX,QAA0BA,OAAOW,iBAAmBX,OAAOW,gBAAgB3oB,KAAKgoB,SAA+B,oBAAbY,UAAgE,mBAA7BA,SAASD,iBAAkCC,SAASD,gBAAgB3oB,KAAK4oB,UACvOC,EAAQ,IAAIlc,WAAW,IACZ,SAASmc,IACtB,IAAKH,EACH,MAAM,IAAIrgB,MAAM,4GAGlB,OAAOqgB,EAAgBE,GCZV,4HCQf,ICFe,MAJf,SAAkBE,GAChB,MAAuB,iBAATA,GAAqB,EAAM9nB,KAAK8nB,IDG5CC,EAAY,GAEP,EAAI,EAAG,EAAI,MAAO,EACzBA,EAAUhlB,MAAM,EAAI,KAAOgP,SAAS,IAAIiW,OAAO,IAoBlC,MAjBf,SAAmBC,GACjB,IAAIC,EAASxJ,UAAU/e,OAAS,QAAsB4D,IAAjBmb,UAAU,GAAmBA,UAAU,GAAK,EAG7EoJ,GAAQC,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAM,IAAMH,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAM,IAAMH,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAM,IAAMH,EAAUE,EAAIC,EAAS,IAAMH,EAAUE,EAAIC,EAAS,IAAM,IAAMH,EAAUE,EAAIC,EAAS,KAAOH,EAAUE,EAAIC,EAAS,KAAOH,EAAUE,EAAIC,EAAS,KAAOH,EAAUE,EAAIC,EAAS,KAAOH,EAAUE,EAAIC,EAAS,KAAOH,EAAUE,EAAIC,EAAS,MAAMjH,cAMzf,IAAK,EAAS6G,GACZ,MAAMK,UAAU,+BAGlB,OAAOL,GEzBT,MAAM,ECEN,SAAYrV,EAAS2V,EAAKF,GAExB,IAAIG,GADJ5V,EAAUA,GAAW,IACF6V,SAAW7V,EAAQoV,KAAOA,KAK7C,GAHAQ,EAAK,GAAe,GAAVA,EAAK,GAAY,GAC3BA,EAAK,GAAe,GAAVA,EAAK,GAAY,IAEvBD,EAAK,CACPF,EAASA,GAAU,EAEnB,IAAK,IAAI3qB,EAAI,EAAGA,EAAI,KAAMA,EACxB6qB,EAAIF,EAAS3qB,GAAK8qB,EAAK9qB,GAGzB,OAAO6qB,EAGT,OAAO,EAAUC,ICnBbE,EAAgB,GACf,SAASC,EAAWC,GACvB,OAAO,SAA0BzK,EAAQlgB,EAAMymB,EAAa,CACxD1G,UAAU,EACV1f,YAAY,EACZ2f,cAAc,IAEd,MACM4K,EAAsB,GADG,iBAAX1K,EAAsBA,EAASA,EAAO8G,YAAYhnB,QAC/BA,IACjC6qB,EAAa,KACVJ,EAAcG,KACfH,EAAcG,IAAuB,EACrC7S,QAAQM,KAAK,YAAYuS,wBAA0CD,gBAGrEG,EAAuB,CACzBzqB,WAAYomB,EAAWpmB,WACvB2f,aAAcyG,EAAWzG,cAE7B,GAAIyG,EAAWnmB,KAAOmmB,EAAWsE,IACzBtE,EAAWnmB,MACXwqB,EAAqBxqB,IAAM,WAEvB,OADAuqB,IACOpE,EAAWnmB,IAAIV,KAAK4D,QAG/BijB,EAAWsE,MACXD,EAAqBC,IAAM,SAAarqB,GAEpC,OADAmqB,IACOpE,EAAWsE,IAAInrB,KAAK4D,KAAM9C,SAIxC,CACD,IAAIsqB,EAAgBvE,EAAW/lB,MAC/BoqB,EAAqBxqB,IAAM,WAEvB,OADAuqB,IACOG,GAEPvE,EAAW1G,WACX+K,EAAqBC,IAAM,SAAarqB,GACpCmqB,IACAG,EAAgBtqB,IAI5B,OAAOoqB,GCvCR,SAASG,EAAgBjX,GAC5B,MAAmC,MAA/BA,EAAIE,OAAOF,EAAInS,OAAS,GACdmS,EAAH,IAEJA,I,0RCZJ,MAAMkX,EAAkB,MAC3B,SAASC,EAA2BnhB,EAASohB,GACrCjrB,OAAOkB,UAAUC,eAAe1B,KAAK2J,MAAO,qBAC5CA,MAAM8hB,kBAAkB7nB,KAAMA,KAAKwjB,aAGnCxjB,KAAKsS,OAAQ,IAAKvM,OAASuM,MAE/BtS,KAAKwG,QAAWA,GAAW,2CAC3BxG,KAAKxD,KAAOwD,KAAKwjB,YAAYhnB,KACzBorB,IACA5nB,KAAK4nB,MAAQA,EACTA,EAAMtV,QACNtS,KAAKsS,OAAS,gBAAgBsV,EAAMtV,QAchD,OARAqV,EAA2B9pB,UAAYlB,OAAOY,OAAOwI,MAAMlI,UAAW,CAClE2lB,YAAa,CACTtmB,MAAOyqB,EACPpL,UAAU,EACV1f,YAAY,EACZ2f,cAAc,KAGfmL,GA3BoB,GA6B/BD,EAAgBxgB,GAAK,SAAY0E,GAC7B,OAAIA,aAAiB8b,EACV9b,EAEJ,IAAI8b,EAAgB,KAAM9b,IChC9B,MAAM,UAA2B8b,EAKpC,YAAYI,EAAa/jB,GACrB,MAAM7C,EAAS6C,EAAS7C,QAAU6C,EAAS6H,OAAS,GAC9CyB,EAA6B,IAApBtJ,EAASrC,OAAe,UAAY,WAInD4I,MAHgBpJ,EAAOsF,SACfshB,GAAe,gBAAgBza,SAAaya,EAAY9mB,QAAQC,UAAU6mB,EAAY9mB,QAAQV,QAC/F,kCACQY,GACflB,KAAKxD,KAAO0E,EAAO6mB,WAAa,qBAChC/nB,KAAKgoB,OAAS9mB,EAAO8mB,QAAU,uBAC/BhoB,KAAK0B,OAASqC,EAASrC,OACnBR,EAAOkB,OACPpC,KAAKoC,KAAOlB,EAAOkB,MAEvB,IAAIwlB,EAAQ1mB,EACZ,KAAO0mB,GAASA,EAAMK,YAAY,CAC9BjoB,KAAKsS,OAAS,2BAA2BsV,EAAMG,aAAaH,EAAMphB,UAClE,MAAM,WAAEyhB,GAAeL,EACvB,IAAK,IAAI3rB,EAAI,EAAGA,EAAIgsB,EAAW5pB,OAAQpC,GAAK,EAAG,CAC3C,MAAM8S,EAAKkZ,EAAWhsB,GACtB+D,KAAKsS,OAAS,YAAYvD,EAAGgZ,aAAahZ,EAAG0Q,aAC7Czf,KAAKsS,OAAS,KAAKvD,EAAGmZ,YAAYnZ,EAAGoZ,cAEzCP,EAAQA,EAAMA,QC3BnB,MAAM,UAA2BF,EAIpC,YAAYxmB,GACRoJ,MAAM,UAAUpJ,2BAChBlB,KAAKkB,OAASA,GCNf,MAAM,UAA0BwmB,EAInC,YAAYxmB,GACRoJ,MAAM,cAAcpJ,mCACpBlB,KAAKkB,OAASA,GCNf,MAAM,UAAsBwmB,EAC/B,YAAYE,GACRtd,MAAM,uCAAwCsd,M,6BCH/C,IAAIQ,E,0zBACX,SAAWA,GACPA,EAAgBA,EAAuB,MAAI,GAAK,QAChDA,EAAgBA,EAA4B,WAAI,GAAK,aACrDA,EAAgBA,EAAwB,OAAI,GAAK,SACjDA,EAAgBA,EAAmC,kBAAI,GAAK,oBAJhE,CAKGA,IAAoBA,EAAkB,KAClC,MAAMC,EAKT,YAAYrM,EAAKH,GACb,GAA4B,IAAxBG,EAAI7d,QAAQ,QACZ,MAAM,IAAImqB,YAAY,YAAYtM,iBAEtChc,KAAKgc,IAAMA,EACXhc,KAAKxD,KAAOwf,EAAI7Z,UAAU,GAC1BnC,KAAKuoB,iBAAmB1M,EAK5B,sBACI,OAAQ,EAMZ,cACI,OAAO7b,KAAKwoB,kBAAoBJ,EAAgBK,MAMpD,mBACI,OAAOzoB,KAAKwoB,kBAAoBJ,EAAgBM,WAMpD,eACI,OAAO1oB,KAAKwoB,kBAAoBJ,EAAgBO,OAMpD,yBACI,OAAO3oB,KAAKwoB,kBAAoBJ,EAAgBQ,kBAKpD,sBACI,OAAO5oB,KAAKuoB,iBAKhB,oBAAoB1M,GAChB,GAAI7b,KAAKuoB,iBACL,MAAM,IAAIxiB,MAAM,yCAEpB/F,KAAKuoB,iBAAmB1M,G,kBChEzB,MAAM,UAAoBwM,EAK7B,YAAYrM,EAAKH,GACbvR,MAA8B,IAAxB0R,EAAI7d,QAAQ,QAAgB,OAAO6d,EAAQA,EAAKH,GACtD7b,KAAK6oB,SAAW,KAChB7oB,KAAKmc,mBAAqB,GAC1Bnc,KAAK8oB,oBAAsB,IAAI,aAC/B9oB,KAAK+oB,wBAA0B,IAAI,aACnC/oB,KAAKqiB,SAAW,KAChBriB,KAAKkc,UAAY,KACjBlc,KAAKgpB,gBAAkB,KAK3B,qBACI,OAAOhpB,KAAKgpB,gBAKhB,mBAAmBpY,GACf5Q,KAAKgpB,gBAAkBpY,EAK3B,sBAII,OAHK5Q,KAAKuoB,mBACNvoB,KAAK6b,gBAAkB7b,KAAKipB,oBAEzBjpB,KAAKuoB,iBAMhB,oBAAoB1M,GAChB,GAAI7b,KAAKuoB,iBACL,MAAM,IAAIxiB,MAAM,0CAEpB,MAAM4H,EAAWkO,EAAgBhe,qBAAqB,SACtD,GAAImC,KAAK2N,UACL,IAAKA,EACD,MAAM,IAAIkZ,UAAU,sDAGvB,KAAMhL,EAAgBhe,qBAAqB,YAAY8P,EACxD,MAAM,IAAIkZ,UAAU,sDAExB7mB,KAAK6oB,SAASK,QAAQlpB,KAAM6b,GAC5B7b,KAAKuoB,iBAAmB1M,EAM5B,KAAKgN,GACD7oB,KAAK6oB,SAAWA,EACZ7oB,KAAKuoB,mBAAqB,WAASY,cAAcnpB,KAAKuoB,mBACtD,WAASxM,cAAc/b,KAAKuoB,iBAAkBvoB,KAAKgc,KAU3D,SACI,MAAMuB,EAAW5gB,OAAOY,OAAOyC,KAAK6b,gBAAgBhe,WAEpD,OADA,UAAQkU,KAAKwL,GACNA,EAMX,aACI,IAAI1O,EACAxO,EAAQ,EACZ,MAAM0B,EAAO/B,KAIb,OAHIA,KAAKkc,YACLrN,EAAO7O,KAAKkc,UAAUpN,cAEnB,CACH,CAAC9R,OAAO0W,YACJ,OAAO1T,MAEX,OACI,GAAI6O,EAAM,CACN,MAAMua,EAAOva,EAAK/B,OAClB,IAAKsc,EAAKpa,KACN,OAAOoa,EAEXva,EAAO,KAEX,GAAIxO,EAAQ0B,EAAKoa,mBAAmB9d,OAAQ,CACxC,MAAMnB,EAAQ6E,EAAKoa,mBAAmB9b,GAEtC,OADAA,GAAS,EACF,CAAEnD,QAAO8R,MAAM,GAE1B,MAAO,CAAEA,MAAM,EAAM9R,WAAO+E,KAUxC,aAAagN,EAAMoa,GACf,GAAIrpB,KAAKspB,aAAara,EAAKzS,MACvB,MAAM,IAAIuJ,MAAM,8BAA8BkJ,EAAKzS,6BAEvD,IAAI+sB,EAKAA,EAJCta,EAAKoa,MAIMpa,EAAKoa,WAHY,IAAVA,EAAwBrpB,KAAKmc,mBAAmB9d,OAASgrB,EAKhFpa,EAAK8C,KAAK/R,KAAMupB,GAChBvpB,KAAKmc,mBAAmB1a,KAAKwN,GACzBjP,KAAKuoB,kBAAkC,WAAdvoB,KAAKxD,MAC9BwD,KAAK6oB,SAASxM,gBAAgBrc,KAAKuoB,iBAAkBtZ,GAQ7D,gBAAgBzS,GACZ,MAAM,OAAE6B,GAAW2B,KAAKmc,mBAExB,GADAnc,KAAKmc,mBAAqBnc,KAAKmc,mBAAmB4I,OAAQ/W,GAAQA,EAAIxR,OAASA,GAC3E6B,IAAW2B,KAAKmc,mBAAmB9d,OACnC,MAAM,IAAI0H,MAAM,8BAA8BvJ,sBAOtD,aAAaA,GACT,IAAIyS,EAAOjP,KAAKwpB,qBAAqBhtB,GAIrC,OAHKyS,GAAQjP,KAAKkc,YACdjN,EAAOjP,KAAKkc,UAAUoN,aAAa9sB,IAEhCyS,EAMX,qBAAqBjB,GACjB,OAAOhO,KAAKmc,mBAAmB4I,OAAQ9V,GAASA,EAAKzS,OAASwR,GAAOiB,EAAKoa,QAAUrb,GAAK,IAAM,KAKnG,cAAcX,EAAOoc,EAAYC,EAAevY,GAC5C,IAAKsY,IAAeC,EAChB,OAAO,KAEX,MAAM7a,EAAO7O,KAAK8O,aAClB,IAAK,IAAIC,EAAKF,EAAK/B,QAASiC,EAAGC,KAAMD,EAAKF,EAAK/B,OAAQ,CACnD,MAAM0O,EAAYzM,EAAG7R,MAChBiU,EAAQwY,eAAgBnO,EAAUY,YACnCZ,EAAUoO,aAAavc,EAAOqc,EAAeD,EAAWjO,EAAUhf,MAAO2U,GAGjF,OAAOuY,EAKX,YAAYrc,EAAO1P,EAAQwT,GACvB,KAAMxT,aAAkBqC,KAAK6b,iBACzB,OAAO,KAEX,MAAM3e,EAAQ,GACR2R,EAAO7O,KAAK8O,aAClB,IAAK,IAAIC,EAAKF,EAAK/B,QAASiC,EAAGC,KAAMD,EAAKF,EAAK/B,OAAQ,CACnD,MAAM0O,EAAYzM,EAAG7R,MAChBiU,EAAQ8T,iBAAoBzJ,EAAUY,aACvClf,EAAMse,EAAUhf,MAAQgf,EAAUqO,aAAaxc,EAAO1P,EAAQwT,IAGtE,OAAOjU,EAMX,SACI,MAAMgT,EAAS,GAMf,OALAlQ,KAAKmc,mBAAmB5a,QAASia,IACxBA,EAAUY,aACXlM,EAAOsL,EAAUhf,MAAQgf,KAG1B7e,OAAOkF,OAAOlF,OAAOkF,OAAOlF,OAAOkF,OAAO,CAAEioB,MAAO9pB,KAAKgc,IAAK9L,SAAQ5M,IAAK,CACzEymB,UAAW/pB,KAAK8oB,oBAAoBzY,SACpC2Z,cAAehqB,KAAK+oB,wBAAwB1Y,WAC1CrQ,KAAKkc,WAAa,CAAEN,WAAY5b,KAAKkc,UAAUF,MAAUhc,KAAK4N,cAAgB,CAAEqc,UAAU,IAAWjqB,KAAKqiB,UAAY,CAAEA,SAAUriB,KAAKqiB,WAMrJ,aACI,MAAMvT,EAAa9O,KAAK8O,aACxB,IAAI0M,EACA0O,EACJ,MAAO,CACH,CAACltB,OAAO0W,YACJ,OAAO1T,MAEX,OACI,OAAS,CACL,GAAIkqB,EAAoB,CACpB,MAAMd,EAAOc,EAAmBpd,OAChC,IAAKsc,EAAKpa,KACN,MAAO,CAAE9R,MAAO,CAAEoD,KAAM,CAACkb,EAAUhf,MAAMwoB,OAAOoE,EAAKlsB,MAAMoD,QAE/D4pB,EAAqB,KAEzB,MAAMd,EAAOta,EAAWhC,OACxB,GAAIsc,EAAKpa,KAEL,MAAO,CAAEA,MAAM,EAAM9R,WAAO+E,GAEhCuZ,EAAY4N,EAAKlsB,MACjB,MAAM6E,EAAOyZ,EAAU2O,aACjB3O,EAAU4O,YACV5O,EAAUzZ,KAChB,GAAIA,EAAK4L,SACL,MAAO,CAAEzQ,MAAO,CAAEoD,KAAM,CAACkb,EAAUhf,QAEnCuF,EAAK6L,eACLsc,EAAqBnoB,EAAKqiB,iBAY9C,YAAY5mB,GACR,QAASwC,KAAKqiB,YAAcriB,KAAKqiB,SAAS7kB,GAQ9C,YAAYA,GACR,OAAKwC,KAAKqqB,YAAY7sB,GAGfwC,KAAKqiB,SAAS7kB,GAFV,M,IC/QR8sB,E,OCEX,SAASC,EAAWrtB,GAEhB,OAAOA,aAAiB2P,KAAO3P,EAAMwV,cAAcxP,QAAQ,SAAU,KAAO,KAEhF,SAASsnB,EAAWpa,EAAMqa,GACtB,MAAMznB,EAAuB,iBAAToN,EAAoB,IAAIvD,KAAKuD,GAAQ,KACzD,OAAIqa,GAAgBznB,GAETynB,EAAa/X,gBAAkB1P,EAAK0P,cAAgB+X,EAExDznB,EAEJ,MAAM,UAAkBqlB,EAO3B,YAAYrM,EAAKH,EAAiB6O,GAE9BpgB,MADmC,IAAxB0R,EAAI7d,QAAQ,QAAgB6d,EAAM,OAAOA,EAC1CH,GACV7b,KAAK0qB,cAAgBA,EAKzB,sBACI,OAAOtC,EAAgBK,MAK3B,YAAYpb,EAAOod,GACf,OAAOA,QAAsD,KAAOzqB,KAAK6b,gBAAgB4O,GAM7F,cAAcpd,EAAO+C,EAAMqa,GACvB,OAAOra,QAAsC,KAAOA,EAExD,WACI,MAAO,aAAapQ,KAAKgc,QAGjC,EAAU2O,QAAU,IAAI,cAA0B,EAC9C,cAActd,EAAO+C,EAAMqa,GACvB,MAAuB,iBAATra,EAA6B,UAATA,EAAmB9F,MAAMkT,cAAcnQ,EAAO+C,EAAMqa,KAE5F,UAAWE,SACb,EAAUC,OAAS,IAAI,cAAyB,EAC5C,cAAcvd,EAAO+C,EAAMqa,GACvB,MAAuB,iBAATra,EAAoBya,WAAWza,GAAQ9F,MAAMkT,cAAcnQ,EAAO+C,EAAMqa,KAE5F,SAAU5nB,QACZ,EAAUioB,QAAU,IAAI,cAA0B,EAC9C,cAAczd,EAAO+C,EAAMqa,GACvB,MAAuB,iBAATra,EAAoB+D,SAAS/D,EAAM,IAAM9F,MAAMkT,cAAcnQ,EAAO+C,EAAMqa,KAE9F,UAAW5nB,QACb,EAAUgQ,OAAS,IAAI,cAAyB,IAC9C,SAAUA,QACZ,EAAUkY,SAAW,IAAI,cAA2B,EAChD,YAAY1d,EAAOnQ,GACf,OAAOqtB,EAAWrtB,GAEtB,cAAcmQ,EAAO+C,EAAMqa,GACvB,OAAOD,EAAWpa,EAAMqa,KAE9B,WAAY5d,MACd,EAAUA,KAAO,IAAI,cAAuB,EACxC,YAAYQ,EAAOnQ,GACf,MAAMkT,EAAOma,EAAWrtB,GACxB,OAAOkT,EAAOA,EAAKjO,UAAU,EAAGiO,EAAKjS,QAAQ,MAAQ,KAEzD,cAAckP,EAAO+C,EAAMqa,GACvB,OAAOD,EAAWpa,EAAMqa,KAE9B,OAAQ5d,MACV,EAAUme,KAAO,IAAI,cAAuB,EACxC,YAAY3d,EAAOnQ,GACf,MAAMkT,EAAOma,EAAWrtB,GACxB,OAAOkT,EAAOA,EAAKjO,UAAUiO,EAAKjS,QAAQ,KAAO,GAAK,KAE1D,cAAckP,EAAO+C,EAAMqa,GACvB,MAAuB,iBAATra,EAAoBoa,EAAW,cAAcpa,EAAQqa,GAAgB,OAEzF,OAAQ5d,MACV,EAAUoV,KAAO,IAAI,cAAuB,EACxC,YAAY5U,EAAOnQ,GACf,OAAOA,aAAiB,OAAOA,EAAMsP,GAAK,KAE9C,cAAca,EAAO+C,EAAMqa,GACvB,OAAKra,EAGDqa,GAAgBA,EAAaje,KAAO4D,EAC7Bqa,EAEPpd,EAAMK,GACC,IAAIL,EAAMK,GAAGuU,KAAK7R,GAEtB,KARI,OAUjB,OAAQ,QACV,EAAU6a,SAAW,IAAI,cAA2B,EAChD,YAAY5d,EAAOnQ,GACf,OAAOA,aAAiB+tB,EAAA,EAAW/tB,EAAMmT,SAAW,KAExD,cAAchD,EAAO+C,GACjB,OAAOA,EAAO,IAAI6a,EAAA,EAAS7a,GAAQ,OAEzC,WAAY6a,EAAA,GACd,EAAUC,UAAY,IAAI,cAA4B,EAClD,YAAY7d,EAAOnQ,GACf,OAAOkV,MAAMC,QAAQnV,GAASA,EAAQ,KAE1C,cAAcmQ,EAAO+C,GACjB,OAAOgC,MAAMC,QAAQjC,GAAQA,EAAO,OAE1C,YAAagC,OACf,EAAU+Y,WAAa,IAAI,cAA6B,EACpD,YAAY9d,EAAOnQ,GACf,OAAIA,GAASA,EAAMsmB,cAAgB7mB,OACxBO,EAEJ,OAEb,aAAcP,QDnIhB,SAAW2tB,GACPA,EAAwBA,EAA+B,MAAI,GAAK,QAChEA,EAAwBA,EAA4C,mBAAI,GAAK,qBAC7EA,EAAwBA,EAAkC,SAAI,GAAK,WACnEA,EAAwBA,EAAsC,aAAI,GAAK,eACvEA,EAAwBA,EAAqC,YAAI,GAAK,cACtEA,EAAwBA,EAAqC,YAAI,GAAK,cACtEA,EAAwBA,EAAoC,WAAI,GAAK,aAPzE,CAQGA,IAA4BA,EAA0B,KACzD,MAAMc,EAAiBpuB,OAAO,iBACxBquB,EAAgBruB,OAAO,gBACtB,MAAM,EAKT,YAAYR,EAAM4f,GACdpc,KAAKsrB,MAAO,EACZtrB,KAAKurB,WAAY,EACjBvrB,KAAKwrB,OAAQ,EACbxrB,KAAKqpB,MAAQ,KACbrpB,KAAKyrB,SAAW,KAChBzrB,KAAK0rB,cAAgB,KACrB1rB,KAAKqiB,SAAW,KAChBriB,KAAKoc,aAAeA,EACpBpc,KAAKxD,KAAOA,EAEhB,mBAAmBmhB,EAAKtQ,EAAOse,GAAyB,GAKpD,YAJc1pB,IAAVoL,IAAwBse,QAAkD1pB,IAAxB0b,EAAIyN,IAEtDzuB,OAAOC,eAAe+gB,EAAKyN,EAAgB,CAAEluB,MAAOmQ,EAAOmP,cAAc,IAEtEmB,EAAIyN,GASf,kBAAkBQ,EAAY/X,GAK1B,YAJa5R,IAAT4R,GAEAlX,OAAOC,eAAegvB,EAAYP,EAAe,CAAEnuB,MAAO2W,EAAM2I,cAAc,IAE3EoP,EAAWP,KAAmB,EAKzC,8BACI,OAAQ,EAMZ,oBACI,OAAOrrB,KAAK6rB,wBAA0BvB,EAAwBwB,SAElE,mBACI,OAAO9rB,KAAK6rB,0BAA4BvB,EAAwByB,mBAOpE,KAAKL,EAAerC,GAChB,GAAIrpB,KAAK0rB,cACL,MAAM,IAAI3lB,MAAM,yCAEpB/F,KAAKqpB,MAAQA,EACbrpB,KAAKyrB,SAAW,IAAI,WACpBzrB,KAAK0rB,cAAgBA,EAMzB,SAASxqB,GACL,OAAOlB,KAAKyrB,SAASO,SAAS9qB,EAAQlB,MAM1C,SAASkB,EAAQhE,GACb8C,KAAKyrB,SAASQ,SAAS/qB,EAAQlB,KAAM9C,GAQzC,YAAYM,GACR,QAASwC,KAAKqiB,UAAY7kB,KAAOwC,KAAKqiB,SAQ1C,YAAY7kB,GACR,OAAKwC,KAAKqqB,YAAY7sB,IAGfwC,KAAKqiB,SAAS7kB,IAFV,KAQf,SACI,OAAOb,OAAOkF,OAAO,CAAErF,KAAMwD,KAAKxD,KAAM6sB,MAAOrpB,KAAKqpB,OAAUrpB,KAAKqiB,UAAY,CAAEA,SAAUriB,KAAKqiB,YAGxG,EAAUiI,wBAA0BA,EExH7B,MAAM,UAA0B,EAMnC,YAAY9tB,EAAMuF,EAAMqa,GACpB9R,MAAM9N,EAAM4f,GACZpc,KAAK+B,KAAOA,EAKhB,sBACI,OAAO/B,KAAK+B,KAAK8Z,gBAKrB,8BACI,OAAQ7b,KAAK+B,KAAKymB,iBACd,KAAKJ,EAAgBK,MACjB,OAAO6B,EAAwB7B,MACnC,KAAKL,EAAgBM,WACjB,OAAO4B,EAAwBwB,SACnC,KAAK1D,EAAgBO,OACjB,OAAO2B,EAAwB4B,YACnC,QACI,MAAM,IAAInmB,MAAM,uCAM5B,aAAasH,EAAO1P,EAAQwT,GACxB,MAAMgb,EAAiB,EAAUC,YAAYzuB,EAAQ,IAC/CT,EAAQ8C,KAAKgsB,SAASruB,GACtB0uB,EAAUF,EAAensB,KAAKxD,QAAUU,EAO9C,OANIiU,EAAQsM,aACR0O,EAAensB,KAAKxD,MAAQU,GAE5BmvB,GACAhf,EAAMiB,WAEHtO,KAAK+B,KAAK2hB,YAAYrW,EAAOnQ,EAAOiU,GAK/C,aAAa9D,EAAO1P,EAAQ2uB,EAAWnb,GACnC,MAAMjU,EAAQ8C,KAAK+B,KAAKyb,cAAcnQ,EAAOif,EAAWtsB,KAAKgsB,SAASruB,GAASwT,GAC/E,GAAIA,EAAQsM,WAAY,CACG,EAAU2O,YAAYzuB,EAAQ,IACtCqC,KAAKxD,MAAQU,EAEhC8C,KAAKisB,SAAStuB,EAAQT,GAK1B,SACI,OAAOP,OAAOkF,OAAO,CAAEE,KAAM/B,KAAK+B,KAAKia,KAAO1R,MAAM+F,WC9DrD,IAAIkc,GACX,SAAWA,GACPA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAAqB,KAAI,GAAK,OAC7CA,EAAeA,EAAoB,IAAI,GAAK,MAC5CA,EAAeA,EAAoB,IAAI,GAAK,MAJhD,CAKGA,IAAmBA,EAAiB,KAChC,MAAM,UAAwB,EAMjC,YAAY/vB,EAAMqf,EAAiBuO,GAC/B9f,MAAM9N,GACNwD,KAAKoqB,YAAcA,EACnBpqB,KAAK6b,gBAAkBA,EAK3B,8BACI,OAAOyO,EAAwByB,mBAOnC,SAAS3b,GACL,OACWyC,OADPzC,GAAwB,iBAATA,GAAqB,OAAQA,EAC9BA,EAAK5D,GAET4D,IAGtB,EAAgBmc,eAAiBA,ECrCjC,IAAItuB,EAAkC,SAAUD,EAAGE,GAC/C,IAAIf,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMG,EAAEC,QAAQJ,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOyB,sBACtB,KAAInC,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOyB,sBAAsBJ,GAAI/B,EAAI8B,EAAEM,OAAQpC,IAC3DiC,EAAEC,QAAQJ,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUS,qBAAqBlC,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAWJ,MAAM,UAAmB,EAM5B,YAAY6e,EAAKE,EAAWL,GACxBvR,MAAM0R,EAAKH,GACX7b,KAAKwsB,WAAa,KAClBxsB,KAAKysB,gBAAkB,KACvBzsB,KAAK0sB,YAAc,KACnB1sB,KAAK2sB,eAAiB,IAAI,aAC1B3sB,KAAK4sB,iBAAmB,IAAI,aAC5B5sB,KAAK6sB,iBAAmB,IAAI,aAC5B7sB,KAAK8sB,gBAAkB,IAAI,aAC3B9sB,KAAK+sB,yBAA2B,IAAI,aACpC/sB,KAAKgtB,iBAAmB,IAAI,aAC5BhtB,KAAKkc,UAAYA,EAKrB,sBACI,OAAOkM,EAAgBO,OAE3B,SACI,OAAO3oB,KAAKwsB,YAAcxsB,KAAKkc,UAAU1P,GAE7C,cACI,OAAOxM,KAAKysB,iBAAmBzsB,KAAKkc,UAAU1O,QAElD,UACI,OAAOxN,KAAK0sB,aAAe1sB,KAAKkc,UAAU5Y,IAK9C,mBACI,IAAI,gBAAEuY,GAAoB7b,KAAKkc,UAC/B,GAAIL,IAAoBlf,OACpB,OAAQqD,KAAKxD,MACT,IAAK,OACDqf,EAAkB,OAClB,MACJ,IAAK,OACDA,EAAkB,OAClB,MACJ,QACIA,EAAkB,SAI9B,OAAO7b,KAAK6oB,SAASoE,YAAYpR,GAUrC,eAAenO,EAAIyD,GACf,MAAMmC,EAAO3W,OAAOkF,OAAO,GAAIsP,IACzB,SAAE+b,GAAaxf,EAAG4C,UAClB6c,EAAc,IAAIC,IAClBC,EAAQ1wB,OAAOkH,KAAKqpB,GAC1B,IAAK,IAAIjxB,EAAI,EAAGuE,EAAM6sB,EAAMhvB,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CACjD,MAAMO,EAAO6wB,EAAMpxB,GAEnB,IAAKqX,EAAKga,UAA2C,IAAhCha,EAAKga,QAAQnvB,QAAQ3B,GAAc,CACpD,MACMqS,EADSqe,EAAS1wB,GACJsS,aACpB,IAAK,IAAIC,EAAKF,EAAK/B,QAASiC,EAAGC,KAAMD,EAAKF,EAAK/B,OAAQ,CACnD,MAAMmC,EAAOF,EAAG7R,MAEhB,GAAK+R,aAAgB,GAAqBA,EAAKlN,OAAS/B,MAChDiP,aAAgB,GAAmBA,EAAKmb,cAAgBpqB,KAAO,CACnE,MAAMutB,EAAiBJ,EAAYrwB,IAAImS,EAAKyc,gBAAkB,IAAIjY,IAClE8Z,EAAe3Z,IAAI3E,EAAKzS,MACxB2wB,EAAY5F,IAAItY,EAAKyc,cAAe6B,MAKpD,OAAOJ,EAKX,oBAAoBzf,GAChB,OAAQ1N,KAAKxD,MACT,IAAK,OACD,OAAO,cAAYe,OAAOyC,KAAM0N,GACpC,IAAK,SACD,OAAO,gBAAcnQ,OAAOyC,KAAM0N,GACtC,QACI,OAAO,gBAAcnQ,OAAOyC,KAAM0N,IAc9C,cAAcL,EAAOoc,EAAYC,EAAevY,GAC5C,IAAIkP,EAAIc,EAER,GAA0B,iBAAfsI,EACP,OAA4B,QAAnBpJ,EAAKhT,EAAMK,UAAuB,IAAP2S,OAAgB,EAASA,EAAG3C,aAAa+L,KAAgB,KAEjG,IAAKA,GAAoC,iBAAfA,EACtB,OAAO,KAEX,MAAMrZ,EAAOqZ,EACPnY,EAAM3U,OAAOkF,OAAO,CAAE4b,YAAY,EAAOkM,cAAc,GAASxY,GACtE,IAAIwM,EACJ,GAAI+L,EAAe,CACf,MAAM8D,EAAqB,WAAS1wB,IAAI4sB,GAKnCtZ,EAAK5D,IAAOghB,EAAmBhhB,IAAM4D,EAAK5D,KAAOghB,EAAmBhhB,KACrEmR,EAAM+L,GAMd,GAHK/L,IACDA,EAA0B,QAAnBwD,EAAK9T,EAAMK,UAAuB,IAAPyT,OAAgB,EAASA,EAAGzD,aAAa1d,KAAK6b,gBAAiBzL,EAAK5D,MAErGmR,EACD,OAAO,KAEX,MAAM8P,EAAc,WAAS3wB,IAAI6gB,GAWjC,OATA8P,EAAYC,QAAO,GACnBpjB,MAAMkT,cAAciQ,EAAard,EAAMuN,EAAKrM,GAC5Cmc,EAAYC,QAAO,GACfpc,EAAImM,WACJgQ,EAAYE,gBAENrc,EAAIqY,cACV8D,EAAYnf,WAETqP,EAaX,YAAYtQ,EAAO1P,EAAQwT,GACvB,MAAM,MAAEyc,EAAQ,EAAC,WAAEnQ,GAAa,GAAUtM,GAAW,GAC/C0c,GAAsB,IAAVD,GAAkBA,GAAS,EAEvCH,EAAc9vB,GAAU,WAASb,IAAIa,GAC3C,GAAIkwB,GAAaJ,GAAeA,EAAYpf,YAAa,CAErDof,EAAYC,QAAO,GACnB,MAAMtd,EAAO9F,MAAMoZ,YAAY+J,EAAa9vB,EAAQhB,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIsP,GAAU,CAAEsM,aAAYmQ,MAAwB,kBAAVA,EAAsBA,EAAQA,EAAQ,KAEhK,OADAH,EAAYC,QAAO,GACZtd,EAEX,OAAI/C,EAAMK,IAAM/P,aAAkBqC,KAAK6b,iBACnCle,EAAOgmB,OAAOtW,EAAMK,IACb/P,EAAO6O,IAEX,KAEX,WACI,MAAO,cAAcxM,KAAKgc,OAE9B,SACI,MAAMqE,EAAK/V,MAAM+F,UAAU,IAAE/M,GAAQ+c,EAAIjQ,EAAOnS,EAAOoiB,EAAI,CAAC,QAC5D,OAAO1jB,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIuO,GAAO,CAAE9M,IAAK3G,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIyB,GAAM,CAAEwqB,eAAgB9tB,KAAK+sB,yBAAyB1c,SAAU7E,KAAMxL,KAAK2sB,eAAetc,SAAUwT,OAAQ7jB,KAAKgtB,iBAAiB3c,SAAU1I,OAAQ3H,KAAK4sB,iBAAiBvc,SAAU0T,OAAQ/jB,KAAK6sB,iBAAiBxc,SAAUvP,MAAOd,KAAK8sB,gBAAgBzc,cAGrV,EAAW1T,OAAS,cAAyB,EACzC,iBACI,MAAO,aAEX,cACI2N,MAAM,EAAW3N,OAAOqf,IAAK,KAAMrf,QACnCqD,KAAKwsB,WAAa,IAAI,cAAc,EAChC,cACIliB,MAAM,KAAM,EAAUuI,QAAQ,GAElC,aAAaxF,GACT,OAAOA,EAAMb,SAAMvK,EAEvB,aAAaoL,EAAO1P,EAAQ2uB,GACnBjf,EAAMb,KAEPa,EAAMb,GAAK8f,KAIvBtsB,KAAKwsB,WAAWza,KAAK/R,KAAM,GAC3BA,KAAKwsB,WAAWlB,MAAO,EACvBtrB,KAAKysB,gBAAkB,IAAI,cAAc,EACrC,cACIniB,MAAM,UAAW,EAAUwgB,SAAS,GAExC,aAAazd,GACT,OAAOA,EAAMG,cAAWvL,EAE5B,aAAaoL,EAAO1P,EAAQ2uB,GACpBA,IAEAjf,EAAMG,QAAU8e,KAI5BtsB,KAAKysB,gBAAgB1a,KAAK/R,KAAM,GAChCA,KAAKysB,gBAAgBlB,WAAY,EACjCvrB,KAAK0sB,YAAc,IAAI,cAAc,EACjC,cACIpiB,MAAM,MAAO,EAAU6gB,YAAY,GAEvC,aAAa9d,EAAO1P,EAAQwT,GACxB,MAAM4c,EAAY,EAAU3B,YAAYzuB,EAAQ,IAC1CqwB,EAAeD,EAAUzqB,KAAO,GAChCA,EAAM+J,EAAM/J,IAAI+M,SAetB,OAdkB1T,OAAOkH,KAAKP,GAAK6M,MAAO8d,IACtC,MAAMC,EAAiBF,EAAaC,IAAe,GAC7CE,EAAgB7qB,EAAI2qB,GACpBG,EAAUzxB,OAAOkH,KAAKsqB,GACtBE,EAAU1xB,OAAOkH,KAAKqqB,GAC5B,OAAOE,EAAQ/vB,SAAWgwB,EAAQhwB,QAC3B+vB,EAAQje,MAAO6L,GAAQkS,EAAclS,KAASmS,EAAcnS,OAGnE3O,EAAMiB,WAEN6C,EAAQsM,aACRsQ,EAAUzqB,IAAMA,GAEbA,EAEX,aAAa+J,EAAO1P,EAAQ2uB,EAAWnb,GACnC,MAAM7N,EAAOgpB,GAAa,GAC1B,GAAInb,EAAQsM,WAAY,CACG,EAAU2O,YAAYzuB,EAAQ,IACtC2F,IAAMA,EAEzB+J,EAAM/J,IAAI4a,SAAS5a,KAG3BtD,KAAK0sB,YAAY3a,KAAK/R,KAAM,GAC5BA,KAAK0sB,YAAYlB,OAAQ,EACzBxrB,KAAKmc,mBAAqB,CAACnc,KAAKwsB,WAAYxsB,KAAKysB,gBAAiBzsB,KAAK0sB,aAE3E,sBACI,MAAM,IAAI3mB,MAAM,qDC1RjB,MAAM,UAAuB,EAIhC,sBACI,OAAOqiB,EAAgBM,WAK3B,mBACI,OAAO1oB,KAAK6oB,SAASoE,YAAY,WAKrC,oBAAoBvf,GAChB,OAAO,iBAAenQ,OAAOyC,KAAM0N,GAKvC,cAAcL,EAAOoc,EAAYC,EAAevY,GAC5C,IAAIwM,EAAM+L,EAMV,OALID,IACM9L,aAAe3d,KAAK6b,kBACtB8B,EAAM3d,KAAKzC,WAGZ+M,MAAMkT,cAAcnQ,EAAOoc,EAAY9L,EAAKxM,GAEvD,WACI,MAAO,kBAAkBnR,KAAKgc,QCjC/B,MAAM,UAAsB,EAI/B,iBACI,MAAO,sBAKX,qBACI,OAAOuQ,EAAe+B,KAM1B,YAAY9xB,EAAM4tB,GACd9f,MAAM9N,EAAM4V,MAAOgY,GAKvB,aAAa/c,EAAO1P,EAAQwT,GACxB,MAAMjU,EAAQ8C,KAAKgsB,SAASruB,GAC5B,KAAMT,aAAiB8C,KAAK6b,iBACxB,OAAO,KAEX,MAAMrb,EAAMtD,EAAMmB,OACZof,EAAa,IAAIrL,MAAM5R,GACvB+tB,EAAgB,EAAUnC,YAAYlvB,GACtCivB,EAAiBoC,GAAiB,GACxC,IAAIlC,GAAWkC,GAAiBA,EAAclwB,SAAWmC,EACzD,MAAM4P,EAAO,IAAIgC,MAAM5R,GACvB,IAAK,IAAIvE,EAAI,EAAGA,EAAIuE,EAAKvE,GAAK,EAAG,CAC7B,MAAM8S,EAAK7R,EAAMjB,GACjBmU,EAAKnU,GAAK+D,KAAKoqB,YAAY1G,YAAYrW,EAAO0B,EAAIoC,GAClDsM,EAAWxhB,GAAK8S,EAChBsd,EAAUA,GAAWF,EAAelwB,KAAO8S,EAQ/C,OANIoC,EAAQsM,YACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GAEzC4O,GACAhf,EAAMiB,WAEH8B,EAKX,aAAa/C,EAAO1P,EAAQyS,EAAMe,GAC9B,IAAIjU,EAAQ,KACZ,GAAIkT,EAAM,CACNlT,EAAQ8C,KAAKgsB,SAASruB,GACtB,MAAM6C,EAAM4P,EAAK/R,OACXnB,aAAiB8C,KAAK6b,kBACxB3e,EAAQ,IAAI8C,KAAK6b,gBAAgBrb,IAErC,MAAMid,EAAa,IAAIrL,MAAM5R,GACvB2rB,EAAiB,EAAUC,YAAYlvB,IAAU,GAEnDsD,EAAMtD,EAAMmB,QACZnB,EAAMsxB,OAAOhuB,EAAKtD,EAAMmB,OAASmC,GAErC,IAAK,IAAIvE,EAAI,EAAGA,EAAIuE,EAAKvE,GAAK,EAAG,CAC7B,MAAM8S,EAAK/O,KAAKoqB,YAAY5M,cAAcnQ,EAAO+C,EAAKnU,GAAIkwB,EAAelwB,GAAIkV,GAC7EjU,EAAMjB,GAAK8S,EACX0O,EAAWxhB,GAAK8S,EAEhBoC,EAAQsM,YACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GAGjDzd,KAAKisB,SAAStuB,EAAQT,GAK1B,SACI,OAAOP,OAAOkF,OAAO,CAAEE,KAAM,GAAG,EAAcia,OAAOhc,KAAKoqB,YAAYpO,QAAU1R,MAAM+F,W,WC/EvF,MAAM,UAAqB,EAM9B,YAAY7T,EAAMiyB,EAASrE,GACvB9f,MAAM9N,EAAM4wB,IAAKhD,GACjBpqB,KAAKyuB,QAAUA,EAMnB,iBACI,MAAO,qBAKX,qBACI,OAAOlC,EAAemC,IAK1B,aAAarhB,EAAO1P,EAAQwT,GACxB,MAAMjU,EAAQ8C,KAAKgsB,SAASruB,GAC5B,KAAMT,aAAiB8C,KAAK6b,iBACxB,OAAO,KAEX,MAAM4B,EAAa,GACb0O,EAAiB,EAAUC,YAAYlvB,IAAU,GACvD,IAAImvB,EAAU,EAAUsC,WAAWzxB,KAAWA,EAAM2W,KACpD,MAAMzD,EAAO,GACPvB,EAAO3R,EAAM0xB,UACnB,IAAK,IAAI7f,EAAKF,EAAK/B,QAASiC,EAAGC,KAAMD,EAAKF,EAAK/B,OAAQ,CACnD,MAAM+hB,EAAQ9f,EAAG7R,MACjB,GAAiB,OAAb2xB,EAAM,SAA4B5sB,IAAb4sB,EAAM,GAC3B,MAAM,IAAI,kBAAgB,yCAE9B,MAAMC,EAAU9uB,KAAK+uB,SAAS/uB,KAAKyuB,QAAQ/K,YAAYrW,EAAOwhB,EAAM,GAAI1d,IACxEf,EAAK0e,GAAW9uB,KAAKoqB,YAAY1G,YAAYrW,EAAOwhB,EAAM,GAAI1d,GAC9DsM,EAAWqR,GAAW,CAACD,EAAM,GAAIA,EAAM,IACvCxC,EAAUA,IAAYF,EAAe2C,IAAY,IAAI,KAAOD,EAAM,GAStE,OAPI1d,EAAQsM,aACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GACzC,EAAUkR,WAAWzxB,EAAOA,EAAM2W,OAElCwY,GACAhf,EAAMiB,WAEH8B,EAKX,aAAa/C,EAAO1P,EAAQyS,EAAMe,GAC9B,IAAIjU,EAAQ,KACZ,GAAIkT,EAAM,CACNlT,EAAQ8C,KAAKgsB,SAASruB,GAChBT,aAAiB8C,KAAK6b,kBAExB3e,EAAQ,IAAI8C,KAAK6b,iBAErB,MAAM4B,EAAa,GACb0O,EAAiB,EAAUC,YAAYlvB,IAAU,GACvDA,EAAM8xB,QACN,MAAMC,EAAWtyB,OAAOkH,KAAKuM,GAC7B,IAAK,IAAInU,EAAI,EAAGuE,EAAMyuB,EAAS5wB,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CACpD,MAAM6yB,EAAUG,EAAShzB,GACnBizB,EAAiB/C,EAAe2C,IAAY,GAE5CtxB,EAAMwC,KAAKyuB,QAAQjR,cAAcnQ,EAAOyhB,EAASI,EAAe,GAAI/d,GACpEnD,EAAMhO,KAAKoqB,YAAY5M,cAAcnQ,EAAO+C,EAAK0e,GAAUI,EAAe,GAAI/d,GACpFsM,EAAWqR,GAAW,CAACtxB,EAAKwQ,GAC5B9Q,EAAMqqB,IAAI/pB,EAAKwQ,GAEfmD,EAAQsM,aACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GACzC,EAAUkR,WAAWzxB,EAAOA,EAAM2W,OAG1C7T,KAAKisB,SAAStuB,EAAQT,GAK1B,SACI,OAAOP,OAAOkF,OAAO,CAAEE,KAAM,GAAG,EAAaia,OAAOhc,KAAKyuB,QAAQzS,OAAOhc,KAAKoqB,YAAYpO,QAAU1R,MAAM+F,WC3F1G,MAAM,UAAqB,EAK9B,iBACI,MAAO,qBAKX,qBACI,OAAOkc,EAAe4C,IAM1B,YAAY3yB,EAAM4tB,GACd9f,MAAM9N,EAAMiX,IAAK2W,GAKrB,aAAa/c,EAAO1P,EAAQwT,GACxB,MAAMjU,EAAQ8C,KAAKgsB,SAASruB,GAC5B,KAAMT,aAAiB8C,KAAK6b,iBACxB,OAAO,KAEX,MAAM4B,EAAa,GACb0O,EAAiB,EAAUC,YAAYlvB,IAAU,GACvD,IAAImvB,EAAU,EAAUsC,WAAWzxB,KAAWA,EAAM2W,KACpD,MAAMzD,EAAO,GACPvB,EAAO3R,EAAMkyB,SACnB,IAAK,IAAIhG,EAAOva,EAAK/B,QAASsc,EAAKpa,KAAMoa,EAAOva,EAAK/B,OAAQ,CACzD,MAAMiC,EAAKqa,EAAKlsB,MACVovB,EAAYtsB,KAAKoqB,YAAY1G,YAAYrW,EAAO0B,EAAIoC,GAC1Df,EAAK3O,KAAK6qB,GACV,MAAMyC,EAAW/uB,KAAK+uB,SAASzC,GAC/B7O,EAAWsR,GAAYhgB,EACvBsd,EAAUA,GAAWF,EAAe4C,KAAchgB,EAStD,OAPIoC,EAAQsM,aACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GACzC,EAAUkR,WAAWzxB,EAAOA,EAAM2W,OAElCwY,GACAhf,EAAMiB,WAEH8B,EAKX,aAAa/C,EAAO1P,EAAQyS,EAAMe,GAC9B,IAAIjU,EAAQ,KACZ,GAAIkT,EAAM,CACNlT,EAAQ8C,KAAKgsB,SAASruB,GAChBT,aAAiB8C,KAAK6b,kBACxB3e,EAAQ,IAAI8C,KAAK6b,iBAErB,MAAM4B,EAAa,GACb0O,EAAiB,EAAUC,YAAYlvB,IAAU,GACvDA,EAAM8xB,QACN,IAAK,IAAI/yB,EAAI,EAAGuE,EAAM4P,EAAK/R,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CAChD,MAAMqwB,EAAYlc,EAAKnU,GACjB8yB,EAAW/uB,KAAK+uB,SAASzC,GACzBvd,EAAK/O,KAAKoqB,YAAY5M,cAAcnQ,EAAOif,EAAWH,EAAe4C,GAAW5d,GACtFjU,EAAM0W,IAAI7E,GACV0O,EAAWsR,GAAYhgB,EAEvBoC,EAAQsM,aACR,EAAU2O,YAAYlvB,EAAOugB,GAAY,GACzC,EAAUkR,WAAWzxB,EAAOA,EAAM2W,OAG1C7T,KAAKisB,SAAStuB,EAAQT,GAK1B,SACI,OAAOP,OAAOkF,OAAO,CAAEE,KAAM,GAAG,EAAaia,OAAOhc,KAAKoqB,YAAYpO,QAAU1R,MAAM+F,WC3EtF,MAAM,EACT,cACIrQ,KAAKqvB,OAAS,GACdrvB,KAAKsvB,iBAAmB,KACxB3yB,OAAOkH,KAAK,GAAWtC,QAASguB,IAC5B,MAAMC,EAAY,EAAUD,GACxBC,aAAqB,IACrBxvB,KAAKqvB,OAAOG,EAAUxT,KAAOwT,KAQzC,SAASxT,GACL,GAAIA,KAAOhc,KAAKqvB,OACZ,OAAOrvB,KAAKqvB,OAAOrT,GAEvB,MAAMyT,EAAQzvB,KAAK0vB,WAAW1T,GAE9B,OADAhc,KAAKqvB,OAAOrT,GAAOyT,EACZA,EAMX,YAAYH,GAgBR,OAfAtvB,KAAKsvB,iBAAmB,GACxBA,EAAiB/tB,QAASouB,IACtB3vB,KAAKsvB,iBAAiBK,EAAgB7F,OAAS6F,IAEnDhzB,OAAOkH,KAAK7D,KAAKsvB,kBAAkB/tB,QAASya,IACxC,IACI,MAAMyT,EAAQzvB,KAAK4vB,SAAS5T,GAC5Bhc,KAAK6vB,gBAAgBJ,GAEzB,MAAOvxB,GACH,MAAM,IAAI,kBAAgB,uCAAuC8d,EAAO9d,MAIhF8B,KAAK4vB,SAAS,EAAWjzB,OAAOqf,KACzBhc,KAAKqvB,OAMhB,WAAWrT,GACP,MAAM2T,EAAkB3vB,KAAKsvB,iBAAiBtT,GAC9C,IAAIja,EACJ,GAAIia,IAAQ,EAAWrf,OAAOqf,IAC1Bja,EAAO,IAAI,EAAWpF,WAErB,KAAIgzB,EAUL,MAAM,IAAI9I,UAAU,0BAA0B7K,GAT9C,GAAI2T,EAAgB1F,SAChBloB,EAAO,IAAI,EAAeia,OAEzB,CACD,MAAM8T,EAAsBH,EAAgB/T,YAAc,EAAWjf,OAAOqf,IAC5Eja,EAAO,IAAI,EAAWia,EAAKhc,KAAK4vB,SAASE,KAOjD,GADA/tB,EAAKsgB,SAAW,GACZsN,EAAiB,CACjB5tB,EAAKsgB,SAAWsN,EAAgBtN,UAAY,GAC5C,MAAM0N,EAAcJ,EAAgBrsB,KAAO,GAC3C3G,OAAOkH,KAAKksB,GAAaxuB,QAAS0sB,IAE9BlsB,EAD8BksB,EAAH,cACF/P,SAAS6R,EAAY9B,MAGtD,OAAOlsB,EAMX,gBAAgB0tB,GACZ,MAAME,EAAkB3vB,KAAKsvB,iBAAiBG,EAAMzT,KAC9C9L,EAASyf,EAAgBzf,OAC/BvT,OAAOkH,KAAKqM,GAAQ3O,QAAS/E,IACzB,MAAMwzB,EAAQ9f,EAAO1T,GAChBizB,EAAMnG,aAAa9sB,IACpBizB,EAAMQ,aAAajwB,KAAKkwB,eAAeF,GAAQA,EAAM3G,SAGf,iBAAnCsG,EAAgB/gB,iBAEvB6gB,EAAM7gB,eAAiB,YAAUqC,QAAQwe,EAAOE,EAAgB/gB,iBAWxE,eAAeohB,GAEX,MAAM5T,EAAa4T,EAAMG,SAA+C,IAArCH,EAAMG,MAAMhyB,QAAQ,cAA2D,IAArC6xB,EAAMG,MAAMhyB,QAAQ,cAC3F,KAAE3B,GAASwzB,EACXhU,EAAMgU,EAAMjuB,KAClB,GAAuC,IAAnCia,EAAI7d,QAAQ,mBAA0B,CACtC,MAAMiyB,EAAoB,IAAI,EAAkB5zB,EAAMwD,KAAK4vB,SAAS5T,GAAMI,GAE1E,OADAgU,EAAkB/N,SAAW2N,EAAM3N,SAC5B+N,EAEX,MAAMC,EAAiBrU,EAAI7Z,UAAU,EAAG6Z,EAAI7d,QAAQ,MAC9CisB,EAAcpO,EAAI7Z,UAAU6Z,EAAI7d,QAAQ,KAAO,EAAG6d,EAAI7d,QAAQ,MAAMmyB,OAC1E,OAAQD,GACJ,KAAK,EAAcrU,IACf,OAAO,IAAI,EAAcxf,EAAMwD,KAAK4vB,SAASxF,IACjD,KAAK,EAAapO,IACd,OAAO,IAAI,EAAaxf,EAAMwD,KAAK4vB,SAASxF,IAChD,KAAK,EAAapO,IAAK,CACnB,MAAMyS,EAAUrE,EAAYjoB,UAAU,EAAGioB,EAAYjsB,QAAQ,MAAMmyB,OAC7DC,EAAYnG,EAAYjoB,UAAUioB,EAAYjsB,QAAQ,KAAO,GAAGmyB,OACtE,OAAO,IAAI,EAAa9zB,EAAMwD,KAAK4vB,SAASnB,GAAUzuB,KAAK4vB,SAASW,IAExE,QACI,MAAM,IAAI1J,UAAU,+BAA+B7K,KCpI5D,MAAMwU,EAQT,YAAY3sB,EAAM4sB,GACd,GAAoB,iBAAT5sB,EAAmB,CAC1B,MAAMrG,EAAM,GACZA,EAAIqG,GAAQ2sB,EAAQE,IACpB1wB,KAAK6D,KAAO,CAACrG,QAEZ,GAAI4U,MAAMC,QAAQxO,GACnB7D,KAAK6D,KAAOA,MAEX,KAAIA,EAIL,MAAM,IAAIkC,MAAM,0DAHhB/F,KAAK6D,KAAO,CAACA,GAKjB7D,KAAKywB,QAAoB,IAAXA,EAOlB,gBAAgBrgB,GACZ,OAAO,IAAIogB,EAAQpgB,EAAKvM,KAAMuM,EAAKqgB,QAOvC,OAAOj0B,GACH,IAAK,IAAIP,EAAI,EAAGA,EAAI+D,KAAK6D,KAAKxF,OAAQpC,GAAK,EACvC,GAAI+D,KAAK6D,KAAK5H,GAAGO,GACb,OAAO,EAGf,OAAO,EAOX,iBACI,OAAOwD,KAAK6D,KAAKxF,OAAS,EAO9B,eACI,OAAO2B,KAAKywB,OAOhB,SACI,MAAO,CACHA,OAAQzwB,KAAKywB,OACb5sB,KAAM7D,KAAK6D,OAIvB2sB,EAAQE,IAAM,MACdF,EAAQG,KAAO,O,yBCvER,MAAM,UAAkB,WAK3B,YAAYpgB,GACRjG,QAIAtK,KAAK4wB,eAAgB,EACrB5wB,KAAKktB,SAAW,GAChBltB,KAAK6wB,YAAc,GACnB7wB,KAAK8wB,UAAY,GACjB9wB,KAAK6oB,SAAW,IAAI,WACpB7oB,KAAKuQ,qBAAuBA,EAOhC,KAAKwgB,GACD,GAAI/wB,KAAK4wB,cACL,MAAM,IAAI7qB,MAAM,qCAEpB/F,KAAKke,SAAS6S,GAAiB,IAC/B/wB,KAAK4wB,eAAgB,EAMzB,OAAO7vB,GACH,IAAIib,EAUJ,MATmB,iBAARjb,GACPib,EAAMjb,EACsB,IAAxBib,EAAI7d,QAAQ,UACZ6d,EAAM,OAAOjb,IAIjBib,EAAM,WAASmN,cAAcpoB,GAE1Bib,EAQX,OAAOH,GACH,MAAMG,EAAMhc,KAAKgxB,OAAOnV,GACxB,OAAOG,EAAMhc,KAAKktB,SAASlR,GAAO,KAOtC,SAASH,GACL,IAAIG,EAAM,KACV,GAA+B,iBAApBH,EACPG,EAAMhc,KAAKgxB,OAAOnV,OAEjB,CACD,MAAMoV,EAAiBt0B,OAAOkH,KAAK7D,KAAK8wB,WACxC,IAAK,IAAI70B,EAAI,EAAGuE,EAAMywB,EAAe5yB,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CAC1D,MAAMO,EAAOy0B,EAAeh1B,GACtB8F,EAAO/B,KAAK8wB,UAAUt0B,GAC5B,IAAKuF,EAAK2oB,aAAe3oB,EAAK8Z,kBAAoBA,EAAiB,CAC/DG,EAAMxf,EACN,QAIZ,OAAOwf,EAAMhc,KAAK8wB,UAAU9U,GAAO,KAOvC,WAAWH,GACP,MAAMG,EAAMhc,KAAKgxB,OAAOnV,GACxB,OAAOG,EAAMhc,KAAK6wB,YAAY7U,GAAO,KAQzC,YAAYH,GACR,OAAO7b,KAAKkB,OAAO2a,IAAoB7b,KAAKkxB,WAAWrV,GAM3D,QAAQ9Z,GACJ,IAAIovB,EAAQ,GACZ,GAAIpvB,EAAKqvB,QACLD,EAAQnxB,KAAK8wB,eAEZ,GAAI/uB,EAAK6L,aACV7L,EAAKgQ,KAAK/R,KAAK6oB,UACfsI,EAAQnxB,KAAK6wB,iBAEZ,GAAI9uB,EAAK4L,SAAU,CACpB,MAAM0jB,EAAatvB,EACnBsvB,EAAWtf,KAAK/R,KAAK6oB,UACrBsI,EAAQnxB,KAAKktB,SACgB,OAAzBmE,EAAWnV,WAAsBmV,EAAWrV,MAAQ,EAAWrf,OAAOqf,MACtEqV,EAAWnV,UAAYlc,KAAKkB,OAAO,EAAWvE,OAAOqf,MAG7D,GAAImV,EAAMpvB,EAAKia,KACX,MAAM,IAAIjW,MAAM,YAAYhE,EAAKia,4BAGrC,OADAmV,EAAMpvB,EAAKia,KAAOja,EACXA,EAMX,OACI,IAAK/B,KAAK4wB,cACN,OAAO5wB,KAAKsxB,SAAS,KACjB,MAAM9oB,EAAM,IAAIhC,EAAA,cAChB,OAAOxG,KAAKuQ,qBAAqBhH,KAAKf,GAAK7B,KAAM5C,IAC7C/D,KAAK+R,KAAKhO,EAAS7C,QACZlB,SAInB,MAAM,IAAI+F,MAAM,qCAWpB,KAAK4I,GACD,OAAO3O,KAAKuxB,WAAW5iB,GAAe3O,KAAKqQ,UAAU1J,KAAK,IAAM3G,MAWpE,OAAOoC,GACH,OAAOpC,KAAKuxB,WAAWnvB,GAAMuE,KAAM5C,IAC/B/D,KAAKke,SAASna,EAAS7C,QAChBlB,OAGf,WAAWoC,GACP,OAAOpC,KAAKsxB,SAAS,KACjB,IAAI9oB,EAOJ,OALIA,EADApG,aAAgB,EACV,IAAIoE,EAAA,aAAqBpE,EAAK5F,KAAM4F,EAAKiO,UAGzC,IAAI7J,EAAA,iBAAyBpE,GAEhCpC,KAAKuQ,qBAAqBhH,KAAKf,KAO9C,SACI,IAAKxI,KAAK4wB,cACN,MAAM,IAAI7qB,MAAM,iCAEpB,MAAO,GAAGif,OAAOroB,OAAOkH,KAAK7D,KAAKktB,UAAUvsB,IAAKqb,GAAQhc,KAAKktB,SAASlR,GAAK3L,UAAW1T,OAAOkH,KAAK7D,KAAK6wB,aAAalwB,IAAKqb,GAAQhc,KAAK6wB,YAAY7U,GAAK3L,WAO5J,SAASD,GACL,MACMif,GADU,IAAI,GACGmC,YAAYphB,GACnCpQ,KAAK8wB,UAAY,GACjB9wB,KAAK6wB,YAAc,GACnB7wB,KAAKktB,SAAW,GAChBvwB,OAAOkH,KAAKwrB,GAAQ9tB,QAASya,GAAQhc,KAAKyxB,QAAQpC,EAAOrT,KAS7D,YAAY/N,EAAQ5N,GAChB,MAAMmI,EAAM,IAAIhC,EAAA,gBAAwByH,EAAQtR,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIxB,EAAMgQ,UAAW,CAAEqhB,MAAM,KACzG,OAAO1xB,KAAKuQ,qBAAqBhH,KAAKf,GAS1C,UAAUyF,EAAQ5N,GACd,MAAMmI,EAAM,IAAIhC,EAAA,gBAAwByH,EAAQtR,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIxB,EAAMgQ,UAAW,CAAEqhB,MAAM,KACzG,OAAO1xB,KAAKuQ,qBAAqBhH,KAAKf,GAQ1C,eAAeyF,GACX,MAAMzF,EAAM,IAAIhC,EAAA,eAAuByH,GACvC,OAAOjO,KAAKuQ,qBAAqBhH,KAAKf,GAQ1C,WAAWyF,GACP,MAAMzF,EAAM,IAAIhC,EAAA,YAAoByH,GACpC,OAAOjO,KAAKuQ,qBAAqBhH,KAAKf,GACjC7B,KAAM5C,GAAaA,EAAS7C,OAAOP,IAAKoO,GAAO,IAAIyhB,EAAQzhB,EAAGlL,KAAMkL,EAAG0hB,UACvExpB,MAAO/I,IACR,GAAIA,EAAEwD,SAAW,aAAW1C,kBAAoBd,EAAEwD,SAAW,aAAWvC,iBACpE,OAAO,KAEX,MAAMjB,KC/PX,MAAM,UAA4B,EAIrC,qBACI,OAAOquB,EAAeoF,WAO1B,YAAYn1B,EAAMqf,EAAiBuO,GAC/B9f,MAAM9N,EAAMqf,EAAiBuO,GAC7B9f,MAAM9N,EAAMqf,EAAiBuO,M,6BCfrC,8CAIO,MAAM3c,EACT,cAIIzN,KAAK4xB,KAAO,IAAI,IAIhB5xB,KAAK6xB,MAAQ,IAAI,IAOrB,QACI7xB,KAAK4xB,KAAK5C,QACVhvB,KAAK6xB,MAAM7C,QAQf,KAAK1rB,GAGD,OAFAtD,KAAK4xB,KAAKE,KAAKxuB,EAAIsuB,MACnB5xB,KAAK6xB,MAAMC,KAAKxuB,EAAIuuB,OACb7xB,KAOX,sBACI,OAAOA,KAAK4xB,KAAKG,kBASrB,uBACI,OAAO/xB,KAAK4xB,KAAKI,mBAQrB,cAAcC,GACV,OAAOjyB,KAAK4xB,KAAKM,UAAUD,GAQ/B,aAAaA,GACT,OAAOjyB,KAAK4xB,KAAKO,SAASF,GAQ9B,mBAAmBA,GAEf,OADAjyB,KAAK4xB,KAAKQ,eAAeH,GAClBjyB,KAQX,kBAAkBiyB,GAEd,OADAjyB,KAAK4xB,KAAKS,cAAcJ,GACjBjyB,KAQX,oBAAoBiyB,GAEhB,OADAjyB,KAAK4xB,KAAKU,gBAAgBL,GACnBjyB,KAOX,uBACI,OAAOA,KAAK6xB,MAAME,kBAStB,wBACI,OAAO/xB,KAAK6xB,MAAMG,mBAQtB,eAAeC,GACX,OAAOjyB,KAAK6xB,MAAMK,UAAUD,GAQhC,cAAcA,GACV,OAAOjyB,KAAK6xB,MAAMM,SAASF,GAQ/B,oBAAoBA,GAEhB,OADAjyB,KAAK6xB,MAAMO,eAAeH,GACnBjyB,KAQX,mBAAmBiyB,GAEf,OADAjyB,KAAK6xB,MAAMQ,cAAcJ,GAClBjyB,KAQX,qBAAqBiyB,GAEjB,OADAjyB,KAAK6xB,MAAMS,gBAAgBL,GACpBjyB,KAOX,SACI,MAAO,CACH4xB,KAAM5xB,KAAK4xB,KAAKvhB,SAChBwhB,MAAO7xB,KAAK6xB,MAAMxhB,UAS1B,SAASD,GACLpQ,KAAK4xB,KAAK1T,SAAS9N,EAAKwhB,MAAQ,IAChC5xB,KAAK6xB,MAAM3T,SAAS9N,EAAKyhB,OAAS,O,6BC1L1C,kCAMO,MAAM5G,EAMT,YAAYsH,EAAUC,GAClB,IAAIC,EACAC,EACJ,GAAwB,iBAAbH,EAAuB,CAC9B,MAAMlyB,EAAQkyB,EAASp0B,QAAQ,KAC/Bs0B,EAAM5vB,OAAO0vB,EAASpwB,UAAU,EAAG9B,IACnCqyB,EAAM7vB,OAAO0vB,EAASpwB,UAAU9B,EAAQ,SAEnC+R,MAAMC,QAAQkgB,IAClBE,EAAKC,GAAOH,EAEY,iBAAbA,GACZE,EAAMF,EAASA,SACfG,EAAMH,EAASC,YAGfC,EAA0B,iBAAbF,EAAwBA,EAAW,EAChDG,EAA2B,iBAAdF,EAAyBA,EAAY,GAItD,GAFAxyB,KAAKwyB,UAAYE,EACjB1yB,KAAKuyB,SAAWE,EACZzyB,KAAKuyB,UAAY,IAAMvyB,KAAKuyB,SAAW,GACvC,MAAM,IAAIxsB,MAAM,YAAY/F,KAAKuyB,qDAErC,GAAIvyB,KAAKwyB,WAAa,KAAOxyB,KAAKwyB,UAAY,IAC1C,MAAM,IAAIzsB,MAAM,aAAa/F,KAAKwyB,yDAO1C,iBACI,OAAO,IAAI/rB,QAAQ,CAAEC,EAASiD,KACrBnL,WACDmL,EAAO,IAAI5D,MAAM,4CAEhBvH,UAAUm0B,aACXhpB,EAAO,IAAI5D,MAAM,+CAErBvH,UAAUm0B,YAAYC,mBAAoBntB,IACtCiB,EAAQ,IAAIukB,EAASxlB,EAASotB,OAAON,SAAU9sB,EAASotB,OAAOL,aAC/D5mB,IACAjC,EAAOiC,OAWnB,aAAaknB,GACT,OAAOjwB,QAAQooB,EAAS8H,2BAA6B/yB,KAAKgzB,UAAUF,IAAQG,QAAQ,IASxF,QAAQH,GACJ,OAAOjwB,QAAQooB,EAASiI,sBAAwBlzB,KAAKgzB,UAAUF,IAAQG,QAAQ,IAcnF,UAAUH,GACN,MACMK,EAAKL,EACLM,EAFOpzB,KAEKuyB,SAAWtH,EAASoI,WAChCC,EAAOH,EAAGZ,SAAWtH,EAASoI,WAC9BE,GAAQJ,EAAGX,UAJJxyB,KAIqBwyB,WAAavH,EAASoI,WACxD,OAAOG,KAAKC,KAAMD,KAAKE,IAAIN,GAAQI,KAAKE,IAAIJ,GAAUE,KAAKG,IAAIP,GAAQI,KAAKG,IAAIL,GAAQE,KAAKG,IAAIJ,IAMrG,WACI,MAAO,GAAGvzB,KAAKuyB,YAAYvyB,KAAKwyB,YAMpC,SACI,MAAO,CAAED,SAAUvyB,KAAKuyB,SAAUC,UAAWxyB,KAAKwyB,YAM1DvH,EAASoI,WAAaG,KAAKI,GAAK,IAIhC3I,EAAS8H,2BAA6B,KAItC9H,EAASiI,sBAAwB,M,6BC7HjC,sDACO,MAAMxlB,EAAK,MACd,MAAMmmB,EAAM,IAAI,IACVC,EAAKD,EAAIE,qBAAoB,GAcnC,OAbAp3B,OAAOkF,OAAOiyB,EAAI,CACd,UAAU3iB,GAEN,OADA0iB,EAAIG,UAAU7iB,GACPnR,MAEX,QAAQi0B,EAAW/uB,EAAQkM,EAAcC,GACrC,OAAInM,aAAkBiK,SACXnP,KAAKk0B,QAAQD,OAAWhyB,EAAWiD,EAAQkM,IAEtDyiB,EAAIK,QAAQD,EAAW/uB,GAChBlF,KAAKkT,MAAM9B,EAAcC,OAGjCyiB,GAhBO,I,6BCDlB,8GAAI5Q,EAA0C,SAAUC,EAAYzG,EAAQlf,EAAK4lB,GAC7E,IAA2H7mB,EAAvHD,EAAI8gB,UAAU/e,OAAQtB,EAAIT,EAAI,EAAIogB,EAAkB,OAAT0G,EAAgBA,EAAOzmB,OAAOmV,yBAAyB4K,EAAQlf,GAAO4lB,EACrH,GAAuB,iBAAZC,SAAoD,mBAArBA,QAAQC,SAAyBvmB,EAAIsmB,QAAQC,SAASH,EAAYzG,EAAQlf,EAAK4lB,QACpH,IAAK,IAAInnB,EAAIknB,EAAW9kB,OAAS,EAAGpC,GAAK,EAAGA,KAASM,EAAI4mB,EAAWlnB,MAAIc,GAAKT,EAAI,EAAIC,EAAEQ,GAAKT,EAAI,EAAIC,EAAEmgB,EAAQlf,EAAKT,GAAKR,EAAEmgB,EAAQlf,KAAST,GAChJ,OAAOT,EAAI,GAAKS,GAAKJ,OAAOC,eAAe8f,EAAQlf,EAAKT,GAAIA,GAE5DkB,EAAkC,SAAUD,EAAGE,GAC/C,IAAIf,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMG,EAAEC,QAAQJ,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOyB,sBACtB,KAAInC,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOyB,sBAAsBJ,GAAI/B,EAAI8B,EAAEM,OAAQpC,IAC3DiC,EAAEC,QAAQJ,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUS,qBAAqBlC,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAaJ,MAAMg3B,UAAsB,WAI/B,YAAY5jB,GACRjG,QAIAtK,KAAKo0B,KAAOhiB,MAIZpS,KAAKyT,IAAMA,IAIXzT,KAAKotB,IAAMA,IAIXptB,KAAKirB,SAAW,IA2ChBjrB,KAAK4R,IAAM,SAAOrU,OAAOyC,MAIzBA,KAAKkG,WAAa,KAMlBlG,KAAKktB,SAAW,GAChBltB,KAAK7D,QAAU,IAAI,UAAQ6D,MAI3BA,KAAK2S,GAAK,KAIV3S,KAAK6f,SAAW,KAIhB7f,KAAKqH,aAAe,KAIpBrH,KAAKq0B,YAAc,KAInBr0B,KAAKs0B,eAAiB,KAKtBt0B,KAAKu0B,eAAiB,KAItBv0B,KAAKw0B,mBAAqB,GAI1Bx0B,KAAKy0B,gBAAkB,IAAI,WAM3Bz0B,KAAKiiB,KAAO,KACZjiB,KAAKuQ,qBAAuBA,EAC5BvQ,KAAKsQ,UAAYC,EAAqBD,UACtCtQ,KAAK4Q,KAAOL,EAAqBK,KAMrC,aACI,QAAS5Q,KAAKkG,WAKlB,YACI,OAAOlG,KAAKqH,aAAaG,MAM7B,wBACI,OAAQxH,KAAK00B,mBAKjB,mBACI,QAAS10B,KAAKq0B,YAKlB,yBACI,QAASr0B,KAAK6f,SAMlB,UAAU3iB,GACN8C,KAAKqH,aAAaM,OAAOzK,GAQ7B,UAAUy3B,EAAWC,EAAavtB,GAC9BrH,KAAKkG,WAAayuB,EAClB30B,KAAKqH,aAAeA,EACpBrH,KAAKw0B,mBAAqBx0B,KAAKuQ,qBAAqBskB,UACpD70B,KAAKiiB,KAAO,cAAY1kB,OAAOyC,MAC/BA,KAAK80B,qBAAqB90B,KAAKsQ,UAAUugB,aACzC7wB,KAAK80B,qBAAqB90B,KAAKsQ,UAAU4c,UACrC0H,IACIA,EAAYjhB,QACZ3T,KAAK+0B,cAAcH,EAAYjhB,QAE/BihB,EAAYhiB,MAAQvL,EAAaG,OACjCxH,KAAKg1B,YAAYJ,EAAYhiB,MAAM,GAEnC5S,KAAKw0B,mBAAqB,GAAKI,EAAYP,aAAe,SAAS,UACnEr0B,KAAKi1B,mBAAmBL,EAAYP,cAQhD,qBAAqBlD,GACjB,MAAM/B,EAASzyB,OAAOyyB,OAAO+B,GAC7B,IAAK,IAAIl1B,EAAI,EAAGA,EAAImzB,EAAO/wB,OAAQpC,GAAK,EAAG,CACvC,MAAM8F,EAAOqtB,EAAOnzB,IACd,KAAEO,GAASuF,EACb/B,KAAKxD,IACLuF,EAAK8Z,gBAAkB7b,KAAKxD,GAC5BG,OAAOC,eAAeoD,KAAMxD,EAAM,CAC9BU,MAAO6E,EAAKmzB,oBAAoBl1B,SAIpCrD,OAAOC,eAAeoD,KAAMxD,EAAM,CAC9B,MAII,OAHAG,OAAOC,eAAeoD,KAAMxD,EAAM,CAC9BU,MAAO6E,EAAKmzB,oBAAoBl1B,QAE7BA,KAAKxD,IAEhB,IAAIqf,GACA9Z,EAAK8Z,gBAAkBA,GAE3BW,cAAc,KAK9B,KAAKhW,EAAS2uB,GAAwB,GAClC,IAAKn1B,KAAKkG,WACN,MAAM,IAAIH,MAAM,wCAEpB,MAAMyC,EAAMhC,EACZgC,EAAInB,aAAarH,KAAKqH,cACtB,IAAIyC,EAAS9J,KAAKkG,WAAWqD,KAAKf,GASlC,OARK2sB,IACDrrB,EAASA,EAAO7C,MAAO/I,IAInB,MAHIA,EAAEwD,SAAW,aAAW3C,iBACxBiB,KAAKo1B,UAEHl3B,KAGP4L,EAcX,aAAaurB,EAAa73B,GACtB,IACIuE,EADAyK,EAAK,KAET,GAAIhP,EAAK,CACL,MAAM83B,EAAW93B,EACjBuE,EAAO/B,KAAKsQ,UAAUpP,OAAOm0B,GAEzB7oB,EADgC,IAAhC8oB,EAASn3B,QA1PP,QA2PGm3B,EAGA,GAAGvzB,EAAKia,OAAOpb,mBAAmB00B,UAG1C,GAA2B,iBAAhBD,EAA0B,CACtC,MAAME,EAAWF,EAAYl3B,QAAQ,IAlQ/B,OAkQ8CE,SAClC,IAAdk3B,IACA/oB,EAAK6oB,GAETtzB,EAAO/B,KAAKsQ,UAAUpP,QAAqB,IAAdq0B,EAAkBF,EAAYlzB,UAAU,EAAGozB,GAAYF,QAGpFtzB,EAAO/B,KAAKsQ,UAAUpP,OAAOm0B,GAEjC,IAAIn0B,EAASlB,KAAKktB,SAAS1gB,GAC3B,IAAKtL,EAAQ,CACTA,EAASa,EAAKxE,SACd,MAAM8kB,EAAW,WAASvlB,IAAIoE,GAC1BsL,IACA6V,EAAS7V,GAAKA,GAElB6V,EAASmT,iBACTx1B,KAAKy1B,QAAQv0B,GAEjB,OAAOA,EAUX,mBAAmBw0B,GACf,OAAO,IAAI,UAAQ11B,KAAM01B,GAS7B,QACI11B,KAAKktB,SAAW,GAapB,QAEI,OADAltB,KAAKkG,WAAa,KACXlG,KAAKgvB,QAQhB,SAAS9tB,GACL,QAASA,KAAYA,EAAOsL,IAAMxM,KAAKktB,SAAShsB,EAAOsL,MAAQtL,EAQnE,aAAaA,GACT,SAAUA,GAAUA,EAAOsL,IAAMxM,KAAKktB,SAAShsB,EAAOsL,KAY1D,OAAOtL,GAEH,OADc,WAASpE,IAAIoE,GACdowB,SAAS,KAClBtxB,KAAK21B,gBAAgBz0B,GACduF,QAAQC,QAAQxF,KAU/B,aAAaA,EAAQiQ,GACjB,IAAKA,IAAYA,EAAQyc,MACrB,OAAOnnB,QAAQC,QAAQxF,GAE3B,MAAM00B,EAAWzkB,EAAQykB,UAAY,GAC/BC,EAAW,GACXC,EAAan5B,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIsP,GAAU,CAAEykB,WAAUhI,OAAyB,IAAlBzc,EAAQyc,OAAwBzc,EAAQyc,MAAQ,IAOhI,OANA5tB,KAAK+1B,eAAe70B,EAAQ,GAAGK,QAASy0B,IAClB,OAAdA,IAAuD,IAAjCJ,EAASz3B,QAAQ63B,IAAqBA,EAAUxpB,KACtEopB,EAASn0B,KAAKu0B,GACdH,EAASp0B,KAAKzB,KAAKwL,KAAKwqB,EAAUxpB,QAAIvK,EAAW6zB,OAGlDrvB,QAAQoe,IAAIgR,GAAUlvB,KAAK,IAAMzF,GAY5C,KAAKm0B,EAAaY,EAAK9kB,GACnB,MAAMG,EAAMH,GAAW,GACjBjQ,EAASlB,KAAK0d,aAAa2X,EAAaY,GACxC5oB,EAAQ,WAASvQ,IAAIoE,GAC3B,IAAKoQ,EAAIqQ,SAAWrQ,EAAIwS,OAASzW,EAAMgB,YACnC,OAAOrO,KAAKk2B,aAAah1B,EAAQoQ,GAErC,MAAM9I,EAAM,IAAI,YAAmB6E,EAAMY,OAAQZ,EAAM7P,KAEvD,OADAwC,KAAK0hB,kBAAkBxgB,EAAOsL,GAAIhE,EAAK8I,EAAIqQ,SACpC3hB,KAAKuJ,KAAKf,GAAK7B,KAAM5C,GAGpB7C,EAAOsM,SAAWtM,EAAOsM,QAAUzJ,EAAS7C,OAAOsM,SACnD8D,EAAIqQ,SAAU,EACP3hB,KAAKwL,KAAK6pB,EAAaY,EAAK3kB,KAEvCtR,KAAK4hB,eAAe7d,EAAS7C,OAAOsL,IAChCzI,EAASrC,SAAW,aAAW5C,cAC/BuO,EAAMtL,KAAKyb,cAAcnQ,EAAOtJ,EAAS7C,OAAQA,EAAQ,CAAEuc,YAAY,IAEpEzd,KAAKk2B,aAAah1B,EAAQoQ,IACjCpT,IACA,GAAIA,EAAEwD,SAAW,aAAWvC,iBAGxB,OAFAa,KAAK21B,gBAAgBz0B,GACrBmM,EAAM8oB,aACC,KAEX,MAAMj4B,IAQd,OAAOgD,EAAQiQ,GACX,MAAMG,EAAMH,GAAW,GACvB,IAAIilB,EACJ,OAAOp2B,KAAKq2B,MAAMn1B,EAAQoQ,EAAK,CAACjE,EAAO+C,KACnC,GAAI/C,EAAMG,QACN,MAAM,IAAI,kBAAgB,uCAG9B,OADA4oB,GAAS/oB,EAAMb,GACR,IAAI,eAAsBa,EAAMY,OAAQmC,KAChDzJ,KAAMqH,IACDooB,GACAp2B,KAAKy1B,QAAQv0B,GAEV8M,IAQf,OAAO9M,EAAQiQ,GACX,MAAMG,EAAMH,GAAW,GACvB,OAAOnR,KAAKq2B,MAAMn1B,EAAQoQ,EAAK,CAACjE,EAAO+C,KACnC,IAAK/C,EAAMG,QACP,MAAM,IAAI,kBAAgB,kCAE9B,GAAI8D,EAAI6Q,MAAO,CACX,MAAM,QAAE3U,GAAY4C,EAAMkmB,EAAqBr4B,EAAOmS,EAAM,CAAC,YAC7D,OAAO,IAAI,gBAAuB/C,EAAMY,OAAQZ,EAAM7P,IAAK84B,GACtDnzB,QAAQ,KAEjB,OAAO,IAAI,gBAAuBkK,EAAMY,OAAQZ,EAAM7P,IAAK4S,GACtDjN,QAAQ,GAAGkK,EAAMG,WAS9B,KAAKtM,EAAQiQ,EAASolB,GAAc,GAChC,MAAMjlB,EAAMH,GAAW,GACjBqlB,EAAa,CAACnpB,EAAO+C,KACvB,GAAIkB,EAAI6Q,MAAO,CACX,IAAK9U,EAAMb,GACP,MAAM,IAAI,kBAAgB,kDAE9B,MAAM,QAAEgB,GAAY4C,EAAMkmB,EAAqBr4B,EAAOmS,EAAM,CAAC,YAC7D,OAAO,IAAI,gBAAuB/C,EAAMY,OAAQZ,EAAM7P,IAAK84B,GAE/D,OAAIjpB,EAAMG,QACC,IAAI,gBAAuBH,EAAMY,OAAQZ,EAAM7P,IAAK4S,GACtDjN,QAAQkK,EAAMG,SAEhB,IAAI,eAAsBH,EAAMY,OAAQmC,IAEnD,OAAOmmB,EAAcv2B,KAAKy2B,cAAcv1B,EAAQoQ,EAAKklB,GAAcx2B,KAAKq2B,MAAMn1B,EAAQoQ,EAAKklB,GAO/F,eAAet1B,EAAQ8iB,GACnB,OAAO,WAASlnB,IAAIoE,GAAQowB,SAAS,IAAMtxB,KAAK02B,gBAAgBx1B,EAAQ8iB,IAQ5E,gBAAgB9iB,EAAQ8iB,GACpB,IAAI2S,GAAQ,EACZ,MAGMC,EAAUnwB,QAAQC,QAAQsd,EAAG9iB,EAHnB,KACZy1B,GAAQ,KAGZ,OAAIA,EACOlwB,QAAQC,QAAQxF,GAEpB01B,EAAQjwB,KAAK,IAAO3G,KAAK4jB,KAAK1iB,EAAQ,IAAI,GAC5C+F,MAAO/I,IACR,GAAiB,MAAbA,EAAEwD,OACF,OAAO1B,KAAK2hB,QAAQzgB,EAAQ,IACvByF,KAAK,IAAM3G,KAAK02B,gBAAgBx1B,EAAQ8iB,IAEjD,MAAM9lB,KAWd,cAAcgD,EAAQiQ,EAASqlB,GAC3Bx2B,KAAK2jB,OAAOziB,GACZ,MAAMmM,EAAQ,WAASvQ,IAAIoE,GAC3B,IAAI21B,EACAzmB,EAOJ,GANI/C,EAAMgB,cAEN+B,EAAO/C,EAAMtL,KAAK2hB,YAAYrW,EAAOnM,EAAQ,CACzCuc,YAAY,KAGhBpQ,EAAMypB,QAAS,CACV3lB,EAAQwQ,SACTtU,EAAMsgB,gBAEV,MAAMoJ,EAAc/2B,KAAKuJ,KAAKitB,EAAWnpB,EAAO+C,IAAOzJ,KAAM5C,IACrDsJ,EAAMb,IAAMa,EAAMb,KAAOzI,EAAS7C,OAAOsL,KACzCxM,KAAK21B,gBAAgBz0B,GACrBmM,EAAMb,GAAKzI,EAAS7C,OAAOsL,GAC3BxM,KAAKy1B,QAAQv0B,IAEjBmM,EAAMtL,KAAKyb,cAAcnQ,EAAOtJ,EAAS7C,OAAQA,EAAQ,CACrDuc,WAAYtM,EAAQwQ,QACpBgI,cAAexY,EAAQwQ,UAEpBzgB,GACPhD,IACA,GAAIA,EAAEwD,SAAW,aAAWvC,iBAGxB,OAFAa,KAAK21B,gBAAgBz0B,GACrBmM,EAAM8oB,aACC,KAGX,MADA9oB,EAAMiB,WACApQ,IAEV24B,EAAc,CAACE,QAGfF,EAAc,CAACpwB,QAAQC,QAAQxF,IAEnC,MAAM40B,EAAan5B,OAAOkF,OAAO,GAAIsP,GAKrC,OAJA2kB,EAAWlI,MAAQ,EACnB5tB,KAAK+1B,eAAe70B,EAAQiQ,EAAQyc,OAAOrsB,QAASy1B,IAChDH,EAAYp1B,KAAKzB,KAAKq2B,MAAMW,EAAKlB,EAAYU,MAE1C/vB,QAAQoe,IAAIgS,GAAalwB,KAAK,IAAMzF,GAU/C,MAAMA,EAAQiQ,EAASqlB,GACnBx2B,KAAKi3B,6BACL,MAAM5pB,EAAQ,WAASvQ,IAAIoE,GAI3B,OAHImM,EAAMG,SACNxN,KAAKuhB,eAAergB,EAAOsL,IAExBa,EAAMikB,SAAS,IAAMtxB,KAAKy2B,cAAcv1B,EAAQiQ,EAASqlB,IAUpE,eAAet1B,EAAQ0sB,EAAOgI,EAAW,GAAIsB,GACzC,IAAKtJ,EACD,OAAOgI,EAEX,MAAMjY,EAAMuZ,GAAiBh2B,EAEvB2N,EADQ,WAAS/R,IAAIoE,GACRa,KAAKqiB,aACxB,IAAK,IAAIgF,EAAOva,EAAK/B,QAASsc,EAAKpa,KAAMoa,EAAOva,EAAK/B,OAAQ,CACzD,MAAM,MAAE5P,GAAUksB,EACZ+N,EAAcn3B,KAAKo3B,qBAAqBl2B,EAAQhE,EAAMoD,MAC5D,IAAK,IAAIrE,EAAI,EAAGuE,EAAM22B,EAAY94B,OAAQpC,EAAIuE,EAAKvE,GAAK,EAAG,CACvD,MAAM+5B,EAAYmB,EAAYl7B,IACO,IAAjC25B,EAASz3B,QAAQ63B,IAAqBA,IAAcrY,IACpDiY,EAASn0B,KAAKu0B,GACdh2B,KAAK+1B,eAAeC,GAAqB,IAAVpI,EAAiBA,EAAQA,EAAQ,EAAGgI,EAAUjY,KAIzF,OAAOiY,EAQX,qBAAqB10B,EAAQZ,GACzB,IAAI62B,EAAc,CAACj2B,GAyBnB,OAxBAZ,EAAKiB,QAAS81B,IACV,MAAMC,EAAiB,GACvBH,EAAY51B,QAASy0B,IACjB,MAAMuB,EAAYvB,EAAUqB,GAC5B,IAAKE,EACD,OAEJ,MAAM/b,EAAYxb,KAAKsQ,UAAU3B,YAAYqnB,EAAUxS,aAAa8F,aAAa+N,GACjF,GAAI7b,aAAqB,kBAAiB,CACtC,MAAM3M,EAAO0oB,EAAU3I,UACvB,IAAK,IAAIxF,EAAOva,EAAK/B,QAASsc,EAAKpa,KAAMoa,EAAOva,EAAK/B,OAAQ,CACzD,MAAM+hB,EAAQzF,EAAKlsB,MACnBo6B,EAAe71B,KAAKotB,EAAM,IACtBrT,aAAqB,gBAAgBA,EAAUiT,QAAQ9gB,UACvD2pB,EAAe71B,KAAKotB,EAAM,UAKlCyI,EAAe71B,KAAK81B,KAG5BJ,EAAcG,IAEXH,EAQX,OAAOj2B,EAAQiQ,GACX,MAAMG,EAAMH,GAAW,GACvBnR,KAAK2jB,OAAOziB,GACZ,MAAMmM,EAAQ,WAASvQ,IAAIoE,GAC3B,OAAOmM,EAAMikB,SAAS,KAClB,IAAKjkB,EAAMG,UAAY8D,EAAI6Q,MACvB,MAAM,IAAI,qBAAmBjhB,GAEjC,MAAMsH,EAAM,IAAI,eAAsB6E,EAAMY,OAAQZ,EAAM7P,KAC1DwC,KAAKuhB,eAAergB,EAAOsL,IACtB8E,EAAI6Q,OACL3Z,EAAIrF,QAAQ,GAAGkK,EAAMG,SAEzB,MAAMqpB,EAAc,CAAC72B,KAAKuJ,KAAKf,GAAK7B,KAAK,KACjC3G,KAAK21B,gBAAgBz0B,GACrBmM,EAAM8oB,aACCj1B,KAET40B,EAAan5B,OAAOkF,OAAO,GAAIyP,GAKrC,OAJAwkB,EAAWlI,MAAQ,EACnB5tB,KAAK+1B,eAAe70B,EAAQoQ,EAAIsc,OAAOrsB,QAASy1B,IAC5CH,EAAYp1B,KAAKzB,KAAK+jB,OAAOiT,EAAKlB,MAE/BrvB,QAAQoe,IAAIgS,GAAalwB,KAAK,IAAMzF,KAQnD,QACI,MAAM,IAAI6E,MAAM,oBAOpB,QAAQ7E,GACJlB,KAAK2jB,OAAOziB,GAQhB,QAAQA,EAAQiQ,GACZ,OAAKjQ,EAAOsL,GAILxM,KAAKwL,KAAKtK,EAAOsL,QAAIvK,EAAWtF,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIsP,GAAU,CAAEwQ,SAAS,KAFjFlb,QAAQC,QAAQxF,GAS/B,OAAOA,GACH,IAAKlB,KAAKw3B,SAASt2B,GAAS,CAExB,IADalB,KAAKsQ,UAAUpP,OAAOA,EAAOsiB,aAEtC,MAAM,IAAI,qBAAmBtiB,GAEjC,GAAIlB,KAAKy3B,aAAav2B,GAClB,MAAM,IAAI,oBAAkBA,GAEhClB,KAAKy1B,QAAQv0B,IAGrB,QAAQA,GACJ,MAAMmhB,EAAW,WAASvlB,IAAIoE,GAC9B,GAAImhB,EAASqV,YACT,GAAIrV,EAAS3U,KAAO1N,KAChB,MAAM,IAAI,oBAAkBkB,QAIhCmhB,EAAS3U,GAAK1N,KAEbqiB,EAAS7V,IACiB,SAAvB6V,EAAStgB,KAAKvF,MAA0C,SAAvB6lB,EAAStgB,KAAKvF,MAA0C,gBAAvB6lB,EAAStgB,KAAKvF,OAChF6lB,EAAS7V,GAAK,GA5tBZ,OA4tB2B6V,EAAStgB,KAAKvF,QAAQ,oBAGvD6lB,EAAS7V,KACTxM,KAAKktB,SAAS7K,EAAS7V,IAAMtL,GAGrC,gBAAgBA,GACZ,MAAMmM,EAAQ,WAASvQ,IAAIoE,GAC3B,IAAKmM,IAAUA,EAAMb,GACjB,MAAM,IAAI,qBAAmBtL,UAE1BlB,KAAKktB,SAAS7f,EAAMb,IAE/B,SAASoG,EAAMkL,EAAUC,GACrB,MAAMK,EAAQL,EAAc,cAAY4Z,SACxC,GAAI33B,KAAK2S,IAAMyL,EACX,MAAM,IAAI,kBAAgB,8BAE9B,OAAOpe,KAAKsxB,SAAS,KACjB,MAAM9oB,EAAM,IAAI,WAAkB,CAAEoK,OAAMkL,WAAUM,UACpD,OAAOpe,KAAK43B,aAAapvB,EAAKuV,KAGtC,MAAMI,EAAUL,EAAUC,GACtB,GAAI/d,KAAK2S,GACL,MAAM,IAAI,kBAAgB,8BAE9B,OAAO3S,KAAKsxB,SAAS,KACjB,MAAM9oB,EAAM,IAAI,QAAe,CAAE2V,WAAUL,aAC3C,OAAO9d,KAAK43B,aAAapvB,EAAKuV,KAGtC,SACI,OAAO/d,KAAKsxB,SAAS,IAAMtxB,KAAKuJ,KAAK,IAAI,UAAmB5C,KAAK3G,KAAKo1B,QAAQ33B,KAAKuC,QAEvF,eAAe63B,EAAUnY,EAAUvO,GAC/B,IAAKnR,KAAKkG,WACN,MAAM,IAAIH,MAAM,wCAEpB,GAAI/F,KAAK2S,GACL,MAAM,IAAI,kBAAgB,8BAE9B,MAAMrB,EAAM3U,OAAOkF,OAAO,CAAEi2B,MAAO,cAAcD,EAAYE,QAAS,IAAe1qB,MAAO,GAAI0Q,aAAa,GAAQ5M,GAIrH,IAAI3I,EACJ,GAJI8I,EAAI0mB,UACJr7B,OAAOkF,OAAOyP,EAAIjE,MAAO,CAAE2qB,SAAU1mB,EAAI0mB,SAAUja,YAAazM,EAAIyM,eAGpE,gBAAc8Z,GAKd,MAAM,IAAI9xB,MAAM,kBAAkB8xB,oBAJlCrvB,EAAM,IAAI,gBAAcqvB,GAAUnY,EAAUpO,EAAI6N,MAAO5b,KAAKC,UAAU8N,EAAIjE,QAC1E7E,EAAIyvB,kBAAkBj4B,KAAKkG,WAAWd,OAASpF,KAAKkG,WAAWf,UAK/DmM,EAAIhR,MACJkI,EAAIlI,KAAKgR,EAAIhR,MAEjB,MAAM43B,EAAgB,CAAEjZ,MAAO,GAAG3N,EAAI2N,MAASC,OAAQ,GAAG5N,EAAI4N,QAC9D,GAAI5N,EAAI0mB,SAAU,CAGd,MAAMG,GAAiD,IAArCxtB,SAASytB,IAAIj6B,QAAQ,aAA2D,IAAtCwM,SAASytB,IAAIj6B,QAAQ,YAEjF,OADA6B,KAAKq4B,gBAAgB7vB,EAAIxH,QAAQV,KAAM63B,EAAY,QAAU,UAAWD,GACjE,IAAIzxB,QAAQ,QAEvB,MAAM6xB,EAAMt4B,KAAK43B,aAAapvB,EAAK8I,EAAIyM,aAEvC,OADA/d,KAAKq4B,gBAAgB7vB,EAAIxH,QAAQV,KAAMgR,EAAIwmB,MAAOI,GAC3C,IAAIzxB,QAAQ,CAACC,EAASiD,KACzB,MAAMouB,EAAUpsB,WAAW,KACvBhC,EAAO,IAAI,kBAAgB,0BAC5B2H,EAAIymB,SACPO,EAAI3xB,KAAKD,EAASiD,GAAQhD,KAAK,KAC3B4xB,aAAaR,OAWzB,gBAAgB9xB,EAAKuyB,EAAernB,GAChC,MAAMX,EAAM7T,OAAOkH,KAAKsN,GACnB4T,OAAQvnB,QAAyByE,IAAjBkP,EAAQ3T,IACxBmD,IAAKnD,GAAQ,GAAGA,KAAO2T,EAAQ3T,MAC/BqD,KAAK,KACVsI,KAAKlD,EAAKuyB,EAAehoB,GAE7B,MAAMuN,GACF,OAAO/d,KAAKsxB,SAAS,KACjB,MAAM9oB,EAAM,IAAI,KAChB,OAAOxI,KAAK43B,aAAapvB,EAAKuV,KAGtC,YAAYI,EAAUL,EAAUU,GAC5B,OAAOxe,KAAKsxB,SAAS,KACjB,MAAM9oB,EAAM,IAAI,cAAqB,CAAE2V,WAAUL,WAAUU,gBAC3D,OAAOxe,KAAKuJ,KAAKf,GAAK,GAAM7B,KAAM5C,GAAa/D,KAAKg1B,YAAYjxB,EAAS7C,WAGjF,qBAAqBsG,EAAOgX,EAAaT,GACrC,OAAO/d,KAAKsxB,SAAS,IAAOtxB,KAAK43B,aAAa,IAAI,cAAqB,CAAEpwB,QAAOgX,gBAAgBT,IAEpG,cAAcI,GACV,OAAOne,KAAKuJ,KAAK,IAAI,gBAAuB,CAAE4U,cAElD,eAAeA,EAAUQ,EAAab,GAClC,OAAO9d,KAAKuJ,KAAK,IAAI,iBAAwB,CAAE4U,WAAUQ,cAAab,cAE1E,YAAYH,EAAK8a,GAAW,GACxB,MAAM7lB,EAAO5S,KAAK0d,aAAaC,EAAInR,IAC7B6V,EAAW,WAASvlB,IAAI8V,GAK9B,OAJAyP,EAAStgB,KAAKyb,cAAc6E,EAAU1E,EAAK/K,EAAM,CAAE6K,YAAY,IAC3Dgb,IACAz4B,KAAK2S,GAAKC,GAEPA,EAEX,UACI5S,KAAK2S,GAAK,KACV3S,KAAKwH,MAAQ,KAEjB,aAAagB,EAAKuV,GACd,MAAMzM,OAAsBrP,IAAhB8b,GAAmCA,EACzCK,EAAQ9M,EAAM,cAAYqmB,SAIhC,OAHIvZ,IACApe,KAAKqH,aAAa2M,UAAY1C,EAAM,cAAYonB,eAE7C14B,KAAKuJ,KAAKf,GAAM4V,GAClBzX,KAAM5C,GAAcA,EAAS7C,OAASlB,KAAKg1B,YAAYjxB,EAAS7C,OAAQkd,GAAS,KAAQlgB,IAC1F,GAAIA,EAAEwD,SAAW,aAAWvC,iBAIxB,OAHIif,GACApe,KAAKo1B,UAEF,KAEX,MAAMl3B,IASd,eAAey6B,EAAY1Y,EAActM,GACrC,MAAMnL,EAAM,IAAI,iBAAwB,CAAEowB,WAAYD,EAAY1Y,aAAcA,EAActM,WAE9F,OADAnL,EAAIvI,iBAAkB,EACfD,KAAKuJ,KAAKf,GACZ7B,KAAM5C,GAAa/D,KAAK+0B,cAAchxB,EAAS7C,SAExD,cAAcyc,GACV,MAAMhK,EAAS3T,KAAK0d,aAAaC,EAAInR,IAC/B6V,EAAW,WAASvlB,IAAI6W,GAG9B,OAFA0O,EAAStgB,KAAKyb,cAAc6E,EAAU1E,EAAKhK,EAAQ,CAAE8J,YAAY,IACjEzd,KAAK6f,SAAWlM,EACTA,EAEX,0BACI,OAAO3T,KAAKuJ,KAAK,IAAI,oBAChB5C,KAAK,KAAM,EAAOzI,IACnB,GAAIA,EAAEwD,SAAW,aAAWvC,iBACxB,OAAO,EAEX,MAAMjB,IAGd,WAAWiiB,GACP,OAAOngB,KAAKuJ,KAAK,IAAI,aAAoB4W,EAAY9P,WAQzD,SAASnP,GACL,MAAM,KAAEa,GAAS,WAASjF,IAAIoE,GACxB4I,EAAS,IAAI,mBACb+E,EAAO9M,EAAK+M,aAClB,IAAK,IAAIsa,EAAOva,EAAK/B,QAASsc,EAAKpa,KAAMoa,EAAOva,EAAK/B,OAAQ,CACzD,MAAMoX,EAAW,IAAI,YAAUkF,EAAKlsB,MAAMV,KAAM0E,GAChD4I,EAAOoG,OAAOgU,EAAS1mB,KAAO0mB,EAElC,MAAM,eAAEtV,GAAmB7M,EAI3B,OAHI6M,GACAA,EAAe9E,EAAOoG,QAEnBpG,EAOX,eAAe+uB,GACP74B,KAAK00B,qBACD10B,KAAKq0B,YAAYmD,SAASqB,IAC1B74B,KAAKs0B,eAAe1gB,IAAIilB,GAE5B74B,KAAKu0B,eAAexQ,OAAO8U,IAQnC,eAAeA,GACP74B,KAAK00B,oBAAsBmE,IACtB74B,KAAKq0B,YAAYmD,SAASqB,IAC3B74B,KAAKu0B,eAAe3gB,IAAIilB,GAE5B74B,KAAKs0B,eAAevQ,OAAO8U,IAGnC,qBACI,IAAK74B,KAAK00B,mBACN,OAAOjuB,QAAQC,QAAQ,MAE3B,MAAM8B,EAAM,IAAI,iBAEhB,OADAA,EAAIswB,UACG94B,KAAKuJ,KAAKf,GAAK7B,KAAM5C,IACxB/D,KAAKi1B,mBAAmBlxB,EAAS7C,QAC1BlB,KAAKq0B,cAGpB,mBAAmBA,GACfr0B,KAAKq0B,YAAc,IAAI,cAAYA,GACnCr0B,KAAKs0B,eAAiB,IAAI7gB,IAC1BzT,KAAKu0B,eAAiB,IAAI9gB,IAK9B,6BACI,IAAKzT,KAAK00B,mBACN,OAEJ,MAAMqE,GAAM,IAAIlsB,MAAOmsB,UACjBC,EAAwC,IAA1Bj5B,KAAKw0B,mBACrBx0B,KAAKy0B,gBAAgBxhB,SAAW8lB,EAAM/4B,KAAKq0B,YAAY6E,SAAWD,GAClEj5B,KAAKy0B,gBAAgBnD,SAAS,IAAMtxB,KAAKm5B,sBAQjD,eAAe3sB,GACX,OAAI,WAGJxM,KAAKi3B,8BACAj3B,KAAK00B,qBAAuB10B,KAAKy0B,gBAAgBxhB,UAG9CjT,KAAKs0B,eAAelP,IAAI5Y,KAAQxM,KAAKu0B,eAAenP,IAAI5Y,IAAOxM,KAAKq0B,YAAYmD,SAAShrB,KAQrG,kBAAkBA,EAAIhG,EAASmb,IACXA,IAAYnV,GAAMxM,KAAKo5B,eAAe5sB,KAElDhG,EAAQsyB,UAUhB,UAAUO,EAAcrY,GACpB,MAAM,WAAE9a,GAAelG,KACvB,IAAKkG,EACD,MAAM,IAAIH,MAAM,wCAEpB,OAAO/F,KAAKqH,aAAaC,SAASpB,EAAWf,SAAWk0B,EAAcrY,GACjEra,KAAMrG,IACP,IAAI2F,EAAMC,EAAWd,OAAS9E,EAI9B,OAHIN,KAAKo5B,eAAeC,KACpBpzB,IAAU+a,EAAY,IAAM,KAArB,OAEJ/a,IAYf,gBAAgBovB,EAAaziB,GACzB,MAAMqL,EAAUje,KAAKs5B,kBAAkBjE,EAAaziB,GAC9CpK,EAAM,IAAI,YAAmByV,EAAQzgB,KAC3C,OAAOwC,KAAKuJ,KAAKf,GAAK7B,KAAM4yB,GAASA,EAAKr4B,QAU9C,gBAAgBm0B,EAAaziB,GACzB,MAAMqL,EAAUje,KAAKs5B,kBAAkBjE,EAAaziB,GAC9CpK,EAAM,IAAI,kBAAyByV,EAAQzgB,KACjD,OAAOwC,KAAKuJ,KAAKf,GAErB,kBAAkB6sB,EAAaziB,GAC3B,MAAoB,iBAATA,EACA5S,KAAK0d,aAAa2X,EAAaziB,GAEnCA,GAGfsQ,EAAW,CACP,qBAAW,qCACZiR,EAAct2B,UAAW,oBAAqB,O,6BCnkCjD,iFAMA,MAAM27B,EAAYx8B,OAAO,aACnBy8B,EAAKz8B,OAAO,aACX,MAAM08B,UAA6B,WAetC,YAAYvoB,EAAU,IAClB7G,QACAtK,KAAKkG,WAAa,KAClBlG,KAAKsQ,UAAYtQ,KAAK25B,kBACtB35B,KAAK4Q,KAAO,IAAI,OAAK5Q,KAAKsQ,UAAWtQ,MACrCA,KAAK45B,oBAAsB,eAAaxkB,aAAe,eAAaL,OACpE/U,KAAKqH,aAAe,KACpBrH,KAAK60B,UAAY,KACjB,MAAMvjB,EAAyB,iBAAZH,EAAuB,CAAEnM,KAAMmM,GAAYA,GAAW,GACzEnR,KAAKg0B,UAAU1iB,GACf,IAAI2B,GAAU,EACVC,EAAQ,IAAIzM,QAASozB,IACrB75B,KAAKw5B,GAAaK,IAElBvoB,EAAItM,KACJhF,KAAKk0B,QAAQ5iB,EAAItM,KAAMsM,EAAIrM,KAAMqM,EAAIpM,OAAQoM,EAAInM,UAGjD8N,GAAU,EAETjT,KAAKqH,eACN4L,GAAU,EACVC,EAAQA,EACHvM,KAAK,IAAM3G,KAAK45B,oBAAoBr8B,OAAOyC,KAAKkG,WAAWd,SAC3DuB,KAAMU,IACPrH,KAAKqH,aAAeA,KAGxBiK,EAAIwoB,QACJ95B,KAAK40B,YAActjB,EACnBtR,KAAKsQ,UAAUyB,KAAKT,EAAIwoB,UAGxB7mB,GAAU,EACVC,EAAQA,EAAMvM,KAAK,KACf,MAAM6B,EAAM,IAAI,UAKhB,OAJAA,EAAIvI,iBAAkB,EACC,IAAnBD,KAAK60B,WACLrsB,EAAIswB,UAED94B,KAAKuJ,KAAKf,KAClB7B,KAAM5C,IACL/D,KAAK40B,YAAc7wB,EAAS7C,OACL,OAAnBlB,KAAK60B,YACL70B,KAAK60B,UAAY70B,KAAK40B,YAAYJ,oBAAsB,IAEvDx0B,KAAKsQ,UAAUsgB,eAChB5wB,KAAKsQ,UAAUyB,KAAK/R,KAAK40B,YAAYkF,QAEzC95B,KAAKqH,aAAaM,OAAO3H,KAAK40B,YAAYptB,UAG7CyL,GACDjT,KAAKsxB,SAAS,IAAMpe,GAAO,GAMnC,gBACI,IAAKlT,KAAKy5B,GAAK,CACX,MAAM,OAAEv0B,GAAWlF,KAAKkG,WACxB,IAAID,EAEAA,EADAjG,KAAK40B,YAAY1oB,WACVhH,EAAS,OAAS,OAASlF,KAAK40B,YAAY1oB,UAG1ClM,KAAKkG,WAAWd,OAAOlC,QAAQ,QAAS,MAAQlD,KAAKkG,WAAWf,SAAnE,UAEVnF,KAAKy5B,GAAM,qBAAmBl8B,OAAO0I,GAEzC,OAAOjG,KAAKy5B,GAYhB,UAAUtoB,GACN,GAAInR,KAAKkG,WACL,MAAM,IAAIH,MAAM,2EAEhBoL,EAAQ9J,eACRrH,KAAKqH,aAAe8J,EAAQ9J,cAE5B8J,EAAQyoB,sBACR55B,KAAK45B,oBAAsBzoB,EAAQyoB,0BAEb33B,IAAtBkP,EAAQ0jB,YACR70B,KAAK60B,UAAY1jB,EAAQ0jB,WAGjC,QAAQZ,EAAWhvB,EAAMC,EAAQC,GAC7B,GAAInF,KAAKkG,WACL,MAAM,IAAIH,MAAM,kDAEpB,MAAoB,kBAATd,EACAjF,KAAKk0B,QAAQD,EAAW,EAAGhvB,EAAMC,IAE5ClF,KAAKkG,WAAa,YAAU3I,OAAO02B,EAAWhvB,EAAMC,EAAQC,GAC5DnF,KAAKw5B,KACEx5B,KAAKkT,SAMhB,kBACI,OAAO,IAAI,YAAUlT,MAWzB,oBAAoB+5B,GAChB,MAAMC,EAAK,IAAI,IAAch6B,MAS7B,OARIA,KAAKiT,QACL+mB,EAAGxvB,UAAUxK,KAAKkG,WAAYlG,KAAK40B,YAAamF,EAAwB/5B,KAAKqH,aAAe,IAAI,eAAarH,KAAKkG,WAAWd,SAG7H40B,EAAG1I,SAAS,IAAMtxB,KAAKkT,QAAQvM,KAAK,KAChCqzB,EAAGxvB,UAAUxK,KAAKkG,WAAYlG,KAAK40B,YAAamF,EAAwB/5B,KAAKqH,aAAe,IAAI,eAAarH,KAAKkG,WAAWd,YAC7H,GAED40B,EAEX,KAAKxxB,GAID,OAHKA,EAAInB,gBACLmB,EAAInB,aAAarH,KAAKqH,cAEnBrH,KAAKkG,WAAWqD,KAAKf,M,4WChK7B,MAAMyxB,EAKT,YAAY9sB,EAAeuoB,GACvB11B,KAAKmN,cAAgBA,EACrBnN,KAAK01B,YAAcA,EAOvB,UAAU1F,GACN,OAAOhwB,KAAKk6B,SAASlK,EAAO,GAOhC,WAAWA,GACP,OAAOhwB,KAAKk6B,SAASlK,GAAQ,GAUjC,KAAKmK,GACD,GAAoB,iBAATA,GAAqBx9B,OAAOigB,eAAeud,KAAUx9B,OAAOkB,UACnE,MAAM,IAAIkI,MAAM,2BAEpB,OAAO/F,KAAKk6B,SAASC,GASzB,OAAOvT,GACH,GAAIA,EAAS,EACT,MAAM,IAAI7gB,MAAM,iCAEpB,OAAO/F,KAAKo6B,UAAUxT,GAS1B,MAAMyT,GACF,GAAIA,EAAQ,EACR,MAAM,IAAIt0B,MAAM,gCAEpB,OAAO/F,KAAKs6B,SAASD,IAItB,SAASE,EAASx6B,GACrB,OAAOqS,MAAMvU,UAAUmnB,OAAO3V,MAAM,GAAItP,GAF5Ck6B,EAAMO,aAAe,I,iCCrEjBv8B,EAAkC,SAAUD,EAAGE,GAC/C,IAAIf,EAAI,GACR,IAAK,IAAIY,KAAKC,EAAOrB,OAAOkB,UAAUC,eAAe1B,KAAK4B,EAAGD,IAAMG,EAAEC,QAAQJ,GAAK,IAC9EZ,EAAEY,GAAKC,EAAED,IACb,GAAS,MAALC,GAAqD,mBAAjCrB,OAAOyB,sBACtB,KAAInC,EAAI,EAAb,IAAgB8B,EAAIpB,OAAOyB,sBAAsBJ,GAAI/B,EAAI8B,EAAEM,OAAQpC,IAC3DiC,EAAEC,QAAQJ,EAAE9B,IAAM,GAAKU,OAAOkB,UAAUS,qBAAqBlC,KAAK4B,EAAGD,EAAE9B,MACvEkB,EAAEY,EAAE9B,IAAM+B,EAAED,EAAE9B,KAE1B,OAAOkB,GAKJ,MAAM,EAeT,yBAAyBgQ,EAAerM,EAAOqQ,GAC3C,MAAMG,EAAMH,GAAW,GAEvB,OADAG,EAAImpB,WAAa,EACV,EAAOC,iBAAiBvtB,EAAerM,EAAOwQ,EAAK,CAAC9I,EAAKsE,KAC5D,MAAM,KAAE/K,GAASyG,EAAKmyB,EAAa18B,EAAOuK,EAAK,CAAC,SAC/B,WAAbA,EAAIzG,MACJyG,EAAIpG,KAAKb,QAAQ,CAACoc,EAAKtd,KACnB,MAAMgI,EAAQ1L,OAAOkF,OAAOlF,OAAOkF,OAAOlF,OAAOkF,OAAO,CAAE+4B,UAAW,MAAOC,UAAW,OAAQC,SAAS,GAAQH,GAAa,CAAEv4B,KAAM,EAAO24B,cAAc5tB,EAAewQ,KAAU7c,EAAMq5B,MAAQ,CAAE95B,UACnMyM,EAAKzE,KAGI,UAAbG,EAAIzG,MACJ+K,EAAKnQ,OAAOkF,OAAOlF,OAAOkF,OAAO,CAAEi5B,SAAS,GAASH,GAAa,CAAEv4B,KAAM,EAAO24B,cAAc5tB,EAAe3E,EAAIpG,WAkB9H,0BAA0B+K,EAAerM,EAAOqQ,GAC5C,MAAMG,EAAMH,GAAW,GAIvB,IAAIrH,EAHJwH,EAAIwpB,SAAU,EACdxpB,EAAI0pB,WAAa,MACjB1pB,EAAI6S,WAAa,MAEjB,MAAM8W,IAAYn6B,EAAMq5B,KACxB,OAAO,EAAOO,iBAAiBvtB,EAAerM,EAAOwQ,EAAK,CAACjJ,EAAOyE,KAK9D,GAJmB,WAAfzE,EAAMtG,OACN+H,EAASzB,EAAMjG,KAAKzB,IAAKgd,GAAQ,EAAOod,cAAc5tB,EAAewQ,IACrE7Q,EAAKhD,EAAO1C,UAEG,UAAfiB,EAAMtG,KAAkB,CACxB,MAAM4b,EAAM,EAAOod,cAAc5tB,EAAe9E,EAAMjG,MACtD,GAAwB,WAApBiG,EAAMuyB,WAA8C,gBAApBvyB,EAAMuyB,UAGtC,IAAK,IAAI3+B,EAAI,EAAGuE,EAAMsJ,EAAOzL,OAAQpC,EAAIuE,EAAKvE,GAAK,EAC/C,GAAI6N,EAAO7N,GAAGuQ,KAAOnE,EAAMjG,KAAKoK,GAAI,CAChC1C,EAAO0kB,OAAOvyB,EAAG,GACjB,MAIY,QAApBoM,EAAMuyB,WAA2C,gBAApBvyB,EAAMuyB,YAC/BK,EACAnxB,EAAO0kB,OAAOnmB,EAAMhI,MAAO,EAAGsd,GAG9B7T,EAAOrI,KAAKkc,IAGpB7Q,EAAKhD,EAAO1C,YAIxB,wBAAwB+F,EAAerM,EAAOqQ,EAAS+pB,GACnD,MAAM5pB,EAAM,EAAO6pB,aAAahqB,GAC1BlF,EAASkB,EAAcoD,qBAAqBrE,UAC5CkvB,EAAa,IAAI,IAAYC,IAC/B,MAAM7uB,EAAK,iBACLtI,EAAS+H,EAAOqvB,WAAWnuB,EAAc9F,aAAcmF,GAC7DtI,EAAOqF,KAAK5M,OAAOkF,OAAOlF,OAAOkF,OAAO,CAAEE,KAAM,aAAejB,GAAQwQ,IACvE,IAAIiqB,GAAS,EACb,MAAMzuB,EAAOuuB,EAAWvuB,KAAKrP,KAAK49B,GAC5Bpb,EAAe/b,EAAOs3B,UAAU,CAClC,WACID,GAAS,EACTF,EAAW3uB,YAEf,MAAMxO,GACFq9B,GAAS,EACTF,EAAWzvB,MAAM1N,IAErB,KAAKsK,GACD0yB,EAAO1yB,EAAKsE,MAGpB,MAAO,KACEyuB,IACDr3B,EAAOqF,KAAK,CAAExH,KAAM,gBACpBke,EAAawb,cACbF,GAAS,MAIrB,OAAO,EAAOG,iBAAiBN,EAAY9pB,GAE/C,wBAAwB8pB,EAAYjqB,GAChC,IAAI8O,EAAe,KACnB,MAAMjU,EAAY,GAClB,OAAO,IAAI,IAAYS,IACnB,IAAKwT,EAAc,CACf,IAAI0b,EAAmBxqB,EAAQspB,WAC3BmB,EAAU,EACd,MAAMC,EAAuB,CACzB,KAAKrzB,GAEDozB,EAAU,EACV5vB,EAAUzK,QAAS7E,GAAMA,EAAEoQ,KAAKtE,KAEpC,MAAMtK,GACF8N,EAAUzK,QAAS7E,GAAMA,EAAEkP,MAAM1N,KAErC,WAC6B,IAArBy9B,GACAA,EAAmBA,EAAmB,GAAK,EAAIA,EAAmB,EAClEhwB,WAAW,KACPsU,EAAemb,EAAWI,UAAUK,IAC3B,IAAVD,GACHA,GAAW,GAGX5vB,EAAUzK,QAAS7E,GAAMA,EAAEgQ,cAIvCuT,EAAemb,EAAWI,UAAUK,GAGxC,OADA7vB,EAAUvK,KAAKgL,GACR,KACHT,EAAUwiB,OAAOxiB,EAAU7N,QAAQsO,GAAW,IACzCT,EAAU3N,QAAU4hB,IACrBA,EAAawb,cACbxb,EAAe,SAW/B,oBAAoB9O,GAChB,MAAMG,EAAMH,GAAW,GACjB2qB,EAAW,CACbhB,aAAyB74B,IAAhBqP,EAAIwpB,WAA2BxpB,EAAIwpB,QAC5CE,WAAY,EAAOe,oBAAoBzqB,EAAI0pB,YAC3C7W,WAAY,EAAO6X,oBAAoB1qB,EAAI6S,YAC3CsW,WAAY,EAAOwB,oBAAoB3qB,EAAImpB,aAE/C,IAA4C,IAAxCqB,EAASd,WAAW78B,QAAQ,SAAyD,IAAxC29B,EAAS3X,WAAWhmB,QAAQ,OACzE,MAAM,IAAI4H,MAAM,yJAEpB,OAAO+1B,EAEX,2BAA2BI,GACvB,OAAO,EAAOC,mBAAmBD,EAAM,MAAO,cAAe,CAAC,MAAO,SAAU,cAAe,QAAS,WAE3G,2BAA2BzB,GACvB,YAAmBx4B,IAAfw4B,GAGGA,EAAa,GAFR,EAEiB53B,OAAO43B,GAExC,2BAA2ByB,GACvB,OAAO,EAAOC,mBAAmBD,EAAM,MAAO,aAAc,CAAC,SAAU,SAAU,OAAQ,WAE7F,0BAA0BA,EAAME,EAAUC,EAAUC,GAChD,IAAKJ,EACD,MAAO,CAACE,GAEZ,MAAMG,EAAKnqB,MAAMC,QAAQ6pB,GAAQA,EAAO,CAACA,GACzC,GAAkB,IAAdK,EAAGl+B,OACH,MAAO,CAAC+9B,GAIZ,IAAIhT,EADJmT,EAAGpC,OAEH,IAAIqC,EAAW,KACf,IAAK,IAAIvgC,EAAIsgC,EAAGl+B,OAAS,EAAGpC,GAAK,EAAGA,GAAK,EAAG,CAExC,GADAmtB,EAAOmT,EAAGtgC,IACLmtB,EACD,MAAM,IAAIrjB,MAAM,mCAKpB,GAHIqjB,IAASoT,GACTD,EAAG/N,OAAOvyB,EAAG,GAEbmtB,IAASgT,EACT,MAAO,CAACA,GAEZ,IAAoC,IAAhCE,EAAan+B,QAAQirB,GACrB,MAAM,IAAIrjB,MAAM,GAAGqjB,qBAAwBiT,kBAAyBC,OAExEE,EAAWpT,EAEf,OAAOmT,EAEX,qBAAqBpvB,EAAexP,GAChC,MAAMuD,EAASiM,EAAcuQ,aAAa/f,EAAO6O,IAC3C6V,EAAW,WAASvlB,IAAIoE,GAQ9B,OAPKvD,EAAO6P,QAIHtM,EAAOsM,SAAW7P,EAAO6P,SAC9B6U,EAAStgB,KAAKyb,cAAc6E,EAAU1kB,EAAQuD,EAAQ,CAAEuc,YAAY,KAJpE4E,EAAS8T,aACThpB,EAAcwoB,gBAAgBz0B,IAK3BA,GCvOR,MAAM,UAAa+4B,EACtB,cACI3vB,SAAS8S,WAITpd,KAAKy8B,YAAc,EAMnBz8B,KAAK08B,YAAc,EAInB18B,KAAKqpB,MAAQ,GAEjB,YAAYlY,EAASwrB,EAAQC,EAASC,GAClC,GAAI1rB,aAAmBhC,SACnB,OAAOnP,KAAK88B,YAAY,GAAI3rB,EAASwrB,EAAQC,GAEjD,MAAMxB,EAAa,EAAO2B,kBAAkB/8B,KAAKmN,cAAenN,KAAKg9B,sBAAuB7rB,GAC5F,OAAIwrB,aAAkBxtB,SACXisB,EAAWI,UAAUmB,EAAQC,EAASC,GAE1CzB,EAEX,aAAajqB,EAASwrB,EAAQC,EAASC,GACnC,GAAI1rB,aAAmBhC,SACnB,OAAOnP,KAAKi9B,aAAa,GAAI9rB,EAASwrB,EAAQC,GAElD,MAAMxB,EAAa,EAAO8B,mBAAmBl9B,KAAKmN,cAAenN,KAAKg9B,sBAAuB7rB,GAC7F,OAAIwrB,aAAkBxtB,SACXisB,EAAWI,UAAUmB,EAAQC,EAASC,GAE1CzB,EAKX,WAAWjqB,EAASC,EAAcC,GAC9B,IAAIgP,EACJ,GAAIlP,aAAmBhC,SACnB,OAAOnP,KAAK4kB,WAAW,GAAIzT,EAASC,GAExC,MAAMrP,EAAO/B,KAAK01B,YAAc11B,KAAKmN,cAAcmD,UAAUpP,OAAOlB,KAAK01B,aAAe,KACxF,IAAK3zB,EACD,MAAM,IAAIgE,MAAM,uCAEpB,MAAMjF,EAAQd,KAAKm9B,iBACbhD,EAAOn6B,KAAKo9B,gBAElB,IAAI50B,EAQJ,OANIA,IAHuD,QAAxC6X,EAAKrgB,KAAKmN,cAAcjH,kBAA+B,IAAPma,OAAgB,EAASA,EAAGrb,KAAK3G,SAAW,GAAKyC,EAAMzC,OAAS87B,EAAK97B,OAE1H47B,EAAMO,aACV,IAAIh0B,EAAA,eAAuBzE,EAAKvF,KAAMwD,KAAKy8B,YAAaz8B,KAAK08B,WAAYvC,GAC1Ej5B,OAAOJ,EAAO,QAGb,IAAI0F,EAAA,WAAmBzE,EAAKvF,KAAMsE,EAAOd,KAAKy8B,YAAaz8B,KAAK08B,WAAYvC,GAE/En6B,KAAKmN,cAAc5D,KAAKf,GAC1B7B,KAAM5C,GAAa/D,KAAKq9B,iBAAiBt5B,EAAS7C,OAAQiQ,IAC1DxK,KAAKyK,EAAcC,GAK5B,aAAaF,EAASC,EAAcC,GAChC,IAAIgP,EACJ,GAAIlP,aAAmBhC,SACnB,OAAOnP,KAAKs9B,aAAa,GAAInsB,EAASC,GAE1C,MAAMrP,EAAO/B,KAAK01B,YAAc11B,KAAKmN,cAAcmD,UAAUpP,OAAOlB,KAAK01B,aAAe,KACxF,IAAK3zB,EACD,MAAM,IAAIgE,MAAM,uCAEpB,MAAMjF,EAAQd,KAAKm9B,iBACbhD,EAAOn6B,KAAKo9B,gBAElB,IAAI50B,EAQJ,OANIA,IAHuD,QAAxC6X,EAAKrgB,KAAKmN,cAAcjH,kBAA+B,IAAPma,OAAgB,EAASA,EAAGrb,KAAK3G,SAAW,GAAKyC,EAAMzC,OAE5G47B,EAAMO,aACV,IAAIh0B,EAAA,eAAuBzE,EAAKvF,KAAMwD,KAAKy8B,YAAa,EAAGtC,GAC5Dj5B,OAAOJ,EAAO,QAGb,IAAI0F,EAAA,WAAmBzE,EAAKvF,KAAMsE,EAAOd,KAAKy8B,YAAa,EAAGtC,GAEjEn6B,KAAKmN,cAAc5D,KAAKf,GAC1B7B,KAAM5C,GAAa/D,KAAKq9B,iBAAiBt5B,EAAS7C,OAAQiQ,IAC1DxK,KAAMu1B,GAAUA,EAAK79B,OAAS69B,EAAK,GAAK,MACxCv1B,KAAKyK,EAAcC,GAK5B,MAAMD,EAAcC,GAChB,IAAIgP,EACJ,MAAMte,EAAO/B,KAAK01B,YAAc11B,KAAKmN,cAAcmD,UAAUpP,OAAOlB,KAAK01B,aAAe,KACxF,IAAK3zB,EACD,MAAM,IAAIgE,MAAM,uCAEpB,MAAMjF,EAAQd,KAAKm9B,iBAEnB,IAAI30B,EAQJ,OANIA,IAHuD,QAAxC6X,EAAKrgB,KAAKmN,cAAcjH,kBAA+B,IAAPma,OAAgB,EAASA,EAAGrb,KAAK3G,SAAW,GAAKyC,EAAMzC,OAE5G47B,EAAMO,aACV,IAAIh0B,EAAA,oBAA4BzE,EAAKvF,MACtC0E,OAAOJ,EAAO,QAGb,IAAI0F,EAAA,gBAAwBzE,EAAKvF,KAAMsE,GAE1Cd,KAAKmN,cAAc5D,KAAKf,GAC1B7B,KAAM5C,GAAaA,EAAS7C,OAAO4hB,OACnCnc,KAAKyK,EAAcC,GAE5B,iBACI,OAAO9N,KAAKC,UAAUxD,MAAM,SAAuBu9B,EAAGC,GAElD,MAAMC,EAAaz9B,KAAKu9B,GACxB,OAAIE,aAAsB5wB,KACf,CAAE6wB,MAAOF,GAEhBC,aAAsB,SACfA,EAAWjxB,GAEfgxB,KAGf,gBACI,OAAOj6B,KAAKC,UAAUxD,KAAKqpB,OAE/B,iBAAiBvf,EAAQqH,GACrB,OAAIrH,EAAOzL,OACAoI,QAAQoe,IAAI/a,EAAOnJ,IAAKoO,IAC3B,GAAIA,EAAGvC,GAAI,CACP,MAAMtL,EAASlB,KAAKmN,cAAcuQ,aAAa1d,KAAK01B,YAAa3mB,EAAGvC,IAC9D6V,EAAW,WAASvlB,IAAIoE,GAE9B,OADAmhB,EAAStgB,KAAKyb,cAAc6E,EAAUtT,EAAI7N,EAAQ,CAAEuc,YAAY,IACzDzd,KAAKmN,cAAc+oB,aAAah1B,EAAQiQ,GAEnD,OAAOnR,KAAKmN,cAAc3B,KAAK7O,OAAOkH,KAAKkL,GAAI,OAE9CpI,KAAMg3B,GAAYA,EAAQ5Y,OAAQ/W,KAAUA,IAE9CvH,QAAQC,QAAQ,IAE3B,sBACI,MAAM3E,EAAO/B,KAAK01B,YAAc11B,KAAKmN,cAAcmD,UAAUpP,OAAOlB,KAAK01B,aAAe,KACxF,IAAK3zB,EACD,MAAM,IAAIgE,MAAM,uCAEpB,MAAMjF,EAAQ,CACVmN,OAAQlM,EAAKvF,KACbsE,MAAOd,KAAKm9B,kBAEVhD,EAAOn6B,KAAKo9B,gBAUlB,OATIjD,GAAiB,OAATA,IACRr5B,EAAMq5B,KAAOA,GAEbn6B,KAAK08B,WAAa,IAClB57B,EAAMu5B,MAAQr6B,KAAK08B,YAEnB18B,KAAKy8B,YAAc,IACnB37B,EAAM8lB,OAAS5mB,KAAKy8B,aAEjB37B,EAEX,SAAS88B,EAAavU,GAOlB,MAN2B,iBAAhBuU,EACP59B,KAAKqpB,MAAMuU,GAAevU,EAG1BrpB,KAAKqpB,MAAQuU,EAEV59B,KAEX,UAAU4mB,GAEN,OADA5mB,KAAKy8B,YAAc7V,EACZ5mB,KAEX,SAASq6B,GAEL,OADAr6B,KAAK08B,WAAarC,EACXr6B,MC9LR,MAAM69B,EAAY,CACrB,MAAMC,GACF,OAAO99B,KAAK+9B,UAAU,KAAM,KAAMD,IAEtC,MAAM9N,EAAO9yB,GACT,OAAO8C,KAAK+9B,UAAU/N,EAAO,KAAM9yB,IAEvC,SAAS8yB,EAAO9yB,GACZ,OAAO8C,KAAK+9B,UAAU/N,EAAO,MAAO9yB,IAExC,YAAY8yB,EAAO9yB,GACf,OAAO8C,KAAK+9B,UAAU/N,EAAO,MAAO9yB,IAExC,qBAAqB8yB,EAAO9yB,GACxB,OAAO8C,KAAK+9B,UAAU/N,EAAO,OAAQ9yB,IAEzC,SAAS8yB,EAAO9yB,GACZ,OAAO8C,KAAK+9B,UAAU/N,EAAO,MAAO9yB,IAExC,kBAAkB8yB,EAAO9yB,GACrB,OAAO8C,KAAK+9B,UAAU/N,EAAO,OAAQ9yB,IAEzC,QAAQ8yB,EAAOgO,EAAcC,GACzB,OAAOj+B,KACF+9B,UAAU/N,EAAO,MAAOgO,GACxBD,UAAU/N,EAAO,MAAOiO,IAEjC,GAAGjO,KAAUjwB,GACT,OAAOC,KAAK+9B,UAAU/N,EAAO,MAAOuK,EAASx6B,KAEjD,MAAMiwB,KAAUjwB,GACZ,OAAOC,KAAK+9B,UAAU/N,EAAO,OAAQuK,EAASx6B,KAElD,OAAOiwB,GACH,OAAOhwB,KAAK0kB,MAAMsL,EAAO,OAE7B,UAAUA,GACN,OAAOhwB,KAAK+9B,UAAU/N,EAAO,WAAW,GACnC+N,UAAU/N,EAAO,MAAO,OAEjC,YAAYA,KAAUjwB,GAClB,OAAOC,KAAK+9B,UAAU/N,EAAO,OAAQuK,EAASx6B,KAElD,IAAIiwB,EAAOkO,EAASC,GAChB,OAAOn+B,KAAK+9B,UAAU/N,EAAO,OAAQ,CAACkO,EAASC,KAEnD,QAAQnO,EAAOoO,GACX,MAAMC,EAAMD,aAAkBE,OAASF,EAAS,IAAIE,OAAOF,GAC3D,GAAIC,EAAIE,WACJ,MAAM,IAAIx4B,MAAM,4CAEpB,GAAIs4B,EAAIG,OACJ,MAAM,IAAIz4B,MAAM,wCAEpB,GAAgC,IAA5Bs4B,EAAII,OAAOtgC,QAAQ,KACnB,MAAM,IAAI4H,MAAM,4EAEpB,MAAM+D,EAAS9J,KAAK+9B,UAAU/N,EAAO,SAAUqO,EAAII,QAInD,OAHIJ,EAAIK,WACJ50B,EAAOi0B,UAAU/N,EAAO,WAAY,KAEjClmB,GAEX,KAAKkmB,EAAOnc,GACR,OAAO7T,KAAK+9B,UAAU/N,EAAO,QAASnc,IAE1C,KAAKmc,EAAO2O,EAAUC,GAClB,OAAO5+B,KAAK+9B,UAAU/N,EAAO,cAAe,CACxC6O,UAAW,CACP98B,KAAM,QACN+8B,YAAa,CAACH,EAASnM,UAAWmM,EAASpM,WAE/CwM,aAAcH,KAGtB,cAAc5O,KAAUjwB,GACpB,MAAMi/B,EAAYzE,EAASx6B,GAC3B,OAAOC,KAAK+9B,UAAU/N,EAAO,aAAc,CACvC6O,UAAW,CACP98B,KAAM,UACN+8B,YAAa,CAACE,EAAUr+B,IAAKg+B,GAAa,CAACA,EAASnM,UAAWmM,EAASpM,iBAMxF51B,OAAOkF,OAAOg8B,EAAW,CACrBoB,GAAIpB,EAAUnZ,MACdwa,GAAIrB,EAAUsB,SACdC,GAAIvB,EAAUwB,SACdC,GAAIzB,EAAU0B,kBACdC,GAAI3B,EAAU4B,YACdC,GAAI7B,EAAU8B,qBACdC,YAAa/B,EAAUgC,KC5FpB,MAAM,UAAe,EACxB,cACIv1B,SAAS8S,WAITpd,KAAK+kB,OAAS,GAKlB,UAAUiL,EAAOjL,EAAQ7nB,GACrB,GAAc,OAAV8yB,EAAgB,CAChB,GAAqB,iBAAVA,EACP,MAAM,IAAIjqB,MAAM,2BAEpB,GAAIgf,EAAQ,CACR,MAAM+a,EAAgB9/B,KAAK+kB,OAAOiL,GAClC,IAAI+P,EACyB,iBAAlBD,GAA8BnjC,OAAOigB,eAAekjB,KAAmBnjC,OAAOkB,UACrFkiC,EAAcD,GAGdC,EAAc,GACd//B,KAAK+kB,OAAOiL,GAAS+P,GAEzBA,EAAYhb,GAAU7nB,OAGtB8C,KAAK+kB,OAAOiL,GAAS9yB,OAIzBP,OAAOkF,OAAO7B,KAAK+kB,OAAQ7nB,GAE/B,OAAO8C,KAEX,SACI,OAAOA,KAAK+kB,QAGpBpoB,OAAOkF,OAAO,EAAOhE,UAAWggC,GCvCzB,MAAM,UAAiB,EAO1B,YAAY1wB,EAAeuoB,EAAasK,EAAUC,GAC9C31B,MAAM6C,EAAeuoB,GACrB11B,KAAKggC,SAAWA,EAChBhgC,KAAKigC,QAAUA,EAEnB,SACI,MAAM7vB,EAAO,GAEb,OADAA,EAAKpQ,KAAKggC,UAAYhgC,KAAKigC,QACpB7vB,GCdR,MAAM,UAAgB6pB,EAMzB,OAAOl6B,GACH,OAAOC,KAAKkgC,YAAY,OAAQ3F,EAASx6B,IAO7C,MAAMA,GACF,OAAOC,KAAKkgC,YAAY,MAAO3F,EAASx6B,IAO5C,OAAOA,GACH,OAAOC,KAAKkgC,YAAY,OAAQ3F,EAASx6B,IAE7C,YAAYoR,EAASwrB,EAAQC,EAASC,GAClC,OAAO78B,KAAKmgC,MAAM,IAAIrD,YAAY3rB,EAASwrB,EAAQC,EAASC,GAEhE,aAAa1rB,EAASwrB,EAAQC,EAASC,GACnC,OAAO78B,KAAKmgC,MAAM,IAAIlD,aAAa9rB,EAASwrB,EAAQC,EAASC,GAKjE,WAAW1rB,EAASC,EAAcC,GAC9B,OAAOrR,KAAKmgC,MAAM,IAAIvb,WAAWzT,EAASC,EAAcC,GAK5D,aAAaF,EAASC,EAAcC,GAChC,OAAOrR,KAAKmgC,MAAM,IAAI7C,aAAansB,EAASC,EAAcC,GAK9D,MAAMD,EAAcC,GAChB,OAAOrR,KAAKmgC,MAAM,IAAIrd,MAAM1R,EAAcC,GAE9C,YAAY2uB,EAAUjgC,GAClB,GAAIA,EAAK1B,OAAS,EACd,MAAM,IAAI0H,MAAM,kDAAkDi6B,eAOtE,OALAjgC,EAAKwB,QAAQ,CAACR,EAAKV,KACf,KAAMU,aAAe,GACjB,MAAM,IAAIgF,MAAM,qBAAqB1F,uBAGtC,IAAI,EAASL,KAAKmN,cAAenN,KAAK01B,YAAasK,EAAUjgC,GAExE,SAAS69B,EAAavU,GAClB,OAAO,IAAI,EAAOrpB,KAAKmN,cAAenN,KAAK01B,aAAawE,SAAS0D,EAAavU,GAElF,UAAU2G,EAAOjL,EAAQ7nB,GACrB,OAAO,IAAI,EAAO8C,KAAKmN,cAAenN,KAAK01B,aAAaqI,UAAU/N,EAAOjL,EAAQ7nB,GAErF,UAAU0pB,GACN,OAAO,IAAI,EAAO5mB,KAAKmN,cAAenN,KAAK01B,aAAa0E,UAAUxT,GAEtE,SAASyT,GACL,OAAO,IAAI,EAAOr6B,KAAKmN,cAAenN,KAAK01B,aAAa4E,SAASD,IAGzE19B,OAAOkF,OAAO,EAAQhE,UAAWggC,I,oJC9E1B,MAAMuC,EAMT,YAAY5jC,EAAM8D,EAAMpD,GACpB8C,KAAKxD,KAAOA,EACZwD,KAAKM,KAAOA,EACZN,KAAK9C,MAAQA,GCRrB,MAAMmjC,EAAqB,CACvB,OACA,OACA,eACA,OACA,OACA,OACA,OACA,OACA,MACA,OACA,QACA,OACA,UACA,UACA,WACA,OACA,SACA,WACA,QAEG,MAAM,EAIT,YAAYlc,GACRnkB,KAAKmkB,WAAa,GACdA,GACAnkB,KAAKsgC,cAAcnc,GAU3B,IAAI6L,EAAO9yB,GACP,IAAI8Q,EAAM9Q,EACV,GAAI8Q,aAAeyF,IACfzF,EAAMoE,MAAM0B,KAAK9F,QAEhB,GAAIA,aAAeof,IAAK,CACzB,MAAM9kB,EAAW,GACjB0F,EAAIzM,QAAQ,CAACi8B,EAAGD,KACZj1B,EAASi1B,GAAKC,IAElBxvB,EAAM1F,EAEV,OAAOtI,KAAKugC,aAAavQ,EAAO,OAAQhiB,GAS5C,IAAIgiB,EAAOwQ,GACP,OAAOxgC,KAAKugC,aAAavQ,EAAO,OAAsB,iBAAPwQ,EAAkBA,EAAK,GAS1E,IAAIxQ,EAAOwQ,GACP,OAAOxgC,KAAKygC,IAAIzQ,EAAqB,iBAAPwQ,GAAmBA,GAAM,GAS3D,IAAIxQ,EAAO0Q,GACP,GAA6B,iBAAlBA,EACP,MAAM,IAAI36B,MAAM,mCAEpB,OAAO/F,KAAKugC,aAAavQ,EAAO,OAAQ0Q,GAS5C,IAAI1Q,EAAOkO,GACP,GAAuB,iBAAZA,EACP,MAAM,IAAIn4B,MAAM,6BAEpB,OAAO/F,KAAKugC,aAAavQ,EAAO,OAAQ,EAAIkO,GAShD,IAAIlO,EAAO9yB,GACP,GAAqB,iBAAVA,EACP,MAAM,IAAI6I,MAAM,0BAEpB,OAAO/F,KAAKugC,aAAavQ,EAAO,OAAQ9yB,GAS5C,IAAI8yB,EAAO9yB,GACP,GAAqB,iBAAVA,EACP,MAAM,IAAI6I,MAAM,0BAEpB,OAAO/F,KAAKugC,aAAavQ,EAAO,OAAQ9yB,GAS5C,OAAO8yB,EAAO5G,GACV,OAAOppB,KAAKugC,aAAavQ,EAAO,UAAW5G,GAU/C,IAAI4G,EAAOxyB,EAAKN,GACZ,MAAMygB,EAAM,GAOZ,MANmB,iBAARngB,GAAmC,iBAARA,EAClCmgB,EAAIngB,GAAON,EAES,iBAARM,GACZb,OAAOkF,OAAO8b,EAAKngB,GAEhBwC,KAAKugC,aAAavQ,EAAO,OAAQrS,GAS5C,KAAKqS,EAAO5G,GACR,OAAOppB,KAAKugC,aAAavQ,EAAO,QAAS5G,GAS7C,QAAQ4G,EAAO5G,GACX,OAAOppB,KAAKugC,aAAavQ,EAAO,WAAY5G,GAQhD,IAAI4G,GACA,OAAOhwB,KAAKugC,aAAavQ,EAAO,QAQpC,MAAMA,GACF,OAAOhwB,KAAKugC,aAAavQ,EAAO,UASpC,IAAIA,EAAO5G,GACP,OAAOppB,KAAKugC,aAAavQ,EAAO,OAAQ5G,GAU5C,QAAQ9oB,EAAMD,EAAO+oB,GACjB,GAAIppB,KAAK2gC,mBAAmBrgC,GACxB,MAAM,IAAIyF,MAAM,qBAAqBzF,oBAEzC,OAAON,KAAKugC,aAAa,GAAGjgC,KAAQD,IAAS,WAAY+oB,GAQ7D,YAAY4G,GACR,OAAOhwB,KAAKugC,aAAavQ,EAAO,gBASpC,IAAI1vB,EAAMsgC,GACN,OAAO5gC,KAAKugC,aAAajgC,EAAM,OAAQsgC,GAS3C,GAAGtgC,EAAMsgC,GACL,OAAO5gC,KAAKugC,aAAajgC,EAAM,MAAOsgC,GAS1C,IAAItgC,EAAMsgC,GACN,OAAO5gC,KAAKugC,aAAajgC,EAAM,OAAQsgC,GAS3C,OAAOC,EAASC,GACZ,OAAO9gC,KAAKugC,aAAaM,EAAS,UAAWC,GAOjD,SACI,OAAO9gC,KAAKmkB,WAAW2B,OAAO,CAAC1V,EAAMyqB,IAAel+B,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIuO,GAAO,CAAE,CAACyqB,EAAUr+B,MAAOG,OAAOkF,OAAOlF,OAAOkF,OAAO,GAAIuO,EAAKyqB,EAAUr+B,OAAQ,CAAE,CAACq+B,EAAUv6B,MAAOu6B,EAAU39B,UAAc,IAQtN,UACI,MAAM,IAAI6I,MAAM,0DAWpB,aAAazF,EAAM0/B,EAAU9iC,GACzB,GAAoB,iBAAToD,EACP,MAAM,IAAIyF,MAAM,yBAEpB,IAA8C,IAA1Cs6B,EAAmBliC,QAAQ6hC,GAC3B,MAAM,IAAIj6B,MAAM,sBAAsBi6B,GAE1C,GAAIhgC,KAAK2gC,mBAAmBrgC,GACxB,MAAM,IAAIyF,MAAM,qBAAqBzF,oBAGzC,GAAqB,iBAAVpD,EAAoB,CAC3B,GAAI2F,OAAOk+B,MAAM7jC,GACb,MAAM,IAAI6I,MAAM,gCAEpB,IAAKlD,OAAOm+B,SAAS9jC,GACjB,MAAM,IAAI6I,MAAM,qCAIxB,MACMk7B,EAAkB,IAAIb,EAAgBJ,EAAU1/B,OADb,IAAVpD,EAAwB,KAAOA,GAG9D,OADA8C,KAAKmkB,WAAW1iB,KAAKw/B,GACdjhC,KAQX,cAAcoQ,GACVzT,OAAOkH,KAAKuM,GAAM7O,QAAS/D,IACvB,MAAM0jC,EAAsB9wB,EAAK5S,GACjCb,OAAOkH,KAAKq9B,GAAqB3/B,QAASjB,IACtC,MAAMpD,EAAQgkC,EAAoB5gC,GAClCN,KAAKmkB,WAAW1iB,KAAK,IAAI2+B,EAAgB5iC,EAAK8C,EAAMpD,QAWhE,mBAAmBoD,GACf,OAAON,KAAKmkB,WAAWgd,KAAMC,GAAOA,EAAG9gC,OAASA,IAIxD3D,OAAOkF,OAAO,EAAqBhE,UAAW,CAC1CwjC,UAAW,EAAqBxjC,UAAU4iC,IAC1Ca,UAAW,EAAqBzjC,UAAU0jC,IAC1CC,SAAU,EAAqB3jC,UAAU4jC,IACzCC,OAAQ,EAAqB7jC,UAAU8jC,IACvCC,OAAQ,EAAqB/jC,UAAUgkC,IACvCC,QAAS,EAAqBjkC,UAAUkkC,IACxCC,MAAO,EAAqBnkC,UAAUokC,c,kBC1VnC,MAAM,UAAmC,EAK5C,YAAY/gC,EAAQijB,GAChB7Z,MAAM6Z,GACNnkB,KAAKkB,OAASA,EAKlB,UACI,MAAMmM,EAAQ,WAASvQ,IAAIkD,KAAKkB,QAC1BiK,EAAO5H,KAAKC,UAAUxD,MACtBwI,EAAM,IAAIhC,EAAA,gBAAwB6G,EAAMY,OAAQZ,EAAM7P,IAAK2N,GACjE,OAAOkC,EAAMikB,SAAS,IAAOjkB,EAAMK,GAAGnE,KAAKf,GAAK7B,KAAM5C,IAElDsJ,EAAMtL,KAAKyb,cAAcnQ,EAAOtJ,EAAS7C,OAAQlB,KAAKkB,OAAQ,CAAEuc,YAAY,IACrEzd,KAAKkB,a,2FCjBjB,MAAM,EAOT,YAAYmzB,GACRr0B,KAAKkiC,MAAQ,eAAK7N,EAAY7uB,GAC9BxF,KAAKmiC,KAAO9N,EAAYh4B,EACxB2D,KAAKoiC,OAAS/N,EAAY9uB,EAC1BvF,KAAKk5B,SAAWrsB,KAAKksB,MAQzB,SAASsJ,GACL,MAAMD,EAAS,EAAYE,UAAUD,EAASriC,KAAKmiC,KAAMniC,KAAKoiC,QAC9D,IAAK,IAAInmC,EAAI,EAAGuE,EAAM4hC,EAAO/jC,OAAQpC,EAAIuE,EAAKvE,GAAK,EAC/C,IAAK+D,KAAKuiC,MAAMH,EAAOnmC,IACnB,OAAO,EAGf,OAAO,EAQX,MAAMoE,GACF,MAAMmiC,EAAMhP,KAAKiP,MAAMpiC,EAAQ,GACzBqiC,EAAM,GAAMriC,EAAQ,EAI1B,OAAwB,IAFXL,KAAKkiC,MAAM73B,WAAWm4B,GAEpBE,GAUnB,iBAAiBL,EAASF,EAAMC,GAC5B,MAAMO,EAAa,IAAIvwB,MAAMgwB,GACvBQ,EAAQ,EAAYC,QAAQ,EAAGR,GAC/BS,EAAQ,EAAYD,QAAQD,EAAOP,GACzC,IAAK,IAAIpmC,EAAI,EAAGA,EAAImmC,EAAQnmC,GAAK,EAC7B0mC,EAAW1mC,IAAM2mC,EAAS3mC,EAAI6mC,GAAUX,EAE5C,OAAOQ,EASX,eAAeI,EAAMvlC,GACjB,MAAM2gC,EAAyB,EAAb3gC,EAAIa,OAChB6jC,EAAQ1kC,EAAIa,OAAS8/B,EACrB6E,EAAK,WACLC,EAAK,UACX,IAAIC,EACAC,EACAC,EACAnnC,EAGJ,IAFAinC,EAAKH,EACL9mC,EAAI,EACGA,EAAIimC,GACPkB,EAA2B,IAApB5lC,EAAI6M,WAAWpO,IACW,IAAzBuB,EAAI6M,WAAWpO,GAAK,KAAc,GACT,IAAzBuB,EAAI6M,WAAWpO,GAAK,KAAc,IACT,IAAzBuB,EAAI6M,WAAWpO,GAAK,KAAc,GAC1CA,GAAK,EACLmnC,GAAc,MAALA,GAAeJ,KAAUI,IAAO,IAAMJ,EAAM,QAAW,IAAQ,WACxEI,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,GAAc,MAALA,GAAeH,KAAUG,IAAO,IAAMH,EAAM,QAAW,IAAQ,WACxEC,GAAME,EACNF,EAAMA,GAAM,GAAOA,IAAO,GAC1BC,EAAyB,GAAV,MAALD,KAAqC,GAAbA,IAAO,IAAW,QAAW,IAAQ,WACvEA,EAAwB,OAAV,MAANC,KAA4C,OAAdA,IAAQ,IAAgB,QAAW,IAG7E,OADAC,EAAK,EACGjF,GACJ,KAAK,EACDiF,IAA+B,IAAxB5lC,EAAI6M,WAAWpO,EAAI,KAAc,GAC5C,KAAK,EACDmnC,IAA+B,IAAxB5lC,EAAI6M,WAAWpO,EAAI,KAAc,EAC5C,KAAK,EACDmnC,GAA2B,IAApB5lC,EAAI6M,WAAWpO,GACtBmnC,GAAa,MAALA,GAAeJ,KAAUI,IAAO,IAAMJ,EAAM,QAAW,IAAO,WACtEI,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,GAAa,MAALA,GAAeH,KAAUG,IAAO,IAAMH,EAAM,QAAW,IAAO,WACtEC,GAAME,EAQd,OANAF,GAAM1lC,EAAIa,OACV6kC,GAAMA,IAAO,GACbA,EAAuB,YAAV,MAALA,KAA8C,YAAbA,IAAO,IAAoB,QAAW,IAAO,WACtFA,GAAMA,IAAO,GACbA,EAAwB,YAAV,MAALA,KAA8C,YAAbA,IAAO,IAAoB,QAAW,IAAQ,WACxFA,GAAMA,IAAO,GACNA,IAAO,K,6BCnHtB,kCAGO,MAAMG,EACT,cACIrjC,KAAKsjC,MAAQ,GAMjB,WACI,OAAO3mC,OAAOkH,KAAK7D,KAAKsjC,OAM5B,QACItjC,KAAKsjC,MAAQ,GAOjB,KAAKrV,GAED,OADAjuB,KAAKsjC,MAAQ3mC,OAAOkF,OAAO,GAAIosB,EAAWqV,OACnCtjC,KAMX,kBACI,QAAI,MAAOA,KAAKsjC,SAGRtjC,KAAKujC,WAAWpC,KAAMnlB,GAA4B,UAApBhc,KAAKsjC,MAAMtnB,IASrD,mBACIhc,KAAKujC,WAAWhiC,QAASya,IACG,UAApBhc,KAAKsjC,MAAMtnB,WACJhc,KAAKsjC,MAAMtnB,KAS9B,QAAQiW,GACJ,OAAOjyB,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,IAQ/B,UAAUA,GACN,MAA4C,UAArCjyB,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,IAQ/B,SAASA,GACL,MAA4C,SAArCjyB,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,IAO/B,eAAeA,GACX,IAAK,IAAIh2B,EAAI,EAAGA,EAAIg2B,EAAW5zB,OAAQpC,GAAK,EACxC+D,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,EAAWh2B,KAAO,QAE1C,OAAO+D,KAOX,cAAciyB,GACV,IAAK,IAAIh2B,EAAI,EAAGA,EAAIg2B,EAAW5zB,OAAQpC,GAAK,EACxC+D,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,EAAWh2B,KAAO,OAE1C,OAAO+D,KAOX,gBAAgBiyB,GACZ,IAAK,IAAIh2B,EAAI,EAAGA,EAAIg2B,EAAW5zB,OAAQpC,GAAK,SACjC+D,KAAKsjC,MAAMtjC,KAAKgc,IAAIiW,EAAWh2B,KAE1C,OAAO+D,KAMX,SACI,OAAOrD,OAAOkF,OAAO,GAAI7B,KAAKsjC,OAOlC,SAASlzB,GACLpQ,KAAKsjC,MAAQlzB,EAOjB,gBAAgBA,GACZ,MAAM6d,EAAa,IAAIjuB,KAEvB,OADAiuB,EAAW/P,SAAS9N,GACb6d,EAOX,IAAIgE,GACA,MAAMjW,EAA4B,iBAAfiW,EAA0BA,EAAaA,EAAWzlB,GACrE,GAAiC,IAA7BwP,EAAI7d,QAAQ,cAAmD,IAA7B6d,EAAI7d,QAAQ,aAC9C,OAAO6d,EAEX,MAAM,IAAI6K,UAAU,8DAG5Bwc,EAAW3gB,iBAAmB,CAAC,OAAQ,SAAU,SAAU,QAAS,W,6BCvJpE,SAAS8gB,IACL,MAAM,IAAIz9B,MAAM,2FADpB,kCAGA,IAAI09B,EAAO,CACPC,WAAYF,EACZG,aAAcH,EACdI,WAAYJ,GAEhB,IAGIC,EAAO,EAAQ,IAEnB,MAAOvlC,IAGP,MAAM,WAAEwlC,EAAU,aAAEC,EAAY,WAAEC,GAAeH,G,8DChBjD,GAAmB,oBAATA,KAAsB,CAAC,IAAIvlC,EAAI,IAAI6H,MAAM,6BAA2D,MAA7B7H,EAAE0S,KAAO,mBAA0B1S,EACpHlC,EAAOD,QAAU0nC,M,cCDjB,GAAwB,oBAAdI,UAA2B,CAAC,IAAI3lC,EAAI,IAAI6H,MAAM,kCAAgE,MAA7B7H,EAAE0S,KAAO,mBAA0B1S,EAC9HlC,EAAOD,QAAU8nC,W,y/BCgBjB,SAASC,EAAiBpnB,EAAQqnB,EAAYC,EAAoBjoC,GAC9DY,OAAOkH,KAAK9H,GAASwF,QAAS0iC,IAC1B,MAAM3gB,EAAW,qBAAW0gB,EAAmB9gC,QAAQ,UAAW+gC,IAClEtnC,OAAOC,eAAe8f,EAAQunB,EAAU3gB,EAASygB,EAAYE,EAAU,CACnEnnC,IAAG,IACQf,EAAQkoC,QAwBxB,SAASjQ,IACZ,MAAM,IAAIjuB,MAAM,4EAEb,SAASmuB,IACZ,MAAM,IAAInuB,MAAM,0EAvBpB+9B,EAAiBI,EAAM,OAAQ,uBAAwB,CACnDb,WAAA,aAAYc,SAAA,WAAUpwB,aAAA,eAActF,UAAA,YAAW21B,YAAA,cAAaC,KAAA,OAAMC,QAAA,UAASC,OAAA,WAE/ET,EAAiB3P,EAAA,EAAct2B,UAAW,KAAM,mCAAsC,CAClF6P,GAAA,KACA82B,UACA7P,YACA/oB,QACApF,UACA09B,OACAO,UACA3jC,QACA4jC,gBACAC,eACAjL,uBAAA,EACAvF,gBAAA,EACA1mB,MAAA,IAEJq2B,EAAiB,YAAUjmC,UAAW,YAAa,sCAAyCyS,GChB5F,MAAMs0B,EAAUnxB,IACVoxB,EAAUzX,IACV0X,EAAW1yB,MAIF,YAAE,W","file":"baqend.es2015.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 22);\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { CommunicationError } from '../error';\n/**\n * Checks whether the user uses a browser which does support revalidation.\n */\n// @ts-ignore\nconst REVALIDATION_SUPPORTED = typeof navigator === 'undefined' || (typeof chrome !== 'undefined' && /google/i.test(navigator.vendor)) || (/cros i686/i.test(navigator.platform));\nexport const StatusCode = {\n    NOT_MODIFIED: 304,\n    BAD_CREDENTIALS: 460,\n    BUCKET_NOT_FOUND: 461,\n    INVALID_PERMISSION_MODIFICATION: 462,\n    INVALID_TYPE_VALUE: 463,\n    OBJECT_NOT_FOUND: 404,\n    OBJECT_OUT_OF_DATE: 412,\n    PERMISSION_DENIED: 466,\n    QUERY_DISPOSED: 467,\n    QUERY_NOT_SUPPORTED: 468,\n    SCHEMA_NOT_COMPATIBLE: 469,\n    SCHEMA_STILL_EXISTS: 470,\n    SYNTAX_ERROR: 471,\n    TRANSACTION_INACTIVE: 472,\n    TYPE_ALREADY_EXISTS: 473,\n    TYPE_STILL_REFERENCED: 474,\n    SCRIPT_ABORTION: 475,\n};\nexport class Message {\n    /**\n     * @param args The path arguments\n     */\n    constructor(...args) {\n        this.withCredentials = false;\n        this.progressCallback = null;\n        this._tokenStorage = null;\n        this._responseType = null;\n        let index = 0;\n        let path = this.spec.path[0];\n        const len = this.spec.path.length;\n        for (let i = 1; i < len; i += 1) {\n            if (this.spec.dynamic && len - 1 === i) {\n                path += args[index].split('/').map(encodeURIComponent).join('/');\n            }\n            else {\n                path += encodeURIComponent(args[index]) + this.spec.path[i];\n            }\n            index += 1;\n        }\n        let query = '';\n        for (let i = 0; i < this.spec.query.length; i += 1) {\n            const arg = args[index];\n            index += 1;\n            if (arg !== undefined && arg !== null) {\n                query += (query || path.indexOf('?') !== -1) ? '&' : '?';\n                query += `${this.spec.query[i]}=${encodeURIComponent(arg)}`;\n            }\n        }\n        this.request = {\n            method: this.spec.method,\n            path: path + query,\n            entity: null,\n            headers: {},\n        };\n        if (args[index]) {\n            this.entity(args[index], 'json');\n        }\n        this.responseType('json');\n    }\n    /**\n     * Returns the specification of this message\n     */\n    get spec() { return null; }\n    /**\n     * Creates a new message class with the given message specification\n     * @return A created message object for the specification\n     */\n    static create(specification) {\n        const parts = specification.path.split('?');\n        const path = parts[0].split(/[:*]\\w*/);\n        const query = [];\n        if (parts[1]) {\n            parts[1].split('&').forEach((arg) => {\n                const part = arg.split('=');\n                query.push(part[0]);\n            });\n        }\n        const spec = {\n            path,\n            query,\n            status: specification.status,\n            method: specification.method,\n            dynamic: specification.path.indexOf('*') !== -1,\n        };\n        return class extends Message {\n            get spec() {\n                return spec;\n            }\n        };\n    }\n    /**\n     * Creates a new message class with the given message specification and a full path\n     * @param specification\n     * @param members additional members applied to the created message\n     * @return\n     */\n    static createExternal(specification, members) {\n        const { path } = specification, props = __rest(specification, [\"path\"]);\n        const spec = Object.assign({ dynamic: false, path: [path] }, props);\n        /**\n         * @ignore\n         */\n        const cls = class extends Message {\n            get spec() {\n                return spec;\n            }\n        };\n        Object.assign(cls.prototype, members);\n        return cls;\n    }\n    get isBinary() {\n        return (this.request.type && this.request.type in Message.BINARY) || this._responseType in Message.BINARY;\n    }\n    tokenStorage(value) {\n        if (value === undefined) {\n            return this._tokenStorage;\n        }\n        this._tokenStorage = value;\n        return this;\n    }\n    path(path) {\n        if (path !== undefined) {\n            const queryIndex = this.request.path.indexOf('?') + 1;\n            this.request.path = path + (queryIndex > 0 ? (path.indexOf('?') > -1 ? '&' : '?') + this.request.path.substring(queryIndex) : '');\n            return this;\n        }\n        return this.request.path;\n    }\n    header(name, value) {\n        if (value === null) {\n            delete this.request.headers[name];\n            return this;\n        }\n        if (value !== undefined) {\n            this.request.headers[name] = value;\n            return this;\n        }\n        return this.request.headers[name];\n    }\n    /**\n     * Sets the entity type\n     * @param data - The data to send\n     * @param type - the type of the data one of 'json'|'text'|'blob'|'arraybuffer'\n     * defaults detect the type based on the body data\n     * @return This message object\n     */\n    entity(data, type) {\n        let requestType = type;\n        if (!requestType) {\n            if (typeof data === 'string') {\n                if (/^data:(.+?)(;base64)?,.*$/.test(data)) {\n                    requestType = 'data-url';\n                }\n                else {\n                    requestType = 'text';\n                }\n            }\n            else if (typeof Blob !== 'undefined' && data instanceof Blob) {\n                requestType = 'blob';\n            }\n            else if (typeof Buffer !== 'undefined' && data instanceof Buffer) {\n                requestType = 'buffer';\n            }\n            else if (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer) {\n                requestType = 'arraybuffer';\n            }\n            else if (typeof FormData !== 'undefined' && data instanceof FormData) {\n                requestType = 'form';\n            }\n            else {\n                requestType = 'json';\n            }\n        }\n        this.request.type = requestType;\n        this.request.entity = data;\n        return this;\n    }\n    mimeType(mimeType) {\n        return this.header('content-type', mimeType);\n    }\n    contentLength(contentLength) {\n        if (contentLength !== undefined) {\n            return this.header('content-length', `${contentLength}`);\n        }\n        return Number(this.header('content-length'));\n    }\n    ifMatch(eTag) {\n        return this.header('If-Match', this.formatETag(eTag));\n    }\n    ifNoneMatch(eTag) {\n        return this.header('If-None-Match', this.formatETag(eTag));\n    }\n    ifUnmodifiedSince(date) {\n        // IE 10 returns UTC strings and not an RFC-1123 GMT date string\n        return this.header('if-unmodified-since', date && date.toUTCString().replace('UTC', 'GMT'));\n    }\n    /**\n     * Indicates that the request should not be served by a local cache\n     * @return\n     */\n    noCache() {\n        if (!REVALIDATION_SUPPORTED) {\n            this.ifMatch('') // is needed for firefox or safari (but forbidden for chrome)\n                .ifNoneMatch('-'); // is needed for edge and ie (but forbidden for chrome)\n        }\n        return this.cacheControl('max-age=0, no-cache');\n    }\n    cacheControl(value) {\n        return this.header('cache-control', value);\n    }\n    acl(acl) {\n        return this.header('baqend-acl', acl && JSON.stringify(acl));\n    }\n    customHeaders(customHeaders) {\n        return this.header('baqend-custom-headers', customHeaders && JSON.stringify(customHeaders));\n    }\n    accept(accept) {\n        return this.header('accept', accept);\n    }\n    responseType(type) {\n        if (type !== undefined) {\n            this._responseType = type;\n            return this;\n        }\n        return this._responseType;\n    }\n    progress(callback) {\n        if (callback !== undefined) {\n            this.progressCallback = callback;\n            return this;\n        }\n        return this.progressCallback;\n    }\n    /**\n     * Adds the given string to the request path\n     *\n     * If the parameter is an object, it will be serialized as a query string.\n     *\n     * @param query which will added to the request path\n     * @return\n     */\n    addQueryString(query) {\n        if (typeof query === 'string') {\n            this.request.path += query;\n            return this;\n        }\n        if (query) {\n            let sep = this.request.path.indexOf('?') >= 0 ? '&' : '?';\n            Object.keys(query).forEach((key) => {\n                this.request.path += `${sep + key}=${encodeURIComponent(query[key])}`;\n                sep = '&';\n            });\n        }\n        return this;\n    }\n    formatETag(eTag) {\n        if (eTag === null || eTag === undefined || eTag === '*') {\n            return eTag;\n        }\n        let tag = `${eTag}`;\n        if (tag.indexOf('\"') === -1) {\n            tag = `\"${tag}\"`;\n        }\n        return tag;\n    }\n    /**\n     * Handle the receive\n     * @param response The received response headers and data\n     * @return\n     */\n    doReceive(response) {\n        if (this.spec.status.indexOf(response.status) === -1) {\n            throw new CommunicationError(this, response);\n        }\n    }\n}\nMessage.StatusCode = StatusCode;\nMessage.BINARY = {\n    blob: true,\n    buffer: true,\n    stream: true,\n    arraybuffer: true,\n    'data-url': true,\n    base64: true,\n};\nexport const OAuthMessages = {\n    Google: Message.createExternal({\n        method: 'OAUTH',\n        path: 'https://accounts.google.com/o/oauth2/auth?response_type=code&access_type=online',\n        query: ['client_id', 'scope', 'state'],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.addQueryString({\n                redirect_uri: `${baseUri}/db/User/OAuth/google`,\n            });\n        },\n    }),\n    Facebook: Message.createExternal({\n        method: 'OAUTH',\n        path: 'https://www.facebook.com/v7.0/dialog/oauth?response_type=code',\n        query: ['client_id', 'scope', 'state'],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.addQueryString({\n                redirect_uri: `${baseUri}/db/User/OAuth/facebook`,\n            });\n        },\n    }),\n    GitHub: Message.createExternal({\n        method: 'OAUTH',\n        path: 'https://github.com/login/oauth/authorize?response_type=code&access_type=online',\n        query: ['client_id', 'scope', 'state'],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.addQueryString({\n                redirect_uri: `${baseUri}/db/User/OAuth/github`,\n            });\n        },\n    }),\n    LinkedIn: Message.createExternal({\n        method: 'OAUTH',\n        path: 'https://www.linkedin.com/oauth/v2/authorization?response_type=code',\n        query: ['client_id', 'scope', 'state'],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.addQueryString({\n                redirect_uri: `${baseUri}/db/User/OAuth/linkedin`,\n            });\n        },\n    }),\n    Twitter: Message.createExternal({\n        method: 'OAUTH',\n        path: '',\n        query: [],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.request.path = `${baseUri}/db/User/OAuth1/twitter`;\n        },\n    }),\n    Salesforce: Message.createExternal({\n        method: 'OAUTH',\n        path: '',\n        query: ['client_id', 'scope', 'state'],\n        status: [200],\n    }, {\n        addRedirectOrigin(baseUri) {\n            this.addQueryString({\n                redirect_uri: `${baseUri}/db/User/OAuth/salesforce`,\n            });\n        },\n    }),\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVzc2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1lc3NhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFJQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUF5QjlDOztHQUVHO0FBQ0gsYUFBYTtBQUNiLE1BQU0sc0JBQXNCLEdBQUcsT0FBTyxTQUFTLEtBQUssV0FBVyxJQUFJLENBQUMsT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBRWxMLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRztJQUN4QixZQUFZLEVBQUUsR0FBRztJQUNqQixlQUFlLEVBQUUsR0FBRztJQUNwQixnQkFBZ0IsRUFBRSxHQUFHO0lBQ3JCLCtCQUErQixFQUFFLEdBQUc7SUFDcEMsa0JBQWtCLEVBQUUsR0FBRztJQUN2QixnQkFBZ0IsRUFBRSxHQUFHO0lBQ3JCLGtCQUFrQixFQUFFLEdBQUc7SUFDdkIsaUJBQWlCLEVBQUUsR0FBRztJQUN0QixjQUFjLEVBQUUsR0FBRztJQUNuQixtQkFBbUIsRUFBRSxHQUFHO0lBQ3hCLHFCQUFxQixFQUFFLEdBQUc7SUFDMUIsbUJBQW1CLEVBQUUsR0FBRztJQUN4QixZQUFZLEVBQUUsR0FBRztJQUNqQixvQkFBb0IsRUFBRSxHQUFHO0lBQ3pCLG1CQUFtQixFQUFFLEdBQUc7SUFDeEIscUJBQXFCLEVBQUUsR0FBRztJQUMxQixlQUFlLEVBQUUsR0FBRztDQUNyQixDQUFDO0FBRUYsTUFBTSxPQUFnQixPQUFPO0lBMkYzQjs7T0FFRztJQUNILFlBQVksR0FBRyxJQUFjO1FBbEZ0QixvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUVqQyxxQkFBZ0IsR0FBNEIsSUFBSSxDQUFDO1FBSWhELGtCQUFh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","/* eslint-disable no-restricted-globals */\nimport { PersistentError } from '../error';\nexport class Connector {\n    /**\n     * @param host - the host to connect to\n     * @param port - the port to connect to\n     * @param secure - <code>true</code> for an secure connection\n     * @param basePath - The base path of the api endpoint\n     */\n    constructor(host, port, secure, basePath) {\n        this.host = host;\n        this.port = port;\n        this.secure = secure;\n        this.basePath = basePath;\n        /**\n         * the origin do not contains the base path\n         */\n        this.origin = Connector.toUri(this.host, this.port, this.secure, '');\n        /**\n         * The connector will detect if gzip is supported.\n         * Returns true if supported otherwise false.\n         */\n        this.gzip = false;\n    }\n    /**\n     * Indicates id this connector is usable in the current runtime environment\n     * This method must be overwritten in subclass implementations\n     * @param host - the host to connect to\n     * @param port - the port to connect to\n     * @param secure - <code>true</code> for an secure connection\n     * @param basePath - The base path of the api endpoint\n     * @return <code>true</code> if this connector is usable in the current environment\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    static isUsable(host, port, secure, basePath) {\n        return false;\n    }\n    /**\n     * @param host or location\n     * @param port\n     * @param secure=true <code>true</code> for an secure connection\n     * @param basePath The basepath of the api\n     * @return\n     */\n    static create(host, port, secure, basePath) {\n        let h = host;\n        let p = port;\n        let s = secure;\n        let b = basePath;\n        if (typeof location !== 'undefined') {\n            if (!h) {\n                h = location.hostname;\n                p = Number(location.port);\n            }\n            if (s === undefined) {\n                s = location.protocol === 'https:';\n            }\n        }\n        // ensure right type, make secure: true the default\n        s = s === undefined || !!s;\n        if (b === undefined) {\n            b = Connector.DEFAULT_BASE_PATH;\n        }\n        if (h.indexOf('/') !== -1) {\n            const matches = /^(https?):\\/\\/([^/:]+|\\[[^\\]]+])(:(\\d*))?(\\/\\w+)?\\/?$/.exec(h);\n            if (matches) {\n                s = matches[1] === 'https';\n                h = matches[2].replace(/(\\[|])/g, '');\n                p = Number(matches[4]);\n                b = matches[5] || '';\n            }\n            else {\n                throw new Error(`The connection uri host ${h} seems not to be valid`);\n            }\n        }\n        else if (h !== 'localhost' && /^[a-z0-9-]*$/.test(h)) {\n            // handle app names as hostname\n            h += Connector.HTTP_DOMAIN;\n        }\n        if (!p) {\n            p = s ? 443 : 80;\n        }\n        const url = Connector.toUri(h, p, s, b);\n        let connection = this.connections[url];\n        if (!connection) {\n            // check last registered connector first to simplify registering connectors\n            for (let i = this.connectors.length - 1; i >= 0; i -= 1) {\n                const ConnectorConstructor = this.connectors[i];\n                if (ConnectorConstructor.isUsable && ConnectorConstructor.isUsable(h, p, s, b)) {\n                    connection = new ConnectorConstructor(h, p, s, b);\n                    break;\n                }\n            }\n            if (!connection) {\n                throw new Error('No connector is usable for the requested connection.');\n            }\n            this.connections[url] = connection;\n        }\n        return connection;\n    }\n    static toUri(host, port, secure, basePath) {\n        let uri = (secure ? 'https://' : 'http://') + (host.indexOf(':') !== -1 ? `[${host}]` : host);\n        uri += ((secure && port !== 443) || (!secure && port !== 80)) ? `:${port}` : '';\n        uri += basePath;\n        return uri;\n    }\n    /**\n     * @param message\n     * @return\n     */\n    send(message) {\n        let response = { status: 0, headers: {} };\n        return Promise.resolve()\n            .then(() => this.prepareRequest(message))\n            .then(() => new Promise((resolve) => {\n            this.doSend(message, message.request, resolve);\n        }))\n            .then((res) => { response = res; })\n            .then(() => this.prepareResponse(message, response))\n            .then(() => {\n            message.doReceive(response);\n            return response;\n        })\n            .catch((e) => {\n            response.entity = null;\n            throw PersistentError.of(e);\n        });\n    }\n    /**\n     * @param message\n     * @return\n     */\n    prepareRequest(message) {\n        const mimeType = message.mimeType();\n        if (!mimeType) {\n            const { type } = message.request;\n            if (type === 'json') {\n                message.mimeType('application/json;charset=utf-8');\n            }\n            else if (type === 'text') {\n                message.mimeType('text/plain;charset=utf-8');\n            }\n        }\n        this.toFormat(message);\n        let accept;\n        switch (message.responseType()) {\n            case 'json':\n                accept = 'application/json';\n                break;\n            case 'text':\n                accept = 'text/*';\n                break;\n            default:\n                accept = 'application/json,text/*;q=0.5,*/*;q=0.1';\n        }\n        if (!message.accept()) {\n            message.accept(accept);\n        }\n        if (this.gzip) {\n            const ifNoneMatch = message.ifNoneMatch();\n            if (ifNoneMatch && ifNoneMatch !== '\"\"' && ifNoneMatch !== '*') {\n                message.ifNoneMatch(`${ifNoneMatch.slice(0, -1)}--gzip\"`);\n            }\n        }\n        const tokenStorage = message.tokenStorage();\n        if (message.request.path === '/connect') {\n            return tokenStorage.signPath(this.basePath + message.request.path)\n                .then((signedPath) => {\n                // eslint-disable-next-line no-param-reassign\n                message.request.path = signedPath.substring(this.basePath.length);\n                if (message.cacheControl()) {\n                    // eslint-disable-next-line no-param-reassign\n                    message.request.path += `${message.request.path.indexOf('?') !== -1 ? '&' : '?'}BCB`;\n                }\n                return message;\n            });\n        }\n        if (tokenStorage) {\n            const { token } = tokenStorage;\n            if (token) {\n                message.header('authorization', `BAT ${token}`);\n            }\n        }\n        return message;\n    }\n    /**\n     * @param message\n     * @param response The received response headers and data\n     * @return\n     */\n    prepareResponse(message, response) {\n        // IE9 returns status code 1223 instead of 204\n        response.status = response.status === 1223 ? 204 : response.status;\n        let type;\n        const headers = response.headers || {};\n        // some proxies send content back on 204 responses\n        const entity = response.status === 204 ? null : response.entity;\n        if (entity) {\n            type = message.responseType();\n            if (!type || response.status >= 400) {\n                const contentType = headers['content-type'] || headers['Content-Type'];\n                if (contentType && contentType.indexOf('application/json') > -1) {\n                    type = 'json';\n                }\n            }\n        }\n        if (headers.etag) {\n            headers.etag = headers.etag.replace('--gzip', '');\n        }\n        const tokenStorage = message.tokenStorage();\n        if (tokenStorage) {\n            const token = headers['baqend-authorization-token'] || headers['Baqend-Authorization-Token'];\n            if (token) {\n                tokenStorage.update(token);\n            }\n        }\n        return new Promise((resolve) => {\n            resolve(entity && this.fromFormat(response, entity, type));\n        }).then((resultEntity) => {\n            response.entity = resultEntity;\n            if (message.request.path.indexOf('/connect') !== -1 && resultEntity) {\n                this.gzip = !!resultEntity.gzip;\n            }\n        }, (e) => {\n            throw new Error(`Response was not valid ${type}: ${e.message}`);\n        });\n    }\n}\nConnector.DEFAULT_BASE_PATH = '/v1';\nConnector.HTTP_DOMAIN = '.app.baqend.com';\n/**\n * An array of all exposed response headers\n */\nConnector.RESPONSE_HEADERS = [\n    'baqend-authorization-token',\n    'content-type',\n    'baqend-size',\n    'baqend-acl',\n    'etag',\n    'last-modified',\n    'baqend-created-at',\n    'baqend-custom-headers',\n];\n/**\n * Array of all available connector implementations\n */\nConnector.connectors = [];\n/**\n * Array of all created connections\n */\nConnector.connections = {};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29ubmVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ29ubmVjdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDBDQUEwQztBQUUxQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBZTNDLE1BQU0sT0FBZ0IsU0FBUztJQXFJN0I7Ozs7O09BS0c7SUFDSCxZQUNrQixJQUFZLEVBQ1osSUFBWSxFQUNaLE1BQWUsRUFDZixRQUFnQjtRQUhoQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ1osU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNaLFdBQU0sR0FBTixNQUFNLENBQVM7UUFDZixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBckJsQzs7V0FFRztRQUNhLFdBQU0sR0FBVyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRXhGOzs7V0FHRztRQUNJLFNBQUksR0FBWSxLQUFLLENBQUM7SUFhMUIsQ0FBQztJQW5ISjs7Ozs7Ozs7T0FRRztJQUNILDZEQUE2RDtJQUM3RCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQVksRUFBRSxJQUFZLEVBQUUsTUFBZSxFQUFFLFFBQWdCO1FBQzNFLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBWSxFQUFFLElBQWEsRUFBRSxNQUFnQixFQUFFLFFBQWlCO1FBQzVFLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNiLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNiLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUNmLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQztRQUVqQixJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsRUFBRTtZQUNuQyxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUNOLENBQUMsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO2dCQUN0QixDQUFDLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUMzQjtZQUVELElBQUksQ0FBQyxLQUFLLFNBQVMsRUFBRTtnQkFDbkIsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDO2FBQ3BDO1NBQ0Y7UUFFRCxtREFBbUQ7UUFDbkQsQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDbkIsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQztTQUNqQztRQUVELElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUN6QixNQUFNLE9BQU8sR0FBRyx1REFBdUQsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEYsSUFBSSxPQUFPLEVBQUU7Z0JBQ1gsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxPQUFPLENBQUM7Z0JBQzNCLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDdEMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkIsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDdEI7aUJBQU07Z0JBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO2FBQ3ZFO1NBQ0Y7YUFBTSxJQUFJLENBQUMsS0FBSyxXQUFXLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN0RCwrQkFBK0I7WUFDL0IsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUM7U0FDNUI7UUFFRCxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ04sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7U0FDbEI7UUFFRCxNQUFNLEdBQUcsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFdkMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLDJFQUEyRTtZQUMzRSxLQUFLLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ3ZELE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxvQkFBb0IsQ0FBQyxRQUFRLElBQUksb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO29CQUM5RSxVQUFVLEdBQUcsSUFBSSxvQkFBb0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDbEQsTUFBTTtpQkFDUDthQUNGO1lBRUQsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDZixNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7YUFDekU7WUFFRCxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQztTQUNwQztRQUVELE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQVksRUFBRSxJQUFZLEVBQUUsTUFBZSxFQUFFLFFBQWdCO1FBQ3hFLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUYsR0FBRyxJQUFJLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNoRixHQUFHLElBQUksUUFBUSxDQUFDO1FBQ2hCLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQTBCRDs7O09BR0c7SUFDSCxJQUFJLENBQUMsT0FBZ0I7UUFDbkIsSUFBSSxRQUFRLEdBQWEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQztRQUNwRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLEVBQUU7YUFDckIsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDeEMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFXLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQzthQUNGLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNsQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7YUFDbkQsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNULE9BQU8sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUIsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDWCxRQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztZQUN2QixNQUFNLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBVUQ7OztPQUdHO0lBQ0gsY0FBYyxDQUFDLE9BQWdCO1FBQzdCLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7WUFDakMsSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFO2dCQUNuQixPQUFPLENBQUMsUUFBUSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7YUFDcEQ7aUJBQU0sSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFO2dCQUMxQixPQUFPLENBQUMsUUFBUSxDQUFDLDBCQUEwQixDQUFDLENBQUM7YUFDOUM7U0FDRjtRQUVELElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFdkIsSUFBSSxNQUFNLENBQUM7UUFDWCxRQUFRLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBRTtZQUM5QixLQUFLLE1BQU07Z0JBQ1QsTUFBTSxHQUFHLGtCQUFrQixDQUFDO2dCQUM1QixNQUFNO1lBQ1IsS0FBSyxNQUFNO2dCQUNULE1BQU0sR0FBRyxRQUFRLENBQUM7Z0JBQ2xCLE1BQU07WUFDUjtnQkFDRSxNQUFNLEdBQUcseUNBQXlDLENBQUM7U0FDdEQ7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ3JCLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDeEI7UUFFRCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDYixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDMUMsSUFBSSxXQUFXLElBQUksV0FBVyxLQUFLLElBQUksSUFBSSxXQUFXLEtBQUssR0FBRyxFQUFFO2dCQUM5RCxPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDM0Q7U0FDRjtRQUVELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM1QyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRTtZQUN2QyxPQUFPLFlBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztpQkFDaEUsSUFBSSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUU7Z0JBQ25CLDZDQUE2QztnQkFDN0MsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUVsRSxJQUFJLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBRTtvQkFDMUIsNkNBQTZDO29CQUM3QyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztpQkFDdEY7Z0JBRUQsT0FBTyxPQUFPLENBQUM7WUFDakIsQ0FBQyxDQUFDLENBQUM7U0FDTjtRQUVELElBQUksWUFBWSxFQUFFO1lBQ2hCLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxZQUFZLENBQUM7WUFDL0IsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsT0FBTyxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsT0FBTyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2FBQ2pEO1NBQ0Y7UUFFRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBU0Q7Ozs7T0FJRztJQUNILGVBQWUsQ0FBQyxPQUFnQixFQUFFLFFBQWtCO1FBQ2xELDhDQUE4QztRQUM5QyxRQUFRLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFFbkUsSUFBSSxJQUE2QixDQUFDO1FBQ2xDLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQ3ZDLGtEQUFrRDtRQUNsRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1FBRWhFLElBQUksTUFBTSxFQUFFO1lBQ1YsSUFBSSxHQUFHLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxNQUFNLElBQUksR0FBRyxFQUFFO2dCQUNuQyxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUN2RSxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7b0JBQy9ELElBQUksR0FBRyxNQUFNLENBQUM7aUJBQ2Y7YUFDRjtTQUNGO1FBRUQsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFO1lBQ2hCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzVDLElBQUksWUFBWSxFQUFFO1lBQ2hCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQzdGLElBQUksS0FBSyxFQUFFO2dCQUNULFlBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDNUI7U0FDRjtRQUVELE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUM3QixPQUFPLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ3ZCLFFBQVEsQ0FBQyxNQUFNLEdBQUcsWUFBWSxDQUFDO1lBRS9CLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLFlBQVksRUFBRTtnQkFDbkUsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUUsWUFBd0IsQ0FBQyxJQUFJLENBQUM7YUFDOUM7UUFDSCxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNQLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLElBQUksS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7O0FBeFNlLDJCQUFpQixHQUFHLEtBQUssQ0FBQztBQUUxQixxQkFBVyxHQUFHLGlCQUFpQixDQUFDO0FBRWhEOztHQUVHO0FBQ2EsMEJBQWdCLEdBQUc7SUFDakMsNEJBQTRCO0lBQzVCLGNBQWM7SUFDZCxhQUFhO0lBQ2IsWUFBWTtJQUNaLE1BQU07SUFDTixlQUFlO0lBQ2YsbUJBQW1CO0lBQ25CLHVCQUF1QjtDQUN4QixDQUFDO0FBRUY7O0dBRUc7QUFDYSxvQkFBVSxHQUE0QyxFQUFFLENBQUM7QUFFekU7O0dBRUc7QUFDYSxxQkFBVyxHQUFrQyxFQUFFLENBQUMifQ==","/* this connector will only be choose in browser compatible environments */\n/* eslint no-restricted-globals: [\"off\", \"addEventListener\", \"removeEventListener\"] */\nimport { Connector, } from './Connector';\nimport { atob } from '../util';\nexport class XMLHttpConnector extends Connector {\n    /**\n     * @inheritDoc\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    static isUsable(host, port, secure, basePath) {\n        return typeof XMLHttpRequest !== 'undefined';\n    }\n    /**\n     * @inheritDoc\n     */\n    doSend(message, request, receive) {\n        if (request.method === 'OAUTH') {\n            if (this.oAuthHandle) {\n                this.oAuthHandle({ status: 409, headers: {}, entity: '{\"message\": \"A new OAuth request was sent.\"}' });\n            }\n            localStorage.removeItem('oauth-response');\n            const handler = (event) => {\n                if (event.key === 'oauth-response' && this.oAuthHandle && event.newValue) {\n                    this.oAuthHandle(JSON.parse(event.newValue));\n                }\n            };\n            this.oAuthHandle = (msg) => {\n                receive(msg);\n                localStorage.removeItem('oauth-response');\n                removeEventListener('storage', handler, false);\n            };\n            addEventListener('storage', handler, false);\n            return;\n        }\n        const xhr = new XMLHttpRequest();\n        const url = this.origin + this.basePath + request.path;\n        xhr.onreadystatechange = () => {\n            // if we receive an error switch the response type to json\n            if (xhr.responseType && xhr.readyState === 2 && xhr.status >= 400) {\n                xhr.responseType = 'text';\n            }\n            if (xhr.readyState === 4) {\n                const response = {\n                    headers: {},\n                    status: xhr.status,\n                    entity: xhr.response || xhr.responseText,\n                };\n                Connector.RESPONSE_HEADERS.forEach((name) => {\n                    response.headers[name] = xhr.getResponseHeader(name) || '';\n                });\n                receive(response);\n            }\n        };\n        // Set the message progress callback\n        if (xhr.upload && message.progress()) {\n            xhr.upload.onprogress = message.progress();\n        }\n        xhr.open(request.method, url, true);\n        const { entity } = request;\n        const { headers } = request;\n        const headerNames = Object.keys(headers);\n        for (let i = 0, len = headerNames.length; i < len; i += 1) {\n            const headerName = headerNames[i];\n            xhr.setRequestHeader(headerName, headers[headerName]);\n        }\n        xhr.withCredentials = message.withCredentials;\n        switch (message.responseType()) {\n            case 'arraybuffer':\n                xhr.responseType = 'arraybuffer';\n                break;\n            case 'blob':\n            case 'data-url':\n            case 'base64':\n                xhr.responseType = 'blob';\n                break;\n            default:\n            // ignore\n        }\n        xhr.send(entity);\n    }\n    /**\n     * @inheritDoc\n     */\n    fromFormat(response, entity, type) {\n        if (type === 'json') {\n            return JSON.parse(entity);\n        }\n        if (type === 'data-url' || type === 'base64') {\n            const reader = new FileReader();\n            reader.readAsDataURL(entity);\n            return new Promise((resolve, reject) => {\n                reader.onload = resolve;\n                reader.onerror = reject;\n            }).then(() => {\n                let { result } = reader;\n                if (type === 'base64' && typeof result === 'string') {\n                    result = result.substring(result.indexOf(',') + 1);\n                }\n                return result;\n            });\n        }\n        return entity;\n    }\n    /**\n     * @inheritDoc\n     */\n    toFormat(message) {\n        let { type } = message.request;\n        if (type) {\n            let { entity } = message.request;\n            let mimeType = message.mimeType();\n            switch (type) {\n                case 'blob':\n                    mimeType = mimeType || entity.type;\n                    break;\n                case 'arraybuffer':\n                case 'form':\n                    break;\n                case 'data-url': {\n                    const match = entity.match(/^data:(.+?)(;base64)?,(.*)$/);\n                    const isBase64 = match[2];\n                    // eslint-disable-next-line prefer-destructuring\n                    entity = match[3];\n                    type = 'blob';\n                    mimeType = mimeType || match[1];\n                    if (!isBase64) {\n                        entity = decodeURIComponent(entity);\n                        break;\n                    }\n                }\n                // fallthrough\n                case 'base64': {\n                    const binaryStr = atob(entity);\n                    const len = binaryStr.length;\n                    const array = new Uint8Array(len);\n                    for (let i = 0; i < len; i += 1) {\n                        array[i] = binaryStr.charCodeAt(i);\n                    }\n                    type = 'blob';\n                    entity = new Blob([array], { type: mimeType });\n                    break;\n                }\n                case 'json':\n                    if (typeof entity !== 'string') {\n                        entity = JSON.stringify(entity);\n                    }\n                    break;\n                case 'text':\n                    break;\n                default:\n                    throw new Error(`Supported request format:${type}`);\n            }\n            message.entity(entity, type).mimeType(mimeType);\n        }\n    }\n}\nConnector.connectors.push(XMLHttpConnector);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiWE1MSHR0cENvbm5lY3Rvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlhNTEh0dHBDb25uZWN0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMkVBQTJFO0FBQzNFLHNGQUFzRjtBQUV0RixPQUFPLEVBQ0wsU0FBUyxHQUNWLE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHL0IsTUFBTSxPQUFPLGdCQUFpQixTQUFRLFNBQVM7SUFHN0M7O09BRUc7SUFDSCw2REFBNkQ7SUFDN0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFZLEVBQUUsSUFBWSxFQUFFLE1BQWUsRUFBRSxRQUFnQjtRQUMzRSxPQUFPLE9BQU8sY0FBYyxLQUFLLFdBQVcsQ0FBQztJQUMvQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsT0FBZ0IsRUFBRSxPQUFnQixFQUFFLE9BQWlCO1FBQzFELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxPQUFPLEVBQUU7WUFDOUIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSw4Q0FBOEMsRUFBRSxDQUFDLENBQUM7YUFDeEc7WUFFRCxZQUFZLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFFMUMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxLQUFtQixFQUFFLEVBQUU7Z0JBQ3RDLElBQUksS0FBSyxDQUFDLEdBQUcsS0FBSyxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUU7b0JBQ3hFLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDOUM7WUFDSCxDQUFDLENBQUM7WUFFRixJQUFJ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","/* this connector will only be choose in browser compatible environments */\n/* eslint no-restricted-globals: [\"off\", \"location\", \"addEventListener\"] */\nimport { Connector } from './Connector';\nimport { XMLHttpConnector } from './XMLHttpConnector';\nexport class IFrameConnector extends XMLHttpConnector {\n    constructor(host, port, secure, basePath) {\n        super(host, port, secure, basePath);\n        this.queue = null;\n        this.connected = false;\n        this.mid = 0;\n        this.messages = {};\n        this.doReceive = this.doReceive.bind(this);\n        addEventListener('message', this.doReceive, false);\n    }\n    /**\n     * Indicates if this connector implementation is usable for the given host and port\n     * @param host\n     * @param port\n     * @param secure\n     * @return\n     */\n    static isUsable(host, port, secure) {\n        // we use location directly here, since there exists environments, which provide a location and a document but\n        // no window object\n        if (typeof location === 'undefined' || typeof document === 'undefined') {\n            return false;\n        }\n        const locationSecure = location.protocol === 'https:';\n        const locationPort = location.port || (locationSecure ? 443 : 80);\n        return location.hostname !== host || locationPort !== port || locationSecure !== secure;\n    }\n    load(path) {\n        this.iframe = document.createElement('iframe');\n        this.iframe.src = this.origin + this.basePath + path;\n        this.iframe.setAttribute('style', IFrameConnector.style);\n        document.body.appendChild(this.iframe);\n        this.queue = [];\n        this.iframe.addEventListener('load', this.onLoad.bind(this), false);\n    }\n    onLoad() {\n        if (!this.queue) {\n            return;\n        }\n        const { queue } = this;\n        for (let i = 0; i < queue.length; i += 1) {\n            this.postMessage(queue[i]);\n        }\n        this.queue = null;\n    }\n    /**\n     * @inheritDoc\n     */\n    doSend(message, request, receive) {\n        // binary data will be send and received directly\n        if (message.isBinary) {\n            super.doSend(message, request, receive);\n            return;\n        }\n        if (!this.iframe) {\n            this.load(message.request.path);\n            // ensure that we get a local resource cache hit\n            // eslint-disable-next-line no-param-reassign\n            message.request.path = '/connect';\n        }\n        const msg = {\n            mid: this.mid += 1,\n            method: request.method,\n            path: request.path,\n            headers: request.headers,\n            entity: request.entity,\n            responseHeaders: Connector.RESPONSE_HEADERS,\n        };\n        this.messages[msg.mid] = receive;\n        const strMsg = JSON.stringify(msg);\n        if (this.queue) {\n            this.queue.push(strMsg);\n        }\n        else {\n            this.postMessage(strMsg);\n        }\n        if (!this.connected) {\n            setTimeout(() => {\n                if (this.messages[msg.mid]) {\n                    delete this.messages[msg.mid];\n                    receive({\n                        status: 0,\n                        error: new Error('Connection refused.'),\n                        headers: {},\n                    });\n                }\n            }, 10000);\n        }\n    }\n    postMessage(msg) {\n        this.iframe.contentWindow.postMessage(msg, this.origin);\n    }\n    doReceive(event) {\n        if (event.origin !== this.origin || event.data[0] !== '{') {\n            return;\n        }\n        const msg = JSON.parse(event.data);\n        const receive = this.messages[msg.mid];\n        if (receive) {\n            delete this.messages[msg.mid];\n            this.connected = true;\n            receive({\n                status: msg.status,\n                headers: msg.headers,\n                entity: msg.entity,\n            });\n        }\n    }\n}\nIFrameConnector.style = 'width:1px;height:1px;position:absolute;top:-10px;left:-10px;';\nConnector.connectors.push(IFrameConnector);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSUZyYW1lQ29ubmVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSUZyYW1lQ29ubmVjdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDJFQUEyRTtBQUMzRSwyRUFBMkU7QUFFM0UsT0FBTyxFQUFFLFNBQVMsRUFBcUIsTUFBTSxhQUFhLENBQUM7QUFDM0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFJdEQsTUFBTSxPQUFPLGVBQWdCLFNBQVEsZ0JBQWdCO0lBaUNuRCxZQUFZLElBQVksRUFBRSxJQUFZLEVBQUUsTUFBZSxFQUFFLFFBQWdCO1FBQ3ZFLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQXpCOUIsVUFBSyxHQUFpQixJQUFJLENBQUM7UUFFM0IsY0FBUyxHQUFZLEtBQUssQ0FBQztRQXlCakMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDYixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTNDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUE1QkQ7Ozs7OztPQU1HO0lBQ0gsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFZLEVBQUUsSUFBWSxFQUFFLE1BQWU7UUFDekQsOEdBQThHO1FBQzlHLG1CQUFtQjtRQUNuQixJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsSUFBSSxPQUFPLFFBQVEsS0FBSyxXQUFXLEVBQUU7WUFDdEUsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDO1FBQ3RELE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFbEUsT0FBTyxRQUFRLENBQUMsUUFBUSxLQUFLLElBQUksSUFBSSxZQUFZLEtBQUssSUFBSSxJQUFJLGNBQWMsS0FBSyxNQUFNLENBQUM7SUFDMUYsQ0FBQztJQVlELElBQUksQ0FBQyxJQUFZO1FBQ2YsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6RCxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFdkMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELE1BQU07UUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNmLE9BQU87U0FDUjtRQUVELE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFFdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzVCO1FBRUQsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDcEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE9BQWdCLEVBQUUsT0FBZ0IsRUFBRSxPQUFpQjtRQUMxRCxpREFBaUQ7UUFDakQsSUFBSSxPQUFPLENBQUMsUUFBUSxFQUFFO1lBQ3BCLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztZQUN4QyxPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDaEMsZ0RBQWdEO1lBQ2hELDZDQUE2QztZQUM3QyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxVQUFVLENBQUM7U0FDbkM7UUFFRCxNQUFNLEdBQUcsR0FBRztZQUNWLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDbEIsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSTtZQUNsQixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87WUFDeEIsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLGVBQWUsRUFBRSxTQUFTLENBQUMsZ0JBQWdCO1NBQzVDLENBQUM7UUFFRixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUM7UUFFakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN6QjthQUFNO1lBQ0wsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMxQjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2QsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtvQkFDMUIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDOUIsT0FBTyxDQUFDO3dCQUNOLE1BQU0sRUFBRSxDQUFDO3dCQUNULEtBQUssRUFBRSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQzt3QkFDdkMsT0FBTyxFQUFFLEVBQUU7cUJBQ1osQ0FBQyxDQUFDO2lCQUNKO1lBQ0gsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ1g7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLEdBQVc7UUFDckIsSUFBSSxDQUFDLE1BQU8sQ0FBQyxhQUFjLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELFNBQVMsQ0FBQyxLQUFtQjtRQUMzQixJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUN6RCxPQUFPO1NBQ1I7UUFFRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQVksQ0FBQztRQUU5QyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFhLENBQUMsQ0FBQztRQUNqRCxJQUFJLE9BQU8sRUFBRTtZQUNYLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBYSxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFFdEIsT0FBTyxDQUFDO2dCQUNOLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBZ0I7Z0JBQzVCLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBMEM7Z0JBQ3ZELE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBYTthQUMxQixDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7O0FBeklzQixxQkFBSyxHQUFHLDhEQUE4RCxDQUFDO0FBNEloRyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyJ9","export const { WebSocket } = window;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Vic29ja2V0LWJyb3dzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWJzb2NrZXQtYnJvd3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLE1BQU0sQ0FBQyJ9","import { CommunicationError } from '../error';\nimport { WebSocket } from '../util/websocket';\nimport { Observable } from '../util/observable';\nexport class WebSocketConnector {\n    /**\n     *url\n     */\n    constructor(url) {\n        this.observers = {};\n        this.socket = null;\n        this.url = url;\n    }\n    /**\n     *url The websocket connect script url\n     *a websocket connection\n     */\n    static create(url) {\n        let websocket = this.websockets[url];\n        if (!websocket) {\n            websocket = new WebSocketConnector(url);\n            this.websockets[url] = websocket;\n        }\n        return websocket;\n    }\n    open() {\n        if (!this.socket) {\n            const socket = new WebSocket(this.url);\n            let socketPromise;\n            const handleSocketCompletion = (error) => {\n                // observable error calls can throw an exception therefore cleanup beforehand\n                let isError = false;\n                if (this.socket === socketPromise) {\n                    isError = socket.readyState !== 3;\n                    this.socket = null;\n                }\n                let firstErr = null;\n                Object.keys(this.observers).forEach((id) => {\n                    const observer = this.observers[id];\n                    delete this.observers[id]; // unsubscribe to allow re subscriptions\n                    if (!observer) {\n                        return;\n                    }\n                    try {\n                        if (isError) {\n                            observer.error(new CommunicationError(null, Object.assign({ status: 0, headers: {} }, (error instanceof Error && { error }))));\n                        }\n                        else {\n                            observer.complete();\n                        }\n                    }\n                    catch (e) {\n                        if (!firstErr) {\n                            firstErr = e;\n                        }\n                    }\n                });\n                if (firstErr) {\n                    throw firstErr;\n                }\n            };\n            socket.onerror = handleSocketCompletion;\n            socket.onclose = handleSocketCompletion;\n            socket.onmessage = (event) => {\n                const message = JSON.parse(event.data);\n                message.date = new Date(message.date);\n                const { id } = message;\n                if (!id) {\n                    if (message.type === 'error') {\n                        handleSocketCompletion(message);\n                    }\n                    return;\n                }\n                const observer = this.observers[id];\n                if (observer) {\n                    if (message.type === 'error') {\n                        observer.error(new CommunicationError(null, message));\n                    }\n                    else {\n                        observer.next(message);\n                    }\n                }\n            };\n            socketPromise = new Promise((resolve) => {\n                socket.onopen = resolve;\n            }).then(() => socket);\n            this.socket = socketPromise;\n        }\n        return this.socket;\n    }\n    close() {\n        if (this.socket) {\n            this.socket.then((socket) => {\n                socket.close();\n            });\n            this.socket = null;\n        }\n    }\n    /**\n     *tokenStorage\n     *id subscription ID\n     *The channel for sending and receiving messages\n     */\n    openStream(tokenStorage, id) {\n        const stream = new Observable((observer) => {\n            if (this.observers[id]) {\n                throw new Error('Only one subscription per stream is allowed.');\n            }\n            this.observers[id] = observer;\n            return () => {\n                // cleanup only our subscription and handle re subscription on the same stream id correctly\n                if (this.observers[id] === observer) {\n                    delete this.observers[id];\n                }\n            };\n        });\n        Object.assign(stream, {\n            send: (message) => {\n                this.open().then((socket) => {\n                    const jsonMessage = JSON.stringify(Object.assign(Object.assign({ id }, message), (tokenStorage.token && { token: tokenStorage.token })));\n                    socket.send(jsonMessage);\n                });\n            },\n        });\n        return stream;\n    }\n}\n/**\n * Map of all available connectors to their respective websocket connections\n */\nWebSocketConnector.websockets = {};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0Q29ubmVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiV2ViU29ja2V0Q29ubmVjdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM5QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUMsT0FBTyxFQUFFLFVBQVUsRUFBYyxNQUFNLG9CQUFvQixDQUFDO0FBNkI1RCxNQUFNLE9BQU8sa0JBQWtCO0lBeUI3Qjs7T0FFRztJQUNILFlBQVksR0FBVztRQXRCZixjQUFTLEdBQXlELEVBQUUsQ0FBQztRQUVyRSxXQUFNLEdBQThCLElBQUksQ0FBQztRQXFCL0MsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDakIsQ0FBQztJQWxCRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQVc7UUFDdkIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2QsU0FBUyxHQUFHLElBQUksa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUM7U0FDbEM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBU0QsSUFBSTtRQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hCLE1BQU0sTUFBTSxHQUFHLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxJQUFJLGFBQWlDLENBQUM7WUFFdEMsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLEtBQWtCLEVBQUUsRUFBRTtnQkFDcEQsNkVBQTZFO2dCQUM3RSxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUM7Z0JBQ3BCLElBQUksSUFBSSxDQUFD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","import { Acl } from '../Acl';\nimport { Lockable } from '../util';\nimport { PersistentError } from '../error';\nexport var MetadataState;\n(function (MetadataState) {\n    MetadataState[MetadataState[\"UNAVAILABLE\"] = -1] = \"UNAVAILABLE\";\n    MetadataState[MetadataState[\"PERSISTENT\"] = 0] = \"PERSISTENT\";\n    MetadataState[MetadataState[\"DIRTY\"] = 1] = \"DIRTY\";\n})(MetadataState || (MetadataState = {}));\n/**\n * The Metadata instance tracks the state of an object and checks if the object state was changed since last\n * load/update. The metadata keeps therefore the state of:\n * - in which state the object currently is\n * - which db managed the instance\n * - the metadata of the object (id, version, bucket)\n * - which is the owning object (root object) of an embedded object\n *\n * {@link Metadata#get(object)} can be used on any managed object to retrieve the metadata of the root object\n */\nexport class Metadata extends Lockable {\n    /**\n     * @param type\n     */\n    constructor(type) {\n        super();\n        this.entityManager = null;\n        this.decodedKey = null;\n        this.id = null;\n        this.state = MetadataState.DIRTY;\n        this.enabled = true;\n        this.id = null;\n        this.version = null;\n        this.type = type;\n        this.acl = new Acl();\n    }\n    static create(type, db) {\n        if (type.isEntity) {\n            return new Metadata(type);\n        }\n        if (type.isEmbeddable) {\n            return { type, db, setDirty() { } };\n        }\n        throw new Error(`Illegal type ${type}`);\n    }\n    /**\n     * Returns the metadata of the managed object\n     * @param managed\n     * @return\n     */\n    static get(managed) {\n        // eslint-disable-next-line no-underscore-dangle\n        return managed._metadata;\n    }\n    /**\n     * @type EntityManager\n     */\n    get db() {\n        if (this.entityManager) {\n            return this.entityManager;\n        }\n        this.entityManager = require('../baqend').db; // eslint-disable-line global-require\n        return this.entityManager;\n    }\n    /**\n     * @param db\n     */\n    set db(db) {\n        if (!this.entityManager) {\n            this.entityManager = db;\n        }\n        else {\n            throw new Error('DB has already been set.');\n        }\n    }\n    /**\n     * @type string\n     * @readonly\n     */\n    get bucket() {\n        return this.type.name;\n    }\n    /**\n     * @type string\n     * @readonly\n     */\n    get key() {\n        if (!this.decodedKey && this.id) {\n            const index = this.id.lastIndexOf('/');\n            this.decodedKey = decodeURIComponent(this.id.substring(index + 1));\n        }\n        return this.decodedKey;\n    }\n    /**\n     * @param value\n     */\n    set key(value) {\n        const val = `${value}`;\n        if (this.id) {\n            throw new Error('The id can\\'t be set twice.');\n        }\n        this.id = `/db/${this.bucket}/${encodeURIComponent(val)}`;\n        this.decodedKey = val;\n    }\n    /**\n     * Indicates if this object already belongs to an db\n     * <code>true</code> if this object belongs already to an db otherwise <code>false</code>\n     * @type boolean\n     * @readonly\n     */\n    get isAttached() {\n        return !!this.entityManager;\n    }\n    /**\n     * Indicates if this object is represents a db object, but was not loaded up to now\n     * @type boolean\n     * @readonly\n     */\n    get isAvailable() {\n        return this.state > MetadataState.UNAVAILABLE;\n    }\n    /**\n     * Indicates if this object represents the state of the db and was not modified in any manner\n     * @type boolean\n     * @readonly\n     */\n    get isPersistent() {\n        return this.state === MetadataState.PERSISTENT;\n    }\n    /**\n     * Indicates that this object was modified and the object was not written back to the db\n     * @type boolean\n     * @readonly\n     */\n    get isDirty() {\n        return this.state === MetadataState.DIRTY;\n    }\n    /**\n     * Enable/Disable state change tracking of this object\n     * @param newStateTrackingState The new change tracking state\n     * @return\n     */\n    enable(newStateTrackingState) {\n        this.enabled = newStateTrackingState;\n    }\n    /**\n     * Throws the corresponding error if a property is accessed before the owning object is loaded\n     * @throws an exception if the object properties aren't available and the object is enabled\n     */\n    throwUnloadedPropertyAccess(property) {\n        if (this.enabled && !this.isAvailable) {\n            throw new PersistentError(`Illegal property access on ${this.id}#${property} , ensure that this reference is loaded before it's properties are accessed.`);\n        }\n    }\n    /**\n     * Indicates that the associated object isn't available\n     * @return\n     */\n    setUnavailable() {\n        this.state = MetadataState.UNAVAILABLE;\n    }\n    /**\n     * Indicates that the associated object is not stale\n     *\n     * An object is stale if it correlates the database state and is not modified by the user.\n     *\n     * @return\n     */\n    setPersistent() {\n        this.state = MetadataState.PERSISTENT;\n    }\n    /**\n     * Indicates the the object is modified by the user\n     * @return\n     */\n    setDirty() {\n        this.state = MetadataState.DIRTY;\n    }\n    /**\n     * Indicates the the object is removed\n     * @return\n     */\n    setRemoved() {\n        // mark the object only as dirty if it was already available\n        if (this.isAvailable) {\n            this.setDirty();\n            this.version = null;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWV0YWRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJNZXRhZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzdCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHbkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQWMzQyxNQUFNLENBQU4sSUFBWSxhQUlYO0FBSkQsV0FBWSxhQUFhO0lBQ3ZCLGdFQUFnQixDQUFBO0lBQ2hCLDZEQUFjLENBQUE7SUFDZCxtREFBUyxDQUFBO0FBQ1gsQ0FBQyxFQUpXLGFBQWEsS0FBYixhQUFhLFFBSXhCO0FBRUQ7Ozs7Ozs7OztHQVNHO0FBQ0gsTUFBTSxPQUFPLFFBQVMsU0FBUSxRQUFRO0lBc0pwQzs7T0FFRztJQUNILFlBQVksSUFBcUI7UUFDL0IsS0FBSyxFQUFFLENBQUM7UUF6SlYsa0JBQWEsR0FBeUIsSUFBSSxDQUFDO1FBSTNDLGVBQVUsR0FBa0IsSUFBSSxDQUFDO1FBRWpDLE9BQUUsR0FBa0IsSUFBSSxDQUFDO1FBcUp2QixJQUFJLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQS9IRCxNQUFNLENBQUMsTUFBTSxDQUFtQixJQUFvQixFQUFFLEVBQWtCO1FBQ3RFLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLElBQUksUUFBUSxDQUFDLElBQXFCLENBQUMsQ0FBQztTQUM1QztR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","const FallBachValLib = {};\nlet valLib = FallBachValLib;\ntry {\n    // we load this module as an optional external dependency\n    // eslint-disable-next-line global-require\n    valLib = require('validator');\n}\ncatch (e) {\n    // ignore loading optional module error\n}\nexport class Validator {\n    constructor(key, entity) {\n        /**\n         * The cached errors of the validation\n         */\n        this.errors = [];\n        this.key = key;\n        this.entity = entity;\n    }\n    /**\n     * Compiles the given validation code for the managedType\n     * @param managedType The managedType of the code\n     * @param validationCode The validation code\n     * @return the parsed validation function\n     */\n    static compile(managedType, validationCode) {\n        const keys = [];\n        const iter = managedType.attributes();\n        for (let el = iter.next(); !el.done; el = iter.next()) {\n            const attr = el.value;\n            keys.push(attr.name);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-implied-eval,no-new-func\n        const fn = new Function(...keys, validationCode);\n        return function onValidate(argObj) {\n            if (valLib === FallBachValLib) {\n                throw new Error('Validation code will not be executed. Make sure that the validator package is correctly provided as an external dependency.');\n            }\n            const args = keys.map((name) => argObj[name]);\n            return fn.apply({}, args);\n        };\n    }\n    /**\n     * Gets the value of the attribute\n     * @return Value\n     */\n    get value() {\n        return this.entity[this.key];\n    }\n    /**\n     * Checks if the attribute is valid\n     * @return\n     */\n    get isValid() {\n        return this.errors.length === 0;\n    }\n    is(error, fn) {\n        if (error instanceof Function) {\n            return this.is('is', error);\n        }\n        if (fn(this.value, valLib) === false) {\n            this.errors.push(error);\n        }\n        return this;\n    }\n    callMethod(method, errorMessage, argumentList) {\n        const args = argumentList || [];\n        try {\n            args.unshift(this.toStringValue());\n            if (valLib[method].apply(this, args) === false) {\n                this.errors.push(errorMessage || method);\n            }\n        }\n        catch (e) {\n            this.errors.push(errorMessage || e.message);\n        }\n        return this;\n    }\n    toStringValue() {\n        const { value } = this;\n        if (typeof value === 'string' || value instanceof Date) {\n            return value;\n        }\n        return JSON.stringify(value);\n    }\n    toJSON() {\n        return {\n            isValid: this.isValid,\n            errors: this.errors,\n        };\n    }\n}\nconst OTHER_VALIDATORS = ['contains', 'equals', 'matches'];\nObject.keys(valLib).forEach((name) => {\n    if (name.startsWith('is') || OTHER_VALIDATORS.includes(name)) {\n        // use function here to keep the correct this context\n        Validator.prototype[name] = function validate(...args) {\n            const error = typeof args[0] === 'string' ? args.shift() : null;\n            return this.callMethod(name, error, args);\n        };\n    }\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVmFsaWRhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztBQUMxQixJQUFJLE1BQU0sR0FBOEIsY0FBYyxDQUFDO0FBQ3ZELElBQUk7SUFDRix5REFBeUQ7SUFDekQsMENBQTBDO0lBQzFDLE1BQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7Q0FDL0I7QUFBQyxPQUFPLENBQUMsRUFBRTtJQUNWLHVDQUF1QztDQUN4QztBQVNELE1BQU0sT0FBTyxTQUFTO0lBK0ZwQixZQUFZLEdBQVcsRUFBRSxNQUFjO1FBcEV2Qzs7V0FFRztRQUNLLFdBQU0sR0FBYSxFQUFFLENBQUM7UUFrRTVCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBQ2YsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQWpHRDs7Ozs7T0FLRztJQUNILE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBNkIsRUFBRSxjQUFzQjtRQUNsRSxNQUFNLElBQUksR0FBYSxFQUFFLENBQUM7UUFDMUIsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3RDLEtBQUssSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3JELE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdEI7UUFFRCwwRUFBMEU7UUFDMUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxRQUFRLENBQUMsR0FBRyxJQUFJLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDakQsT0FBTyxTQUFTLFVBQVUsQ0FBQyxN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","export class ValidationResult {\n    constructor() {\n        this.fields = {};\n    }\n    /**\n     * Indicates if all fields are valid\n     * @return <code>true</code> if all fields are valid\n     */\n    get isValid() {\n        return Object.keys(this.fields).every((key) => this.fields[key].isValid);\n    }\n    toJSON() {\n        const json = {};\n        Object.keys(this.fields).forEach((key) => {\n            json[key] = this.fields[key].toJSON();\n        });\n        return json;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsaWRhdGlvblJlc3VsdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlZhbGlkYXRpb25SZXN1bHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsTUFBTSxPQUFPLGdCQUFnQjtJQUE3QjtRQUNTLFdBQU0sR0FBb0MsRUFBRSxDQUFDO0lBaUJ0RCxDQUFDO0lBZkM7OztPQUdHO0lBQ0gsSUFBSSxPQUFPO1FBQ1QsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0UsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLElBQUksR0FBWSxFQUFFLENBQUM7UUFDekIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDRiJ9","import * as message from '../message';\nimport { StatusCode } from '../connector';\nimport { Validator } from './Validator';\n/**\n * Representation of a Code which runs on Baqend.\n */\nexport class Code {\n    /**\n     * @param metamodel\n     * @param entityManagerFactory\n     */\n    constructor(metamodel, entityManagerFactory) {\n        this.metamodel = metamodel;\n        this.entityManagerFactory = entityManagerFactory;\n    }\n    /**\n     * Converts the given function to a string\n     * @param fn The JavaScript function to serialize\n     * @return The serialized function\n     */\n    functionToString(fn) {\n        if (!fn) {\n            return '';\n        }\n        let str = fn.toString();\n        str = str.substring(str.indexOf('{') + 1, str.lastIndexOf('}'));\n        if (str.charAt(0) === '\\n') {\n            str = str.substring(1);\n        }\n        if (str.charAt(str.length - 1) === '\\n') {\n            str = str.substring(0, str.length - 1);\n        }\n        return str;\n    }\n    /**\n     * Converts the given string to a module wrapper function\n     * @param signature The expected parameters of the function\n     * @param code The JavaScript function to deserialize\n     * @return The deserialized function\n     */\n    stringToFunction(signature, code) {\n        // eslint-disable-next-line @typescript-eslint/no-implied-eval\n        return new Function(signature /* typings are incorrect here */, code); // eslint-disable-line no-new-func\n    }\n    /**\n     * Loads a list of all available modules without handlers\n     *\n     * @return\n     */\n    loadModules() {\n        const msg = new message.GetAllModules();\n        return this.entityManagerFactory.send(msg)\n            .then((response) => response.entity);\n    }\n    loadCode(type, codeType, asFunction = false) {\n        const bucket = typeof type === 'string' ? type : type.name;\n        const msg = new message.GetBaqendCode(bucket, codeType)\n            .responseType('text');\n        return this.entityManagerFactory.send(msg)\n            .then((response) => this.parseCode(bucket, codeType, asFunction, response.entity), (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return null;\n            }\n            throw e;\n        });\n    }\n    saveCode(type, codeType, fn) {\n        const bucket = typeof type === 'string' ? type : type.name;\n        const msg = new message.SetBaqendCode(bucket, codeType)\n            .entity(fn instanceof Function ? this.functionToString(fn) : fn, 'text')\n            .responseType('text');\n        return this.entityManagerFactory.send(msg)\n            .then((response) => this.parseCode(bucket, codeType, fn instanceof Function, response.entity));\n    }\n    /**\n     * Deletes Baqend code identified by the given bucket and code type\n     *\n     * @param type The entity type for the handler or the Name of the\n     * Baqend code\n     * @param codeType The type of the code\n     * @return succeed if the code was deleted\n     */\n    deleteCode(type, codeType) {\n        const bucket = typeof type === 'string' ? type : type.name;\n        const msg = new message.DeleteBaqendCode(bucket, codeType);\n        return this.entityManagerFactory.send(msg)\n            .then(() => this.parseCode(bucket, codeType, false, null));\n    }\n    /**\n     * @param bucket\n     * @param codeType\n     * @param [asFunction=false]\n     * @param code\n     * @return\n     * @private\n     */\n    parseCode(bucket, codeType, asFunction, code) {\n        if (codeType === 'validate') {\n            const type = this.metamodel.entity(bucket);\n            type.validationCode = code === null ? null : Validator.compile(type, code);\n            return asFunction ? type.validationCode : code;\n        }\n        return code && asFunction ? this.stringToFunction(['module', 'exports'], code) : code;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNvZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUkxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXhDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLElBQUk7SUFLZjs7O09BR0c7SUFDSCxZQUFZLFNBQW9CLEVBQUUsb0JBQTBDO1FBQzFFLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxvQkFBb0IsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGdCQUFnQixDQUFDLEVBQVk7UUFDM0IsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNQLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFFRCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDeEIsR0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDMUIsR0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDeEI7UUFFRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDdkMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDeEM7UUFFRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGdCQUFnQixDQUFDLFNBQW1CLEVBQUUsSUFBWTtRQUNoRCw4REFBOEQ7UUFDOUQsT0FBTyxJQUFJLFFBQVEsQ0FBQyxTQUFnQixDQUFDLGdDQUFnQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsa0NBQWtDO0lBQ2xILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsV0FBVztRQUNULE1BQU0sR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7YUFDdkMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQTBCRCxRQUFRLENBQUMsSUFBK0IsRUFBRSxRQUFnQixFQUFFLFVBQVUsR0FBRyxLQUFLO1FBQzVFLE1BQU0sTUFBTSxHQUFHLE9BQU8sSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzNELE1BQU0sR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDO2FBQ3BELFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV4QixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO2FBQ3ZDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUN2RixJQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssVUFBVSxDQUFDLGdCQUFnQixFQUFFO2dCQUM1QyxPQUFPLElBQUksQ0FBQzthQUNiO1lBRUQsTUFBTSxDQUFDLENBQUM7UUFDVixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUF3QkQsUUFBUSxDQUFDLElBQStCLEVBQUUsUUFBZ0IsRUFBRSxFQUFxQjtRQUMvRSxNQUFNLE1BQU0sR0FBRyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUUzRCxNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQzthQUNwRCxNQUFNLENBQUMsRUFBRSxZQUFZLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDO2FBQ3ZFLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV4QixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO2FBQ3ZDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEVBQUUsWUFBWSxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBRSxDQUFDLENBQUM7SUFDcEcsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxVQUFVLENBQUMsSUFBK0IsRUFBRSxRQUFnQjtRQUMxRCxNQUFNLE1BQU0sR0FBRyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUMzRCxNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDM0QsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQzthQUN2QyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFRDs7Ozs7OztPQU9HO0lBQ0gsU0FBUyxDQUFDLE1BQWMsRUFBRSxRQUFnQixFQUFFLFVBQW1CLEVBQUUsSUFBbUI7UUFDbEYsSUFBSSxRQUFRLEtBQUssVUFBVSxFQUFFO1lBQzNCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzRSxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQ2hEO1FBRUQsT0FBTyxJQUFJLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUN4RixDQUFDO0NBQ0YifQ==","import * as message from '../message';\n/**\n * An executor of Modules running on Baqend.\n */\nexport class Modules {\n    /**\n     * @param entityManager\n     */\n    constructor(entityManager) {\n        this.entityManager = entityManager;\n    }\n    /**\n     * Calls the module, which is identified by the given bucket\n     *\n     * The optional query parameter will be attached as GET-parameters.\n     *\n     * @param bucket Name of the module\n     * @param query GET-Parameter as key-value-pairs or query string\n     * @param options Additional request options\n     * @param options.responseType The type used to provide the response data, defaults to text oder json\n     * depends on the received data, can be one of arraybuffer, blob, json, text, base64, data-url\n     * @param doneCallback\n     * @param failCallback\n     * @return\n     */\n    get(bucket, query, options, doneCallback, failCallback) {\n        if (query instanceof Function) {\n            return this.get(bucket, {}, query, options, doneCallback);\n        }\n        if (options instanceof Function) {\n            return this.get(bucket, query, {}, options, doneCallback);\n        }\n        const opt = options || {};\n        const msg = new message.GetBaqendModule(bucket)\n            .addQueryString(query || '')\n            .responseType(opt.responseType || null);\n        return this.send(msg, doneCallback, failCallback);\n    }\n    /**\n     * Calls the module, which is identified by the given bucket\n     *\n     * @param bucket Name of the module\n     * @param [body] The POST-body data to send\n     * @param options Additional request options\n     * @param options.requestType A optional type hint used to correctly interpret the provided data, can be one\n     * of arraybuffer, blob, json, text, base64, data-url, form\n     * @param options.mimeType The mimType of the body. Defaults to the mimeType of the provided data if\n     * it is a file object, blob or data-url\n     * @param options.responseType The type used to provide the response data, defaults to text oder json\n     * depends on the received data, can be one of arraybuffer, blob, json, text, base64, data-url\n     * @param doneCallback\n     * @param failCallback\n     * @return\n     */\n    post(bucket, body, options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.post(bucket, body, {}, options, doneCallback);\n        }\n        const opt = options || {};\n        const msg = new message.PostBaqendModule(bucket)\n            .entity(body, opt.requestType)\n            .mimeType(opt.mimeType || null)\n            .responseType(opt.responseType || null);\n        return this.send(msg, doneCallback, failCallback);\n    }\n    send(msg, doneCallback, failCallback) {\n        return this.entityManager.send(msg)\n            .then((response) => response.entity)\n            .then(doneCallback, failCallback);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kdWxlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1vZHVsZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFNdEM7O0dBRUc7QUFDSCxNQUFNLE9BQU8sT0FBTztJQUdsQjs7T0FFRztJQUNILFlBQVksYUFBNEI7UUFDdEMsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7SUFDckMsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7O09BYUc7SUFDSCxHQUFHLENBQUMsTUFBYyxFQUFFLEtBQXFELEVBQ3ZFLE9BQXdELEVBQUUsWUFBa0IsRUFBRSxZQUFrQjtRQUNoRyxJQUFJLEtBQUssWUFBWSxRQUFRLEVBQUU7WUFDN0IsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztTQUMzRDtRQUVELElBQUksT0FBTyxZQUFZLFFBQVEsRUFBRTtZQUMvQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQzNEO1FBRUQsTUFBTSxHQUFHLEdBQUcsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUUxQixNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDO2FBQzVDLGNBQWMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO2FBQzNCLFlBQVksQ0FBQyxHQUFHLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxDQUFDO1FBRTFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7O09BZUc7SUFDSCxJQUFJLENBQUMsTUFBYyxFQUFFLElBQWlCLEVBQUUsT0FDTCxFQUFFLFlBQWtCLEVBQUUsWUFBa0I7UUFDekUsSUFBSSxPQUFPLE9BQU8sS0FBSyxVQUFVLEVBQUU7WUFDakMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztTQUMzRDtRQUVELE1BQU0sR0FBRyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFFMUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDO2FBQzdDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQzthQUM3QixRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUM7YUFDOUIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLENBQUM7UUFFMUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELElBQUksQ0FBQyxHQUFZLEVBQUUsWUFBa0IsRUFBRSxZQUFrQjtRQUN2RCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQzthQUNoQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7YUFDbkMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0NBQ0YifQ==","import * as msg from '../message';\n/**\n * A Logger to store log notes when running the app.\n */\nexport class Logger {\n    constructor() {\n        this.entityManager = null;\n        this.levelIndex = 2;\n    }\n    /**\n     * Creates a Logger instance for the given EntityManager\n     * @param entityManager - Theo owning entityManager\n     * @return The created logger instance\n     */\n    static create(entityManager) {\n        const proto = this.prototype;\n        const logger = (() => {\n            function LoggerFunction(...args) {\n                proto.log.apply(LoggerFunction, args);\n            }\n            Object.getOwnPropertyNames(proto).forEach((key) => {\n                Object.defineProperty(LoggerFunction, key, Object.getOwnPropertyDescriptor(proto, key));\n            });\n            return LoggerFunction;\n        })();\n        logger.init(entityManager);\n        return logger;\n    }\n    /**\n     * The log level which will be logged\n     *\n     * The log level can be one of 'trace', 'debug', 'info', 'warn', 'error'\n     * @type string\n     */\n    get level() {\n        return Logger.LEVELS[this.levelIndex];\n    }\n    /**\n     * Sets the log level which will be logged\n     * @param value\n     */\n    set level(value) {\n        const index = Logger.LEVELS.indexOf(value);\n        if (index === -1) {\n            throw new Error(`Unknown logging level ${value}`);\n        }\n        this.levelIndex = index;\n    }\n    log(...args) {\n        const level = Logger.LEVELS.indexOf(args[0]) === -1 ? 'info' : args.shift();\n        if (this.levelIndex > Logger.LEVELS.indexOf(level)) {\n            return Promise.resolve(null);\n        }\n        let message = typeof args[0] === 'string' ? this.format(args.shift(), args) : '[no message]';\n        let data = null;\n        if (args.length) {\n            const arg = args.pop();\n            data = arg;\n            if (typeof arg !== 'object' || Array.isArray(arg)) {\n                data = { data: arg };\n            }\n            if (arg instanceof Error) {\n                // errors aren't loggable by default, since they do not have any visible property\n                const { \n                // @ts-ignore\n                stack, data: data1, message: message1, name, status, } = arg;\n                data = {\n                    name,\n                    message: message1,\n                    stack,\n                    status,\n                    data: data1,\n                };\n            }\n        }\n        if (args.length) {\n            message += `, ${args.join(', ')}`;\n        }\n        return this.logJSON(Object.assign({ date: new Date().toISOString(), message,\n            level,\n            data }, (this.entityManager.me && { user: this.entityManager.me.id })));\n    }\n    format(message, args) {\n        if (args.length === 0) {\n            return message;\n        }\n        const str = String(message).replace(Logger.FORMAT_REGEXP, (x) => {\n            if (x === '%%') {\n                return '%';\n            }\n            if (!args.length) {\n                return x;\n            }\n            switch (x) {\n                case '%s':\n                    return String(args.shift());\n                case '%d':\n                    return String(Number(args.shift()));\n                case '%j':\n                    try {\n                        return JSON.stringify(args.shift());\n                    }\n                    catch (_) {\n                        return '[Circular]';\n                    }\n                default:\n                    return x;\n            }\n        });\n        return str;\n    }\n    init(entityManager) {\n        this.entityManager = entityManager;\n        this.levelIndex = 2;\n        Logger.LEVELS.forEach((level) => {\n            this[level] = this.log.bind(this, level);\n        });\n    }\n    logJSON(json) {\n        if (!this.entityManager.isReady) {\n            return this.entityManager.ready(this.logJSON.bind(this, json));\n        }\n        return this.entityManager.send(new msg.CreateObject('logs.AppLog', json));\n    }\n}\nLogger.LEVELS = ['trace', 'debug', 'info', 'warn', 'error'];\nLogger.FORMAT_REGEXP = /%[sdj%]/g;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sWUFBWSxDQUFDO0FBTWxDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLE1BQU07SUFBbkI7UUFLUyxrQkFBYSxHQUFrQixJQUFXLENBQUM7UUFFM0MsZUFBVSxHQUFXLENBQUMsQ0FBQztJQWtNaEMsQ0FBQztJQWhNQzs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUE0QjtRQUN4QyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBRTdCLE1BQU0sTUFBTSxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ25CLFNBQVMsY0FBYyxDQUFDLEdBQUcsSUFBVztnQkFDcEMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLElBQVcsQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFFRCxNQUFNLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ2hELE1BQU0sQ0FBQyxjQUFjLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsd0JBQXdCLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBRSxDQUFDLENBQUM7WUFDM0YsQ0FBQyxDQUFDLENBQUM7WUFFSCxPQUFPLGNBQStCLENBQUM7UUFDekMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUVMLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFM0IsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsSUFBSSxLQUFLO1FBQ1AsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxLQUFLLENBQUMsS0FBZTtRQUN2QixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQXNERCxHQUFHLENBQUMsR0FBRyxJQUFXO1FBQ2hCLE1BQU0sS0FBSyxHQUFhLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUV0RixJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDbEQsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzlCO1FBRUQsSUFBSSxPQUFPLEdBQVcsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1FBRXJHLElBQUksSUFBSSxHQUFzRyxJQUFJLENBQUM7UUFDbkgsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2YsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3ZCLElBQUksR0FBRyxHQUFHLENBQUM7WUFDWCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNqRCxJQUFJLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUM7YUFDdEI7WUFDRCxJQUFJLEdBQUcsWUFBWSxLQUFLLEVBQUU7Z0JBQ3hCLGlGQUFpRjtnQkFDakYsTUFBTTtnQkFDSixhQUFhO2dCQUNiLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sR0FDcEQsR0FBRyxHQUFHLENBQUM7Z0JBQ1IsSUFBSSxHQUFHO29CQUNMLElBQUk7b0JBQ0osT0FBTyxFQUFFLFFBQVE7b0JBQ2pCLEtBQUs7b0JBQ0wsTUFBTTtvQkFDTixJQUFJLEVBQUUsS0FBSztpQkFDWixDQUFDO2FBQ0g7U0FDRjtRQUVELElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNmLE9BQU8sSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztTQUNuQztRQUVELE9BQU8sSUFBSSxDQUFDLE9BQU8saUJBQ2pCLElBQUksRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUM5QixPQUFPO1lBQ1AsS0FBSztZQUNMLElBQUksSUFDRCxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQ2hFLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQWUsRUFBRSxJQUFTO1FBQy9CLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDckIsT0FBTyxPQUFPLENBQUM7U0FDaEI7UUFFRCxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFTLEVBQUUsRUFBRTtZQUN0RSxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ2QsT0FBTyxHQUFHLENBQUM7YUFDWjtZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUNoQixPQUFPLENBQUMsQ0FBQzthQUNWO1lBQ0QsUUFBUSxDQUFDLEVBQUU7Z0JBQ1QsS0FBSyxJQUFJO29CQUNQLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QixLQUFLLElBQUk7b0JBQ1AsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLEtBQUssSUFBSTtvQkFDUCxJQUFJO3dCQUNGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztxQkFDckM7b0JBQUMsT0FBTyxDQUFDLEVBQUU7d0JBQ1YsT0FBTyxZQUFZLENBQUM7cUJBQ3JCO2dCQUNIO29CQUNFLE9BQU8sQ0FBQyxDQUFDO2FBQ1o7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVELElBQUksQ0FBQyxhQUE0QjtRQUMvQixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUVwQixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsT0FBTyxDQUFDLElBQWE7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFO1lBQy9CLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDaEU7UUFFRCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1RSxDQUFDOztBQXZNZSxhQUFNLEdBQWUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFakUsb0JBQWEsR0FBRyxVQUFVLENBQUMifQ==","import { Entity } from '../binding';\n/**\n * PushMessages are used to send a push notification to a set of devices\n */\nexport class PushMessage {\n    /**\n     * Push message will be used to send a push notification to a set of devices\n     *\n     * @param [devices] The Set of device references which\n     * will receive this push notification.\n     * @param message The message of the push notification.\n     * @param subject The subject of the push notification.\n     * @param [options] The options object which can contain additional information and data\n     * @param [badge] The badge for iOS or Web Push devices\n     * @param [data] The data object which can contain additional information.\n     */\n    constructor(devices, message, subject, options, badge, data) {\n        const opts = typeof options === 'string' ? { sound: options, badge, data } : (options || {});\n        this.devices = PushMessage.initDevices(devices);\n        this.message = message;\n        this.subject = subject;\n        Object.assign(this, opts);\n    }\n    /**\n     * Instantiates a set of devices from the given parameter\n     * @param devices\n     * @return\n     */\n    static initDevices(devices) {\n        if (devices instanceof Set) {\n            return devices;\n        }\n        if (devices instanceof Entity) {\n            return new Set([devices]);\n        }\n        if (!devices || devices[Symbol.iterator]) {\n            return new Set(devices);\n        }\n        throw new Error('Only Sets, Lists and Arrays can be used as devices.');\n    }\n    /**\n     * Adds a new object to the set of devices\n     * @param device will be added to the device set to receive the push notification\n     * @return\n     */\n    addDevice(device) {\n        this.devices.add(device);\n    }\n    /**\n     * Converts the push message to JSON\n     * @return\n     */\n    toJSON() {\n        if (!this.devices || !this.devices.size) {\n            throw new Error('Set of devices is empty.');\n        }\n        return Object.assign({}, this, {\n            devices: Array.from(this.devices, (device) => device.id),\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHVzaE1lc3NhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJQdXNoTWVzc2FnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBd0VwQzs7R0FFRztBQUNILE1BQU0sT0FBTyxXQUFXO0lBZ0J0Qjs7Ozs7Ozs7OztPQVVHO0lBQ0gsWUFBWSxPQUE4RCxFQUFFLE9BQWdCLEVBQUUsT0FBZ0IsRUFDNUcsT0FBcUMsRUFBRSxLQUFxQixFQUFFLElBQVc7UUFDekUsTUFBTSxJQUFJLEdBQUcsT0FBTyxPQUFPLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQztRQUU3RixJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFFdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQStEO1FBQ3hGLElBQUksT0FBTyxZQUFZLEdBQUcsRUFBRTtZQUMxQixPQUFPLE9BQU8sQ0FBQztTQUNoQjtRQUVELElBQUksT0FBTyxZQUFZLE1BQU0sRUFBRTtZQUM3QixPQUFPLElBQUksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUMzQjtRQUVELElBQUksQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN4QyxPQUFPLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3pCO1FBRUQsTUFBTSxJQUFJLEtBQUssQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsU0FBUyxDQUFDLE1BQW9CO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNO1FBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRTtZQUN2QyxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDN0M7UUFFRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBYSxFQUFFLElBQUksRUFBRTtZQUN4QyxPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1NBQ3pELENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRiJ9","import { hmac } from '../util';\nexport class TokenStorage {\n    /**\n     * @param origin The origin where the token belongs to\n     * @param token The initial token\n     * @param temporary If the token should be saved temporary or permanently\n     */\n    constructor(origin, token, temporary) {\n        this.tokenData = token ? TokenStorage.parse(token) : null;\n        this.origin = origin;\n        this.temporary = !!temporary;\n    }\n    /**\n     * Parse a token string in its components\n     * @param token The token string to parse, time values are returned as timestamps\n     * @return The parsed token data\n     */\n    static parse(token) {\n        return {\n            val: token,\n            createdAt: parseInt(token.substring(0, 8), 16) * 1000,\n            expireAt: parseInt(token.substring(8, 16), 16) * 1000,\n            sig: token.substring(token.length - 40),\n            data: token.substring(0, token.length - 40),\n        };\n    }\n    /**\n     * Get the stored token\n     * @return The token or undefined, if no token is available\n     */\n    get token() {\n        return this.tokenData ? this.tokenData.val : null;\n    }\n    static create(origin) {\n        return Promise.resolve(new TokenStorage(origin));\n    }\n    /**\n     * Use the underlying storage implementation to save the token\n     * @param origin The origin where the token belongs to\n     * @param token The initial token\n     * @param temporary If the token should be saved temporary or permanently\n     * @return\n     */\n    saveToken(origin, token, temporary) {\n        // eslint-disable-next-line no-underscore-dangle\n        if (this._saveToken !== TokenStorage.prototype._saveToken) {\n            // eslint-disable-next-line no-console\n            console.log('Using deprecated TokenStorage._saveToken implementation.');\n            // eslint-disable-next-line no-underscore-dangle\n            this._saveToken(origin, token, temporary);\n        }\n    }\n    /**\n     * Use the underlying storage implementation to save the token\n     * @param origin The origin where the token belongs to\n     * @param token The initial token\n     * @param temporary If the token should be saved temporary or permanently\n     * @return\n     * @deprecated Use TokenStorage#saveToken instead\n     * @protected\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _saveToken(origin, token, temporary) { }\n    /**\n     * Update the token for the givin origin, the operation may be asynchronous\n     * @param token The token to store or <code>null</code> to remove the token\n     */\n    update(token) {\n        const t = token ? TokenStorage.parse(token) : null;\n        if (this.tokenData && t && this.tokenData.expireAt > t.expireAt) {\n            // an older token was fetched from the cache, so ignore it\n            return;\n        }\n        this.tokenData = t;\n        this.saveToken(this.origin, token, this.temporary);\n    }\n    /**\n     * Derives a resource token from the stored origin token and signs the resource with the generated resource token\n     *\n     * @param resource The resource which will be accessible with the returned token\n     * @param sign Sign the given resource with a token, if sign is false the resource will only be encoded to a path\n     * @return A resource token which can only be used to access the specified resource\n     */\n    signPath(resource, sign = true) {\n        const { tokenData } = this;\n        const result = Promise.resolve(resource.split('/').map(encodeURIComponent).join('/'));\n        if (!tokenData || !sign) {\n            return result;\n        }\n        return result.then((path) => TokenStorage.hmac(path + tokenData.data, tokenData.sig)\n            .then((hash) => `${path}?BAT=${tokenData.data + hash}`))\n            .catch((e) => {\n            // eslint-disable-next-line no-console\n            console.warn('Can\\'t sign the resource, run the SDK on a secured origin, or provide an alternative hmac implementation on TokenStorage.hmac', e);\n            return result;\n        });\n    }\n}\nTokenStorage.hmac = hmac;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9rZW5TdG9yYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVG9rZW5TdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFxQi9CLE1BQU0sT0FBTyxZQUFZO0lBaUR2Qjs7OztPQUlHO0lBQ0gsWUFBWSxNQUFjLEVBQUUsS0FBcUIsRUFBRSxTQUFtQjtRQUNwRSxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzFELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUMvQixDQUFDO0lBcENEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQWE7UUFDeEIsT0FBTztZQUNMLEdBQUcsRUFBRSxLQUFLO1lBQ1YsU0FBUyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJO1lBQ3JELFFBQVEsRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsSUFBSTtZQUNyRCxHQUFHLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztZQUN2QyxJQUFJLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7U0FDNUMsQ0FBQztJQUNKLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFD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","import { TokenStorage } from './TokenStorage';\nexport class GlobalStorage extends TokenStorage {\n    /**\n     * Creates a global token storage instance for the given origin\n     * A global token storage use a global variable to store the actual origin tokens\n     * @param origin\n     * @return\n     */\n    static create(origin) {\n        return Promise.resolve(new GlobalStorage(origin, GlobalStorage.tokens[origin]));\n    }\n    /**\n     * @inheritDoc\n     */\n    saveToken(origin, token, temporary) {\n        if (!temporary) {\n            if (token) {\n                GlobalStorage.tokens[origin] = token;\n            }\n            else {\n                delete GlobalStorage.tokens[origin];\n            }\n        }\n    }\n}\nGlobalStorage.tokens = {};\nTokenStorage.GLOBAL = GlobalStorage;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR2xvYmFsU3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkdsb2JhbFN0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlDLE1BQU0sT0FBTyxhQUFjLFNBQVEsWUFBWTtJQUc3Qzs7Ozs7T0FLRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBYztRQUMxQixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxhQUFhLENBQUMsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xGLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsQ0FBQyxNQUFjLEVBQUUsS0FBYSxFQUFFLFNBQWtCO1FBQ3pELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDZCxJQUFJLEtBQUssRUFBRTtnQkFDVCxhQUFhLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUN0QztpQkFBTTtnQkFDTCxPQUFPLGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDckM7U0FDRjtJQUNILENBQUM7O0FBdkJjLG9CQUFNLEdBQWlDLEVBQUUsQ0FBQztBQTBCM0QsWUFBWSxDQUFDLE1BQU0sR0FBRyxhQUFhLENBQUMifQ==","import { TokenStorage } from './TokenStorage';\n/**\n * @ignore\n */\nexport class WebStorage extends TokenStorage {\n    static isAvailable() {\n        try {\n            // firefox throws an exception if cookies are disabled\n            if (typeof localStorage === 'undefined') {\n                return false;\n            }\n            localStorage.setItem('bq_webstorage_test', 'bq');\n            localStorage.removeItem('bq_webstorage_test');\n            return true;\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    /**\n     * Creates a global web storage instance for the given origin\n     * A web token storage use the localStorage or sessionStorage to store the origin tokens\n     * @param origin\n     * @return\n     */\n    static create(origin) {\n        let temporary = false;\n        let token = localStorage.getItem(`BAT:${origin}`);\n        if (!token && typeof sessionStorage !== 'undefined') {\n            token = sessionStorage.getItem(`BAT:${origin}`);\n            temporary = !!token;\n        }\n        return Promise.resolve(new WebStorage(origin, token, temporary));\n    }\n    /**\n     * @inheritDoc\n     */\n    saveToken(origin, token, temporary) {\n        const webStorage = temporary ? sessionStorage : localStorage;\n        if (token) {\n            webStorage.setItem(`BAT:${origin}`, token);\n        }\n        else {\n            webStorage.removeItem(`BAT:${origin}`);\n        }\n    }\n}\nif (WebStorage.isAvailable()) {\n    TokenStorage.WEB_STORAGE = WebStorage;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIldlYlN0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLFVBQVcsU0FBUSxZQUFZO0lBQzFDLE1BQU0sQ0FBQyxXQUFXO1FBQ2hCLElBQUk7WUFDRixzREFBc0Q7WUFDdEQsSUFBSSxPQUFPLFlBQVksS0FBSyxXQUFXLEVBQUU7Z0JBQ3ZDLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7WUFFRCxZQUFZLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2pELFlBQVksQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUM5QyxPQUFPLElBQUksQ0FBQztTQUNiO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLEtBQUssQ0FBQztTQUNkO0lBQ0gsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFjO1FBQzFCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLEtBQUssR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sTUFBTSxFQUFFLENBQUMsQ0FBQztRQUVsRCxJQUFJLENBQUMsS0FBSyxJQUFJLE9BQU8sY0FBYyxLQUFLLFdBQVcsRUFBRTtZQUNuRCxLQUFLLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxPQUFPLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDaEQsU0FBUyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7U0FDckI7UUFFRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsQ0FBQyxNQUFjLEVBQUUsS0FBb0IsRUFBRSxTQUFrQjtRQUNoRSxNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQzdELElBQUksS0FBSyxFQUFFO1lBQ1QsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLE1BQU0sRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzVDO2FBQU07WUFDTCxVQUFVLENBQUMsVUFBVSxDQUFDLE9BQU8sTUFBTSxFQUFFLENBQUMsQ0FBQztTQUN4QztJQUNILENBQUM7Q0FDRjtBQUVELElBQUksVUFBVSxDQUFDLFdBQVcsRUFBRSxFQUFFO0lBQzVCLFlBQVksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO0NBQ3ZDIn0=","/* DO NOT TOUCH THIS AUTO-GENERATED FILE */\n/* eslint-disable max-len */\nimport { Message } from './connector';\nexport const ListAllResources = Message.create({\n    method: 'GET',\n    path: '/',\n    status: [200],\n});\nexport const ApiVersion = Message.create({\n    method: 'GET',\n    path: '/version',\n    status: [200],\n});\nexport const Specification = Message.create({\n    method: 'GET',\n    path: '/spec',\n    status: [200],\n});\nexport const GetBloomFilter = Message.create({\n    method: 'GET',\n    path: '/bloomfilter?rules=false',\n    status: [200],\n});\nexport const GetBloomFilterExpirations = Message.create({\n    method: 'GET',\n    path: '/bloomfilter/expirations',\n    status: [200],\n});\nexport const DeleteBloomFilter = Message.create({\n    method: 'DELETE',\n    path: '/bloomfilter?flush=true',\n    status: [204],\n});\nexport const GetOrestesConfig = Message.create({\n    method: 'GET',\n    path: '/config',\n    status: [200],\n});\nexport const UpdateOrestesConfig = Message.create({\n    method: 'PUT',\n    path: '/config',\n    status: [200, 202],\n});\nexport const Connect = Message.create({\n    method: 'GET',\n    path: '/connect',\n    status: [200],\n});\nexport const Status = Message.create({\n    method: 'GET',\n    path: '/status',\n    status: [200],\n});\nexport const EventsUrl = Message.create({\n    method: 'GET',\n    path: '/events-url',\n    status: [200],\n});\nexport const BannedIp = Message.create({\n    method: 'GET',\n    path: '/banned/:ip',\n    status: [204],\n});\nexport const Banned = Message.create({\n    method: 'GET',\n    path: '/banned',\n    status: [],\n});\nexport const Unban = Message.create({\n    method: 'DELETE',\n    path: '/banned',\n    status: [204],\n});\nexport const UnbanIp = Message.create({\n    method: 'DELETE',\n    path: '/banned/:ip',\n    status: [204],\n});\nexport const GetBucketNames = Message.create({\n    method: 'GET',\n    path: '/db',\n    status: [200],\n});\nexport const GetBucketIds = Message.create({\n    method: 'GET',\n    path: '/db/:bucket/ids?start=0&count=-1',\n    status: [200],\n});\nexport const ExportBucket = Message.create({\n    method: 'GET',\n    path: '/db/:bucket',\n    status: [200],\n});\nexport const ImportBucket = Message.create({\n    method: 'PUT',\n    path: '/db/:bucket',\n    status: [200],\n});\nexport const TruncateBucket = Message.create({\n    method: 'DELETE',\n    path: '/db/:bucket',\n    status: [200],\n});\nexport const CreateObject = Message.create({\n    method: 'POST',\n    path: '/db/:bucket',\n    status: [201, 202],\n});\nexport const GetObject = Message.create({\n    method: 'GET',\n    path: '/db/:bucket/:oid',\n    status: [200, 304],\n});\nexport const ReplaceObject = Message.create({\n    method: 'PUT',\n    path: '/db/:bucket/:oid',\n    status: [200, 202],\n});\nexport const DeleteObject = Message.create({\n    method: 'DELETE',\n    path: '/db/:bucket/:oid',\n    status: [202, 204],\n});\nexport const GetAllSchemas = Message.create({\n    method: 'GET',\n    path: '/schema',\n    status: [200],\n});\nexport const UpdateAllSchemas = Message.create({\n    method: 'POST',\n    path: '/schema',\n    status: [200],\n});\nexport const ReplaceAllSchemas = Message.create({\n    method: 'PUT',\n    path: '/schema',\n    status: [200],\n});\nexport const GetSchema = Message.create({\n    method: 'GET',\n    path: '/schema/:bucket',\n    status: [200],\n});\nexport const UpdateSchema = Message.create({\n    method: 'POST',\n    path: '/schema/:bucket',\n    status: [200],\n});\nexport const ReplaceSchema = Message.create({\n    method: 'PUT',\n    path: '/schema/:bucket',\n    status: [200],\n});\nexport const DeleteSchema = Message.create({\n    method: 'DELETE',\n    path: '/schema/:bucket',\n    status: [204],\n});\nexport const AdhocQuery = Message.create({\n    method: 'GET',\n    path: '/db/:bucket/query?q&start=0&count=-1&sort=&eager=&hinted=',\n    status: [200],\n});\nexport const AdhocQueryPOST = Message.create({\n    method: 'POST',\n    path: '/db/:bucket/query?start=0&count=-1&sort=',\n    status: [200],\n});\nexport const AdhocCountQuery = Message.create({\n    method: 'GET',\n    path: '/db/:bucket/count?q',\n    status: [200],\n});\nexport const AdhocCountQueryPOST = Message.create({\n    method: 'POST',\n    path: '/db/:bucket/count',\n    status: [200],\n});\nexport const ListQueryResources = Message.create({\n    method: 'GET',\n    path: '/query',\n    status: [200],\n});\nexport const CreateQuery = Message.create({\n    method: 'POST',\n    path: '/query',\n    status: [201],\n});\nexport const ListThisQueryResources = Message.create({\n    method: 'GET',\n    path: '/query/:qid',\n    status: [200],\n});\nexport const GetQueryCode = Message.create({\n    method: 'GET',\n    path: '/query/:qid/source',\n    status: [200],\n});\nexport const RunQuery = Message.create({\n    method: 'GET',\n    path: '/query/:qid/result?start=0&count=-1',\n    status: [200],\n});\nexport const GetQueryParameters = Message.create({\n    method: 'GET',\n    path: '/query/:qid/parameters',\n    status: [200],\n});\nexport const NewTransaction = Message.create({\n    method: 'POST',\n    path: '/transaction',\n    status: [201],\n});\nexport const CommitTransaction = Message.create({\n    method: 'PUT',\n    path: '/transaction/:tid/committed',\n    status: [200],\n});\nexport const UpdatePartially = Message.create({\n    method: 'POST',\n    path: '/db/:bucket/:oid',\n    status: [200],\n});\nexport const UpdateField = Message.create({\n    method: 'POST',\n    path: '/db/:bucket/:oid/:field',\n    status: [200],\n});\nexport const Login = Message.create({\n    method: 'POST',\n    path: '/db/User/login',\n    status: [200],\n});\nexport const Register = Message.create({\n    method: 'POST',\n    path: '/db/User/register',\n    status: [200, 204],\n});\nexport const Me = Message.create({\n    method: 'GET',\n    path: '/db/User/me',\n    status: [200],\n});\nexport const ValidateUser = Message.create({\n    method: 'GET',\n    path: '/db/User/validate',\n    status: [200],\n});\nexport const Logout = Message.create({\n    method: 'GET',\n    path: '/db/User/logout',\n    status: [204],\n});\nexport const NewPassword = Message.create({\n    method: 'POST',\n    path: '/db/User/password',\n    status: [200],\n});\nexport const ResetPassword = Message.create({\n    method: 'POST',\n    path: '/db/User/reset',\n    status: [200],\n});\nexport const Verify = Message.create({\n    method: 'GET',\n    path: '/db/User/verify?token=',\n    status: [204],\n});\nexport const ChangeUsername = Message.create({\n    method: 'POST',\n    path: '/db/User/changeUsername',\n    status: [204],\n});\nexport const VerifyUsername = Message.create({\n    method: 'GET',\n    path: '/db/User/verifyUsername?token=',\n    status: [204],\n});\nexport const OAuth2 = Message.create({\n    method: 'GET',\n    path: '/db/User/OAuth/:provider?state=&code=&oauth_verifier=&oauth_token=&error_description=',\n    status: [200],\n});\nexport const OAuth1 = Message.create({\n    method: 'GET',\n    path: '/db/User/OAuth1/:provider',\n    status: [200],\n});\nexport const UserToken = Message.create({\n    method: 'POST',\n    path: '/db/User/:oid/token',\n    status: [200],\n});\nexport const RevokeUserToken = Message.create({\n    method: 'DELETE',\n    path: '/db/User/:oid/token',\n    status: [204],\n});\nexport const GetBaqendCode = Message.create({\n    method: 'GET',\n    path: '/code/:bucket/:type',\n    status: [200],\n});\nexport const SetBaqendCode = Message.create({\n    method: 'PUT',\n    path: '/code/:bucket/:type',\n    status: [200, 202],\n});\nexport const DeleteBaqendCode = Message.create({\n    method: 'DELETE',\n    path: '/code/:bucket/:type',\n    status: [202, 204],\n});\nexport const PostBaqendModule = Message.create({\n    method: 'POST',\n    path: '/code/:bucket',\n    status: [200, 204],\n});\nexport const GetBaqendModule = Message.create({\n    method: 'GET',\n    path: '/code/:bucket',\n    status: [200, 204],\n});\nexport const GetAllModules = Message.create({\n    method: 'GET',\n    path: '/code',\n    status: [200],\n});\nexport const ListFiles = Message.create({\n    method: 'GET',\n    path: '/file/:bucket/ids?path=/&start=&count=-1&deep=false',\n    status: [200],\n});\nexport const ListBuckets = Message.create({\n    method: 'GET',\n    path: '/file/buckets',\n    status: [200],\n});\nexport const DownloadArchive = Message.create({\n    method: 'GET',\n    path: '/file',\n    status: [200],\n});\nexport const UploadPatchArchive = Message.create({\n    method: 'POST',\n    path: '/file',\n    status: [200],\n});\nexport const GetFileBucketMetadata = Message.create({\n    method: 'GET',\n    path: '/file/:bucket',\n    status: [200],\n});\nexport const SetFileBucketMetadata = Message.create({\n    method: 'PUT',\n    path: '/file/:bucket',\n    status: [204],\n});\nexport const DeleteFileBucket = Message.create({\n    method: 'DELETE',\n    path: '/file/:bucket',\n    status: [204],\n});\nexport const CreateFile = Message.create({\n    method: 'POST',\n    path: '/file/:bucket',\n    status: [200],\n});\nexport const DownloadFile = Message.create({\n    method: 'GET',\n    path: '/file/:bucket/*oid',\n    status: [200, 304],\n});\nexport const UploadFile = Message.create({\n    method: 'PUT',\n    path: '/file/:bucket/*oid',\n    status: [200],\n});\nexport const GetFileMetadata = Message.create({\n    method: 'HEAD',\n    path: '/file/:bucket/*oid',\n    status: [200],\n});\nexport const UpdateFileMetadata = Message.create({\n    method: 'POST',\n    path: '/file/:bucket/*oid',\n    status: [200],\n});\nexport const DeleteFile = Message.create({\n    method: 'DELETE',\n    path: '/file/:bucket/*oid',\n    status: [200, 204],\n});\nexport const CreateManifest = Message.create({\n    method: 'POST',\n    path: '/pwa/manifest',\n    status: [202],\n});\nexport const DownloadAsset = Message.create({\n    method: 'GET',\n    path: '/asset/*url',\n    status: [200, 304],\n});\nexport const RevalidateAssets = Message.create({\n    method: 'POST',\n    path: '/asset/revalidate',\n    status: [202],\n});\nexport const GetRevalidationStatus = Message.create({\n    method: 'GET',\n    path: '/asset/revalidate/:id',\n    status: [200, 202],\n});\nexport const CancelRevalidation = Message.create({\n    method: 'DELETE',\n    path: '/asset/revalidate/:id',\n    status: [202],\n});\nexport const GetAllRevalidationStatus = Message.create({\n    method: 'GET',\n    path: '/asset/revalidate?state=',\n    status: [200],\n});\nexport const CleanUpAssets = Message.create({\n    method: 'POST',\n    path: '/asset/cleanup',\n    status: [202],\n});\nexport const ListIndexes = Message.create({\n    method: 'GET',\n    path: '/index/:bucket',\n    status: [200],\n});\nexport const CreateDropIndex = Message.create({\n    method: 'POST',\n    path: '/index/:bucket',\n    status: [202],\n});\nexport const DropAllIndexes = Message.create({\n    method: 'DELETE',\n    path: '/index/:bucket',\n    status: [202],\n});\nexport const DeviceRegister = Message.create({\n    method: 'POST',\n    path: '/db/Device/register',\n    status: [200],\n});\nexport const DevicePush = Message.create({\n    method: 'POST',\n    path: '/db/Device/push',\n    status: [204],\n});\nexport const DeviceRegistered = Message.create({\n    method: 'GET',\n    path: '/db/Device/registered',\n    status: [200],\n});\nexport const VAPIDKeys = Message.create({\n    method: 'POST',\n    path: '/config/VAPIDKeys',\n    status: [200],\n});\nexport const VAPIDPublicKey = Message.create({\n    method: 'GET',\n    path: '/config/VAPIDPublicKey',\n    status: [200],\n});\nexport const GCMAKey = Message.create({\n    method: 'POST',\n    path: '/config/GCMKey',\n    status: [204],\n});\nexport const UploadAPNSCertificate = Message.create({\n    method: 'POST',\n    path: '/config/APNSCert',\n    status: [204],\n});\nexport const Install = Message.create({\n    method: 'GET',\n    path: '/speedkit?d=',\n    status: [200],\n});\nexport const SW = Message.create({\n    method: 'GET',\n    path: '/speedkit?r=&v=',\n    status: [200],\n});\nexport const Beacon = Message.create({\n    method: 'POST',\n    path: '/rum/pi',\n    status: [200],\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1lc3NhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMkNBQTJDO0FBQzNDLDRCQUE0QjtBQUM1QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBVXRDLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQW1CO0lBQy9ELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLEdBQUc7SUFDVCxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFTSCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYTtJQUNuRCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxVQUFVO0lBQ2hCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVNILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFnQjtJQUN6RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxPQUFPO0lBQ2IsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLDBCQUEwQjtJQUNoQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFTSCxNQUFNLENBQUMsTUFBTSx5QkFBeUIsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUE0QjtJQUNqRixNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSwwQkFBMEI7SUFDaEMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBb0I7SUFDakUsTUFBTSxFQUFFLFFBQVE7SUFDaEIsSUFBSSxFQUFFLHlCQUF5QjtJQUMvQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFTSCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFtQjtJQUMvRCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxTQUFTO0lBQ2YsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBc0I7SUFDckUsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsU0FBUztJQUNmLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBU0gsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVU7SUFDN0MsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsVUFBVTtJQUNoQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFTSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBUztJQUMzQyxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxTQUFTO0lBQ2YsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBU0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVk7SUFDakQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsYUFBYTtJQUNuQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBVztJQUMvQyxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxhQUFhO0lBQ25CLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVNILE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFTO0lBQzNDLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLFNBQVM7SUFDZixNQUFNLEVBQUUsRUFBRTtDQUNYLENBQUMsQ0FBQztBQVNILE1BQU0sQ0FBQyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFRO0lBQ3pDLE1BQU0sRUFBRSxRQUFRO0lBQ2hCLElBQUksRUFBRSxTQUFTO0lBQ2YsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVU7SUFDN0MsTUFBTSxFQUFFLFFBQVE7SUFDaEIsSUFBSSxFQUFFLGFBQWE7SUFDbkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLEtBQUs7SUFDWCxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxrQ0FBa0M7SUFDeEMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWU7SUFDdkQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsYUFBYTtJQUNuQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxhQUFhO0lBQ25CLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFpQjtJQUMzRCxNQUFNLEVBQUUsUUFBUTtJQUNoQixJQUFJLEVBQUUsYUFBYTtJQUNuQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxhQUFhO0lBQ25CLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVk7SUFDakQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsa0JBQWtCO0lBQ3hCLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBaUJILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFnQjtJQUN6RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxrQkFBa0I7SUFDeEIsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQztDQUNuQixDQUFDLENBQUM7QUFjSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsUUFBUTtJQUNoQixJQUFJLEVBQUUsa0JBQWtCO0lBQ3hCLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWdCO0lBQ3pELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLFNBQVM7SUFDZixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFtQjtJQUMvRCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxTQUFTO0lBQ2YsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBb0I7SUFDakUsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsU0FBUztJQUNmLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFZO0lBQ2pELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGlCQUFpQjtJQUN2QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFZSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxpQkFBaUI7SUFDdkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWdCO0lBQ3pELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGlCQUFpQjtJQUN2QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsUUFBUTtJQUNoQixJQUFJLEVBQUUsaUJBQWlCO0lBQ3ZCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQWlCSCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYTtJQUNuRCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSwyREFBMkQ7SUFDakUsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBZUgsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLDBDQUEwQztJQUNoRCxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFZSCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBa0I7SUFDN0QsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUscUJBQXFCO0lBQzNCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXNCO0lBQ3JFLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLG1CQUFtQjtJQUN6QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFTSCxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFxQjtJQUNuRSxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxRQUFRO0lBQ2QsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWM7SUFDckQsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsUUFBUTtJQUNkLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVVILE1BQU0sQ0FBQyxNQUFNLHNCQUFzQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXlCO0lBQzNFLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGFBQWE7SUFDbkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWU7SUFDdkQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsb0JBQW9CO0lBQzFCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFXO0lBQy9DLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLHFDQUFxQztJQUMzQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFxQjtJQUNuRSxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSx3QkFBd0I7SUFDOUIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBU0gsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLGNBQWM7SUFDcEIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBb0I7SUFDakUsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsNkJBQTZCO0lBQ25DLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQWlCSCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBa0I7SUFDN0QsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsa0JBQWtCO0lBQ3hCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQWtCSCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYztJQUNyRCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSx5QkFBeUI7SUFDL0IsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVE7SUFDekMsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsZ0JBQWdCO0lBQ3RCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFXO0lBQy9DLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLG1CQUFtQjtJQUN6QixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ25CLENBQUMsQ0FBQztBQVVILE1BQU0sQ0FBQyxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFLO0lBQ25DLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGFBQWE7SUFDbkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWU7SUFDdkQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVVILE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFTO0lBQzNDLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGlCQUFpQjtJQUN2QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYztJQUNyRCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxtQkFBbUI7SUFDekIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWdCO0lBQ3pELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBUztJQUMzQyxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSx3QkFBd0I7SUFDOUIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLHlCQUF5QjtJQUMvQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBaUI7SUFDM0QsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsZ0NBQWdDO0lBQ3RDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQWdCSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBUztJQUMzQyxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSx1RkFBdUY7SUFDN0YsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVM7SUFDM0MsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsMkJBQTJCO0lBQ2pDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFZO0lBQ2pELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLHFCQUFxQjtJQUMzQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBa0I7SUFDN0QsTUFBTSxFQUFFLFFBQVE7SUFDaEIsSUFBSSxFQUFFLHFCQUFxQjtJQUMzQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZ0I7SUFDekQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUscUJBQXFCO0lBQzNCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFnQjtJQUN6RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxxQkFBcUI7SUFDM0IsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQztDQUNuQixDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFtQjtJQUMvRCxNQUFNLEVBQUUsUUFBUTtJQUNoQixJQUFJLEVBQUUscUJBQXFCO0lBQzNCLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBbUI7SUFDL0QsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsZUFBZTtJQUNyQixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ25CLENBQUMsQ0FBQztBQVVILE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFrQjtJQUM3RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxlQUFlO0lBQ3JCLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBU0gsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWdCO0lBQ3pELE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLE9BQU87SUFDYixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFlSCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBWTtJQUNqRCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxxREFBcUQ7SUFDM0QsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWM7SUFDckQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsZUFBZTtJQUNyQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBa0I7SUFDN0QsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsT0FBTztJQUNiLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXFCO0lBQ25FLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLE9BQU87SUFDYixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUF3QjtJQUN6RSxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxlQUFlO0lBQ3JCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXdCO0lBQ3pFLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLGVBQWU7SUFDckIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBbUI7SUFDL0QsTUFBTSxFQUFFLFFBQVE7SUFDaEIsSUFBSSxFQUFFLGVBQWU7SUFDckIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWE7SUFDbkQsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsZUFBZTtJQUNyQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFZSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBZTtJQUN2RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQztDQUNuQixDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYTtJQUNuRCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWtCO0lBQzdELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLG9CQUFvQjtJQUMxQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFxQjtJQUNuRSxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBYUgsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWE7SUFDbkQsTUFBTSxFQUFFLFFBQVE7SUFDaEIsSUFBSSxFQUFFLG9CQUFvQjtJQUMxQixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ25CLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFpQjtJQUMzRCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxlQUFlO0lBQ3JCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFnQjtJQUN6RCxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxhQUFhO0lBQ25CLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Q0FDbkIsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBbUI7SUFDL0QsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXdCO0lBQ3pFLE1BQU0sRUFBRSxLQUFLO0lBQ2IsSUFBSSxFQUFFLHVCQUF1QjtJQUM3QixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ25CLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQXFCO0lBQ25FLE1BQU0sRUFBRSxRQUFRO0lBQ2hCLElBQUksRUFBRSx1QkFBdUI7SUFDN0IsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBMkI7SUFDL0UsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsMEJBQTBCO0lBQ2hDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFnQjtJQUN6RCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWM7SUFDckQsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsZ0JBQWdCO0lBQ3RCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVlILE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFrQjtJQUM3RCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxRQUFRO0lBQ2hCLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQWlCO0lBQzNELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLHFCQUFxQjtJQUMzQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFXSCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBYTtJQUNuRCxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxpQkFBaUI7SUFDdkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBVUgsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBbUI7SUFDL0QsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsdUJBQXVCO0lBQzdCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVVILE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFZO0lBQ2pELE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLG1CQUFtQjtJQUN6QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBaUI7SUFDM0QsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsd0JBQXdCO0lBQzlCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQztBQVdILE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFVO0lBQzdDLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFVSCxNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUF3QjtJQUN6RSxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxrQkFBa0I7SUFDeEIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBWUgsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVU7SUFDN0MsTUFBTSxFQUFFLEtBQUs7SUFDYixJQUFJLEVBQUUsY0FBYztJQUNwQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUM7Q0FDZCxDQUFDLENBQUM7QUFhSCxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBSztJQUNuQyxNQUFNLEVBQUUsS0FBSztJQUNiLElBQUksRUFBRSxpQkFBaUI7SUFDdkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO0NBQ2QsQ0FBQyxDQUFDO0FBV0gsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQVM7SUFDM0MsTUFBTSxFQUFFLE1BQU07SUFDZCxJQUFJLEVBQUUsU0FBUztJQUNmLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztDQUNkLENBQUMsQ0FBQyJ9","export class Accessor {\n    /**\n     * @param object\n     * @param attribute\n     * @return\n     */\n    getValue(object, attribute) {\n        return object[attribute.name];\n    }\n    /**\n     * @param object\n     * @param attribute\n     * @param value\n     */\n    setValue(object, attribute, value) {\n        // eslint-disable-next-line no-param-reassign\n        object[attribute.name] = value;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBY2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxNQUFNLE9BQU8sUUFBUTtJQUNuQjs7OztPQUlHO0lBQ0gsUUFBUSxDQUFJLE1BQWUsRUFBRSxTQUF1QjtRQUNsRCxPQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFhLENBQUM7SUFDNUMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxRQUFRLENBQUksTUFBZSxFQUFFLFNBQXVCLEVBQUUsS0FBUTtRQUM1RCw2Q0FBNkM7UUFDN0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7SUFDakMsQ0FBQztDQUNGIn0=","const BAQEND_ID = Symbol('BaqendId');\nconst BAQEND_TYPE = Symbol('BaqendType');\nexport class Enhancer {\n    /**\n     * @param superClass\n     * @return typeConstructor\n     */\n    createProxy(superClass) {\n        return class Proxy extends superClass {\n        };\n    }\n    /**\n     * @param typeConstructor\n     * @returns type the managed type metadata for this class\n     */\n    static getBaqendType(typeConstructor) {\n        return typeConstructor[BAQEND_TYPE];\n    }\n    /**\n     * @param typeConstructor\n     * @return\n     */\n    static getIdentifier(typeConstructor) {\n        return typeConstructor[BAQEND_ID];\n    }\n    /**\n     * @param typeConstructor\n     * @param identifier\n     */\n    static setIdentifier(typeConstructor, identifier) {\n        typeConstructor[BAQEND_ID] = identifier;\n    }\n    /**\n     * @param type\n     * @param typeConstructor\n     */\n    enhance(type, typeConstructor) {\n        if (typeConstructor[BAQEND_TYPE] === type) {\n            return;\n        }\n        if (Object.prototype.hasOwnProperty.call(typeConstructor, BAQEND_TYPE)) {\n            throw new Error('Type is already used by a different manager');\n        }\n        typeConstructor[BAQEND_TYPE] = type;\n        Enhancer.setIdentifier(typeConstructor, type.ref);\n        this.enhancePrototype(typeConstructor.prototype, type);\n    }\n    /**\n     * Enhance the prototype of the type\n     * @param proto\n     * @param type\n     */\n    enhancePrototype(proto, type) {\n        if (type.isEmbeddable) {\n            return; // we do not need to enhance the prototype of embeddable\n        }\n        if (proto.toString === Object.prototype.toString) {\n            // implements a better convenience toString method\n            Object.defineProperty(proto, 'toString', {\n                value: function toString() {\n                    return this._metadata.id || this._metadata.bucket;\n                },\n                enumerable: false,\n            });\n        }\n        // enhance all persistent object properties\n        if (type.superType && type.superType.name === 'Object') {\n            type.superType.declaredAttributes.forEach((attr) => {\n                if (!attr.isMetadata) {\n                    this.enhanceProperty(proto, attr);\n                }\n            });\n        }\n        // enhance all persistent properties\n        type.declaredAttributes.forEach((attr) => {\n            this.enhanceProperty(proto, attr);\n        });\n    }\n    /**\n     * @param proto\n     * @param attribute\n     */\n    enhanceProperty(proto, attribute) {\n        const { name } = attribute;\n        Object.defineProperty(proto, name, {\n            get() {\n                this._metadata.throwUnloadedPropertyAccess(name);\n                return null;\n            },\n            set(value) {\n                this._metadata.throwUnloadedPropertyAccess(name);\n                Object.defineProperty(this, name, {\n                    value,\n                    writable: true,\n                    enumerable: true,\n                    configurable: true,\n                });\n            },\n            configurable: true,\n            enumerable: true,\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW5oYW5jZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbmhhbmNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLQSxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDckMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBRXpDLE1BQU0sT0FBTyxRQUFRO0lBQ25COzs7T0FHRztJQUNILFdBQVcsQ0FBaUIsVUFBb0I7UUFDOUMsT0FBTyxNQUFNLEtBQU0sU0FBUyxVQUFrQjtTQUFlLENBQUM7SUFDaEUsQ0FBQztJQUVEOzs7T0FHRztJQUNILE1BQU0sQ0FBQyxhQUFhLENBQUMsZUFBc0M7UUFDekQsT0FBUSxlQUF1QixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsYUFBYSxDQUFDLGVBQXNDO1FBQ3pELE9BQVEsZUFBdUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLGFBQWEsQ0FBQyxlQUEyQixFQUFFLFVBQWtCO1FBQ2pFLGVBQXVCLENBQUMsU0FBUyxDQUFDLEdBQUcsVUFBVSxDQUFDO0lBQ25ELENBQUM7SUFFRDs7O09BR0c7SUFDSCxPQUFPLENBQW9CLElBQW9CLEVBQUUsZUFBeUI7UUFDeEUsSUFBSyxlQUF1QixDQUFDLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNsRCxPQUFPO1NBQ1I7UUFFRCxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsV0FBVyxDQUFDLEVBQUU7WUFDdEUsTUFBTSxJQUFJLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1NBQ2hFO1FBRUEsZUFBdUIsQ0FBQyxXQUFXLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFN0MsUUFBUSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsZ0JBQWdCLENBQW9CLEtBQVEsRUFBRSxJQUFvQjtRQUNoRSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsT0FBTyxDQUFDLHdEQUF3RDtTQUNqRTtRQUVELElBQUksS0FBSyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRTtZQUNoRCxrREFBa0Q7WUFDbEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFO2dCQUN2QyxLQUFLLEVBQUUsU0FBUyxRQUFRO29CQUN0QixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO2dCQUNwRCxDQUFDO2dCQUNELFVBQVUsRUFBRSxLQUFLO2FBQ2xCLENBQUMsQ0FBQztTQUNKO1FBRUQsMkNBQTJDO1FBQzNDLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDdEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDakQsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7b0JBQ3BCLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO2lCQUNuQztZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxvQ0FBb0M7UUFDcEMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNILGVBQWUsQ0FBSSxLQUFRLEVBQUUsU0FBeUI7UUFDcEQsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQztRQUMzQixNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDakMsR0FBRztnQkFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNqRCxPQUFPLElBQUksQ0FBQztZQUNkLENBQUM7WUFDRCxHQUFHLENBQUMsS0FBSztnQkFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNqRCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUU7b0JBQ2hDLEtBQUs7b0JBQ0wsUUFBUSxFQUFFLElBQUk7b0JBQ2QsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFlBQVksRUFBRSxJQUFJO2lCQUNuQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBQ0QsWUFBWSxFQUFFLElBQUk7WUFDbEIsVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIn0=","// @ts-ignore\nexport class Factory {\n    constructor() {\n        this.type = null;\n        this.prototype = null;\n    }\n    static extend(target, proto) {\n        if (proto !== Factory.prototype) {\n            this.extend(target, Object.getPrototypeOf(proto));\n        }\n        const properties = Object.getOwnPropertyNames(proto);\n        for (let j = 0, len = properties.length; j < len; j += 1) {\n            const prop = properties[j];\n            Object.defineProperty(target, prop, Object.getOwnPropertyDescriptor(proto, prop));\n        }\n        return target;\n    }\n    /**\n     * Creates a new Factory for the given type\n     * @param type - the type constructor of T\n     * @return A new object factory to created instances of T\n     */\n    static createFactory(type) {\n        // We want te explicitly name the created factory and give the constructor a properly argument name\n        const factory = Factory.extend((function FactoryConstructor(...args) {\n            return factory.newInstance(args);\n        }), this.prototype);\n        // lets instanceof work properly\n        factory.prototype = type.prototype;\n        factory.type = type;\n        return factory;\n    }\n    /**\n     * Creates a new instance of the factory type\n     * @param args Constructor arguments used for instantiation\n     * @return A new created instance of *\n     * @instance\n     */\n    new(...args) {\n        return this.newInstance(args);\n    }\n    /**\n     * Creates a new instance of the factory type\n     * @param args Constructor arguments used for instantiation\n     * @return A new created instance of *\n     * @instance\n     */\n    newInstance(args) {\n        if (!args || args.length === 0) {\n            // eslint-disable-next-line new-cap\n            return new this.type();\n        }\n        // es6 constructors can't be called, therefore bind all arguments and invoke the constructor\n        // then with the bounded parameters\n        // The first argument is shift out by invocation with `new`.\n        const a = [null];\n        Array.prototype.push.apply(a, args);\n        const boundConstructor = (Function.prototype.bind.apply(this.type, a));\n        // eslint-disable-next-line new-cap\n        return new boundConstructor();\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkZhY3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBZ0JBLGFBQWE7QUFDYixNQUFNLE9BQU8sT0FBTztJQUFwQjtRQWlDUyxTQUFJLEdBQWEsSUFBVyxDQUFDO1FBRTdCLGNBQVMsR0FBTSxJQUFXLENBQUM7SUFpQ3BDLENBQUM7SUFuRVMsTUFBTSxDQUFDLE1BQU0sQ0FBNEIsTUFBUyxFQUFFLEtBQVE7UUFDbEUsSUFBSSxLQUFLLEtBQUssT0FBTyxDQUFDLFNBQVMsRUFBRTtZQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDbkQ7UUFFRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hELE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUUsQ0FBQyxDQUFDO1NBQ3BGO1FBRUQsT0FBTyxNQUFlLENBQUM7SUFDekIsQ0FBQztJQUVEOzs7O09BSUc7SUFDTyxNQUFNLENBQUMsYUFBYSxDQUEwQyxJQUFjO1FBQ3BGLG1HQUFtRztRQUNuRyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxrQkFBa0IsQ0FBQyxHQUFHLElBQVc7WUFDeEUsT0FBTyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBYSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVoQyxnQ0FBZ0M7UUFDaEMsT0FBTyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ25DLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRXBCLE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFNRDs7Ozs7T0FLRztJQUNILEdBQUcsQ0FBQyxHQUFHLElBQVc7UUFDaEIsT0FBTyxJQUFJLENBQUMsV0FBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFdBQVcsQ0FBQyxJQUF5QjtRQUNuQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzlCLG1DQUFtQztZQUNuQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUssRUFBRSxDQUFDO1NBQ3pCO1FBRUQsNEZBQTRGO1FBQzVGLG1DQUFtQztRQUNuQyw0REFBNEQ7UUFDNUQsTUFBTSxDQUFDLEdBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QixLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQWEsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLG1DQUFtQztRQUNuQyxPQUFPLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0NBQ0YifQ==","import { EntityFactory } from './EntityFactory';\nexport var LoginOption;\n(function (LoginOption) {\n    /**\n     * Do not login the user after a successful registration\n     */\n    LoginOption[LoginOption[\"NO_LOGIN\"] = -1] = \"NO_LOGIN\";\n    /**\n     * Login in after a successful registration and keep the token in a nonpermanent storage, i.e SessionStorage\n     */\n    LoginOption[LoginOption[\"SESSION_LOGIN\"] = 0] = \"SESSION_LOGIN\";\n    /**\n     * Login in after a successful registration and keep the token in a persistent storage, i.e LocalStorage\n     */\n    LoginOption[LoginOption[\"PERSIST_LOGIN\"] = 1] = \"PERSIST_LOGIN\";\n})(LoginOption || (LoginOption = {}));\n/**\n * Creates a new instance of the managed type of this factory\n */\nexport class UserFactory extends EntityFactory {\n    get LoginOption() {\n        return LoginOption;\n    }\n    /**\n     * The current logged in user, or <code>null</code> if the user is not logged in\n     */\n    get me() {\n        return this.db.me;\n    }\n    /**\n     * Register a new user with the given username and password, if the username is not used by an another user.\n     * @param user The username as a string or a <User> Object, which must contain the username.\n     * @param password The password for the given user\n     * @param [loginOption=true] The default logs the user in after a successful\n     * registration and keeps the user logged in over multiple sessions\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return The created user object, for the new registered user.\n     */\n    register(user, password, loginOption, doneCallback, failCallback) {\n        if (loginOption instanceof Function) {\n            return this.register(user, password, true, loginOption, doneCallback);\n        }\n        const userObj = typeof user === 'string' ? this.fromJSON({ username: user }) : user;\n        return this.db.register(userObj, password, loginOption === undefined ? true : loginOption)\n            .then(doneCallback, failCallback);\n    }\n    /**\n     * Log in the user with the given username and password and starts a user session\n     * @param username The username of the user\n     * @param password The password of the user\n     * @param [loginOption=true] The default keeps the user logged in over\n     * multiple sessions\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    login(username, password, loginOption, doneCallback, failCallback) {\n        if (loginOption instanceof Function) {\n            return this.login(username, password, true, loginOption, doneCallback);\n        }\n        return this.db.login(username, password, loginOption === undefined ? true : loginOption)\n            .then(doneCallback, failCallback);\n    }\n    /**\n     * Log in the user assiciated with the given token and starts a user session.\n     * @param token The user token.\n     * @param [loginOption=true] The default keeps the user logged in over\n     * multiple sessions\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    loginWithToken(token, loginOption, doneCallback, failCallback) {\n        if (loginOption instanceof Function) {\n            return this.loginWithToken(token, true, loginOption, doneCallback);\n        }\n        this.db.token = token;\n        return this.db.renew(loginOption).then(doneCallback, failCallback);\n    }\n    /**\n     * Log out the current logged in user and ends the active user session\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    logout(doneCallback, failCallback) {\n        return this.db.logout().then(doneCallback, failCallback);\n    }\n    newPassword(...args) {\n        // detect signature newPassword(token, newPassword, [loginOption=true][, doneCallback[, failCallback]])\n        if (typeof args[2] === 'string') {\n            const [username, password, newPassword, doneCallback, failCallback] = args;\n            return this.db.newPassword(username, password, newPassword).then(doneCallback, failCallback);\n        }\n        // eslint-disable-next-line prefer-const\n        let [token, newPassword, loginOption, doneCallback, failCallback] = args;\n        if (loginOption instanceof Function) {\n            failCallback = doneCallback;\n            doneCallback = loginOption;\n            loginOption = true;\n        }\n        return this.db.newPasswordWithToken(token, newPassword, loginOption).then(doneCallback, failCallback);\n    }\n    /**\n     * Sends an email with a link to reset the password for the given username\n     *\n     * The username must be a valid email address.\n     *\n     * @param username Username (email) to identify the user\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    resetPassword(username, doneCallback, failCallback) {\n        return this.db.resetPassword(username).then(doneCallback, failCallback);\n    }\n    /**\n     * Sends an email with a link to change the current username\n     *\n     * The user is identified by their current username and password.\n     * The username must be a valid email address.\n     *\n     * @param username Current username (email) to identify the user\n     * @param newUsername New username (email) to change the current username to\n     * @param password The current password of the user. Has to be passed to the function for security reason\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    changeUsername(username, newUsername, password, doneCallback, failCallback) {\n        return this.db.changeUsername(username, newUsername, password).then(doneCallback, failCallback);\n    }\n    /**\n     * Requests a perpetual token for the given user\n     *\n     * Only users with the admin role are allowed to request an API token.\n     *\n     * @param user The user object or id of the user object\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    requestAPIToken(user, doneCallback, failCallback) {\n        return this.db.requestAPIToken(this.managedType.typeConstructor, user).then(doneCallback, failCallback);\n    }\n    /**\n     * Revoke all created tokens for the given user\n     *\n     * This method will revoke all previously issued tokens and the user must login again.\n     *\n     * @param user The user object or id of the user object\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    revokeAllTokens(user, doneCallback, failCallback) {\n        return this.db.revokeAllTokens(this.managedType.typeConstructor, user).then(doneCallback, failCallback);\n    }\n}\n/**\n * @property oauth default properties\n * @property google default oauth properties for Google\n * @property facebook default oauth properties for Facebook\n * @property github default oauth properties for GitHub\n * @property twitter default oauth properties for Twitter\n * @property linkedin default oauth properties for LinkedIn\n * @property {Object} oauth.salesforce default oauth properties for Salesforce\n */\nUserFactory.DefaultOptions = {\n    google: {\n        width: 585,\n        height: 545,\n        scope: 'email',\n    },\n    facebook: {\n        width: 1140,\n        height: 640,\n        scope: 'email',\n    },\n    github: {\n        width: 1040,\n        height: 580,\n        scope: 'user:email',\n    },\n    twitter: {\n        width: 740,\n        height: 730,\n    },\n    linkedin: {\n        width: 630,\n        height: 530,\n        scope: 'r_liteprofile',\n    },\n    salesforce: {\n        width: 585,\n        height: 545,\n        scope: 'email',\n    },\n};\n['Google', 'Facebook', 'GitHub', 'Twitter', 'LinkedIn', 'Salesforce'].forEach((name) => {\n    const methodName = `loginWith${name}`;\n    // do not use a lambda here since we will loose the this context\n    UserFactory.prototype[methodName] = function loginWithOAuth(clientID, options, doneCallback, failCallback) {\n        if (options instanceof Function) {\n            return this[methodName](clientID, {}, options, doneCallback);\n        }\n        const opt = Object.assign(Object.assign({}, UserFactory.DefaultOptions[name.toLowerCase()]), options || {});\n        return this.db.loginWithOAuth(name, clientID, opt).then(doneCallback, failCallback);\n    };\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2VyRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHaEQsTUFBTSxDQUFOLElBQVksV0FhWDtBQWJELFdBQVksV0FBVztJQUNyQjs7T0FFRztJQUNILHNEQUFhLENBQUE7SUFDYjs7T0FFRztJQUNILCtEQUFpQixDQUFBO0lBQ2pCOztPQUVHO0lBQ0gsK0RBQWlCLENBQUE7QUFDbkIsQ0FBQyxFQWJXLFdBQVcsS0FBWCxXQUFXLFFBYXRCO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sV0FBWSxTQUFRLGFBQXlCO0lBQ3hELElBQVcsV0FBVztRQUNwQixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBMkNEOztPQUVHO0lBQ0gsSUFBSSxFQUFFO1FBQ0osT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0gsUUFBUSxDQUFDLElBQXlCLEVBQUUsUUFBZ0IsRUFBRSxXQUE4QyxFQUNsRyxZQUFrQixFQUFFLFlBQWtCO1FBQ3RDLElBQUksV0FBVyxZQUFZLFFBQVEsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3ZFO1FBRUQsTUFBTSxPQUFPLEdBQUcsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNwRixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7YUFDdkYsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0gsS0FBSyxDQUFDLFFBQWdCLEVBQUUsUUFBZ0IsRUFBRSxXQUE4QyxFQUFFLFlBQWtCLEVBQzFHLFlBQWtCO1FBQ2xCLElBQUksV0FBVyxZQUFZLFFBQVEsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ3hFO1FBRUQsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLFdBQVcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDO2FBQ3JGLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBQ0gsY0FBYyxDQUFDLEtBQWEsRUFBRSxXQUE4QyxFQUFFLFlBQWtCLEVBQzlGLFlBQWtCO1FBQ2xCLElBQUksV0FBVyxZQUFZLFFBQVEsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDcEU7UUFFRCxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILE1BQU0sQ0FBQyxZQUFrQixFQUFFLFlBQWtCO1FBQzNDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzNELENBQUM7SUE4QkQsV0FBVyxDQUFDLEdBQUcsSUFBVztRQUN4Qix1R0FBdUc7UUFDdkcsSUFBSSxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLEVBQUU7WUFDL0IsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxZQUFZLENBQUMsR0FBRyxJQUEwQyxDQUFDO1lBQ2pILE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQzlGO1FBRUQsd0NBQXdDO1FBQ3hDLElBQUksQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFDSyxDQUFDO1FBQzFFLElBQUksV0FBVyxZQUFZLFFBQVEsRUFBRTtZQUNuQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1lBQzVCLFlBQVksR0FBRyxXQUFXLENBQUM7WUFDM0IsV0FBVyxHQUFHLElBQUksQ0FBQztTQUNwQjtRQUVELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDeEcsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRztJQUNILGFBQWEsQ0FBQyxRQUFnQixFQUFFLFlBQWtCLEVBQUUsWUFBa0I7UUFDcEUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7O09BWUc7SUFDSCxjQUFjLENBQUMsUUFBZ0IsRUFBRSxXQUFtQixFQUFFLFFBQWdCLEVBQUUsWUFBa0IsRUFDeEYsWUFBa0I7UUFDbEIsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbEcsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRztJQUNILGVBQWUsQ0FBQyxJQUFnQixFQUFFLFlBQWtCLEVBQUUsWUFBa0I7UUFDdEUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzFHLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxlQUFlLENBQUMsSUFBZ0IsRUFBRSxZQUFrQixFQUFFLFlBQWtCO1FBQ3RFLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUMxRyxDQUFDOztBQS9ORDs7Ozs7Ozs7R0FRRztBQUNvQiwwQkFBYyxHQUFHO0lBQ3RDLE1BQU0sRUFBRTtRQUNOLEtBQUssRUFBRSxHQUFHO1FBQ1YsTUFBTSxFQUFFLEdBQUc7UUFDWCxLQUFLLEVBQUUsT0FBTztLQUNmO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsS0FBSyxFQUFFLElBQUk7UUFDWCxNQUFNLEVBQUUsR0FBRztRQUNYLEtBQUssRUFBRSxPQUFPO0tBQ2Y7SUFDRCxNQUFNLEVBQUU7UUFDTixLQUFLLEVBQUUsSUFBSTtRQUNYLE1BQU0sRUFBRSxHQUFHO1FBQ1gsS0FBSyxFQUFFLFlBQVk7S0FDcEI7SUFDRCxPQUFPLEVBQUU7UUFDUCxLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxHQUFHO0tBQ1o7SUFDRCxRQUFRLEVBQUU7UUFDUixLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxHQUFHO1FBQ1gsS0FBSyxFQUFFLGVBQWU7S0FDdkI7SUFDRCxVQUFVLEVBQUU7UUFDVixLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxHQUFHO1FBQ1gsS0FBSyxFQUFFLE9BQU87S0FDZjtDQUNGLENBQUM7QUErVUosQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO0lBQ3JGLE1BQU0sVUFBVSxHQUFHLFlBQVksSUFBSSxFQUFFLENBQUM7SUFDdEMsZ0VBQWdFO0lBQy9ELFdBQVcsQ0FBQyxTQUFpQixDQUFDLFVBQVUsQ0FBQyxHQUFHLFNBQVMsY0FBYyxDQUFDLFFBQWdCLEVBQ25GLE9BQWdDLEVBQUUsWUFBa0IsRUFBRSxZQUFrQjtRQUN4RSxJQUFJLE9BQU8sWUFBWSxRQUFRLEVBQUU7WUFDL0IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDOUQ7UUFFRCxNQUFNLEdBQUcsbUNBQVMsV0FBVyxDQUFDLGNBQXNCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUssT0FBTyxJQUFJLEVBQUUsQ0FBRSxDQUFDO1FBRTdGLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3RGLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDIn0=","import { Factory } from './Factory';\nimport { Metadata } from '../intersection';\nexport class ManagedFactory extends Factory {\n    constructor() {\n        super(...arguments);\n        /**\n         * Methods that are added to object instances\n         * This property is an alias for this factory type prototype\n         * @name methods\n         */\n        this.methods = null;\n        /**\n         * The managed type of this factory\n         */\n        this.managedType = null;\n        /**\n         * The owning EntityManager where this factory belongs to\n         */\n        this.db = null;\n    }\n    /**\n     * Creates a new ManagedFactory for the given type\n     * @param managedType The metadata of type T\n     * @param db The entity manager instance\n     */\n    static create(managedType, db) {\n        const factory = this.createFactory(managedType.typeConstructor);\n        factory.methods = factory.prototype;\n        factory.managedType = managedType;\n        factory.db = db;\n        return factory;\n    }\n    /**\n     * Creates a new instance and sets the Managed Object to the given json\n     * @param json\n     * @return A new created instance of T\n     */\n    fromJSON(json) {\n        const instance = this.newInstance();\n        return this.managedType.fromJsonValue(Metadata.create(this.managedType, this.db), json, instance, {\n            persisting: false,\n        });\n    }\n    /**\n     * Adds methods to instances of this factories type\n     * @param methods The methods to add\n     * @return\n     */\n    addMethods(methods) {\n        Object.assign(this.methods, methods);\n    }\n    /**\n     * Add a method to instances of this factories type\n     * @param name The method name to add\n     * @param fn The Method to add\n     * @return\n     */\n    addMethod(name, fn) {\n        this.methods[name] = fn;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFuYWdlZEZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJNYW5hZ2VkRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBS3BDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxNQUFNLE9BQU8sY0FBa0MsU0FBUSxPQUFVO0lBQWpFOztRQWdCRTs7OztXQUlHO1FBQ0ksWUFBTyxHQUFnQyxJQUFXLENBQUM7UUFFMUQ7O1dBRUc7UUFDSSxnQkFBVyxHQUFtQixJQUFXLENBQUM7UUFFakQ7O1dBRUc7UUFDSSxPQUFFLEdBQWtCLElBQVcsQ0FBQztJQWdDekMsQ0FBQztJQTlEQzs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLE1BQU0sQ0FBb0IsV0FBMkIsRUFBRSxFQUFpQjtRQUNwRixNQUFNLE9BQU8sR0FBc0IsSUFBSSxDQUFDLGFBQWEsQ0FBdUIsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBRXpHLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQztRQUNwQyxPQUFPLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUNsQyxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUVoQixPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBbUJEOzs7O09BSUc7SUFDSCxRQUFRLENBQUMsSUFBVTtRQUNqQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDcEMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7WUFDaEcsVUFBVSxFQUFFLEtBQUs7U0FDbEIsQ0FBRSxDQUFDO0lBQ04sQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxVQUFVLENBQUMsT0FBbUM7UUFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFNBQVMsQ0FBQyxJQUFZLEVBQUUsRUFBWTtRQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUMxQixDQUFDO0NBQ0YifQ==","import { ManagedFactory } from './ManagedFactory';\nimport { Metadata } from '../intersection';\nexport class EntityFactory extends ManagedFactory {\n    /**\n     * Creates a new instance of the factory type\n     *\n     * @param args Constructor arguments used for instantiation, the constructor will not be called\n     * when no arguments are passed\n     * @return A new created instance of T\n     */\n    newInstance(args) {\n        const instance = super.newInstance(args);\n        Metadata.get(instance).db = this.db;\n        return instance;\n    }\n    /**\n     * Loads the instance for the given id, or null if the id does not exists.\n     * @param id The id to query\n     * @param [options] The load options\n     * @param [options.depth=0] The object depth which will be loaded. Depth 0 loads only this object,\n     * <code>true</code> loads the objects by reachability.\n     * @param [options.refresh=false] Indicates whether the object should be revalidated (cache bypass).\n     * @param [options.local=false] Indicates whether the local copy (from the entity manager)\n     * of an object should be returned if it exists. This value might be stale.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     */\n    load(id, options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.load(id, {}, options, doneCallback);\n        }\n        return this.db.load(this.managedType.typeConstructor, id, options).then(doneCallback, failCallback);\n    }\n    /**\n     * Gets an unloaded reference for the given id.\n     * @param id The id of an object to get a reference for.\n     * @return An unloaded reference to the object with the given id.\n     */\n    ref(id) {\n        return this.db.getReference(this.managedType.ref, id);\n    }\n    /**\n     * Creates a new instance and sets the DatabaseObject to the given json\n     * @param json\n     * @return instance\n     */\n    fromJSON(json) {\n        const obj = this.db.getReference(this.managedType.ref, json.id);\n        return this.managedType.fromJsonValue(Metadata.get(obj), json, obj, { persisting: false });\n    }\n    /**\n     * Creates a new query for this class\n     * @return The query builder\n     */\n    find() {\n        return this.db.createQueryBuilder(this.managedType.typeConstructor);\n    }\n    /**\n     * Creates a new partial update for this class\n     * @param id The id to partial update\n     * @param [partialUpdate] An initial partial update to execute\n     * @return A partial update builder for the given entity id\n     */\n    partialUpdate(id, partialUpdate) {\n        return this.ref(id).partialUpdate(partialUpdate);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5RmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkVudGl0eUZhY3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBS2xELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxNQUFNLE9BQU8sYUFBZ0MsU0FBUSxjQUFpQjtJQUNwRTs7Ozs7O09BTUc7SUFDSCxXQUFXLENBQUMsSUFBeUI7UUFDbkMsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3BDLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7O09BWUc7SUFDSCxJQUFJLENBQUMsRUFBVSxFQUFFLE9BQTJFLEVBQUUsWUFBa0IsRUFDOUcsWUFBa0I7UUFDbEIsSUFBSSxPQUFPLE9BQU8sS0FBSyxVQUFVLEVBQUU7WUFDakMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQ2pEO1FBRUQsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0RyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILEdBQUcsQ0FBQyxFQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFFBQVEsQ0FBQyxJQUFVO1FBQ2pCLE1BQU0sR0FBRyxHQUFNLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFHLElBQWdCLENBQUMsRUFBWSxDQUFDLENBQUM7UUFDMUYsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLENBQUUsQ0FBQztJQUM5RixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGFBQWEsQ0FBQyxFQUFVLEVBQUUsYUFBb0I7UUFDNUMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNuRCxDQUFDO0NBQ0YifQ==","import * as message from '../message';\nimport { PushMessage } from '../intersection';\nimport { EntityFactory } from './EntityFactory';\nexport class DeviceFactory extends EntityFactory {\n    /**\n     * Push message will be used to send a push notification to a set of devices\n     */\n    get PushMessage() {\n        return PushMessage;\n    }\n    /**\n     * The current registered device, or <code>null</code> if the device is not registered\n     * @type model.Device\n     */\n    get me() {\n        return this.db.deviceMe;\n    }\n    /**\n     * Returns true if the devices is already registered, otherwise false.\n     * @type boolean\n     */\n    get isRegistered() {\n        return this.db.isDeviceRegistered;\n    }\n    /**\n     * Loads the Public VAPID Key which can be used to subscribe a Browser for Web Push notifications\n     * @return The public VAPID Web Push subscription key\n     */\n    loadWebPushKey() {\n        const msg = new message.VAPIDPublicKey();\n        msg.responseType('arraybuffer');\n        return this.db.send(msg).then((response) => response.entity);\n    }\n    register(os, tokenOrSubscription, device, doneCallback, failCallback) {\n        if (device instanceof Function) {\n            return this.register(os, tokenOrSubscription, null, device, doneCallback);\n        }\n        const subscription = typeof tokenOrSubscription === 'string' ? { token: tokenOrSubscription } : tokenOrSubscription;\n        return this.db.registerDevice(os, subscription, device).then(doneCallback, failCallback);\n    }\n    /**\n     * Uses the info from the given {@link PushMessage} message to send an push notification.\n     * @param pushMessage to send an push notification.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    push(pushMessage, doneCallback, failCallback) {\n        return this.db.pushDevice(pushMessage).then(doneCallback, failCallback);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGV2aWNlRmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRldmljZUZhY3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTlDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVoRCxNQUFNLE9BQU8sYUFBYyxTQUFRLGFBQTJCO0lBQzVEOztPQUVHO0lBQ0gsSUFBVyxXQUFXO1FBQ3BCLE9BQU8sV0FBVyxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLEVBQUU7UUFDSixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDO0lBQzFCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLFlBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsa0JBQWtCLENBQUM7SUFDcEMsQ0FBQztJQUVEOzs7T0FHRztJQUNILGNBQWM7UUFDWixNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN6QyxHQUFHLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQTBCRCxRQUFRLENBQUMsRUFBVSxFQUFFLG1CQUE4QyxFQUFFLE1BQXNDLEVBQ3pHLFlBQWtCLEVBQUUsWUFBa0I7UUFDdEMsSUFBSSxNQUFNLFlBQVksUUFBUSxFQUFFO1lBQzlCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQztTQUMzRTtRQUVELE1BQU0sWUFBWSxHQUFHLE9BQU8sbUJBQW1CLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQztRQUVwSCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUMzRixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsSUFBSSxDQUFDLFdBQXdCLEVBQUUsWUFBa0IsRUFBRSxZQUFrQjtRQUNuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDMUUsQ0FBQztDQUNGIn0=","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar _a;\nimport { PersistentError } from '../error';\nimport { Acl } from '../Acl';\nimport { uuid, trailingSlashIt, } from '../util';\nimport * as message from '../message';\nimport { StatusCode, } from '../connector';\nconst FILE_BUCKET = '/file';\nconst FILE_BUCKET_LENGTH = FILE_BUCKET.length;\nconst ID = Symbol('Id');\nconst METADATA = Symbol('Metadata');\nconst DATA = Symbol('Data');\n/**\n * Creates a file object, which represents one specific file reference.\n * This File object can afterwards be used to up- and download the file contents or to retrieves and change the files\n * metadata.\n *\n * The file data can be uploaded and downloaded as:\n *\n *  <table class=\"table\">\n *   <tr>\n *     <th>type</th>\n *     <th>JavaScript type</th>\n *     <th>Description</th>\n *   </tr>\n *   <tr>\n *     <td>'arraybuffer'</td>\n *     <td>ArrayBuffer</td>\n *     <td>The content is represented as a fixed-length raw binary data buffer</td>\n *   </tr>\n *   <tr>\n *     <td>'blob'</th>\n *     <td>Blob</td>\n *     <td>The content is represented as a simple blob</td>\n *   </tr>\n *   <tr>\n *     <td>'json'</td>\n *     <td>object|array|string</td>\n *     <td>The file content is represented as json</td>\n *   </tr>\n *   <tr>\n *     <td>'text'</td>\n *     <td>string</td>\n *     <td>The file content is represented through the string</td>\n *   </tr>\n *   <tr>\n *     <td>'base64'</td>\n *     <td>string</td>\n *     <td>The file content as base64 encoded string</td>\n *   </tr>\n *   <tr>\n *     <td>'data-url'</td>\n *     <td>string</td>\n *     <td>A data url which represents the file content</td>\n *   </tr>\n * </table>\n *\n */\nexport class File {\n    /**\n     * Creates a new file object which represents a file at the given id. Data which is provided to the constructor will\n     * be uploaded by invoking {@link upload()}\n     * @param fileOptions The fileOptions used to create a new file object, or just the id of the file\n     */\n    constructor(fileOptions) {\n        /**\n         * The database connection to use\n         */\n        this.db = null; // is lazy initialized and never null\n        this[_a] = null;\n        // Is fileOptions just an id?\n        const opt = typeof fileOptions === 'string' ? { id: fileOptions } : (fileOptions || {});\n        if (opt.id) {\n            // Check validity of id\n            const nameSeparator = opt.id.indexOf('/', '/file/'.length);\n            if (nameSeparator === -1 || opt.id.indexOf('/file/') !== 0) {\n                throw new Error(`Invalid file reference ${opt.id}`);\n            }\n            this[ID] = opt.id;\n        }\n        else {\n            this[ID] = this.createIdFromOptions(opt);\n        }\n        // Assign metadata\n        this.setDataOptions(opt);\n        this.isFolder = this.id.charAt(this.id.length - 1) === '/';\n    }\n    /**\n     * The complete id of the file, including folder and name\n     */\n    get id() {\n        return this[ID];\n    }\n    // @ts-ignore\n    get url() {\n        throw new Error('This method is removed. Use the asynchronous File.createURL() method instead.');\n    }\n    /**\n     * The name of the file\n     */\n    get name() {\n        return this.id.substring(this.id.lastIndexOf('/', this.id.length - 2) + 1);\n    }\n    /**\n     * The mimeType of the file, only accessible after fetching the metadata or downloading/uploading/providing the file\n     */\n    get mimeType() {\n        if (this.isFolder) {\n            throw new Error('A folder has no mimeType');\n        }\n        this.checkAvailable();\n        return this[METADATA].mimeType;\n    }\n    /**\n     * The current file acl, only accessible after fetching the metadata or downloading/uploading/providing the file\n     */\n    get acl() {\n        this.checkAvailable();\n        return this[METADATA].acl;\n    }\n    /**\n     * The last modified date of the file, only accessible after fetching the metadata\n     * or downloading/uploading/providing the eTag\n     */\n    get lastModified() {\n        if (this.isFolder) {\n            throw new Error('A folder has no lastModified');\n        }\n        this.checkAvailable();\n        return this[METADATA].lastModified;\n    }\n    /**\n     * The creation date of the file, only accessible after fetching the metadata\n     * or downloading/uploading/providing the eTag\n     */\n    get createdAt() {\n        if (this.isFolder) {\n            throw new Error('A folder has no creation date');\n        }\n        this.checkAvailable();\n        return this[METADATA].createdAt;\n    }\n    /**\n     * The eTag of the file, only accessible after fetching the metadata or downloading/uploading/providing the file\n     */\n    get eTag() {\n        if (this.isFolder) {\n            throw new Error('A folder has no eTag');\n        }\n        this.checkAvailable();\n        return this[METADATA].eTag;\n    }\n    /**\n     * The custom headers of the file, only accessible after fetching the metadata or downloading/uploading/providing\n     * the file\n     */\n    get headers() {\n        if (this.isFolder) {\n            throw new Error('A folder has no custom headers');\n        }\n        this.checkAvailable();\n        return this[METADATA].headers;\n    }\n    /**\n     * The size of the file, only accessible after fetching the metadata or downloading/uploading/providing the file\n     */\n    get size() {\n        if (this.isFolder) {\n            throw new Error('A folder has no size');\n        }\n        this.checkAvailable();\n        return this[METADATA].size;\n    }\n    /**\n     * The root bucket of this file\n     */\n    get bucket() {\n        return this.id.substring(FILE_BUCKET_LENGTH + 1, this.id.indexOf('/', FILE_BUCKET_LENGTH + 1));\n    }\n    /**\n     * The full path under the bucket of this file\n     */\n    get key() {\n        return this.id.substring(this.id.indexOf('/', FILE_BUCKET_LENGTH + 1) + 1);\n    }\n    /**\n     * The full path of the file.\n     */\n    get path() {\n        return this.id.substring(FILE_BUCKET_LENGTH);\n    }\n    /**\n     * The parent folder of the file.\n     */\n    get parent() {\n        return this.id.substring(FILE_BUCKET_LENGTH, this.id.lastIndexOf('/', this.id.length - 2));\n    }\n    /**\n     * Indicates if the metadata are loaded.\n     */\n    get isMetadataLoaded() {\n        return !!this[METADATA];\n    }\n    /**\n     * Parses an E-Tag header\n     * @param eTag The E-Tag to parse or something falsy\n     * @return Returns the parsed E-Tag or null, if it could not be parsed\n     */\n    static parseETag(eTag) {\n        if (!eTag) {\n            return null;\n        }\n        const match = eTag.match(/^(?:[wW]\\/)?[\"'](.*)[\"']$/);\n        if (!match) {\n            return null;\n        }\n        return match[1];\n    }\n    /**\n     * The fully url to the file, can be directly used to link the file, i.e. in link tags ot image sources\n     * @param authorize - Authorize the the link with an temporary token, to give authorized access to this protected\n     * resource default false if the root bucket is www, true otherwise\n     * @return A url with an optional token, to give direct access o the linked resource\n     */\n    createURL(authorize) {\n        if (this.isFolder) {\n            throw new Error('Url can not be created for folders.');\n        }\n        return this.db.createURL(this.id, typeof authorize === 'boolean' ? authorize : this.bucket !== 'www');\n    }\n    /**\n     * Uploads the file content which was provided in the constructor or by uploadOptions.data\n     * @param uploadOptions The upload options\n     * @param [uploadOptions.force=false] force the upload and overwrite any existing files without validating\n     * it\n     * @param [uploadOptions.progress] listen to progress changes during upload\n     * @param doneCallback The callback is invoked after the upload succeed successfully\n     * @param failCallback The callback is invoked if any error is occurred\n     * @return A promise which will be fulfilled with this file object where the metadata is updated\n     */\n    upload(uploadOptions, doneCallback, failCallback) {\n        var _b;\n        const opt = uploadOptions || {};\n        if (this.isFolder) {\n            throw new Error('A folder cannot be uploaded');\n        }\n        this.setDataOptions(opt);\n        const uploadMessage = new message.UploadFile(this.bucket, this.key)\n            .entity(this[DATA].data, (_b = this[DATA]) === null || _b === void 0 ? void 0 : _b.type);\n        const meta = this[METADATA];\n        if (meta) {\n            uploadMessage.acl(meta.acl);\n            uploadMessage.contentLength(meta.size);\n            uploadMessage.mimeType(meta.mimeType);\n            uploadMessage.customHeaders(meta.headers);\n        }\n        uploadMessage.progress(opt.progress || null);\n        this.conditional(uploadMessage, opt);\n        this.db.addToBlackList(this.id);\n        return this.db.send(uploadMessage).then((response) => {\n            this[DATA] = null;\n            this.fromJSON(response.entity);\n            return this;\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Download a file and providing it in the requested type\n     * @param downloadOptions The download options\n     * @param downloadOptions.type=\"blob\" The type used to provide the file\n     * @param downloadOptions.refresh=false Indicates to make a revalidation request and not use the cache\n     * @param doneCallback The callback is invoked after the download succeed\n     * successfully\n     * @param failCallback The callback is invoked if any error is occurred\n     * @return A promise which will be fulfilled with the downloaded file content\n     */\n    download(downloadOptions, doneCallback, failCallback) {\n        const opt = downloadOptions || {};\n        if (this.isFolder) {\n            throw new Error('A folder cannot be downloaded');\n        }\n        const type = opt.type || 'blob';\n        const downloadMessage = new message.DownloadFile(this.bucket, this.key)\n            .responseType(type);\n        this.db.ensureCacheHeader(this.id, downloadMessage, opt.refresh);\n        return this.db.send(downloadMessage).then((response) => {\n            this.db.addToWhiteList(this.id);\n            this.fromHeaders(response.headers);\n            return response.entity;\n        }, (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return null;\n            }\n            throw e;\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Deletes a file\n     * @param deleteOptions The delete options\n     * @param deleteOptions.force=false force the deletion without verifying any version\n     * @param doneCallback The callback is invoked after the deletion succeed successfully\n     * @param failCallback The callback is invoked if any error is occurred\n     * @return A promise which will be fulfilled with this file object,\n     * or with a list of all deleted files, if this file is an folder\n     */\n    delete(deleteOptions, doneCallback, failCallback) {\n        const opt = deleteOptions || {};\n        const deleteMessage = new message.DeleteFile(this.bucket, this.key);\n        this.conditional(deleteMessage, opt);\n        if (!this.isFolder) {\n            this.db.addToBlackList(this.id);\n        }\n        return this.db.send(deleteMessage).then((response) => {\n            if (!this.isFolder) {\n                return this;\n            }\n            return response.entity.map((fileId) => new this.db.File(fileId));\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Creates the file id from given options.\n     * @param fileOptions\n     * @return\n     */\n    createIdFromOptions(fileOptions) {\n        var _b;\n        let path;\n        if (fileOptions.path) {\n            path = fileOptions.path;\n        }\n        else {\n            const parent = trailingSlashIt(fileOptions.parent || '/www');\n            if (parent.length < 3) {\n                throw new Error(`Invalid parent name: ${parent}`);\n            }\n            const name = fileOptions.name || ((_b = fileOptions === null || fileOptions === void 0 ? void 0 : fileOptions.data) === null || _b === void 0 ? void 0 : _b.name) || uuid();\n            path = parent + name;\n        }\n        // Add leading slash if missing\n        if (path.charAt(0) !== '/') {\n            path = `/${path}`;\n        }\n        // Check path validity\n        if (path.indexOf('//') !== -1 || path.length < 3) {\n            throw new Error(`Invalid path: ${path}`);\n        }\n        return FILE_BUCKET + path;\n    }\n    /**\n     * Makes the given message a conditional request based on the file metadata\n     * @param msg The message to make conditional\n     * @param options additional request options\n     * @param options.force=false Force the request operation by didn't make it conditional\n     */\n    conditional(msg, options) {\n        if (options.force) {\n            return;\n        }\n        const meta = this[METADATA];\n        if (!meta || (!meta.lastModified && !meta.eTag)) {\n            msg.ifNoneMatch('*');\n            return;\n        }\n        msg.ifUnmodifiedSince(meta.lastModified);\n        msg.ifMatch(meta.eTag);\n    }\n    /**\n     * Gets the file metadata of a file\n     * @param options The load metadata options\n     * @param [options.refresh=false] Force a revalidation while fetching the metadata\n     * @param doneCallback The callback is invoked after the metadata is fetched\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return A promise which will be fulfilled with this file\n     */\n    loadMetadata(options, doneCallback, failCallback) {\n        const opt = options || {};\n        if (this.isFolder) {\n            throw new Error('A folder has no mata data.');\n        }\n        const msg = new message.GetFileMetadata(this.bucket, this.key);\n        this.db.ensureCacheHeader(this.id, msg, opt.refresh);\n        return this.db.send(msg).then((response) => {\n            // do not white list the file, because head-request does not revalidate the cache.\n            this.fromHeaders(response.headers);\n            return this;\n        }, (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return null;\n            }\n            throw e;\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Updates the mata data of this file.\n     * @param options The save metadata options\n     * @param [options.force=false] force the update and overwrite the existing metadata without validating it\n     * @param doneCallback The callback is invoked after the metadata is saved\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return A promise which will be fulfilled with this file\n     */\n    saveMetadata(options, doneCallback, failCallback) {\n        const opt = options || {};\n        const json = this.toJSON();\n        const msg = new message.UpdateFileMetadata(this.bucket, this.key)\n            .entity(json);\n        this.conditional(msg, opt);\n        return this.db.send(msg).then((response) => {\n            this.fromJSON(response.entity);\n            return this;\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Validates and sets the file metadata based on the given options\n     * @param options\n     * @private\n     */\n    setDataOptions(options) {\n        const { data, type } = options, metadata = __rest(options, [\"data\", \"type\"]);\n        if (!data) {\n            return;\n        }\n        // Set data\n        this[DATA] = { type, data };\n        const mimeType = this.guessMimeType(options) || undefined;\n        this.fromJSON(Object.assign(Object.assign({}, metadata), { mimeType }));\n    }\n    /**\n     * Gets the MIME type of given file options.\n     * @param options\n     * @return Returns the guessed MIME type or null, if it could not be guessed.\n     * @private\n     */\n    guessMimeType(options) {\n        const { mimeType } = options;\n        if (mimeType) {\n            return mimeType;\n        }\n        if (typeof Blob !== 'undefined' && options.data instanceof Blob) {\n            return options.data.type;\n        }\n        if (options.type === 'data-url' && typeof options.data === 'string') {\n            const match = options.data.match(/^data:(.+?)(;base64)?,.*$/);\n            return match && match[1];\n        }\n        return null;\n    }\n    /**\n     * @param headers\n     */\n    fromHeaders(headers) {\n        this.fromJSON({\n            eTag: File.parseETag(headers.etag),\n            lastModified: headers['last-modified'],\n            createdAt: headers['baqend-created-at'],\n            mimeType: headers['content-type'],\n            acl: headers['baqend-acl'] && JSON.parse(headers['baqend-acl']),\n            size: +headers['baqend-size'],\n            headers: headers['baqend-custom-headers'] && JSON.parse(headers['baqend-custom-headers']),\n        });\n    }\n    /**\n     * Deserialize the given JSON file metadata back to this file instance\n     *\n     * If the JSON object contains an ID, it must match with this file ID, otherwise an exception is thrown.\n     *\n     * @param json The json to deserialize\n     */\n    fromJSON(json) {\n        const { id } = json;\n        if (id && this.id !== id) {\n            throw new Error(`This file id ${this.id} does not match the given json id ${id}`);\n        }\n        const meta = this[METADATA] || {};\n        let acl;\n        if (json.acl instanceof Acl) {\n            acl = json.acl;\n        }\n        else {\n            acl = meta.acl || new Acl();\n            if (json.acl) {\n                acl.fromJSON(json.acl);\n            }\n        }\n        // keep last known lastModified, createdAt, eTag and headers\n        this[METADATA] = Object.assign(Object.assign({}, this[METADATA]), { mimeType: json.mimeType, lastModified: (json.lastModified && new Date(json.lastModified)) || meta.lastModified, createdAt: (json.createdAt && new Date(json.createdAt)) || meta.createdAt, eTag: json.eTag || meta.eTag, acl, size: typeof json.size === 'number' ? json.size : json.contentLength, headers: json.headers || meta.headers || {} });\n    }\n    /**\n     * Serialize the file metadata of this object to json\n     * @return The serialized file metadata as json\n     */\n    toJSON() {\n        var _b;\n        this.checkAvailable();\n        const meta = this[METADATA];\n        return {\n            id: this.id,\n            mimeType: meta.mimeType,\n            eTag: meta.eTag,\n            acl: (_b = meta.acl) === null || _b === void 0 ? void 0 : _b.toJSON(),\n            size: meta.size,\n            lastModified: meta.lastModified && meta.lastModified.toISOString(),\n            createdAt: meta.createdAt && meta.createdAt.toISOString(),\n            headers: meta.headers,\n        };\n    }\n    /**\n     * Checks whenever metadata are already loaded of the file, throws an error otherwise\n     * @return\n     */\n    checkAvailable() {\n        if (!this.isMetadataLoaded) {\n            throw new PersistentError(`The file metadata of ${this.id} is not available.`);\n        }\n    }\n}\n_a = DATA;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkZpbGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzdCLE9BQU8sRUFDTCxJQUFJLEVBQUUsZUFBZSxHQUV0QixNQUFNLFNBQVMsQ0FBQztBQUNqQixPQUFPLEtBQUssT0FBTyxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLEVBQ3NCLFVBQVUsR0FDdEMsTUFBTSxjQUFjLENBQUM7QUFJdEIsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDO0FBQzVCLE1BQU0sa0JBQWtCLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQztBQUU5QyxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEIsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQXdFNUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTZDRztBQUNILE1BQU0sT0FBTyxJQUFJO0lBcUpmOzs7O09BSUc7SUFDSCxZQUFZLFdBQXdCO1FBcEpwQzs7V0FFRztRQUNJLE9BQUUsR0FBa0IsSUFBVyxDQUFDLENBQUMscUNBQXFDO1FBTXJFLFFBQU0sR0FBb0IsSUFBSSxDQUFDO1FBNElyQyw2QkFBNkI7UUFDN0IsTUFBTSxHQUFHLEdBQUcsT0FBTyxXQUFXLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLENBQUM7UUFFeEYsSUFBSSxHQUFHLENBQUMsRUFBRSxFQUFFO1lBQ1YsdUJBQXVCO1lBQ3ZCLE1BQU0sYUFBYSxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0QsSUFBSSxhQUFhLEtBQUssQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUMxRCxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQzthQUNyRDtZQUVELElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDO1NBQ25CO2FBQU07WUFDTCxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQzFDO1FBRUQsa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUM7SUFDN0QsQ0FBQztJQTVKRDs7T0FFRztJQUNILElBQUksRUFBRTtRQUNKLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFRCxhQUFhO0lBQ2IsSUFBSSxHQUFHO1FBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQywrRUFBK0UsQ0FBQyxDQUFDO0lBQ25HLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksSUFBSTtRQUNOLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksUUFBUTtRQUNWLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDN0M7UUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksR0FBRztRQUNMLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7T0FHRztJQUNILElBQUksWUFBWTtRQUNkLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLDhCQUE4QixDQUFDLENBQUM7U0FDakQ7UUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBb0IsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxTQUFTO1FBQ1gsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQztTQUNsRDtRQUNELElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFpQixDQUFDO0lBQzFDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksSUFBSTtRQUNOLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7U0FDekM7UUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLE9BQU87UUFDVCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQVMsQ0FBQztJQUNsQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLElBQUk7UUFDTixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1NBQ3pDO1FBQ0QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLE1BQU07UUFDUixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGtCQUFrQixHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLEdBQUc7UUFDTCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxrQkFBa0IsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLElBQUk7UUFDTixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxNQUFNO1FBQ1IsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3RixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLGdCQUFnQjtRQUNsQixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQTRCRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFhO1FBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsU0FBUyxDQUFDLFNBQW1CO1FBQzNCLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHFDQUFxQyxDQUFDLENBQUM7U0FDeEQ7UUFFRCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsT0FBTyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLENBQUM7SUFDeEcsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRztJQUNILE1BQU0sQ0FBQyxhQUEwRixFQUFFLFlBQWtCLEVBQ25ILFlBQWtCOztRQUNsQixNQUFNLEdBQUcsR0FBRyxhQUFhLElBQUksRUFBRSxDQUFDO1FBRWhDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7U0FDaEQ7UUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXpCLE1BQU0sYUFBYSxHQUFHLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUM7YUFDaEUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUcsQ0FBQyxJQUFNLFFBQUUsSUFBSSxDQUFDLElBQUksQ0FBQywwQ0FBRSxJQUFJLENBQUMsQ0FBQztRQUVqRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUIsSUFBSSxJQUFJLEVBQUU7WUFDUixhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFLLENBQUMsQ0FBQztZQUM5QixhQUFhLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFNLENBQUMsQ0FBQztZQUN6QyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFVLENBQUMsQ0FBQztZQUN4QyxhQUFhLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFTLENBQUMsQ0FBQztTQUM3QztRQUVELGFBQWEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUU3QyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVyQyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEMsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNuRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9CLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0gsUUFBUSxDQUFDLGVBQThELEVBQUUsWUFBa0IsRUFDekYsWUFBa0I7UUFDbEIsTUFBTSxHQUFHLEdBQUcsZUFBZSxJQUFJLEVBQUUsQ0FBQztRQUVsQyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1NBQ2xEO1FBRUQsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxNQUFNLENBQUM7UUFFaEMsTUFBTSxlQUFlLEdBQUcsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQzthQUNwRSxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFdEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLGVBQWUsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFakUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNyRCxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbkMsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDO1FBQ3pCLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ1AsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDNUMsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELE1BQU0sQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7Ozs7O09BUUc7SUFDSCxNQUFNLENBQUMsYUFBbUMsRUFBRSxZQUFrQixFQUFFLFlBQWtCO1FBQ2hGLE1BQU0sR0FBRyxHQUFHLGFBQWEsSUFBSSxFQUFFLENBQUM7UUFFaEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRXJDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUNqQztRQUVELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2xCLE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFFRCxPQUFRLFFBQVEsQ0FBQyxNQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxtQkFBbUIsQ0FBQyxXQUF1Qzs7UUFDakUsSUFBSSxJQUFZLENBQUM7UUFDakIsSUFBSSxXQUFXLENBQUMsSUFBSSxFQUFFO1lBQ3BCLElBQUksR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDO1NBQ3pCO2FBQU07WUFDTCxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsV0FBVyxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQztZQUM3RCxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNyQixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixNQUFNLEVBQUUsQ0FBQyxDQUFDO2FBQ25EO1lBRUQsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLElBQUksV0FBSyxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsSUFBWSwwQ0FBRSxJQUFJLENBQUEsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUM1RSxJQUFJLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQztTQUN0QjtRQUVELCtCQUErQjtRQUMvQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO1lBQzFCLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1NBQ25CO1FBRUQsc0JBQXNCO1FBQ3RCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoRCxNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQzFDO1FBRUQsT0FBTyxXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQzVCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFdBQVcsQ0FBQyxHQUFZLEVBQUUsT0FBNEI7UUFDcEQsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ2pCLE9BQU87U0FDUjtRQUVELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQy9DLEdBQUcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckIsT0FBTztTQUNSO1FBRUQsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxZQUFvQixDQUFDLENBQUM7UUFDakQsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBTSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxZQUFZLENBQUMsT0FBK0IsRUFBRSxZQUFrQixFQUFFLFlBQWtCO1FBQ2xGLE1BQU0sR0FBRyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFFMUIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLENBQUMsQ0FBQztTQUMvQztRQUVELE1BQU0sR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyRCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ3pDLGtGQUFrRjtZQUNsRixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNuQyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ1AsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDNUMsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELE1BQU0sQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILFlBQVksQ0FBQyxPQUE2QixFQUFFLFlBQWtCLEVBQUUsWUFBa0I7UUFDaEYsTUFBTSxHQUFHLEdBQUcsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUUxQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDM0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDO2FBQzlELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVoQixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUUzQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9CLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FBQyxPQUFnQztRQUM3QyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksS0FBa0IsT0FBTyxFQUFwQixRQUFRLFVBQUssT0FBTyxFQUFyQyxnQkFBMkIsQ0FBVSxDQUFDO1FBRTVDLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPO1NBQ1I7UUFFRCxXQUFXO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDO1FBRTVCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksU0FBUyxDQUFDO1FBQzFELElBQUksQ0FBQyxRQUFRLGlDQUFNLFFBQVEsS0FBRSxRQUFRLElBQUcsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxhQUFhLENBQUMsT0FBZ0M7UUFDNUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLE9BQU8sQ0FBQztRQUM3QixJQUFJLFFBQVEsRUFBRTtZQUNaLE9BQU8sUUFBUSxDQUFDO1NBQ2pCO1FBRUQsSUFBSSxPQUFPLElBQUksS0FBSyxXQUFXLElBQUksT0FBTyxDQUFDLElBQUksWUFBWSxJQUFJLEVBQUU7WUFDL0QsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztTQUMxQjtRQUVELElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxVQUFVLElBQUksT0FBTyxPQUFPLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUNuRSxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQzlELE9BQU8sS0FBSyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUMxQjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOztPQUVHO0lBQ0ssV0FBVyxDQUFDLE9BQW1DO1FBQ3JELElBQUksQ0FBQyxRQUFRLENBQUM7WUFDWixJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ2xDLFlBQVksRUFBRSxPQUFPLENBQUMsZUFBZSxDQUFDO1lBQ3RDLFNBQVMsRUFBRSxPQUFPLENBQUMsbUJBQW1CLENBQUM7WUFDdkMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxjQUFjLENBQUM7WUFDakMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMvRCxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO1lBQzdCLE9BQU8sRUFBRSxPQUFPLENBQUMsdUJBQXVCLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1NBQzFGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxRQUFRLENBQUMsSUFBNEI7UUFDbkMsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQWUsQ0FBQztRQUMvQixJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUN4QixNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixJQUFJLENBQUMsRUFBRSxxQ0FBcUMsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUNuRjtRQUVELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFbEMsSUFBSSxHQUFHLENBQUM7UUFDUixJQUFJLElBQUksQ0FBQyxHQUFHLFlBQVksR0FBRyxFQUFFO1lBQzNCLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQ2hCO2FBQU07WUFDTCxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQzVCLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDWixHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFjLENBQUMsQ0FBQzthQUNuQztTQUNGO1FBRUQsNERBQTREO1FBQzVELElBQUksQ0FBQyxRQUFRLENBQUMsbUNBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUNqQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQWtCLEVBQ2pDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQXNCLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQy9GLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQW1CLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQ25GLElBQUksRUFBRSxJQUFJLENBQUMsSUFBYyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQ3RDLEdBQUcsRUFDSCxJQUFJLEVBQUUsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsSUFBZ0IsQ0FBQyxhQUF1QixFQUMzRixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQXFDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxFQUFFLEdBQzFFLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTTs7UUFDSixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTVCLE9BQU87WUFDTCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDWCxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsR0FBRyxRQUFFLElBQUksQ0FBQyxHQUFHLDBDQUFFLE1BQU0sRUFBRTtZQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVksSUFBSyxJQUFJLENBQUMsWUFBcUIsQ0FBQyxXQUFXLEVBQUU7WUFDNUUsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLElBQUssSUFBSSxDQUFDLFNBQWtCLENBQUMsV0FBVyxFQUFFO1lBQ25FLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztTQUNYLENBQUM7SUFDZixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsY0FBYztRQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDMUIsTUFBTSxJQUFJLGVBQWUsQ0FBQyx3QkFBd0IsSUFBSSxDQUFDLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztTQUNoRjtJQUNILENBQUM7Q0FDRjtLQWxoQlUsSUFBSSJ9","import { Factory } from './Factory';\nimport { File } from './File';\nimport * as message from '../message';\nimport { trailingSlashIt } from '../util';\nimport { StatusCode } from '../connector';\nimport { Permission } from '../intersection';\nexport class FileFactory extends Factory {\n    constructor() {\n        super(...arguments);\n        /**\n         * The owning EntityManager where this factory belongs to\n         */\n        this.db = null;\n    }\n    /**\n     * Creates a new FileFactory for the given type\n     * @param db\n     * @return A new file factory\n     */\n    static create(db) {\n        const factory = this.createFactory(File);\n        factory.db = db;\n        return factory;\n    }\n    /**\n     * Creates a new file\n     * @param args Constructor arguments used for instantiation, the constructor will not be called\n     * when no arguments are passed\n     * @return A new created file\n     */\n    newInstance(args) {\n        const instance = super.newInstance(args);\n        instance.db = this.db;\n        return instance;\n    }\n    /**\n     * Deserialize the file metadata from a json object back to a new file instance\n     * @param json The file metadata as json\n     * @return The deserialize File instance\n     */\n    fromJSON(json) {\n        const file = this.newInstance([json.id]);\n        file.fromJSON(json);\n        return file;\n    }\n    /**\n     * Updates the metadata of the root file directory formally the file \"bucket\"\n     * @param bucket The name of the root file directory\n     * @param metadata The new metadata for the bucket\n     * @param doneCallback Invoked if the operation succeeds\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return A promise which will fulfilled with the updated metadata\n     */\n    saveMetadata(bucket, metadata, doneCallback, failCallback) {\n        const msg = new message.SetFileBucketMetadata(bucket, metadata);\n        return this.db.send(msg).then(doneCallback, failCallback);\n    }\n    /**\n     * Gets the metadata of the root folder (formally the file \"bucket\")\n     * @param bucket The name of the root file directory\n     * @param options The load metadata options\n     * @param [options.refresh=false] Force a revalidation while fetching the metadata\n     * @param doneCallback\n     * The callback is invoked after the metadata is fetched\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return A promise which will be fulfilled with the bucket ACLs\n     */\n    loadMetadata(bucket, options, doneCallback, failCallback) {\n        const msg = new message.GetFileBucketMetadata(bucket);\n        // this._db.ensureCacheHeader(this.id, msg, options.refresh);\n        // do not white list the file, because head-request does not revalidate the cache.\n        return this.db.send(msg).then((response) => {\n            const result = {};\n            Permission.BASE_PERMISSIONS.forEach((key) => {\n                result[key] = Permission.fromJSON(response.entity[key] || {});\n            });\n            return result;\n        }, (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return null;\n            }\n            throw e;\n        }).then(doneCallback, failCallback);\n    }\n    /**\n     * Lists all the buckets.\n     * @param doneCallback The callback is invoked with the listed buckets\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return The listed buckets.\n     */\n    listBuckets(doneCallback, failCallback) {\n        return this.db.send(new message.ListBuckets()).then((response) => (response.entity.map((bucket) => this.new(`${bucket}/`)))).then(doneCallback, failCallback);\n    }\n    /**\n     * Lists the files (and folders) in the given folder.\n     *\n     * @param folderOrPath The folder/path to list.\n     * @param start The file/folder from where to start listing (not included)\n     * @param count The maximum number of files to return.\n     * @param doneCallback The callback is invoked with the listed files\n     * @param failCallback The callback is invoked if any error has occurred\n     * @return The listed files/folders.\n     */\n    listFiles(folderOrPath, start, count, doneCallback, failCallback) {\n        let folder;\n        if (typeof folderOrPath === 'string') {\n            const path = trailingSlashIt(folderOrPath);\n            folder = this.new({ path });\n        }\n        else {\n            folder = folderOrPath;\n        }\n        const path = folder.key;\n        const { bucket } = folder;\n        return this.db.send(new message.ListFiles(bucket, path, start ? start.key : undefined, count)).then((response) => (response.entity.map((file) => this.new(file)))).then(doneCallback, failCallback);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsZUZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJGaWxlRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxJQUFJLEVBQWUsTUFBTSxRQUFRLENBQUM7QUFDM0MsT0FBTyxLQUFLLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUFXLGVBQWUsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQStCN0MsTUFBTSxPQUFPLFdBQVksU0FBUSxPQUFhO0lBQTlDOztRQVlFOztXQUVHO1FBQ0ksT0FBRSxHQUFrQixJQUFXLENBQUM7SUEyR3pDLENBQUM7SUF6SEM7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBaUI7UUFDN0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBb0IsSUFBSSxDQUFDLENBQUM7UUFDNUQsT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDaEIsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQU9EOzs7OztPQUtHO0lBQ0gsV0FBVyxDQUFDLElBQXFCO1FBQy9CLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsUUFBUSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3RCLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsUUFBUSxDQUFDLElBQWE7UUFDcEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxR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","/**\n * This decorator modifies the enumerable flag of an class member\n * @param value - the enumerable value of the property descriptor\n */\nexport function enumerable(value) {\n    return function decorate(target, propertyKey, descriptor) {\n        // eslint-disable-next-line no-param-reassign\n        descriptor.enumerable = value;\n    };\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW51bWVyYWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImVudW1lcmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFVBQVUsQ0FBQyxLQUFjO0lBQ3ZDLE9BQU8sU0FBUyxRQUFRLENBQ3RCLE1BQVcsRUFDWCxXQUFtQixFQUNuQixVQUE4QjtRQUU5Qiw2Q0FBNkM7UUFDN0MsVUFBVSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDaEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyJ9","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { enumerable } from '../util/enumerable';\nimport { Enhancer } from './Enhancer';\nimport { Metadata } from '../intersection';\nexport class Managed {\n    /**\n     * Initialize the given instance\n     * @param instance The managed instance to initialize\n     * @param properties The optional properties to set on the instance\n     */\n    static init(instance, properties) {\n        const type = Enhancer.getBaqendType(instance.constructor);\n        if (type.isEntity) {\n            Object.defineProperty(instance, '_metadata', {\n                value: Metadata.create(type),\n                configurable: true,\n            });\n        }\n        if (properties) {\n            Object.assign(instance, properties);\n        }\n    }\n    /**\n     * Creates a subclass of this class\n     * @param {Class<*>} childClass\n     * @return {Class<*>} The extended child class\n     */\n    static extend(childClass) {\n        // eslint-disable-next-line no-param-reassign\n        childClass.prototype = Object.create(this.prototype, {\n            constructor: {\n                value: childClass,\n                configurable: true,\n                writable: true,\n            },\n        });\n        // eslint-disable-next-line no-param-reassign\n        childClass.extend = Managed.extend;\n        return childClass;\n    }\n    /**\n     * The default constructor, copy all given properties to this object\n     * @param properties - The optional properties to copy\n     */\n    constructor(properties) {\n        Managed.init(this, properties);\n    }\n    /**\n     * Returns this object identifier or the baqend type of this object\n     * @return the object id or type whatever is available\n     */\n    toString() {\n        const type = Enhancer.getBaqendType(this.constructor);\n        return type.ref;\n    }\n    /**\n     * Converts the managed object to an JSON-Object.\n     * @return JSON-Object\n     * @method\n     */\n    toJSON() {\n        const type = Enhancer.getBaqendType(this.constructor);\n        return type.toJsonValue(Metadata.create(type), this, { persisting: false });\n    }\n}\n__decorate([\n    enumerable(false)\n], Managed.prototype, \"toString\", null);\n__decorate([\n    enumerable(false)\n], Managed.prototype, \"toJSON\", null);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFuYWdlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1hbmFnZWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRWhELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBZTNDLE1BQU0sT0FBTyxPQUFPO0lBQ2xCOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQWlCLEVBQUUsVUFBc0M7UUFDbkUsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFFLENBQUM7UUFDM0QsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRTtnQkFDM0MsS0FBSyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBdUIsQ0FBQztnQkFDL0MsWUFBWSxFQUFFLElBQUk7YUFDbkIsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxJQUFJLFVBQVUsRUFBRTtZQUNkLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQ3JDO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQWlDO1FBQzdDLDZDQUE2QztRQUM3QyxVQUFVLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNuRCxXQUFXLEVBQUU7Z0JBQ1gsS0FBSyxFQUFFLFVBQVU7Z0JBQ2pCLFlBQVksRUFBRSxJQUFJO2dCQUNsQixRQUFRLEVBQUUsSUFBSTthQUNmO1NBQ0YsQ0FBQyxDQUFDO1FBQ0gsNkNBQTZDO1FBQzVDLFVBQWtCLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDNUMsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7T0FHRztJQUNILFlBQVksVUFBc0M7UUFDaEQsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7T0FHRztJQUVILFFBQVE7UUFDTixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN0RCxPQUFPLElBQUssQ0FBQyxHQUFHLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7O09BSUc7SUFFSCxNQUFNO1FBQ0osTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFFLENBQUM7UUFDdkQsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDOUUsQ0FBQztDQUNGO0FBZkM7SUFEQyxVQUFVLENBQUMsS0FBSyxDQUFDO3VDQUlqQjtBQVFEO0lBREMsVUFBVSxDQUFDLEtBQUssQ0FBQztxQ0FJakIifQ==","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Managed } from './Managed';\nimport { EntityPartialUpdateBuilder } from '../partialupdate';\nimport { enumerable } from '../util/enumerable';\nimport { PersistentError } from '../error';\nimport { Enhancer } from './Enhancer';\nexport class Entity extends Managed {\n    /**\n     * The unique id of this object\n     *\n     * Sets the unique id of this object, if the id is not formatted as an valid id,\n     * it will be used as the key component of the id has the same affect as setting the key\n     *\n     * @type string\n     */\n    get id() {\n        return this._metadata.id;\n    }\n    set id(value) {\n        if (this._metadata.id) {\n            throw new Error(`The id can't be set twice: ${value}`);\n        }\n        const val = `${value}`;\n        if (val.indexOf(`/db/${this._metadata.bucket}/`) === 0) {\n            this._metadata.id = value;\n        }\n        else {\n            this.key = value;\n        }\n    }\n    /**\n     * The unique key part of the id\n     * When the key of the unique id is set an error will be thrown if an id is already set.\n     * @type string\n     */\n    get key() {\n        return this._metadata.key;\n    }\n    set key(value) {\n        this._metadata.key = value;\n    }\n    /**\n     * The version of this object\n     * @type number\n     * @readonly\n     */\n    get version() {\n        return this._metadata.version;\n    }\n    /**\n     * The object read/write permissions\n     * @type Acl\n     * @readonly\n     */\n    get acl() {\n        this._metadata.throwUnloadedPropertyAccess('acl');\n        return this._metadata.acl;\n    }\n    /**\n     * Attach this object to the given db\n     * @param db The db which will be used for future crud operations\n     * @return\n     */\n    attach(db) {\n        db.attach(this);\n    }\n    ready(doneCallback) {\n        return this._metadata.ready().then(() => this).then(doneCallback);\n    }\n    /**\n     * Saves the object. Inserts the object if it doesn't exists and updates the object if the object exist.\n     * @param [options] The save options\n     * @param [options.force=false] Force the save operation, the version will not be validated.\n     * @param [options.depth=0] The object depth which will be saved. Depth 0 save this object only,\n     * <code>true</code> saves the objects by reachability.\n     * @param [options.refresh=false] Refresh the local object state from remote.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     */\n    save(options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.save({}, options, doneCallback);\n        }\n        return this._metadata.db.save(this, options).then(doneCallback, failCallback);\n    }\n    /**\n     * Inserts a new object. Inserts the object if it doesn't exists and raise an error if the object already exist.\n     * @param [options] The insertion options\n     * @param [options.depth=0] The object depth which will be inserted. Depth 0 insert this object only,\n     * <code>true</code> inserts objects by reachability.\n     * @param [options.refresh=false] Refresh the local object state from remote.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     * @method\n     */\n    insert(options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.insert({}, options, doneCallback);\n        }\n        return this._metadata.db.insert(this, options).then(doneCallback, failCallback);\n    }\n    /**\n     * Updates an existing object\n     *\n     * Updates the object if it exists and raise an error if the object doesn't exist.\n     *\n     * @param [options] The update options\n     * @param [options.force=false] Force the update operation,\n     * the version will not be validated, only existence will be checked.\n     * @param [options.depth=0] The object depth which will be updated. Depth 0 updates this object only,\n     * <code>true</code> updates objects by reachability.\n     * @param [options.refresh=false] Refresh the local object state from remote.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     * @method\n     */\n    update(options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.update({}, options, doneCallback);\n        }\n        return this._metadata.db.update(this, options).then(doneCallback, failCallback);\n    }\n    /**\n     * Resolves the referenced object in the specified depth\n     *\n     * Only unresolved objects will be loaded unless the refresh option is specified.\n     *\n     * Removed objects will be marked as removed.\n     * @param [options] The load options\n     * @param [options.depth=0] The object depth which will be loaded. Depth set to <code>true</code>\n     * loads objects by reachability.\n     * @param [options.refresh=false] Refresh the local object state from remote.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     * @method\n     */\n    load(options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.load({}, options, doneCallback);\n        }\n        const opt = Object.assign({ local: true }, options);\n        if (this.id === null) {\n            throw new PersistentError(\"This object can't be loaded, it does have an id.\");\n        }\n        return this._metadata.db.load(this.id, undefined, opt).then(doneCallback, failCallback);\n    }\n    /**\n     * Deletes an existing object\n     *\n     * @param [options] The remove options\n     * @param [options.force=false] Force the remove operation, the version will not be validated.\n     * @param [options.depth=0] The object depth which will be removed. Depth 0 removes this object only,\n     * <code>true</code> removes objects by reachability.\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     * @method\n     */\n    delete(options, doneCallback, failCallback) {\n        if (typeof options === 'function') {\n            return this.delete({}, options, doneCallback);\n        }\n        return this._metadata.db.delete(this, options).then(doneCallback, failCallback);\n    }\n    /**\n     * Saves the object and repeats the operation if the object is out of date\n     *\n     * In each pass the callback will be called. Ths first parameter of the callback is the entity and the second one\n     * is a function to abort the process.\n     *\n     * @param cb Will be called in each pass\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return A Promise that will be fulfilled when the asynchronous operation completes.\n     * @method\n     */\n    optimisticSave(cb, doneCallback, failCallback) {\n        return this._metadata.db.optimisticSave(this, cb).then(doneCallback, failCallback);\n    }\n    attr() {\n        throw new Error('Attr is not yet implemented.');\n    }\n    /**\n     * Validates the entity by using the validation code of the entity type\n     *\n     * @return Contains the result of the Validation\n     * @method\n     */\n    validate() {\n        return this._metadata.db.validate(this);\n    }\n    /**\n     * Starts a partial update on this entity\n     *\n     * @param operations initial operations which should be executed\n     * @return\n     */\n    partialUpdate(operations) {\n        return new EntityPartialUpdateBuilder(this, operations);\n    }\n    /**\n     * Get all objects which refer to this object\n     *\n     * @param [options] Some options to pass\n     * @param [options.classes] An array of class names to filter for, null for no filter\n     * @return A promise resolving with an array of all referencing objects\n     * @method\n     */\n    getReferencing(options) {\n        const { db } = this._metadata;\n        const references = this._metadata.type.getReferencing(db, options);\n        // Query all possibly referencing objects\n        const allResults = Array.from(references).map(([ref, attrs]) => {\n            // Create query for given entity\n            const qb = db.createQueryBuilder(ref.typeConstructor);\n            // Add term for each attribute\n            const terms = [];\n            attrs.forEach((attr) => {\n                terms.push(qb.equal(attr, this));\n            });\n            // If more than one term, put everything in a disjunction\n            const query = terms.length === 1 ? terms[0] : qb.or(terms);\n            return query.resultList();\n        });\n        return Promise.all(allResults).then((results) => (\n        // Filter out all objects which did not match\n        results.filter((result) => !!result.length))).then((results) => (\n        // Flat the array of results\n        Array.prototype.concat.apply([], results)));\n    }\n    /**\n     * Returns this object identifier or the baqend type of this object\n     * @return the object id or type whatever is available\n     */\n    toString() {\n        const type = Enhancer.getBaqendType(this.constructor);\n        return this.id || type.ref;\n    }\n    /**\n     * Converts the object to an JSON-Object\n     * @param [options=false] to json options by default excludes the metadata\n     * @param [options.excludeMetadata=false] Excludes the metadata form the serialized json\n     * @param [options.depth=0] Includes up to depth referenced objects into the serialized json\n     * @return JSON-Object\n     * @method\n     */\n    toJSON(options) {\n        // JSON.stringify calls toJSON with the parent key as the first argument.\n        // Therefore ignore all unknown option types.\n        let opt = options;\n        if (typeof opt === 'boolean') {\n            opt = {\n                excludeMetadata: opt,\n            };\n        }\n        if (typeof opt !== 'object') {\n            opt = {};\n        }\n        const state = this._metadata;\n        return state.type.toJsonValue(state, this, opt);\n    }\n}\n__decorate([\n    enumerable(true)\n], Entity.prototype, \"id\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"key\", null);\n__decorate([\n    enumerable(true)\n], Entity.prototype, \"version\", null);\n__decorate([\n    enumerable(true)\n], Entity.prototype, \"acl\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"attach\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"ready\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"save\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"insert\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"update\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"load\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"delete\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"optimisticSave\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"attr\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"validate\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"partialUpdate\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"getReferencing\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"toString\", null);\n__decorate([\n    enumerable(false)\n], Entity.prototype, \"toJSON\", null);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRW50aXR5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEMsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFLM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQVF0QyxNQUFNLE9BQU8sTUFBTyxTQUFRLE9BQU87SUFtQmpDOzs7Ozs7O09BT0c7SUFFSCxJQUFJLEVBQUU7UUFDSixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFRCxJQUFJLEVBQUUsQ0FBQyxLQUFvQjtRQUN6QixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFO1lBQ3JCLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLEtBQUssRUFBRSxDQUFDLENBQUM7U0FDeEQ7UUFFRCxNQUFNLEdBQUcsR0FBRyxHQUFHLEtBQUssRUFBRSxDQUFDO1FBQ3ZCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsS0FBSyxDQUFDO1NBQzNCO2FBQU07WUFDTCxJQUFJLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBRUgsSUFBSSxHQUFHO1FBQ0wsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQztJQUM1QixDQUFDO0lBRUQsSUFBSSxHQUFHLENBQUMsS0FBSztRQUNYLElBQUks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","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { enumerable } from '../util/enumerable';\nimport { Entity } from './Entity';\nexport class User extends Entity {\n    /**\n     * Change the password of the given user\n     *\n     * @param currentPassword Current password of the user\n     * @param password New password of the user\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    newPassword(currentPassword, password, doneCallback, failCallback) {\n        return this._metadata.db.newPassword(this.username, currentPassword, password).then(doneCallback, failCallback);\n    }\n    /**\n     * Change the username of the current user\n     *\n     * @param newUsername New username for the current user\n     * @param password The password of the current user\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    changeUsername(newUsername, password, doneCallback, failCallback) {\n        return this._metadata.db.changeUsername(this.username, newUsername, password).then(doneCallback, failCallback);\n    }\n    /**\n     * Requests a perpetual token for the user\n     *\n     * Only users with the admin role are allowed to request an API token.\n     *\n     * @param doneCallback Called when the operation succeed.\n     * @param failCallback Called when the operation failed.\n     * @return\n     */\n    requestAPIToken(doneCallback, failCallback) {\n        return this._metadata.db.requestAPIToken(this.constructor, this)\n            .then(doneCallback, failCallback);\n    }\n}\n__decorate([\n    enumerable(false)\n], User.prototype, \"newPassword\", null);\n__decorate([\n    enumerable(false)\n], User.prototype, \"changeUsername\", null);\n__decorate([\n    enumerable(false)\n], User.prototype, \"requestAPIToken\", null);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFJbEMsTUFBTSxPQUFPLElBQUssU0FBUSxNQUFNO0lBVzlCOzs7Ozs7OztPQVFHO0lBRUgsV0FBVyxDQUFDLGVBQXVCLEVBQUUsUUFBZ0IsRUFBRSxZQUFrQixFQUFFLFlBQWtCO1FBQzNGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFVLEVBQUUsZUFBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDcEgsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBRUgsY0FBYyxDQUFDLFdBQW1CLEVBQUUsUUFBZ0IsRUFBRSxZQUFrQixFQUFFLFlBQWtCO1FBQzFGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFVLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbkgsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBRUgsZUFBZSxDQUFDLFlBQWtCLEVBQUUsWUFBa0I7UUFDcEQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFdBQWdDLEVBQUUsSUFBSSxDQUFDO2FBQ2xGLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDdEMsQ0FBQztDQUNGO0FBaENDO0lBREMsVUFBVSxDQUFDLEtBQUssQ0FBQzt1Q0FHakI7QUFZRDtJQURDLFVBQVUsQ0FBQyxLQUFLLENBQUM7MENBR2pCO0FBWUQ7SUFEQyxVQUFVLENBQUMsS0FBSyxDQUFDOzJDQUlqQiJ9","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { User } from './User';\nimport { Entity } from './Entity';\nimport { enumerable } from '../util/enumerable';\nexport class Role extends Entity {\n    constructor() {\n        super(...arguments);\n        /**\n         * A set of users which have this role\n         */\n        this.users = null;\n        /**\n         * The name of the role\n         */\n        this.name = null;\n    }\n    /**\n     * Test if the given user has this role\n     * @param user The user to check\n     * @return <code>true</code> if the given user has this role,\n     * otherwise <code>false</code>\n     */\n    hasUser(user) {\n        return !!this.users && this.users.has(user);\n    }\n    /**\n     * Add the given user to this role\n     * @param user The user to add\n     */\n    addUser(user) {\n        if (user instanceof User) {\n            if (!this.users) {\n                this.users = new Set();\n            }\n            this.users.add(user);\n        }\n        else {\n            throw new Error('Only user instances can be added to a role.');\n        }\n    }\n    /**\n     * Remove the given user from this role\n     * @param user The user to remove\n     */\n    removeUser(user) {\n        if (user instanceof User) {\n            if (this.users) {\n                this.users.delete(user);\n            }\n        }\n        else {\n            throw new Error('Only user instances can be removed from a role.');\n        }\n    }\n}\n__decorate([\n    enumerable(false)\n], Role.prototype, \"hasUser\", null);\n__decorate([\n    enumerable(false)\n], Role.prototype, \"addUser\", null);\n__decorate([\n    enumerable(false)\n], Role.prototype, \"removeUser\", null);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUm9sZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJvbGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM5QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRCxNQUFNLE9BQU8sSUFBSyxTQUFRLE1BQU07SUFBaEM7O1FBQ0U7O1dBRUc7UUFDSSxVQUFLLEdBQTJCLElBQUksQ0FBQztRQUU1Qzs7V0FFRztRQUNJLFNBQUksR0FBa0IsSUFBSSxDQUFDO0lBNENwQyxDQUFDO0lBMUNDOzs7OztPQUtHO0lBRUgsT0FBTyxDQUFDLElBQWdCO1FBQ3RCLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOzs7T0FHRztJQUVILE9BQU8sQ0FBQyxJQUFnQjtRQUN0QixJQUFJLElBQUksWUFBWSxJQUFJLEVBQUU7WUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO2FBQ3hCO1lBRUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdEI7YUFBTTtZQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztTQUNoRTtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFFSCxVQUFVLENBQUMsSUFBZ0I7UUFDekIsSUFBSSxJQUFJLFlBQVksSUFBSSxFQUFFO1lBQ3hCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QjtTQUNGO2FBQU07WUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLGlEQUFpRCxDQUFDLENBQUM7U0FDcEU7SUFDSCxDQUFDO0NBQ0Y7QUFuQ0M7SUFEQyxVQUFVLENBQUMsS0FBSyxDQUFDO21DQUdqQjtBQU9EO0lBREMsVUFBVSxDQUFDLEtBQUssQ0FBQzttQ0FXakI7QUFPRDtJQURDLFVBQVUsQ0FBQyxLQUFLLENBQUM7c0NBU2pCIn0=","export const isNode = false;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXMtbm9kZS1icm93c2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaXMtbm9kZS1icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMifQ==","export const atob = window.atob.bind(window);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXRvYi1icm93c2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXRvYi1icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyJ9","export function hmac(message, key) {\n    const encoder = new TextEncoder();\n    return Promise.resolve(crypto.subtle.importKey('raw', // raw format of the key - should be Uint8Array\n    encoder.encode(key), {\n        name: 'HMAC',\n        hash: { name: 'SHA-1' },\n    }, false, // export = false\n    ['sign', 'verify']))\n        .then((cryptoKey) => crypto.subtle.sign('HMAC', cryptoKey, encoder.encode(message)))\n        .then((signature) => {\n        const byteArray = new Uint8Array(signature);\n        return byteArray.reduce((token, x) => token + x.toString(16).padStart(2, '0'), '');\n    });\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG1hYy1icm93c2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaG1hYy1icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sVUFBVSxJQUFJLENBQUMsT0FBZSxFQUFFLEdBQVc7SUFDL0MsTUFBTSxPQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztJQUVsQyxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUNyQixLQUFLLEVBQUUsK0NBQStDO0lBQ3RELE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQ25CO1FBQ0UsSUFBSSxFQUFFLE1BQU07UUFDWixJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFO0tBQ3hCLEVBQ0QsS0FBSyxFQUFFLGlCQUFpQjtJQUN4QixDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FDbkIsQ0FDRjtTQUNFLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDbkYsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUU7UUFDbEIsTUFBTSxTQUFTLEdBQUcsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUMsT0FBTyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNyRixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMifQ==","/**\n * This base class provides an lock interface to execute exclusive operations\n */\nexport class Lockable {\n    constructor() {\n        /**\n         * Indicates if there is currently an onging exclusive operation\n         * @type boolean\n         * @private\n         */\n        this.isLocked = false;\n        /**\n         * A promise which represents the state of the least exclusive operation\n         * @type Promise\n         * @private\n         */\n        this.readyPromise = Promise.resolve(this);\n    }\n    /**\n     * Indicates if there is currently no exclusive operation executed\n     * <code>true</code> If no exclusive lock is hold\n     */\n    get isReady() {\n        return !this.isLocked;\n    }\n    /**\n     * Waits on the previously requested operation and calls the doneCallback if the operation is fulfilled\n     * @param doneCallback The callback which will be invoked when the previously\n     * operations on this object is completed.\n     * @param failCallback When the lock can't be released caused by a none\n     * recoverable error\n     * @return A promise which completes successfully, when the previously requested\n     * operation completes\n     */\n    ready(doneCallback, failCallback) {\n        return this.readyPromise.then(doneCallback, failCallback);\n    }\n    /**\n     * Try to aquire an exclusive lock and executes the given callback.\n     * @param callback The exclusive operation to execute\n     * @param [critical=false] Indicates if the operation is critical. If the operation is critical and the\n     * operation fails, then the lock will not be released\n     * @return A promise\n     * @throws If the lock can't be aquired\n     * @protected\n     */\n    withLock(callback, critical = false) {\n        if (this.isLocked) {\n            throw new Error('Current operation has not been finished.');\n        }\n        try {\n            this.isLocked = true;\n            const result = callback().then((res) => {\n                this.isLocked = false;\n                return res;\n            }, (e) => {\n                if (!critical) {\n                    this.isLocked = false;\n                }\n                throw e;\n            });\n            this.readyPromise = result.then(() => this, (e) => {\n                if (!critical) {\n                    return this;\n                }\n                throw e;\n            });\n            return result;\n        }\n        catch (e) {\n            if (critical) {\n                this.readyPromise = Promise.reject(e);\n            }\n            else {\n                this.isLocked = false;\n            }\n            throw e;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9ja2FibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJMb2NrYWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUNILE1BQU0sT0FBTyxRQUFRO0lBS25CO1FBQ0U7Ozs7V0FJRztRQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBRXRCOzs7O1dBSUc7UUFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVEOzs7T0FHRztJQUNILElBQUksT0FBTztRQUNULE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7Ozs7Ozs7T0FRRztJQUNILEtBQUssQ0FBQyxZQUFrQyxFQUFFLFlBQW9DO1FBQzVFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFRDs7Ozs7Ozs7T0FRRztJQUNILFFBQVEsQ0FBSSxRQUEwQixFQUFFLFFBQVEsR0FBRyxLQUFLO1FBQ3RELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7U0FDN0Q7UUFFRCxJQUFJO1lBQ0YsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDckIsTUFBTSxNQUFNLEdBQUcsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ3JDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2dCQUN0QixPQUFPLEdBQUcsQ0FBQztZQUNiLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUNQLElBQUksQ0FBQyxRQUFRLEVBQUU7b0JBQ2IsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7aUJBQ3ZCO2dCQUNELE1BQU0sQ0FBQyxDQUFDO1lBQ1YsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hELElBQUksQ0FBQyxRQUFRLEVBQUU7b0JBQ2IsT0FBTyxJQUFJLENBQUM7aUJBQ2I7Z0JBQ0QsTUFBTSxDQUFDLENBQUM7WUFDVixDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sTUFBTSxDQUFDO1NBQ2Y7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLElBQUksUUFBUSxFQUFFO2dCQUNaLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN2QztpQkFBTTtnQkFDTCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQzthQUN2QjtZQUNELE1BQU0sQ0FBQyxDQUFDO1NBQ1Q7SUFDSCxDQUFDO0NBQ0YifQ==","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import { v4 } from 'uuid';\nconst uuid = v4;\nexport { uuid };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXVpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV1aWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUxQixNQUFNLElBQUksR0FBRyxFQUFVLENBQUM7QUFVeEIsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDIn0=","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","/* eslint-disable no-console */\nconst alreadyWarned = {};\nexport function deprecated(alternativeSignature) {\n    return function decorateProperty(target, name, descriptor = {\n        writable: true,\n        enumerable: false,\n        configurable: true,\n    }) {\n        const type = typeof target === 'string' ? target : target.constructor.name;\n        const deprecatedSignature = `${type}.${name}`;\n        const logWarning = () => {\n            if (!alreadyWarned[deprecatedSignature]) {\n                alreadyWarned[deprecatedSignature] = true;\n                console.warn(`Usage of ${deprecatedSignature} is deprecated, use ${alternativeSignature} instead.`);\n            }\n        };\n        const deprecatedDescriptor = {\n            enumerable: descriptor.enumerable,\n            configurable: descriptor.configurable,\n        };\n        if (descriptor.get || descriptor.set) {\n            if (descriptor.get) {\n                deprecatedDescriptor.get = function get() {\n                    logWarning();\n                    return descriptor.get.call(this);\n                };\n            }\n            if (descriptor.set) {\n                deprecatedDescriptor.set = function set(value) {\n                    logWarning();\n                    return descriptor.set.call(this, value);\n                };\n            }\n        }\n        else {\n            let propertyValue = descriptor.value;\n            deprecatedDescriptor.get = function get() {\n                logWarning();\n                return propertyValue;\n            };\n            if (descriptor.writable) {\n                deprecatedDescriptor.set = function set(value) {\n                    logWarning();\n                    propertyValue = value;\n                };\n            }\n        }\n        return deprecatedDescriptor;\n    };\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVwcmVjYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRlcHJlY2F0ZWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsK0JBQStCO0FBQy9CLE1BQU0sYUFBYSxHQUFtQyxFQUFFLENBQUM7QUFDekQsTUFBTSxVQUFVLFVBQVUsQ0FBQyxvQkFBNEI7SUFDckQsT0FBTyxTQUFTLGdCQUFnQixDQUM5QixNQUF1QixFQUN2QixJQUFZLEVBQ1osYUFBaUM7UUFDL0IsUUFBUSxFQUFFLElBQUk7UUFDZCxVQUFVLEVBQUUsS0FBSztRQUNqQixZQUFZLEVBQUUsSUFBSTtLQUNuQjtRQUVELE1BQU0sSUFBSSxHQUFHLE9BQU8sTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztRQUMzRSxNQUFNLG1CQUFtQixHQUFHLEdBQUcsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzlDLE1BQU0sVUFBVSxHQUFHLEdBQUcsRUFBRTtZQUN0QixJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLEVBQUU7Z0JBQ3ZDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDMUMsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLG1CQUFtQix1QkFBdUIsb0JBQW9CLFdBQVcsQ0FBQyxDQUFDO2FBQ3JHO1FBQ0gsQ0FBQyxDQUFDO1FBRUYsTUFBTSxvQkFBb0IsR0FBdUI7WUFDL0MsVUFBVSxFQUFFLFVBQVUsQ0FBQyxVQUFVO1lBQ2pDLFlBQVksRUFBRSxVQUFVLENBQUMsWUFBWTtTQUN0QyxDQUFDO1FBRUYsSUFBSSxVQUFVLENBQUMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDcEMsSUFBSSxVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNsQixvQkFBb0IsQ0FBQyxHQUFHLEdBQUcsU0FBUyxHQUFHO29CQUNyQyxVQUFVLEVBQUUsQ0FBQztvQkFDYixPQUFPLFVBQVUsQ0FBQyxHQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNwQyxDQUFDLENBQUM7YUFDSDtZQUVELElBQUksVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDbEIsb0JBQW9CLENBQUMsR0FBRyxHQUFHLFNBQVMsR0FBRyxDQUFDLEtBQUs7b0JBQzNDLFVBQVUsRUFBRSxDQUFDO29CQUNiLE9BQU8sVUFBVSxDQUFDLEdBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUMzQyxDQUFDLENBQUM7YUFDSDtTQUNGO2FBQU07WUFDTCxJQUFJLGFBQWEsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO1lBRXJDLG9CQUFvQixDQUFDLEdBQUcsR0FBRyxTQUFTLEdBQUc7Z0JBQ3JDLFVBQVUsRUFBRSxDQUFDO2dCQUNiLE9BQU8sYUFBYSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQztZQUVGLElBQUksVUFBVSxDQUFDLFFBQVEsRUFBRTtnQkFDdkIsb0JBQW9CLENBQUMsR0FBRyxHQUFHLFNBQVMsR0FBRyxDQUFDLEtBQUs7b0JBQzNDLFVBQVUsRUFBRSxDQUFDO29CQUNiLGFBQWEsR0FBRyxLQUFLLENBQUM7Z0JBQ3hCLENBQUMsQ0FBQzthQUNIO1NBQ0Y7UUFFRCxPQUFPLG9CQUFvQixDQUFDO0lBQzlCLENBQUMsQ0FBQztBQUNKLENBQUMifQ==","/**\n * Adds a trailing slash to a string if it is missing\n * @param str\n * @return\n * @name trailingSlashIt\n * @memberOf prototype\n * @function\n */\nexport function trailingSlashIt(str) {\n    if (str.charAt(str.length - 1) !== '/') {\n        return `${str}/`;\n    }\n    return str;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhaWxpbmdTbGFzaEl0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHJhaWxpbmdTbGFzaEl0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0dBT0c7QUFDSCxNQUFNLFVBQVUsZUFBZSxDQUFDLEdBQVc7SUFDekMsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO1FBQ3RDLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQztLQUNsQjtJQUVELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyJ9","export const PersistentError = (() => {\n    function PersistentErrorConstructor(message, cause) {\n        if (Object.prototype.hasOwnProperty.call(Error, 'captureStackTrace')) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n        else {\n            this.stack = (new Error()).stack;\n        }\n        this.message = (message || 'An unexpected persistent error occurred.');\n        this.name = this.constructor.name;\n        if (cause) {\n            this.cause = cause;\n            if (cause.stack) {\n                this.stack += `\\nCaused By: ${cause.stack}`;\n            }\n        }\n    }\n    // custom errors must be manually extended, since JS Errors can't be super called in a class hierarchy,\n    // otherwise the super call destroys the origin 'this' reference\n    PersistentErrorConstructor.prototype = Object.create(Error.prototype, {\n        constructor: {\n            value: PersistentErrorConstructor,\n            writable: true,\n            enumerable: false,\n            configurable: true,\n        },\n    });\n    return PersistentErrorConstructor;\n})();\nPersistentError.of = function of(error) {\n    if (error instanceof PersistentError) {\n        return error;\n    }\n    return new PersistentError(null, error);\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGVyc2lzdGVudEVycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUGVyc2lzdGVudEVycm9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQW9DQSxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FBQyxHQUFHLEVBQUU7SUFDbkMsU0FBUywwQkFBMEIsQ0FBd0IsT0FBc0IsRUFBRSxLQUFhO1FBQzlGLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxtQkFBbUIsQ0FBQyxFQUFFO1lBQ3BFLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ2pEO2FBQU07WUFDTCxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUNsQztRQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLElBQUksMENBQTBDLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDO1FBRWxDLElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7WUFDbkIsSUFBSSxLQUFLLENBQUMsS0FBSyxFQUFFO2dCQUNmLElBQUksQ0FBQyxLQUFLLElBQUksZ0JBQWdCLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUM3QztTQUNGO0lBQ0gsQ0FBQztJQUVELHVHQUF1RztJQUN2RyxnRUFBZ0U7SUFDaEUsMEJBQTBCLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRTtRQUNwRSxXQUFXLEVBQUU7WUFDWCxLQUFLLEVBQUUsMEJBQTBCO1lBQ2pDLFFBQVEsRUFBRSxJQUFJO1lBQ2QsVUFBVSxFQUFFLEtBQUs7WUFDakIsWUFBWSxFQUFFLElBQUk7U0FDbkI7S0FDRixDQUFDLENBQUM7SUFFSCxPQUFPLDBCQUErRCxDQUFDO0FBQ3pFLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFTCxlQUFlLENBQUMsRUFBRSxHQUFHLFNBQVMsRUFBRSxDQUFDLEtBQVk7SUFDM0MsSUFBSSxLQUFLLFlBQVksZUFBZSxFQUFFO1FBQ3BDLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFFRCxPQUFPLElBQUksZUFBZSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMxQyxDQUFDLENBQUMifQ==","import { PersistentError } from './PersistentError';\nexport class CommunicationError extends PersistentError {\n    /**\n     * @param httpMessage The http message which was send\n     * @param response The received entity headers and content\n     */\n    constructor(httpMessage, response) {\n        const entity = response.entity || response.error || {};\n        const state = (response.status === 0 ? 'Request' : 'Response');\n        const message = entity.message\n            || (httpMessage && `Handling the ${state} for ${httpMessage.request.method} ${httpMessage.request.path}`)\n            || 'A communication error occurred.';\n        super(message, entity);\n        this.name = entity.className || 'CommunicationError';\n        this.reason = entity.reason || 'Communication failed';\n        this.status = response.status;\n        if (entity.data) {\n            this.data = entity.data;\n        }\n        let cause = entity;\n        while (cause && cause.stackTrace) {\n            this.stack += `\\nServerside Caused by: ${cause.className} ${cause.message}`;\n            const { stackTrace } = cause;\n            for (let i = 0; i < stackTrace.length; i += 1) {\n                const el = stackTrace[i];\n                this.stack += `\\n    at ${el.className}.${el.methodName}`;\n                this.stack += ` (${el.fileName}:${el.lineNumber})`;\n            }\n            cause = cause.cause;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbXVuaWNhdGlvbkVycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ29tbXVuaWNhdGlvbkVycm9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUlwRCxNQUFNLE9BQU8sa0JBQW1CLFNBQVEsZUFBZTtJQWdCckQ7OztPQUdHO0lBQ0gsWUFBWSxXQUEyQixFQUFFLFFBQWtCO1FBQ3pELE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDdkQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvRCxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsT0FBTztlQUN2QixDQUFDLFdBQVcsSUFBSSxnQkFBZ0IsS0FBSyxRQUFRLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7ZUFDdEcsaUNBQWlDLENBQUM7UUFFekMsS0FBSyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUV2QixJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLElBQUksb0JBQW9CLENBQUM7UUFDckQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxJQUFJLHNCQUFzQixDQUFDO1FBQ3RELElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUU5QixJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUU7WUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7U0FDekI7UUFFRCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUM7UUFDbkIsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLFVBQVUsRUFBRTtZQUNoQyxJQUFJLENBQUMsS0FBSyxJQUFJLDJCQUEyQixLQUFLLENBQUMsU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUU1RSxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBQzdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdDLE1BQU0sRUFBRSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFekIsSUFBSSxDQUFDLEtBQUssSUFBSSxZQUFZLEVBQUUsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUMxRCxJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssRUFBRSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsVUFBVSxHQUFHLENBQUM7YUFDcEQ7WUFFRCxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztTQUNyQjtJQUNILENBQUM7Q0FDRiJ9","import { PersistentError } from './PersistentError';\nexport class IllegalEntityError extends PersistentError {\n    /**\n     * @param entity - The entity which cause the error\n     */\n    constructor(entity) {\n        super(`Entity ${entity} is not a valid entity`);\n        this.entity = entity;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSWxsZWdhbEVudGl0eUVycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSWxsZWdhbEVudGl0eUVycm9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdwRCxNQUFNLE9BQU8sa0JBQW1CLFNBQVEsZUFBZTtJQU1yRDs7T0FFRztJQUNILFlBQVksTUFBYztRQUN4QixLQUFLLENBQUMsVUFBVSxNQUFNLHdCQUF3QixDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsQ0FBQztDQUNGIn0=","import { PersistentError } from './PersistentError';\nexport class EntityExistsError extends PersistentError {\n    /**\n     * @param entity - The entity which cause the error\n     */\n    constructor(entity) {\n        super(`The entity ${entity} is managed by a different db.`);\n        this.entity = entity;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5RXhpc3RzRXJyb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbnRpdHlFeGlzdHNFcnJvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHcEQsTUFBTSxPQUFPLGlCQUFrQixTQUFRLGVBQWU7SUFNcEQ7O09BRUc7SUFDSCxZQUFZLE1BQWM7UUFDeEIsS0FBSyxDQUFDLGNBQWMsTUFBTSxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7Q0FDRiJ9","import { PersistentError } from './PersistentError';\nexport class RollbackError extends PersistentError {\n    constructor(cause) {\n        super('The transaction has been roll backed', cause);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUm9sbGJhY2tFcnJvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJvbGxiYWNrRXJyb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE1BQU0sT0FBTyxhQUFjLFNBQVEsZUFBZTtJQUNoRCxZQUFZLEtBQVk7UUFDdEIsS0FBSyxDQUFDLHNDQUFzQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Q0FDRiJ9","export var PersistenceType;\n(function (PersistenceType) {\n    PersistenceType[PersistenceType[\"BASIC\"] = 0] = \"BASIC\";\n    PersistenceType[PersistenceType[\"EMBEDDABLE\"] = 1] = \"EMBEDDABLE\";\n    PersistenceType[PersistenceType[\"ENTITY\"] = 2] = \"ENTITY\";\n    PersistenceType[PersistenceType[\"MAPPED_SUPERCLASS\"] = 3] = \"MAPPED_SUPERCLASS\";\n})(PersistenceType || (PersistenceType = {}));\nexport class Type {\n    /**\n     * @param ref\n     * @param typeConstructor\n     */\n    constructor(ref, typeConstructor) {\n        if (ref.indexOf('/db/') !== 0) {\n            throw new SyntaxError(`Type ref ${ref} is invalid.`);\n        }\n        this.ref = ref;\n        this.name = ref.substring(4);\n        this._typeConstructor = typeConstructor;\n    }\n    /**\n     * The persistent type of this type\n     */\n    get persistenceType() {\n        return -1;\n    }\n    /**\n     * @type boolean\n     * @readonly\n     */\n    get isBasic() {\n        return this.persistenceType === PersistenceType.BASIC;\n    }\n    /**\n     * @type boolean\n     * @readonly\n     */\n    get isEmbeddable() {\n        return this.persistenceType === PersistenceType.EMBEDDABLE;\n    }\n    /**\n     * @type boolean\n     * @readonly\n     */\n    get isEntity() {\n        return this.persistenceType === PersistenceType.ENTITY;\n    }\n    /**\n     * @type boolean\n     * @readonly\n     */\n    get isMappedSuperclass() {\n        return this.persistenceType === PersistenceType.MAPPED_SUPERCLASS;\n    }\n    /**\n     * The type constructor of this type\n     */\n    get typeConstructor() {\n        return this._typeConstructor;\n    }\n    /**\n     * @param typeConstructor - sets the type constructor of this type if it is not already set\n     */\n    set typeConstructor(typeConstructor) {\n        if (this._typeConstructor) {\n            throw new Error('typeConstructor has already been set.');\n        }\n        this._typeConstructor = typeConstructor;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlR5cGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsTUFBTSxDQUFOLElBQVksZUFLWDtBQUxELFdBQVksZUFBZTtJQUN6Qix1REFBUyxDQUFBO0lBQ1QsaUVBQWMsQ0FBQTtJQUNkLHlEQUFVLENBQUE7SUFDViwrRUFBcUIsQ0FBQTtBQUN2QixDQUFDLEVBTFcsZUFBZSxLQUFmLGVBQWUsUUFLMUI7QUFFRCxNQUFNLE9BQWdCLElBQUk7SUFpRXhCOzs7T0FHRztJQUNILFlBQXNCLEdBQVcsRUFBRSxlQUEwQjtRQUMzRCxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzdCLE1BQU0sSUFBSSxXQUFXLENBQUMsWUFBWSxHQUFHLGNBQWMsQ0FBQyxDQUFDO1NBQ3REO1FBRUQsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztJQUMxQyxDQUFDO0lBcEVEOztPQUVHO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDWixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsZUFBZSxLQUFLLGVBQWUsQ0FBQyxLQUFLLENBQUM7SUFDeEQsQ0FBQztJQUVEOzs7T0FHRztJQUNILElBQUksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLGVBQWUsS0FBSyxlQUFlLENBQUMsVUFBVSxDQUFDO0lBQzdELENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxlQUFlLEtBQUssZUFBZSxDQUFDLE1BQU0sQ0FBQztJQUN6RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxrQkFBa0I7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxLQUFLLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQztJQUNwRSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLGVBQWU7UUFDakIsT0FBTyxJQUFJLENBQUMsZ0JBQWtCLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxlQUFlLENBQUMsZUFBeUI7UUFDM0MsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDekIsTUFBTSxJQUFJLEtBQUssQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1NBQzFEO1FBQ0QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztJQUMxQyxDQUFDO0NBNENGIn0=","import { Type } from './Type';\nimport { Enhancer, Entity, Managed, } from '../binding';\nimport { Permission } from '../intersection';\nexport class ManagedType extends Type {\n    /**\n     * @param ref or full class name\n     * @param typeConstructor The type constructor of the managed lass\n     */\n    constructor(ref, typeConstructor) {\n        super(ref.indexOf('/db/') !== 0 ? `/db/${ref}` : ref, typeConstructor);\n        this.enhancer = null;\n        this.declaredAttributes = [];\n        this.schemaAddPermission = new Permission();\n        this.schemaReplacePermission = new Permission();\n        this.metadata = null;\n        this.superType = null;\n        this._validationCode = null;\n    }\n    /**\n     * @type Function\n     */\n    get validationCode() {\n        return this._validationCode;\n    }\n    /**\n     * @param code\n     */\n    set validationCode(code) {\n        this._validationCode = code;\n    }\n    /**\n     * The Managed class\n     */\n    get typeConstructor() {\n        if (!this._typeConstructor) {\n            this.typeConstructor = this.createProxyClass();\n        }\n        return this._typeConstructor;\n    }\n    /**\n     * The Managed class constructor\n     * @param typeConstructor The managed class constructor\n     */\n    set typeConstructor(typeConstructor) {\n        if (this._typeConstructor) {\n            throw new Error('Type constructor has already been set.');\n        }\n        const isEntity = typeConstructor.prototype instanceof Entity;\n        if (this.isEntity) {\n            if (!isEntity) {\n                throw new TypeError('Entity classes must extends the Entity class.');\n            }\n        }\n        else if (!(typeConstructor.prototype instanceof Managed) || isEntity) {\n            throw new TypeError('Embeddable classes must extends the Managed class.');\n        }\n        this.enhancer.enhance(this, typeConstructor);\n        this._typeConstructor = typeConstructor;\n    }\n    /**\n     * Initialize this type\n     * @param enhancer The class enhancer used to instantiate an instance of this managed class\n     */\n    init(enhancer) {\n        this.enhancer = enhancer;\n        if (this._typeConstructor && !Enhancer.getIdentifier(this._typeConstructor)) {\n            Enhancer.setIdentifier(this._typeConstructor, this.ref);\n        }\n    }\n    /**\n     * Creates a new instance of the managed type, without invoking any constructors\n     *\n     * This method is used to create object instances which are loaded form the backend.\n     *\n     * @return The created instance\n     */\n    create() {\n        const instance = Object.create(this.typeConstructor.prototype);\n        Managed.init(instance);\n        return instance;\n    }\n    /**\n     * An iterator which returns all attributes declared by this type and inherited form all super types\n     * @return\n     */\n    attributes() {\n        let iter;\n        let index = 0;\n        const type = this;\n        if (this.superType) {\n            iter = this.superType.attributes();\n        }\n        return {\n            [Symbol.iterator]() {\n                return this;\n            },\n            next() {\n                if (iter) {\n                    const item = iter.next();\n                    if (!item.done) {\n                        return item;\n                    }\n                    iter = null;\n                }\n                if (index < type.declaredAttributes.length) {\n                    const value = type.declaredAttributes[index];\n                    index += 1;\n                    return { value, done: false };\n                }\n                return { done: true, value: undefined };\n            },\n        };\n    }\n    /**\n     * Adds an attribute to this type\n     * @param attr The attribute to add\n     * @param order Position of the attribute\n     * @return\n     */\n    addAttribute(attr, order) {\n        if (this.getAttribute(attr.name)) {\n            throw new Error(`An attribute with the name ${attr.name} is already declared.`);\n        }\n        let initOrder;\n        if (!attr.order) {\n            initOrder = typeof order === 'undefined' ? this.declaredAttributes.length : order;\n        }\n        else {\n            initOrder = attr.order;\n        }\n        attr.init(this, initOrder);\n        this.declaredAttributes.push(attr);\n        if (this._typeConstructor && this.name !== 'Object') {\n            this.enhancer.enhanceProperty(this._typeConstructor, attr);\n        }\n    }\n    /**\n     * Removes an attribute from this type\n     * @param name The Name of the attribute which will be removed\n     * @return\n     */\n    removeAttribute(name) {\n        const { length } = this.declaredAttributes;\n        this.declaredAttributes = this.declaredAttributes.filter((val) => val.name !== name);\n        if (length === this.declaredAttributes.length) {\n            throw new Error(`An Attribute with the name ${name} is not declared.`);\n        }\n    }\n    /**\n     * @param name\n     * @return\n     */\n    getAttribute(name) {\n        let attr = this.getDeclaredAttribute(name);\n        if (!attr && this.superType) {\n            attr = this.superType.getAttribute(name);\n        }\n        return attr;\n    }\n    /**\n     * @param val Name or order of the attribute\n     * @return\n     */\n    getDeclaredAttribute(val) {\n        return this.declaredAttributes.filter((attr) => attr.name === val || attr.order === val)[0] || null;\n    }\n    /**\n     * @inheritDoc\n     */\n    fromJsonValue(state, jsonObject, currentObject, options) {\n        if (!jsonObject || !currentObject) {\n            return null;\n        }\n        const iter = this.attributes();\n        for (let el = iter.next(); !el.done; el = iter.next()) {\n            const attribute = el.value;\n            if (!options.onlyMetadata || attribute.isMetadata) {\n                attribute.setJsonValue(state, currentObject, jsonObject[attribute.name], options);\n            }\n        }\n        return currentObject;\n    }\n    /**\n     * @inheritDoc\n     */\n    toJsonValue(state, object, options) {\n        if (!(object instanceof this.typeConstructor)) {\n            return null;\n        }\n        const value = {};\n        const iter = this.attributes();\n        for (let el = iter.next(); !el.done; el = iter.next()) {\n            const attribute = el.value;\n            if (!options.excludeMetadata || !attribute.isMetadata) {\n                value[attribute.name] = attribute.getJsonValue(state, object, options);\n            }\n        }\n        return value;\n    }\n    /**\n     * Converts ths type schema to json\n     * @return\n     */\n    toJSON() {\n        const fields = {};\n        this.declaredAttributes.forEach((attribute) => {\n            if (!attribute.isMetadata) {\n                fields[attribute.name] = attribute;\n            }\n        });\n        return Object.assign(Object.assign(Object.assign({ class: this.ref, fields, acl: {\n                schemaAdd: this.schemaAddPermission.toJSON(),\n                schemaReplace: this.schemaReplacePermission.toJSON(),\n            } }, (this.superType && { superClass: this.superType.ref })), (this.isEmbeddable && { embedded: true })), (this.metadata && { metadata: this.metadata }));\n    }\n    /**\n     * Returns iterator to get all referenced entities\n     * @return\n     */\n    references() {\n        const attributes = this.attributes();\n        let attribute;\n        let embeddedAttributes;\n        return {\n            [Symbol.iterator]() {\n                return this;\n            },\n            next() {\n                for (;;) {\n                    if (embeddedAttributes) {\n                        const item = embeddedAttributes.next();\n                        if (!item.done) {\n                            return { value: { path: [attribute.name].concat(item.value.path) } };\n                        }\n                        embeddedAttributes = null;\n                    }\n                    const item = attributes.next();\n                    if (item.done) {\n                        // currently TS requires a undefined value here https://github.com/microsoft/TypeScript/issues/38479\n                        return { done: true, value: undefined };\n                    }\n                    attribute = item.value;\n                    const type = attribute.isCollection\n                        ? attribute.elementType\n                        : attribute.type;\n                    if (type.isEntity) {\n                        return { value: { path: [attribute.name] } };\n                    }\n                    if (type.isEmbeddable) {\n                        embeddedAttributes = type.references();\n                    }\n                }\n            },\n        };\n    }\n    /**\n     * Retrieves whether this type has specific metadata\n     *\n     * @param key\n     * @return\n     */\n    hasMetadata(key) {\n        return !!this.metadata && !!this.metadata[key];\n    }\n    /**\n     * Gets some metadata of this type\n     *\n     * @param key\n     * @return\n     */\n    getMetadata(key) {\n        if (!this.hasMetadata(key)) {\n            return null;\n        }\n        return this.metadata[key];\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFuYWdlZFR5cGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJNYW5hZ2VkVHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRTlCLE9BQU8sRUFDTCxRQUFRLEVBQUUsTUFBTSxFQUFFLE9BQU8sR0FDMUIsTUFBTSxZQUFZLENBQUM7QUFPcEIsT0FBTyxFQUFFLFVBQVUsRUFBZ0IsTUFBTSxpQkFBaUIsQ0FBQztBQUUzRCxNQUFNLE9BQWdCLFdBQStCLFNBQVEsSUFBTztJQTZEbEU7OztPQUdHO0lBQ0gsWUFBWSxHQUFXLEVBQUUsZUFBMEI7UUFDakQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFqRWxFLGFBQVEsR0FBb0IsSUFBSSxDQUFDO1FBRWpDLHVCQUFrQixHQUFxQixFQUFFLENBQUM7UUFFMUMsd0JBQW1CLEdBQWUsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUVuRCw0QkFBdUIsR0FBZSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBRXZELGFBQVEsR0FBbUMsSUFBSSxDQUFDO1FBRWhELGNBQVMsR0FBMkIsSUFBSSxDQUFDO1FBRXpDLG9CQUFlLEdBQW9CLElBQUksQ0FBQztJQXNEL0MsQ0FBQztJQXBERDs7T0FFRztJQUNILElBQUksY0FBYztRQUNoQixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxjQUFjLENBQUMsSUFBcUI7UUFDdEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDMUIs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","import { Accessor } from '../binding';\nexport var PersistentAttributeType;\n(function (PersistentAttributeType) {\n    PersistentAttributeType[PersistentAttributeType[\"BASIC\"] = 0] = \"BASIC\";\n    PersistentAttributeType[PersistentAttributeType[\"ELEMENT_COLLECTION\"] = 1] = \"ELEMENT_COLLECTION\";\n    PersistentAttributeType[PersistentAttributeType[\"EMBEDDED\"] = 2] = \"EMBEDDED\";\n    PersistentAttributeType[PersistentAttributeType[\"MANY_TO_MANY\"] = 3] = \"MANY_TO_MANY\";\n    PersistentAttributeType[PersistentAttributeType[\"MANY_TO_ONE\"] = 4] = \"MANY_TO_ONE\";\n    PersistentAttributeType[PersistentAttributeType[\"ONE_TO_MANY\"] = 5] = \"ONE_TO_MANY\";\n    PersistentAttributeType[PersistentAttributeType[\"ONE_TO_ONE\"] = 6] = \"ONE_TO_ONE\";\n})(PersistentAttributeType || (PersistentAttributeType = {}));\nconst ATTACHED_STATE = Symbol('AttachedState');\nconst ATTACHED_SIZE = Symbol('AttachedSize');\nexport class Attribute {\n    /**\n     * @param name The attribute name\n     * @param isMetadata <code>true</code> if the attribute is an metadata attribute\n     */\n    constructor(name, isMetadata) {\n        this.isId = false;\n        this.isVersion = false;\n        this.isAcl = false;\n        this.order = null;\n        this.accessor = null;\n        this.declaringType = null;\n        this.metadata = null;\n        this.isMetadata = !!isMetadata;\n        this.name = name;\n    }\n    static attachState(obj, state, overwriteExistingValue = false) {\n        if (state !== undefined && (overwriteExistingValue || obj[ATTACHED_STATE] === undefined)) {\n            // ensure that this property is not visible on browsers which do not support Symbols\n            Object.defineProperty(obj, ATTACHED_STATE, { value: state, configurable: true });\n        }\n        return obj[ATTACHED_STATE];\n    }\n    /**\n     * Attach and returns the the given size on the collection, in a meaner that it isn't enumerable\n     * @param {Set<*>|Map<*,*>} collection The collection where the size is attached on\n     * @param {number} size The size which should be attached, the previously attached size will be\n     * returned if omitted\n     * @return {number} The actual or new attached size whenever a new size was provided or not\n     */\n    static attachSize(collection, size) {\n        if (size !== undefined) {\n            // ensure that this property is not visible on browsers which do not support Symbols\n            Object.defineProperty(collection, ATTACHED_SIZE, { value: size, configurable: true });\n        }\n        return collection[ATTACHED_SIZE] || -1;\n    }\n    /**\n     * Returns the persistent attribute type\n     */\n    get persistentAttributeType() {\n        return -1;\n    }\n    /**\n     * @type boolean\n     * @readonly\n     */\n    get isAssociation() {\n        return this.persistentAttributeType > PersistentAttributeType.EMBEDDED;\n    }\n    get isCollection() {\n        return this.persistentAttributeType === PersistentAttributeType.ELEMENT_COLLECTION;\n    }\n    /**\n     * @param declaringType The type that owns this attribute\n     * @param order Position of the attribute\n     * @return\n     */\n    init(declaringType, order) {\n        if (this.declaringType) {\n            throw new Error('The attribute is already initialized.');\n        }\n        this.order = order;\n        this.accessor = new Accessor();\n        this.declaringType = declaringType;\n    }\n    /**\n     * @param entity\n     * @return\n     */\n    getValue(entity) {\n        return this.accessor.getValue(entity, this);\n    }\n    /**\n     * @param entity\n     * @param value\n     */\n    setValue(entity, value) {\n        this.accessor.setValue(entity, this, value);\n    }\n    /**\n     * Retrieves whether this type has specific metadata\n     *\n     * @param key\n     * @return\n     */\n    hasMetadata(key) {\n        return !!this.metadata && key in this.metadata;\n    }\n    /**\n     * Gets some metadata of this type\n     *\n     * @param key\n     * @return\n     */\n    getMetadata(key) {\n        if (!this.hasMetadata(key)) {\n            return null;\n        }\n        return this.metadata[key] || null;\n    }\n    /**\n     * Converts this attribute field to json\n     * @return The attribute description as json\n     */\n    toJSON() {\n        return Object.assign({ name: this.name, order: this.order }, (this.metadata && { metadata: this.metadata }));\n    }\n}\nAttribute.PersistentAttributeType = PersistentAttributeType;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXR0cmlidXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQXR0cmlidXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQVcsTUFBTSxZQUFZLENBQUM7QUFLL0MsTUFBTSxDQUFOLElBQVksdUJBUVg7QUFSRCxXQUFZLHVCQUF1QjtJQUNqQyx1RUFBUyxDQUFBO0lBQ1QsaUdBQXNCLENBQUE7SUFDdEIsNkVBQVksQ0FBQTtJQUNaLHFGQUFnQixDQUFBO0lBQ2hCLG1GQUFlLENBQUE7SUFDZixtRkFBZSxDQUFBO0lBQ2YsaUZBQWMsQ0FBQTtBQUNoQixDQUFDLEVBUlcsdUJBQXVCLEtBQXZCLHVCQUF1QixRQVFsQztBQUVELE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUMvQyxNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7QUFFN0MsTUFBTSxPQUFnQixTQUFTO0lBa0Y3Qjs7O09BR0c7SUFDSCxZQUFzQixJQUFZLEVBQUUsVUFBb0I7UUFqRmpELFNBQUksR0FBRyxLQUFLLENBQUM7UUFFYixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBRWxCLFVBQUssR0FBRyxLQUFLLENBQUM7UUFJZCxVQUFLLEdBQWtCLElBQUksQ0FBQztRQUU1QixhQUFRLEdBQW9CLElBQUksQ0FBQztRQUVqQyxrQkFBYSxHQUE0QixJQUFJLENBQUM7UUFFOUMsYUFBUSxHQUFvQyxJQUFJLENBQUM7UUFvRXRELElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUMvQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNuQixDQUFDO0lBbERELE1BQU0sQ0FBQyxXQUFXLENBQUksR0FBb0QsRUFBRSxLQUFTLEVBQ25GLHlCQUFrQyxLQUFLO1FBQ3ZDLElBQUksS0FBSyxLQUFLLFNBQVMsSUFBSSxDQUFDLHNCQUFzQixJQUFLLEdBQVcsQ0FBQyxjQUFj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","import { File } from '../binding';\nimport { GeoPoint } from '../GeoPoint';\nimport { PersistenceType, Type } from './Type';\nfunction dateToJson(value) {\n    // remove trailing zeros\n    return value instanceof Date ? value.toISOString().replace(/\\.?0*Z/, 'Z') : null;\n}\nfunction jsonToDate(json, currentValue) {\n    const date = typeof json === 'string' ? new Date(json) : null;\n    if (currentValue && date) {\n        // compare normalized date strings instead of plain strings\n        return currentValue.toISOString() === date.toISOString() ? currentValue : date;\n    }\n    return date;\n}\nexport class BasicType extends Type {\n    /**\n     * Creates a new instance of a native db type\n     * @param ref The db ref of this type\n     * @param typeConstructor The javascript class of this type\n     * @param noResolving Indicates if this type is not the main type of the constructor\n     */\n    constructor(ref, typeConstructor, noResolving) {\n        const id = ref.indexOf('/db/') === 0 ? ref : `/db/${ref}`;\n        super(id, typeConstructor);\n        this.noResolving = !!noResolving;\n    }\n    /**\n     * @inheritDoc\n     */\n    get persistenceType() {\n        return PersistenceType.BASIC;\n    }\n    /**\n     * @inheritDoc\n     */\n    toJsonValue(state, currentValue) {\n        return currentValue === null || currentValue === undefined ? null : this.typeConstructor(currentValue);\n    }\n    /**\n     * @inheritDoc\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    fromJsonValue(state, json, currentValue) {\n        return json === null || json === undefined ? null : json;\n    }\n    toString() {\n        return `BasicType(${this.ref})`;\n    }\n}\nBasicType.Boolean = new class BooleanType extends BasicType {\n    fromJsonValue(state, json, currentValue) {\n        return typeof json === 'string' ? json !== 'false' : super.fromJsonValue(state, json, currentValue);\n    }\n}('Boolean', Boolean);\nBasicType.Double = new class DoubleType extends BasicType {\n    fromJsonValue(state, json, currentValue) {\n        return typeof json === 'string' ? parseFloat(json) : super.fromJsonValue(state, json, currentValue);\n    }\n}('Double', Number);\nBasicType.Integer = new class IntegerType extends BasicType {\n    fromJsonValue(state, json, currentValue) {\n        return typeof json === 'string' ? parseInt(json, 10) : super.fromJsonValue(state, json, currentValue);\n    }\n}('Integer', Number);\nBasicType.String = new class StringType extends BasicType {\n}('String', String);\nBasicType.DateTime = new class DateTimeType extends BasicType {\n    toJsonValue(state, value) {\n        return dateToJson(value);\n    }\n    fromJsonValue(state, json, currentValue) {\n        return jsonToDate(json, currentValue);\n    }\n}('DateTime', Date);\nBasicType.Date = new class DateType extends BasicType {\n    toJsonValue(state, value) {\n        const json = dateToJson(value);\n        return json ? json.substring(0, json.indexOf('T')) : null;\n    }\n    fromJsonValue(state, json, currentValue) {\n        return jsonToDate(json, currentValue);\n    }\n}('Date', Date);\nBasicType.Time = new class TimeType extends BasicType {\n    toJsonValue(state, value) {\n        const json = dateToJson(value);\n        return json ? json.substring(json.indexOf('T') + 1) : null;\n    }\n    fromJsonValue(state, json, currentValue) {\n        return typeof json === 'string' ? jsonToDate(`1970-01-01T${json}`, currentValue) : null;\n    }\n}('Time', Date);\nBasicType.File = new class FileType extends BasicType {\n    toJsonValue(state, value) {\n        return value instanceof File ? value.id : null;\n    }\n    fromJsonValue(state, json, currentValue) {\n        if (!json) {\n            return null;\n        }\n        if (currentValue && currentValue.id === json) {\n            return currentValue;\n        }\n        if (state.db) {\n            return new state.db.File(json);\n        }\n        return null;\n    }\n}('File', File);\nBasicType.GeoPoint = new class GeoPointType extends BasicType {\n    toJsonValue(state, value) {\n        return value instanceof GeoPoint ? value.toJSON() : null;\n    }\n    fromJsonValue(state, json) {\n        return json ? new GeoPoint(json) : null;\n    }\n}('GeoPoint', GeoPoint);\nBasicType.JsonArray = new class JsonArrayType extends BasicType {\n    toJsonValue(state, value) {\n        return Array.isArray(value) ? value : null;\n    }\n    fromJsonValue(state, json) {\n        return Array.isArray(json) ? json : null;\n    }\n}('JsonArray', Array);\nBasicType.JsonObject = new class JsonObjectType extends BasicType {\n    toJsonValue(state, value) {\n        if (value && value.constructor === Object) {\n            return value;\n        }\n        return null;\n    }\n}('JsonObject', Object);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzaWNUeXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQmFzaWNUeXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDbEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUcvQyxTQUFTLFVBQVUsQ0FBQyxLQUFrQjtJQUNwQyx3QkFBd0I7SUFDeEIsT0FBTyxLQUFLLFlBQVksSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ25GLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxJQUFVLEVBQUUsWUFBeUI7SUFDdkQsTUFBTSxJQUFJLEdBQUcsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQzlELElBQUksWUFBWSxJQUFJLElBQUksRUFBRTtRQUN4QiwyREFBMkQ7UUFDM0QsT0FBTyxZQUFZLENBQUMsV0FBVyxFQUFFLEtBQUssSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztLQUNoRjtJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELE1BQU0sT0FBTyxTQUFhLFNBQVEsSUFBTztJQXFIdkM7Ozs7O09BS0c7SUFDSCxZQUFZLEdBQVcsRUFBRSxlQUF5QixFQUFFLFdBQXFCO1FBQ3ZFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FB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","import { Attribute, PersistentAttributeType } from './Attribute';\nimport { PersistenceType } from './Type';\nexport class SingularAttribute extends Attribute {\n    /**\n     * @param name\n     * @param type\n     * @param isMetadata <code>true</code> if the attribute is an metadata attribute\n     */\n    constructor(name, type, isMetadata) {\n        super(name, isMetadata);\n        this.type = type;\n    }\n    /**\n     * The constructor of the element type of this attribute\n     */\n    get typeConstructor() {\n        return this.type.typeConstructor;\n    }\n    /**\n     * @inheritDoc\n     */\n    get persistentAttributeType() {\n        switch (this.type.persistenceType) {\n            case PersistenceType.BASIC:\n                return PersistentAttributeType.BASIC;\n            case PersistenceType.EMBEDDABLE:\n                return PersistentAttributeType.EMBEDDED;\n            case PersistenceType.ENTITY:\n                return PersistentAttributeType.ONE_TO_MANY;\n            default:\n                throw new Error('Unknown persistent attribute type.');\n        }\n    }\n    /**\n     * @inheritDoc\n     */\n    getJsonValue(state, object, options) {\n        const persistedState = Attribute.attachState(object, {});\n        const value = this.getValue(object);\n        const changed = persistedState[this.name] !== value;\n        if (options.persisting) {\n            persistedState[this.name] = value;\n        }\n        if (changed) {\n            state.setDirty();\n        }\n        return this.type.toJsonValue(state, value, options);\n    }\n    /**\n     * @inheritDoc\n     */\n    setJsonValue(state, object, jsonValue, options) {\n        const value = this.type.fromJsonValue(state, jsonValue, this.getValue(object), options);\n        if (options.persisting) {\n            const persistedState = Attribute.attachState(object, {});\n            persistedState[this.name] = value;\n        }\n        this.setValue(object, value);\n    }\n    /**\n     * @inheritDoc\n     */\n    toJSON() {\n        return Object.assign({ type: this.type.ref }, super.toJSON());\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2luZ3VsYXJBdHRyaWJ1dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTaW5ndWxhckF0dHJpYnV0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQVEsTUFBTSxRQUFRLENBQUM7QUFPL0MsTUFBTSxPQUFPLGlCQUFxQixTQUFRLFNBQVk7SUEwQnBEOzs7O09BSUc7SUFDSCxZQUFZLElBQVksRUFBRSxJQUFhLEVBQUUsVUFBb0I7UUFDM0QsS0FBSyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNuQixDQUFDO0lBL0JEOztPQUVHO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSx1QkFBdUI7UUFDekIsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUNqQyxLQUFLLGVBQWUsQ0FBQyxLQUFLO2dCQUN4QixPQUFPLHVCQUF1QixDQUFDLEtBQUssQ0FBQztZQUN2QyxLQUFLLGVBQWUsQ0FBQyxVQUFVO2dCQUM3QixPQUFPLHVCQUF1QixDQUFDLFFBQVEsQ0FBQztZQUMxQyxLQUFLLGVBQWUsQ0FBQyxNQUFNO2dCQUN6QixPQUFPLHVCQUF1QixDQUFDLFdBQVcsQ0FBQztZQUM3QztnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7U0FDekQ7SUFDSCxDQUFDO0lBWUQ7O09BRUc7SUFDSCxZQUFZLENBQUMsS0FBbUIsRUFBRSxNQUFlLEVBQy9DLE9BQXFGO1FBQ3JGLE1BQU0sY0FBYyxHQUEyQixTQUFTLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqRixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sT0FBTyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDO1FBRXBELElBQUksT0FBTyxDQUFDLFVBQVUsRUFBRTtZQUN0QixjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUNuQztRQUVELElBQUksT0FBTyxFQUFFO1lBQ1gsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2xCO1FBRUQsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRDs7T0FFRztJQUNILFlBQVksQ0FBQyxLQUFtQixFQUFFLE1BQWUsRUFBRSxTQUFlLEVBQ2hFLE9BQXdEO1FBQ3hELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV4RixJQUFJLE9BQU8sQ0FBQyxVQUFVLEVBQUU7WUFDdEIsTUFBTSxjQUFjLEdBQTJCLFNBQVMsQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ2pGLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQ25DO1FBRUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTTtRQUNKLHVCQUNFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFDaEIsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUNqQjtJQUNKLENBQUM7Q0FDRiJ9","import { Attribute, PersistentAttributeType } from './Attribute';\nexport var CollectionType;\n(function (CollectionType) {\n    CollectionType[CollectionType[\"COLLECTION\"] = 0] = \"COLLECTION\";\n    CollectionType[CollectionType[\"LIST\"] = 1] = \"LIST\";\n    CollectionType[CollectionType[\"MAP\"] = 2] = \"MAP\";\n    CollectionType[CollectionType[\"SET\"] = 3] = \"SET\";\n})(CollectionType || (CollectionType = {}));\nexport class PluralAttribute extends Attribute {\n    /**\n     * @param name - The attribute name\n     * @param typeConstructor - The collection constructor of the attribute\n     * @param elementType - The type of the elements of the attribute collection\n     */\n    constructor(name, typeConstructor, elementType) {\n        super(name);\n        this.elementType = elementType;\n        this.typeConstructor = typeConstructor;\n    }\n    /**\n     * @inheritDoc\n     */\n    get persistentAttributeType() {\n        return PersistentAttributeType.ELEMENT_COLLECTION;\n    }\n    /**\n     * Retrieves a serialized string value of the given json which can be used as object keys\n     * @param json The json of which the key should be retrieved\n     * @return A serialized version of the json\n     */\n    keyValue(json) {\n        if (json && typeof json === 'object' && 'id' in json) {\n            return String(json.id);\n        }\n        return String(json);\n    }\n}\nPluralAttribute.CollectionType = CollectionType;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGx1cmFsQXR0cmlidXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUGx1cmFsQXR0cmlidXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFakUsTUFBTSxDQUFOLElBQVksY0FLWDtBQUxELFdBQVksY0FBYztJQUN4QiwrREFBYyxDQUFBO0lBQ2QsbURBQVEsQ0FBQTtJQUNSLGlEQUFPLENBQUE7SUFDUCxpREFBTyxDQUFBO0FBQ1QsQ0FBQyxFQUxXLGNBQWMsS0FBZCxjQUFjLFFBS3pCO0FBRUQsTUFBTSxPQUFnQixlQUFzQixTQUFRLFNBQVk7SUFtQjlEOzs7O09BSUc7SUFDSCxZQUFzQixJQUFZLEVBQUUsZUFBeUIsRUFBRSxXQUFvQjtRQUNqRixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztJQUN6QyxDQUFDO0lBaEJEOztPQUVHO0lBQ0gsSUFBSSx1QkFBdUI7UUFDekIsT0FBTyx1QkFBdUIsQ0FBQyxrQkFBa0IsQ0FBQztJQUNwRCxDQUFDO0lBYUQ7Ozs7T0FJRztJQUNPLFFBQVEsQ0FBQyxJQUFVO1FBQzNCLElBQUksSUFBSSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO1lBQ3BELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUN4QjtRQUVELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7O0FBeENzQiw4QkFBYyxHQUFHLGNBQWMsQ0FBQyJ9","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n// eslint-disable-next-line max-classes-per-file\nimport { DeviceFactory, Entity, EntityFactory, Role, User, UserFactory, } from '../binding';\nimport { ManagedType } from './ManagedType';\nimport { PersistenceType } from './Type';\nimport { BasicType } from './BasicType';\nimport { SingularAttribute } from './SingularAttribute';\nimport { PluralAttribute } from './PluralAttribute';\nimport { Attribute } from './Attribute';\nimport { Metadata, Permission } from '../intersection';\nexport class EntityType extends ManagedType {\n    /**\n     * @param ref\n     * @param superType\n     * @param typeConstructor\n     */\n    constructor(ref, superType, typeConstructor) {\n        super(ref, typeConstructor);\n        this.declaredId = null;\n        this.declaredVersion = null;\n        this.declaredAcl = null;\n        this.loadPermission = new Permission();\n        this.updatePermission = new Permission();\n        this.deletePermission = new Permission();\n        this.queryPermission = new Permission();\n        this.schemaSubclassPermission = new Permission();\n        this.insertPermission = new Permission();\n        this.superType = superType;\n    }\n    /**\n     * @inheritDoc\n     */\n    get persistenceType() {\n        return PersistenceType.ENTITY;\n    }\n    get id() {\n        return this.declaredId || this.superType.id;\n    }\n    get version() {\n        return this.declaredVersion || this.superType.version;\n    }\n    get acl() {\n        return this.declaredAcl || this.superType.acl;\n    }\n    /**\n     * @inheritDoc\n     */\n    createProxyClass() {\n        let { typeConstructor } = this.superType;\n        if (typeConstructor === Object) {\n            switch (this.name) {\n                case 'User':\n                    typeConstructor = User;\n                    break;\n                case 'Role':\n                    typeConstructor = Role;\n                    break;\n                default:\n                    typeConstructor = Entity;\n                    break;\n            }\n        }\n        return this.enhancer.createProxy(typeConstructor);\n    }\n    /**\n     * Gets all on this class referencing attributes\n     *\n     * @param db The instances will be found by this EntityManager\n     * @param [options] Some options to pass\n     * @param [options.classes] An array of class names to filter for, null for no filter\n     * @return A map from every referencing class to a set of its referencing attribute names\n     */\n    getReferencing(db, options) {\n        const opts = Object.assign({}, options);\n        const { entities } = db.metamodel;\n        const referencing = new Map();\n        const names = Object.keys(entities);\n        for (let i = 0, len = names.length; i < len; i += 1) {\n            const name = names[i];\n            // Skip class if not in class filter\n            if (!opts.classes || opts.classes.indexOf(name) !== -1) {\n                const entity = entities[name];\n                const iter = entity.attributes();\n                for (let el = iter.next(); !el.done; el = iter.next()) {\n                    const attr = el.value;\n                    // Filter only referencing singular and collection attributes\n                    if ((attr instanceof SingularAttribute && attr.type === this)\n                        || (attr instanceof PluralAttribute && attr.elementType === this)) {\n                        const typeReferences = referencing.get(attr.declaringType) || new Set();\n                        typeReferences.add(attr.name);\n                        referencing.set(attr.declaringType, typeReferences);\n                    }\n                }\n            }\n        }\n        return referencing;\n    }\n    /**\n     * @inheritDoc\n     */\n    createObjectFactory(db) {\n        switch (this.name) {\n            case 'User':\n                return UserFactory.create(this, db);\n            case 'Device':\n                return DeviceFactory.create(this, db);\n            default:\n                return EntityFactory.create(this, db);\n        }\n    }\n    /**\n     * @param state The root object state, can be <code>null</code> if a currentObject is provided\n     * @param jsonObject The json data to merge\n     * @param currentObject The object where the jsonObject will be merged into, if the current object is null,\n     * a new instance will be created\n     * @param options The options used to apply the json\n     * @param [options.persisting=false] indicates if the current state will be persisted.\n     * Used to update the internal change tracking state of collections and mark the object persistent or dirty afterwards\n     * @param [options.onlyMetadata=false] Indicates if only the metadata should be updated\n     * @return The merged entity instance\n     */\n    fromJsonValue(state, jsonObject, currentObject, options) {\n        var _a, _b;\n        // handle references\n        if (typeof jsonObject === 'string') {\n            return ((_a = state.db) === null || _a === void 0 ? void 0 : _a.getReference(jsonObject)) || null;\n        }\n        if (!jsonObject || typeof jsonObject !== 'object') {\n            return null;\n        }\n        const json = jsonObject;\n        const opt = Object.assign({ persisting: false, onlyMetadata: false }, options);\n        let obj;\n        if (currentObject) {\n            const currentObjectState = Metadata.get(currentObject);\n            // merge state into the current object if:\n            // 1. The provided json does not contains an id and we have an already created object for it\n            // 2. The object was created without an id and was later fetched from the server (e.g. User/Role)\n            // 3. The provided json has the same id as the current object, they can differ on embedded json for a reference\n            if (!json.id || !currentObjectState.id || json.id === currentObjectState.id) {\n                obj = currentObject;\n            }\n        }\n        if (!obj) {\n            obj = (_b = state.db) === null || _b === void 0 ? void 0 : _b.getReference(this.typeConstructor, json.id);\n        }\n        if (!obj) {\n            return null;\n        }\n        const objectState = Metadata.get(obj);\n        // deserialize our properties\n        objectState.enable(false);\n        super.fromJsonValue(objectState, json, obj, opt);\n        objectState.enable(true);\n        if (opt.persisting) {\n            objectState.setPersistent();\n        }\n        else if (!opt.onlyMetadata) {\n            objectState.setDirty();\n        }\n        return obj;\n    }\n    /**\n     * Converts the given object to json\n     * @param state The root object state\n     * @param object The object to convert\n     * @param [options=false] to json options by default excludes the metadata\n     * @param [options.excludeMetadata=false] Excludes the metadata form the serialized json\n     * @param [options.depth=0] Includes up to depth referenced objects into the serialized json\n     * @param [options.persisting=false] indicates if the current state will be persisted.\n     *  Used to update the internal change tracking state of collections and mark the object persistent if its true\n     * @return JSON-Object\n     */\n    toJsonValue(state, object, options) {\n        const { depth = 0, persisting = false } = options || {};\n        const isInDepth = depth === true || depth > -1;\n        // check if object is already loaded in state\n        const objectState = object && Metadata.get(object);\n        if (isInDepth && objectState && objectState.isAvailable) {\n            // serialize our properties\n            objectState.enable(false);\n            const json = super.toJsonValue(objectState, object, Object.assign(Object.assign({}, options), { persisting, depth: typeof depth === 'boolean' ? depth : depth - 1 }));\n            objectState.enable(true);\n            return json;\n        }\n        if (state.db && object instanceof this.typeConstructor) {\n            object.attach(state.db);\n            return object.id;\n        }\n        return null;\n    }\n    toString() {\n        return `EntityType(${this.ref})`;\n    }\n    toJSON() {\n        const _a = super.toJSON(), { acl } = _a, json = __rest(_a, [\"acl\"]);\n        return Object.assign(Object.assign({}, json), { acl: Object.assign(Object.assign({}, acl), { schemaSubclass: this.schemaSubclassPermission.toJSON(), load: this.loadPermission.toJSON(), insert: this.insertPermission.toJSON(), update: this.updatePermission.toJSON(), delete: this.deletePermission.toJSON(), query: this.queryPermission.toJSON() }) });\n    }\n}\nEntityType.Object = class ObjectType extends EntityType {\n    static get ref() {\n        return '/db/Object';\n    }\n    constructor() {\n        super(EntityType.Object.ref, null, Object);\n        this.declaredId = new class extends SingularAttribute {\n            constructor() {\n                super('id', BasicType.String, true);\n            }\n            getJsonValue(state) {\n                return state.id || undefined;\n            }\n            setJsonValue(state, object, jsonValue) {\n                if (!state.id) {\n                    // eslint-disable-next-line no-param-reassign\n                    state.id = jsonValue;\n                }\n            }\n        }();\n        this.declaredId.init(this, 0);\n        this.declaredId.isId = true;\n        this.declaredVersion = new class extends SingularAttribute {\n            constructor() {\n                super('version', BasicType.Integer, true);\n            }\n            getJsonValue(state) {\n                return state.version || undefined;\n            }\n            setJsonValue(state, object, jsonValue) {\n                if (jsonValue) {\n                    // eslint-disable-next-line no-param-reassign\n                    state.version = jsonValue;\n                }\n            }\n        }();\n        this.declaredVersion.init(this, 1);\n        this.declaredVersion.isVersion = true;\n        this.declaredAcl = new class extends SingularAttribute {\n            constructor() {\n                super('acl', BasicType.JsonObject, true);\n            }\n            getJsonValue(state, object, options) {\n                const persisted = Attribute.attachState(object, {});\n                const persistedAcl = persisted.acl || {};\n                const acl = state.acl.toJSON();\n                const unchanged = Object.keys(acl).every((permission) => {\n                    const oldPermission = (persistedAcl[permission] || {});\n                    const newPermission = acl[permission];\n                    const newKeys = Object.keys(newPermission);\n                    const oldKeys = Object.keys(oldPermission);\n                    return newKeys.length === oldKeys.length\n                        && newKeys.every((ref) => oldPermission[ref] === newPermission[ref]);\n                });\n                if (!unchanged) {\n                    state.setDirty();\n                }\n                if (options.persisting) {\n                    persisted.acl = acl;\n                }\n                return acl;\n            }\n            setJsonValue(state, object, jsonValue, options) {\n                const acl = (jsonValue || {});\n                if (options.persisting) {\n                    const persistedState = Attribute.attachState(object, {});\n                    persistedState.acl = acl;\n                }\n                state.acl.fromJSON(acl);\n            }\n        }();\n        this.declaredAcl.init(this, 2);\n        this.declaredAcl.isAcl = true;\n        this.declaredAttributes = [this.declaredId, this.declaredVersion, this.declaredAcl];\n    }\n    createObjectFactory() {\n        throw new Error(\"Objects can't be directly created and persisted\");\n    }\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5VHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkVudGl0eVR5cGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxnREFBZ0Q7QUFDaEQsT0FBTyxFQUNMLGFBQWEsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFXLElBQUksRUFBRSxJQUFJLEVBQUUsV0FBVyxHQUN2RSxNQUFNLFlBQVksQ0FBQztBQUdwQixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUd4RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBZ0IsTUFBTSxpQkFBaUIsQ0FBQztBQUVyRSxNQUFNLE9BQU8sVUFBNkIsU0FBUSxXQUFjO0lBNEk5RDs7OztPQUlHO0lBQ0gsWUFBWSxHQUFXLEVBQUUsU0FBMEIsRUFBRSxlQUEwQjtRQUM3RSxLQUFLLENBQUMsR0FBRyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBM0N2QixlQUFVLEdBQXFDLElBQUksQ0FBQztRQUVwRCxvQkFBZSxHQUFxQyxJQUFJLENBQUM7UUFFekQsZ0JBQVcsR0FBa0MsSUFBSSxDQUFDO1FBRWxELG1CQUFjLEdBQWUsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUU5QyxxQkFBZ0IsR0FBZSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBRWhELHFCQUFnQixHQUFlLElBQUksVUFBVSxFQUFFLENBQUM7UUFFaEQsb0JBQWUsR0FBZSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBRS9DLDZCQUF3QixHQUFl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","import { ManagedType } from './ManagedType';\nimport { PersistenceType } from './Type';\nimport { Managed, ManagedFactory } from '../binding';\nexport class EmbeddableType extends ManagedType {\n    /**\n     * @inheritDoc\n     */\n    get persistenceType() {\n        return PersistenceType.EMBEDDABLE;\n    }\n    /**\n     * @inheritDoc\n     */\n    createProxyClass() {\n        return this.enhancer.createProxy(Managed);\n    }\n    /**\n     * @inheritDoc\n     */\n    createObjectFactory(db) {\n        return ManagedFactory.create(this, db);\n    }\n    /**\n     * @inheritDoc\n     */\n    fromJsonValue(state, jsonObject, currentObject, options) {\n        let obj = currentObject;\n        if (jsonObject) {\n            if (!(obj instanceof this.typeConstructor)) {\n                obj = this.create();\n            }\n        }\n        return super.fromJsonValue(state, jsonObject, obj, options);\n    }\n    toString() {\n        return `EmbeddableType(${this.ref})`;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW1iZWRkYWJsZVR5cGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbWJlZGRhYmxlVHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFLckQsTUFBTSxPQUFPLGNBQWtDLFNBQVEsV0FBYztJQUNuRTs7T0FFRztJQUNILElBQUksZUFBZTtRQUNqQixPQUFPLGVBQWUsQ0FBQyxVQUFVLENBQUM7SUFDcEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsZ0JBQWdCO1FBQ2QsT0FBTyxJQUFJLENBQUMsUUFBUyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxtQkFBbUIsQ0FBQyxFQUFpQjtRQUNuQyxPQUFPLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNILGFBQWEsQ0FBQyxLQUFtQixFQUFFLFVBQWdCLEVBQUUsYUFBdUIsRUFDMUUsT0FBd0Q7UUFDeEQsSUFBSSxHQUFHLEdBQUcsYUFBYSxDQUFDO1FBRXhCLElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRTtnQkFDMUMsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUNyQjtTQUNGO1FBRUQsT0FBTyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFRCxRQUFRO1FBQ04sT0FBTyxrQkFBa0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ3ZDLENBQUM7Q0FDRiJ9","import { CollectionType, PluralAttribute } from './PluralAttribute';\nimport { Attribute } from './Attribute';\nexport class ListAttribute extends PluralAttribute {\n    /**\n     * Get the type id for this list type\n     */\n    static get ref() {\n        return '/db/collection.List';\n    }\n    /**\n     * @inheritDoc\n     */\n    get collectionType() {\n        return CollectionType.LIST;\n    }\n    /**\n     * @param name\n     * @param elementType\n     */\n    constructor(name, elementType) {\n        super(name, Array, elementType);\n    }\n    /**\n     * @inheritDoc\n     */\n    getJsonValue(state, object, options) {\n        const value = this.getValue(object);\n        if (!(value instanceof this.typeConstructor)) {\n            return null;\n        }\n        const len = value.length;\n        const persisting = new Array(len);\n        const attachedState = Attribute.attachState(value);\n        const persistedState = attachedState || [];\n        let changed = !attachedState || attachedState.length !== len;\n        const json = new Array(len);\n        for (let i = 0; i < len; i += 1) {\n            const el = value[i];\n            json[i] = this.elementType.toJsonValue(state, el, options);\n            persisting[i] = el;\n            changed = changed || persistedState[i] !== el;\n        }\n        if (options.persisting) {\n            Attribute.attachState(value, persisting, true);\n        }\n        if (changed) {\n            state.setDirty();\n        }\n        return json;\n    }\n    /**\n     * @inheritDoc\n     */\n    setJsonValue(state, object, json, options) {\n        let value = null;\n        if (json) {\n            value = this.getValue(object);\n            const len = json.length;\n            if (!(value instanceof this.typeConstructor)) {\n                value = new this.typeConstructor(len); // eslint-disable-line new-cap\n            }\n            const persisting = new Array(len);\n            const persistedState = Attribute.attachState(value) || [];\n            // clear additional items\n            if (len < value.length) {\n                value.splice(len, value.length - len);\n            }\n            for (let i = 0; i < len; i += 1) {\n                const el = this.elementType.fromJsonValue(state, json[i], persistedState[i], options);\n                value[i] = el;\n                persisting[i] = el;\n            }\n            if (options.persisting) {\n                Attribute.attachState(value, persisting, true);\n            }\n        }\n        this.setValue(object, value);\n    }\n    /**\n     * @inheritDoc\n     */\n    toJSON() {\n        return Object.assign({ type: `${ListAttribute.ref}[${this.elementType.ref}]` }, super.toJSON());\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGlzdEF0dHJpYnV0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkxpc3RBdHRyaWJ1dGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBTXhDLE1BQU0sT0FBTyxhQUFpQixTQUFRLGVBQW1DO0lBQ3ZFOztPQUVHO0lBQ0gsTUFBTSxLQUFLLEdBQUc7UUFDWixPQUFPLHFCQUFxQixDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksY0FBYztRQUNoQixPQUFPLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDN0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILFlBQVksSUFBWSxFQUFFLFdBQW9CO1FBQzVDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7T0FFRztJQUNILFlBQVksQ0FBQyxLQUFtQixFQUFFLE1BQWUsRUFDL0MsT0FBcUY7UUFDckYsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwQyxJQUFJLENBQUMsQ0FBQyxLQUFLLFlBQVksSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQzVDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3pCLE1BQU0sVUFBVSxHQUFpQixJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoRCxNQUFNLGFBQWEsR0FBc0IsU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0RSxNQUFNLGNBQWMsR0FBRyxhQUFhLElBQUksRUFBRSxDQUFDO1FBRTNDLElBQUksT0FBTyxHQUFHLENBQUMsYUFBYSxJQUFJLGFBQWEsQ0FBQyxNQUFN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","import { CollectionType, PluralAttribute } from './PluralAttribute';\nimport { Attribute } from './Attribute';\nimport { PersistentError } from '../error';\nexport class MapAttribute extends PluralAttribute {\n    /**\n     * @param name\n     * @param keyType\n     * @param elementType\n     */\n    constructor(name, keyType, elementType) {\n        super(name, Map, elementType);\n        this.keyType = keyType;\n    }\n    /**\n     * Get the type id for this map type\n     * @return\n     */\n    static get ref() {\n        return '/db/collection.Map';\n    }\n    /**\n     * @inheritDoc\n     */\n    get collectionType() {\n        return CollectionType.MAP;\n    }\n    /**\n     * @inheritDoc\n     */\n    getJsonValue(state, object, options) {\n        const value = this.getValue(object);\n        if (!(value instanceof this.typeConstructor)) {\n            return null;\n        }\n        const persisting = {};\n        const persistedState = Attribute.attachState(value) || {};\n        let changed = Attribute.attachSize(value) !== value.size;\n        const json = {};\n        const iter = value.entries();\n        for (let el = iter.next(); !el.done; el = iter.next()) {\n            const entry = el.value;\n            if (entry[0] === null || entry[0] === undefined) {\n                throw new PersistentError('Map keys can\\'t be null nor undefined.');\n            }\n            const jsonKey = this.keyValue(this.keyType.toJsonValue(state, entry[0], options));\n            json[jsonKey] = this.elementType.toJsonValue(state, entry[1], options);\n            persisting[jsonKey] = [entry[0], entry[1]];\n            changed = changed || (persistedState[jsonKey] || [])[1] !== entry[1];\n        }\n        if (options.persisting) {\n            Attribute.attachState(value, persisting, true);\n            Attribute.attachSize(value, value.size);\n        }\n        if (changed) {\n            state.setDirty();\n        }\n        return json;\n    }\n    /**\n     * @inheritDoc\n     */\n    setJsonValue(state, object, json, options) {\n        let value = null;\n        if (json) {\n            value = this.getValue(object);\n            if (!(value instanceof this.typeConstructor)) {\n                // eslint-disable-next-line new-cap\n                value = new this.typeConstructor();\n            }\n            const persisting = {};\n            const persistedState = Attribute.attachState(value) || {};\n            value.clear();\n            const jsonKeys = Object.keys(json);\n            for (let i = 0, len = jsonKeys.length; i < len; i += 1) {\n                const jsonKey = jsonKeys[i];\n                const persistedEntry = persistedState[jsonKey] || [];\n                // ensures that \"false\" keys will be converted to false, disallow null as keys\n                const key = this.keyType.fromJsonValue(state, jsonKey, persistedEntry[0], options);\n                const val = this.elementType.fromJsonValue(state, json[jsonKey], persistedEntry[1], options);\n                persisting[jsonKey] = [key, val];\n                value.set(key, val);\n            }\n            if (options.persisting) {\n                Attribute.attachState(value, persisting, true);\n                Attribute.attachSize(value, value.size);\n            }\n        }\n        this.setValue(object, value);\n    }\n    /**\n     * @inheritDoc\n     */\n    toJSON() {\n        return Object.assign({ type: `${MapAttribute.ref}[${this.keyType.ref},${this.elementType.ref}]` }, super.toJSON());\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFwQXR0cmlidXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTWFwQXR0cmlidXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBTTNDLE1BQU0sT0FBTyxZQUFtQixTQUFRLGVBQTJDO0lBa0JqRjs7OztPQUlHO0lBQ0gsWUFBWSxJQUFZLEVBQUUsT0FBZ0IsRUFBRSxXQUFvQjtRQUM5RCxLQUFLLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0lBdkJEOzs7T0FHRztJQUNILE1BQU0sS0FBSyxHQUFHO1FBQ1osT0FBTyxvQkFBb0IsQ0FBQztJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLGNBQWM7UUFDaEIsT0FBTyxjQUFjLENBQUMsR0FBRyxDQUFDO0lBQzVCLENBQUM7SUFZRDs7T0FFRztJQUNILFlBQVksQ0FBQyxLQUFtQixFQUFFLE1BQWUsRUFDL0MsT0FBcUY7UUFDckYsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwQyxJQUFJLENBQUMsQ0FBQyxLQUFLLFlBQVksSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQzVDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxNQUFNLFVBQVUsR0FBMEMsRUFBRSxDQUFDO1FBQzdELE1BQU0sY0FBYyxHQUEwQyxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqRyxJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxL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","import { CollectionType, PluralAttribute } from './PluralAttribute';\nimport { Attribute } from './Attribute';\nexport class SetAttribute extends PluralAttribute {\n    /**\n     * Get the type id for this set type\n     * @return\n     */\n    static get ref() {\n        return '/db/collection.Set';\n    }\n    /**\n     * @inheritDoc\n     */\n    get collectionType() {\n        return CollectionType.SET;\n    }\n    /**\n     * @param name The name of the attribute\n     * @param elementType The element type of the collection\n     */\n    constructor(name, elementType) {\n        super(name, Set, elementType);\n    }\n    /**\n     * @inheritDoc\n     */\n    getJsonValue(state, object, options) {\n        const value = this.getValue(object);\n        if (!(value instanceof this.typeConstructor)) {\n            return null;\n        }\n        const persisting = {};\n        const persistedState = Attribute.attachState(value) || {};\n        let changed = Attribute.attachSize(value) !== value.size;\n        const json = [];\n        const iter = value.values();\n        for (let item = iter.next(); !item.done; item = iter.next()) {\n            const el = item.value;\n            const jsonValue = this.elementType.toJsonValue(state, el, options);\n            json.push(jsonValue);\n            const keyValue = this.keyValue(jsonValue);\n            persisting[keyValue] = el;\n            changed = changed || persistedState[keyValue] !== el;\n        }\n        if (options.persisting) {\n            Attribute.attachState(value, persisting, true);\n            Attribute.attachSize(value, value.size);\n        }\n        if (changed) {\n            state.setDirty();\n        }\n        return json;\n    }\n    /**\n     * @inheritDoc\n     */\n    setJsonValue(state, object, json, options) {\n        let value = null;\n        if (json) {\n            value = this.getValue(object);\n            if (!(value instanceof this.typeConstructor)) {\n                value = new this.typeConstructor(); // eslint-disable-line new-cap\n            }\n            const persisting = {};\n            const persistedState = Attribute.attachState(value) || {};\n            value.clear();\n            for (let i = 0, len = json.length; i < len; i += 1) {\n                const jsonValue = json[i];\n                const keyValue = this.keyValue(jsonValue);\n                const el = this.elementType.fromJsonValue(state, jsonValue, persistedState[keyValue], options);\n                value.add(el);\n                persisting[keyValue] = el;\n            }\n            if (options.persisting) {\n                Attribute.attachState(value, persisting, true);\n                Attribute.attachSize(value, value.size);\n            }\n        }\n        this.setValue(object, value);\n    }\n    /**\n     * @inheritDoc\n     */\n    toJSON() {\n        return Object.assign({ type: `${SetAttribute.ref}[${this.elementType.ref}]` }, super.toJSON());\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2V0QXR0cmlidXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2V0QXR0cmlidXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQU14QyxNQUFNLE9BQU8sWUFBZ0IsU0FBUSxlQUFpQztJQUNwRTs7O09BR0c7SUFDSCxNQUFNLEtBQUssR0FBRztRQUNaLE9BQU8sb0JBQW9CLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxjQUFjO1FBQ2hCLE9BQU8sY0FBYyxDQUFDLEdBQUcsQ0FBQztJQUM1QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsWUFBWSxJQUFZLEVBQUUsV0FBb0I7UUFDNUMsS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWSxDQUFDLEtBQW1CLEVBQUUsTUFBZSxFQUMvQyxPQUFxRjtRQUNyRixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXBDLElBQUksQ0FBQyxDQUFDLEtBQUssWUFBWSxJQUFJLENBQUMsZUFBZSxDQUFDLEVBQUU7WUFDNUMsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE1BQU0sVUFBVSxHQUE4QixFQUFFLENBQUM7UUFDakQsTUFBTSxjQUFjLEdBQVksU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbkUsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBRXpELE1BQU0sSUFBSSxHQUFjLEVBQUUsQ0FBQztRQUMzQixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxF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","import { BasicType } from './BasicType';\nimport { EntityType } from './EntityType';\nimport { EmbeddableType } from './EmbeddableType';\nimport { ListAttribute } from './ListAttribute';\nimport { MapAttribute } from './MapAttribute';\nimport { SetAttribute } from './SetAttribute';\nimport { SingularAttribute } from './SingularAttribute';\nimport { PersistentError } from '../error';\nimport { Validator } from '../intersection';\nexport class ModelBuilder {\n    constructor() {\n        this.models = {};\n        this.modelDescriptors = null;\n        Object.keys(BasicType).forEach((typeName) => {\n            const basicType = BasicType[typeName];\n            if (basicType instanceof BasicType) {\n                this.models[basicType.ref] = basicType;\n            }\n        });\n    }\n    /**\n     * @param ref\n     * @return\n     */\n    getModel(ref) {\n        if (ref in this.models) {\n            return this.models[ref];\n        }\n        const model = this.buildModel(ref);\n        this.models[ref] = model;\n        return model;\n    }\n    /**\n     * @param modelDescriptors\n     * @return\n     */\n    buildModels(modelDescriptors) {\n        this.modelDescriptors = {};\n        modelDescriptors.forEach((modelDescriptor) => {\n            this.modelDescriptors[modelDescriptor.class] = modelDescriptor;\n        });\n        Object.keys(this.modelDescriptors).forEach((ref) => {\n            try {\n                const model = this.getModel(ref);\n                this.buildAttributes(model);\n            }\n            catch (e) {\n                throw new PersistentError(`Can't create model for entity class ${ref}`, e);\n            }\n        });\n        // ensure at least an object entity\n        this.getModel(EntityType.Object.ref);\n        return this.models;\n    }\n    /**\n     * @param ref\n     * @return\n     */\n    buildModel(ref) {\n        const modelDescriptor = this.modelDescriptors[ref];\n        let type;\n        if (ref === EntityType.Object.ref) {\n            type = new EntityType.Object();\n        }\n        else if (modelDescriptor) {\n            if (modelDescriptor.embedded) {\n                type = new EmbeddableType(ref);\n            }\n            else {\n                const superTypeIdentifier = modelDescriptor.superClass || EntityType.Object.ref;\n                type = new EntityType(ref, this.getModel(superTypeIdentifier));\n            }\n        }\n        else {\n            throw new TypeError(`No model available for ${ref}`);\n        }\n        type.metadata = {};\n        if (modelDescriptor) {\n            type.metadata = modelDescriptor.metadata || {};\n            const permissions = modelDescriptor.acl || {};\n            Object.keys(permissions).forEach((permission) => {\n                const permissionProperty = `${permission}Permission`;\n                type[permissionProperty].fromJSON(permissions[permission]);\n            });\n        }\n        return type;\n    }\n    /**\n     * @param model\n     * @return\n     */\n    buildAttributes(model) {\n        const modelDescriptor = this.modelDescriptors[model.ref];\n        const fields = modelDescriptor.fields;\n        Object.keys(fields).forEach((name) => {\n            const field = fields[name];\n            if (!model.getAttribute(name)) { // skip predefined attributes\n                model.addAttribute(this.buildAttribute(field), field.order);\n            }\n        });\n        if (typeof modelDescriptor.validationCode === 'string') {\n            // eslint-disable-next-line no-param-reassign\n            model.validationCode = Validator.compile(model, modelDescriptor.validationCode);\n        }\n    }\n    /**\n     * @param field The field metadata\n     * @param field.name The name of zhe field\n     * @param field.type The type reference of the field\n     * @param field.order The order number of the field\n     * @param field.metadata Additional metadata of the field\n     * @return\n     */\n    buildAttribute(field) {\n        // TODO: remove readonly if createdAt and updatedAt becomes real metadata fields in the schema\n        const isMetadata = field.flags && (field.flags.indexOf('METADATA') !== -1 || field.flags.indexOf('READONLY') !== -1);\n        const { name } = field;\n        const ref = field.type;\n        if (ref.indexOf('/db/collection.') !== 0) {\n            const singularAttribute = new SingularAttribute(name, this.getModel(ref), isMetadata);\n            singularAttribute.metadata = field.metadata;\n            return singularAttribute;\n        }\n        const collectionType = ref.substring(0, ref.indexOf('['));\n        const elementType = ref.substring(ref.indexOf('[') + 1, ref.indexOf(']')).trim();\n        switch (collectionType) {\n            case ListAttribute.ref:\n                return new ListAttribute(name, this.getModel(elementType));\n            case SetAttribute.ref:\n                return new SetAttribute(name, this.getModel(elementType));\n            case MapAttribute.ref: {\n                const keyType = elementType.substring(0, elementType.indexOf(',')).trim();\n                const valueType = elementType.substring(elementType.indexOf(',') + 1).trim();\n                return new MapAttribute(name, this.getModel(keyType), this.getModel(valueType));\n            }\n            default:\n                throw new TypeError(`No collection available for ${ref}`);\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kZWxCdWlsZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTW9kZWxCdWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUszQyxPQUFPLEVBQWMsU0FBUyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFeEQsTUFBTSxPQUFPLFlBQVk7SUFLdkI7UUFKUSxXQUFNLEdBQWdDLEVBQUUsQ0FBQztRQUV6QyxxQkFBZ0IsR0FBcUMsSUFBSSxDQUFDO1FBRy9ELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFnQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQzFFLE1BQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN0QyxJQUFJLFNBQVMsWUFBWSxTQUFTLEVBQUU7Z0JBQ2xDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQzthQUN4QztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNILFFBQVEsQ0FBQyxHQUFXO1FBQ2xCLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDdEIsT0FB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","/**\n * Creates a new index instance which is needed to create an\n * database index.\n */\nexport class DbIndex {\n    /**\n     * @param keys The name of the field which will be used\n     * for the index,\n     * an object of an field and index type combination or\n     * an array of objects to create an compound index\n     * @param unique Indicates if the index will be unique\n     */\n    constructor(keys, unique) {\n        if (typeof keys === 'string') {\n            const key = {};\n            key[keys] = DbIndex.ASC;\n            this.keys = [key];\n        }\n        else if (Array.isArray(keys)) {\n            this.keys = keys;\n        }\n        else if (keys) {\n            this.keys = [keys];\n        }\n        else {\n            throw new Error('The keys parameter must be an String, Object or Array.');\n        }\n        this.unique = unique === true;\n    }\n    /**\n     * Returns DbIndex Object created from the given JSON\n     * @param json\n     * @return\n     */\n    static fromJSON(json) {\n        return new DbIndex(json.keys, json.unique);\n    }\n    /**\n     * Indicates if this index is for the given field or includes it in a compound index\n     * @param name The name of the field to check for\n     * @return <code>true</code> if the index contains this field\n     */\n    hasKey(name) {\n        for (let i = 0; i < this.keys.length; i += 1) {\n            if (this.keys[i][name]) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Indicates if this index is a compound index of multiple attributes\n     * @type boolean\n     * @readonly\n     */\n    get isCompound() {\n        return this.keys.length > 1;\n    }\n    /**\n     * Indicates if this index is an unique index\n     * @type boolean\n     * @readonly\n     */\n    get isUnique() {\n        return this.unique;\n    }\n    /**\n     * Returns a JSON representation of the Index object\n     *\n     * @return A Json of this Index object\n     */\n    toJSON() {\n        return {\n            unique: this.unique,\n            keys: this.keys,\n        };\n    }\n}\nDbIndex.ASC = 'asc';\nDbIndex.DESC = 'desc';\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGJJbmRleC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRiSW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUE7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLE9BQU87SUF1QmxCOzs7Ozs7T0FNRztJQUNILFlBQVksSUFBbUQsRUFBRSxNQUFnQjtRQUMvRSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUM1QixNQUFNLEdBQUcsR0FBMEIsRUFBRSxDQUFDO1lBQ3RDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1lBQ3hCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNuQjthQUFNLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM5QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNsQjthQUFNLElBQUksSUFBSSxFQUFFO1lBQ2YsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BCO2FBQU07WUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7U0FDM0U7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sS0FBSyxJQUFJLENBQUM7SUFDaEMsQ0FBQztJQTlCRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFhO1FBQ2xDLE9BQU8sSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQWlCLEVBQUUsSUFBSSxDQUFDLE1BQWlCLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBeUJEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsSUFBWTtRQUNqQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM1QyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ3RCLE9BQU8sSUFBSSxDQUFDO2FBQ2I7U0FDRjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILE1BQU07UUFDSixPQUFPO1lBQ0wsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtTQUNoQixDQUFDO0lBQ0osQ0FBQzs7QUF2RnNCLFdBQUcsR0FBRyxLQUFLLENBQUM7QUFFWixZQUFJLEdBQUcsTUFBTSxDQUFDIn0=","import { ManagedType } from './ManagedType';\nimport { EntityType } from './EntityType';\nimport { Enhancer } from '../binding';\nimport { ModelBuilder } from './ModelBuilder';\nimport { DbIndex } from './DbIndex';\nimport { Lockable, } from '../util';\nimport { StatusCode } from '../connector';\nimport * as message from '../message';\nexport class Metamodel extends Lockable {\n    /**\n     * Constructs a new metamodel instance which represents the complete schema of one baqend app\n     * @param entityManagerFactory\n     */\n    constructor(entityManagerFactory) {\n        super();\n        /**\n         * Defines if the Metamodel has been finalized\n         */\n        this.isInitialized = false;\n        this.entities = {};\n        this.embeddables = {};\n        this.baseTypes = {};\n        this.enhancer = new Enhancer();\n        this.entityManagerFactory = entityManagerFactory;\n    }\n    /**\n     * Prepare the Metamodel for custom schema creation\n     * @param jsonMetamodel initialize the metamodel with the serialized json schema\n     * @return\n     */\n    init(jsonMetamodel) {\n        if (this.isInitialized) {\n            throw new Error('Metamodel is already initialized.');\n        }\n        this.fromJSON(jsonMetamodel || []);\n        this.isInitialized = true;\n    }\n    /**\n     * @param arg\n     * @return\n     */\n    getRef(arg) {\n        let ref;\n        if (typeof arg === 'string') {\n            ref = arg;\n            if (ref.indexOf('/db/') !== 0) {\n                ref = `/db/${arg}`;\n            }\n        }\n        else {\n            ref = Enhancer.getIdentifier(arg);\n        }\n        return ref;\n    }\n    /**\n     * Return the metamodel entity type representing the entity.\n     *\n     * @param typeConstructor - the type of the represented entity\n     * @return the metamodel entity type or null if the class is not a managed entity\n     */\n    entity(typeConstructor) {\n        const ref = this.getRef(typeConstructor);\n        return ref ? this.entities[ref] : null;\n    }\n    /**\n     * Return the metamodel basic type representing the native class.\n     * @param typeConstructor - the type of the represented native class\n     * @return the metamodel basic type\n     */\n    baseType(typeConstructor) {\n        let ref = null;\n        if (typeof typeConstructor === 'string') {\n            ref = this.getRef(typeConstructor);\n        }\n        else {\n            const baseTypesNames = Object.keys(this.baseTypes);\n            for (let i = 0, len = baseTypesNames.length; i < len; i += 1) {\n                const name = baseTypesNames[i];\n                const type = this.baseTypes[name];\n                if (!type.noResolving && type.typeConstructor === typeConstructor) {\n                    ref = name;\n                    break;\n                }\n            }\n        }\n        return ref ? this.baseTypes[ref] : null;\n    }\n    /**\n     * Return the metamodel embeddable type representing the embeddable class.\n     * @param typeConstructor - the type of the represented embeddable class\n     * @return the metamodel embeddable type or null if the class is not a managed embeddable\n     */\n    embeddable(typeConstructor) {\n        const ref = this.getRef(typeConstructor);\n        return ref ? this.embeddables[ref] : null;\n    }\n    /**\n     * Return the metamodel managed type representing the entity, mapped superclass, or embeddable class.\n     *\n     * @param typeConstructor - the type of the represented managed class\n     * @return the metamodel managed type\n     */\n    managedType(typeConstructor) {\n        return this.entity(typeConstructor) || this.embeddable(typeConstructor);\n    }\n    /**\n     * @param type\n     * @return the added type\n     */\n    addType(type) {\n        let types = {};\n        if (type.isBasic) {\n            types = this.baseTypes;\n        }\n        else if (type.isEmbeddable) {\n            type.init(this.enhancer);\n            types = this.embeddables;\n        }\n        else if (type.isEntity) {\n            const entityType = type;\n            entityType.init(this.enhancer);\n            types = this.entities;\n            if (entityType.superType === null && entityType.ref !== EntityType.Object.ref) {\n                entityType.superType = this.entity(EntityType.Object.ref);\n            }\n        }\n        if (types[type.ref]) {\n            throw new Error(`The type ${type.ref} is already declared.`);\n        }\n        types[type.ref] = type;\n        return type;\n    }\n    /**\n     * Load all schema data from the server\n     * @return\n     */\n    load() {\n        if (!this.isInitialized) {\n            return this.withLock(() => {\n                const msg = new message.GetAllSchemas();\n                return this.entityManagerFactory.send(msg).then((response) => {\n                    this.init(response.entity);\n                    return this;\n                });\n            });\n        }\n        throw new Error('Metamodel is already initialized.');\n    }\n    /**\n     * Store all local schema data on the server, or the provided one\n     *\n     * Note: The schema must be initialized, by init or load\n     *\n     * @param managedType The specific type to persist, if omitted the complete schema\n     * will be updated\n     * @return\n     */\n    save(managedType) {\n        return this.sendUpdate(managedType || this.toJSON()).then(() => this);\n    }\n    /**\n     * Update the metamodel with the schema\n     *\n     * The provided data object will be forwarded to the UpdateAllSchemas resource.\n     * The underlying schema of this Metamodel object will be replaced by the result.\n     *\n     * @param data The JSON which will be send to the UpdateAllSchemas resource.\n     * @return\n     */\n    update(data) {\n        return this.sendUpdate(data).then((response) => {\n            this.fromJSON(response.entity);\n            return this;\n        });\n    }\n    sendUpdate(data) {\n        return this.withLock(() => {\n            let msg;\n            if (data instanceof ManagedType) {\n                msg = new message.UpdateSchema(data.name, data.toJSON());\n            }\n            else {\n                msg = new message.UpdateAllSchemas(data);\n            }\n            return this.entityManagerFactory.send(msg);\n        });\n    }\n    /**\n     * Get the current schema types as json\n     * @return the json data\n     */\n    toJSON() {\n        if (!this.isInitialized) {\n            throw new Error('Metamodel is not initialized.');\n        }\n        return [].concat(Object.keys(this.entities).map((ref) => this.entities[ref].toJSON()), Object.keys(this.embeddables).map((ref) => this.embeddables[ref].toJSON()));\n    }\n    /**\n     * Replace the current schema by the provided one in json\n     * @param json The json schema data\n     * @return\n     */\n    fromJSON(json) {\n        const builder = new ModelBuilder();\n        const models = builder.buildModels(json);\n        this.baseTypes = {};\n        this.embeddables = {};\n        this.entities = {};\n        Object.keys(models).forEach((ref) => this.addType(models[ref]));\n    }\n    /**\n     * Creates an index\n     *\n     * @param bucket Name of the Bucket\n     * @param index Will be applied for the given bucket\n     * @return\n     */\n    createIndex(bucket, index) {\n        const msg = new message.CreateDropIndex(bucket, Object.assign(Object.assign({}, index.toJSON()), { drop: false }));\n        return this.entityManagerFactory.send(msg);\n    }\n    /**\n     * Drops an index\n     *\n     * @param bucket Name of the Bucket\n     * @param index Will be dropped for the given bucket\n     * @return\n     */\n    dropIndex(bucket, index) {\n        const msg = new message.CreateDropIndex(bucket, Object.assign(Object.assign({}, index.toJSON()), { drop: true }));\n        return this.entityManagerFactory.send(msg);\n    }\n    /**\n     * Drops all indexes\n     *\n     * @param bucket Indexes will be dropped for the given bucket\n     * @return\n     */\n    dropAllIndexes(bucket) {\n        const msg = new message.DropAllIndexes(bucket);\n        return this.entityManagerFactory.send(msg);\n    }\n    /**\n     * Loads all indexes for the given bucket\n     *\n     * @param bucket Current indexes will be loaded for the given bucket\n     * @return\n     */\n    getIndexes(bucket) {\n        const msg = new message.ListIndexes(bucket);\n        return this.entityManagerFactory.send(msg)\n            .then((response) => response.entity.map((el) => new DbIndex(el.keys, el.unique)))\n            .catch((e) => {\n            if (e.status === StatusCode.BUCKET_NOT_FOUND || e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return null;\n            }\n            throw e;\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWV0YW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTWV0YW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsUUFBUSxFQUFXLE1BQU0sWUFBWSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BDLE9BQU8sRUFDNEIsUUFBUSxHQUMxQyxNQUFNLFNBQVMsQ0FBQztBQUNqQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQzFDLE9BQU8sS0FBSyxPQUFPLE1BQU0sWUFBWSxDQUFDO0FBTXRDLE1BQU0sT0FBTyxTQUFVLFNBQVEsUUFBUTtJQWdCckM7OztPQUdHO0lBQ0gsWUFBWSxvQkFBMEM7UUFDcEQsS0FBSyxFQUFFLENBQUM7UUFwQlY7O1dBRUc7UUFDSSxrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUkvQixhQUFRLEdBQXNDLEVBQUUsQ0FBQztRQUVqRCxnQkFBVyxHQUEwQyxFQUFFLENBQUM7UUFFeEQsY0FBUyxHQUFxQyxFQUFFLENBQUM7UUFFakQsYUFBUSxHQUFhLElBQUksUUFBUSxFQUFFLENBQUM7UUFRekMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLG9CQUFvQixDQUFDO0lBQ25ELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBSSxDQUFDLGFBQXVCO1FBQzFCLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7U0FDdEQ7UUFFRCxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsYUFB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","import { CollectionType, PluralAttribute } from './PluralAttribute';\nexport class CollectionAttribute extends PluralAttribute {\n    /**\n     * @inheritDoc\n     */\n    get collectionType() {\n        return CollectionType.COLLECTION;\n    }\n    /**\n     * @param name - the name of the attribute\n     * @param typeConstructor - The collection constructor of the attribute\n     * @param elementType - The element type of the collection\n     */\n    constructor(name, typeConstructor, elementType) {\n        super(name, typeConstructor, elementType);\n        super(name, typeConstructor, elementType);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29sbGVjdGlvbkF0dHJpYnV0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNvbGxlY3Rpb25BdHRyaWJ1dGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUlwRSxNQUFNLE9BQWdCLG1CQUEwQixTQUFRLGVBQXFCO0lBQzNFOztPQUVHO0lBQ0gsSUFBSSxjQUFjO1FBQ2hCLE9BQU8sY0FBYyxDQUFDLFVBQVUsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFlBQXNCLElBQVksRUFBRSxlQUF5QixFQUFFLFdBQW9CO1FBQ2pGLEtBQUssQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQzVDLENBQUM7Q0FDRiJ9","import { Permission } from './intersection/Permission';\n/**\n * Creates a new Acl object, with an empty rule set for an object\n */\nexport class Acl {\n    constructor() {\n        /**\n         * The read permission of the object\n         */\n        this.read = new Permission();\n        /**\n         * The write permission of the object\n         */\n        this.write = new Permission();\n    }\n    /**\n     * Removes all acl rules, read and write access is public afterwards\n     *\n     * @return\n     * */\n    clear() {\n        this.read.clear();\n        this.write.clear();\n    }\n    /**\n     * Copies permissions from another ACL\n     *\n     * @param acl The ACL to copy from\n     * @return\n     */\n    copy(acl) {\n        this.read.copy(acl.read);\n        this.write.copy(acl.write);\n        return this;\n    }\n    /**\n     * Gets whenever all users and roles have the permission to read the object\n     *\n     * @return <code>true</code> If public access is allowed\n     */\n    isPublicReadAllowed() {\n        return this.read.isPublicAllowed();\n    }\n    /**\n     * Sets whenever all users and roles should have the permission to read the object\n     *\n     * Note: All other allow read rules will be removed.\n     *\n     * @return\n     * */\n    setPublicReadAllowed() {\n        return this.read.setPublicAllowed();\n    }\n    /**\n     * Checks whenever the user or role is explicit allowed to read the object\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> if read access is explicitly allowed for the given user or role\n     */\n    isReadAllowed(userOrRole) {\n        return this.read.isAllowed(userOrRole);\n    }\n    /**\n     * Checks whenever the user or role is explicit denied to read the object\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> if read access is explicitly denied for the given user or role\n     */\n    isReadDenied(userOrRole) {\n        return this.read.isDenied(userOrRole);\n    }\n    /**\n     * Allows the given user or rule to read the object\n     *\n     * @param userOrRole The user or role to allow\n     * @return this acl object\n     */\n    allowReadAccess(...userOrRole) {\n        this.read.allowAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * Denies the given user or rule to read the object\n     *\n     * @param userOrRole The user or role to deny\n     * @return this acl object\n     */\n    denyReadAccess(...userOrRole) {\n        this.read.denyAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * Deletes any read allow/deny rule for the given user or role\n     *\n     * @param userOrRole The user or role\n     * @return this acl object\n     */\n    deleteReadAccess(...userOrRole) {\n        this.read.deleteAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * Gets whenever all users and roles have the permission to write the object\n     *\n     * @return <code>true</code> If public access is allowed\n     */\n    isPublicWriteAllowed() {\n        return this.write.isPublicAllowed();\n    }\n    /**\n     * Sets whenever all users and roles should have the permission to write the object\n     *\n     * Note: All other allow write rules will be removed.\n     *\n     * @return\n     * */\n    setPublicWriteAllowed() {\n        return this.write.setPublicAllowed();\n    }\n    /**\n     * Checks whenever the user or role is explicit allowed to write the object\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> if write access is explicitly allowed for the given user or role\n     */\n    isWriteAllowed(userOrRole) {\n        return this.write.isAllowed(userOrRole);\n    }\n    /**\n     * Checks whenever the user or role is explicit denied to write the object\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> if write access is explicitly denied for the given user or role\n     */\n    isWriteDenied(userOrRole) {\n        return this.write.isDenied(userOrRole);\n    }\n    /**\n     * Allows the given user or rule to write the object\n     *\n     * @param userOrRole The user or role to allow\n     * @return this acl object\n     */\n    allowWriteAccess(...userOrRole) {\n        this.write.allowAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * Denies the given user or rule to write the object\n     *\n     * @param userOrRole The user or role to deny\n     * @return this acl object\n     */\n    denyWriteAccess(...userOrRole) {\n        this.write.denyAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * Deletes any write allow/deny rule for the given user or role\n     *\n     * @param userOrRole The user or role\n     * @return this acl object\n     */\n    deleteWriteAccess(...userOrRole) {\n        this.write.deleteAccess(...userOrRole);\n        return this;\n    }\n    /**\n     * A JSON representation of the set of rules\n     *\n     * @return\n     */\n    toJSON() {\n        return {\n            read: this.read.toJSON(),\n            write: this.write.toJSON(),\n        };\n    }\n    /**\n     * Sets the acl rules form JSON\n     *\n     * @param json The json encoded acls\n     * @return\n     */\n    fromJSON(json) {\n        this.read.fromJSON(json.read || {});\n        this.write.fromJSON(json.write || {});\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQWNsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUl2RDs7R0FFRztBQUNILE1BQU0sT0FBTyxHQUFHO0lBQWhCO1FBQ0U7O1dBRUc7UUFDTSxTQUFJLEdBQWUsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUU3Qzs7V0FFRztRQUNNLFVBQUssR0FBZSxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBZ01oRCxDQUFDO0lBOUxDOzs7O1NBSUs7SUFDTCxLQUFLO1FBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILElBQUksQ0FBQyxHQUFRO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsbUJBQW1CO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBRUQ7Ozs7OztTQU1LO0lBQ0wsb0JBQW9CO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3RDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGFBQWEsQ0FBQyxVQUF5QjtRQUNyQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFlBQVksQ0FBQyxVQUF5QjtRQUNwQyxPQUFPLElBQUksQ0FB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","/**\n * Creates a new GeoPoint instance\n * From latitude and longitude\n * From a json object\n * Or an tuple of latitude and longitude\n */\nexport class GeoPoint {\n    /**\n     * @param latitude A coordinate pair (latitude first),\n     * a GeoPoint like object or the GeoPoint's latitude\n     * @param longitude The GeoPoint's longitude\n     */\n    constructor(latitude, longitude) {\n        let lat;\n        let lng;\n        if (typeof latitude === 'string') {\n            const index = latitude.indexOf(';');\n            lat = Number(latitude.substring(0, index));\n            lng = Number(latitude.substring(index + 1));\n        }\n        else if (Array.isArray(latitude)) {\n            [lat, lng] = latitude;\n        }\n        else if (typeof latitude === 'object') {\n            lat = latitude.latitude;\n            lng = latitude.longitude;\n        }\n        else {\n            lat = typeof latitude === 'number' ? latitude : 0;\n            lng = typeof longitude === 'number' ? longitude : 0;\n        }\n        this.longitude = lng;\n        this.latitude = lat;\n        if (this.latitude < -90 || this.latitude > 90) {\n            throw new Error(`Latitude ${this.latitude} is not in bound of -90 <= latitude <= 90`);\n        }\n        if (this.longitude < -180 || this.longitude > 180) {\n            throw new Error(`Longitude ${this.longitude} is not in bound of -180 <= longitude <= 180`);\n        }\n    }\n    /**\n     * Creates a GeoPoint with the user's current location, if available.\n     * @return A promise that will be resolved with a GeoPoint\n     */\n    static current() {\n        return new Promise(((resolve, reject) => {\n            if (!navigator) {\n                reject(new Error('This seems not to be a browser context.'));\n            }\n            if (!navigator.geolocation) {\n                reject(new Error('This browser does not support geolocation.'));\n            }\n            navigator.geolocation.getCurrentPosition((location) => {\n                resolve(new GeoPoint(location.coords.latitude, location.coords.longitude));\n            }, (error) => {\n                reject(error);\n            });\n        }));\n    }\n    /**\n     * Returns the distance from this GeoPoint to another in kilometers.\n     * @param point another GeoPoint\n     * @return The distance in kilometers\n     *\n     * @see GeoPoint#radiansTo\n     */\n    kilometersTo(point) {\n        return Number((GeoPoint.EARTH_RADIUS_IN_KILOMETERS * this.radiansTo(point)).toFixed(3));\n    }\n    /**\n     * Returns the distance from this GeoPoint to another in miles.\n     * @param point another GeoPoint\n     * @return The distance in miles\n     *\n     * @see GeoPoint#radiansTo\n     */\n    milesTo(point) {\n        return Number((GeoPoint.EARTH_RADIUS_IN_MILES * this.radiansTo(point)).toFixed(3));\n    }\n    /**\n     * Computes the arc, in radian, between two WGS-84 positions.\n     *\n     * The haversine formula implementation is taken from:\n     * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n     *\n     * Returns the distance from this GeoPoint to another in radians.\n     * @param point another GeoPoint\n     * @return the arc, in radian, between two WGS-84 positions\n     *\n     * @see http://en.wikipedia.org/wiki/Haversine_formula\n     */\n    radiansTo(point) {\n        const from = this;\n        const to = point;\n        const rad1 = from.latitude * GeoPoint.DEG_TO_RAD;\n        const rad2 = to.latitude * GeoPoint.DEG_TO_RAD;\n        const dLng = (to.longitude - from.longitude) * GeoPoint.DEG_TO_RAD;\n        return Math.acos((Math.sin(rad1) * Math.sin(rad2)) + (Math.cos(rad1) * Math.cos(rad2) * Math.cos(dLng)));\n    }\n    /**\n     * A String representation in latitude, longitude format\n     * @return The string representation of this class\n     */\n    toString() {\n        return `${this.latitude};${this.longitude}`;\n    }\n    /**\n     * Returns a JSON representation of the GeoPoint\n     * @return A GeoJson object of this GeoPoint\n     */\n    toJSON() {\n        return { latitude: this.latitude, longitude: this.longitude };\n    }\n}\n/**\n * How many radians fit in one degree.\n */\nGeoPoint.DEG_TO_RAD = Math.PI / 180;\n/**\n * The Earth radius in kilometers used by {@link GeoPoint#kilometersTo}\n */\nGeoPoint.EARTH_RADIUS_IN_KILOMETERS = 6371;\n/**\n * The Earth radius in miles used by {@link GeoPoint#milesTo}\n */\nGeoPoint.EARTH_RADIUS_IN_MILES = 3956;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR2VvUG9pbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJHZW9Qb2ludC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTs7Ozs7R0FLRztBQUNILE1BQU0sT0FBTyxRQUFRO0lBK0NuQjs7OztPQUlHO0lBQ0gsWUFBWSxRQUF1RixFQUNqRyxTQUFrQjtRQUNsQixJQUFJLEdBQVcsQ0FBQztRQUNoQixJQUFJLEdBQVcsQ0FBQztRQUNoQixJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsRUFBRTtZQUNoQyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3BDLEdBQUcsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMzQyxHQUFHLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0M7YUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDbEMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsUUFBUSxDQUFDO1NBQ3ZCO2FBQU0sSUFBSSxPQUFPLFFBQVEsS0FBSyxRQUFRLEVBQUU7WUFDdkMsR0FBRyxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUM7WUFDeEIsR0FBRyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUM7U0FDMUI7YUFBTTtZQUNMLEdBQUcsR0FBRyxPQUFPLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEdBQUcsR0FBRyxPQUFPLFNBQVMsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3JEO1FBRUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUM7UUFDckIsSUFBSSxDQUFD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","import { EntityManagerFactory } from './EntityManagerFactory';\nexport const db = (() => {\n    const emf = new EntityManagerFactory();\n    const bq = emf.createEntityManager(true);\n    Object.assign(bq, {\n        configure(options) {\n            emf.configure(options);\n            return this;\n        },\n        connect(hostOrApp, secure, doneCallback, failCallback) {\n            if (secure instanceof Function) {\n                return this.connect(hostOrApp, undefined, secure, doneCallback);\n            }\n            emf.connect(hostOrApp, secure);\n            return this.ready(doneCallback, failCallback);\n        },\n    });\n    return bq;\n})();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFxZW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmFxZW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBOEI5RCxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUU7SUFDdEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxvQkFBb0IsRUFBRSxDQUFDO0lBQ3ZDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUV6QyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRTtRQUNoQixTQUFTLENBQWUsT0FBTztZQUM3QixHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE9BQU8sQ0FBZSxTQUFpQixFQUFFLE1BQTJCLEVBQUUsWUFBa0IsRUFBRSxZQUFrQjtZQUMxRyxJQUFJLE1BQU0sWUFBWSxRQUFRLEVBQUU7Z0JBQzlCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQzthQUNqRTtZQUVELEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQy9CLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDaEQsQ0FBQztLQUNpQixDQUFDLENBQUM7SUFFdEIsT0FBTyxFQUFZLENBQUM7QUFDdEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyJ9","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as messages from './message';\nimport { FileFactory, LoginOption, } from './binding';\nimport { atob, deprecated, isNode, Lockable, uuid, } from './util';\nimport { StatusCode, OAuthMessages, } from './connector';\nimport { BloomFilter } from './caching';\nimport { GeoPoint } from './GeoPoint';\nimport { Builder } from './query';\nimport { EntityExistsError, IllegalEntityError, PersistentError } from './error';\nimport { MapAttribute, PluralAttribute, } from './metamodel';\nimport { Logger, Metadata, Modules, ValidationResult, Validator, } from './intersection';\nconst DB_PREFIX = '/db/';\nexport class EntityManager extends Lockable {\n    /**\n     * @param entityManagerFactory The factory which of this entityManager instance\n     */\n    constructor(entityManagerFactory) {\n        super();\n        /**\n         * Constructor for a new List collection\n         */\n        this.List = Array;\n        /**\n         * Constructor for a new Set collection\n         */\n        this.Set = Set;\n        /**\n         * Constructor for a new Map collection\n         */\n        this.Map = Map;\n        /**\n         * Constructor for a new GeoPoint\n         */\n        this.GeoPoint = GeoPoint;\n        /**\n         * Log messages can created by calling log directly as function, with a specific log level or with the helper\n         * methods, which a members of the log method.\n         *\n         * Logs will be filtered by the client logger and the before they persisted. The default log level is\n         * 'info' therefore all log messages below the given message aren't persisted.\n         *\n         * Examples:\n         * <pre class=\"prettyprint\">\n         // default log level ist info\n         db.log('test message %s', 'my string');\n         // info: test message my string\n      \n         // pass a explicit log level as the first argument, one of ('trace', 'debug', 'info', 'warn', 'error')\n         db.log('warn', 'test message %d', 123);\n         // warn: test message 123\n      \n         // debug log level will not be persisted by default, since the default logging level is info\n         db.log('debug', 'test message %j', {number: 123}, {});\n         // debug: test message {\"number\":123}\n         // data = {}\n      \n         // One additional json object can be provided, which will be persisted together with the log entry\n         db.log('info', 'test message %s, %s', 'first', 'second', {number: 123});\n         // info: test message first, second\n         // data = {number: 123}\n      \n         //use the log level helper\n         db.log.info('test message', 'first', 'second', {number: 123});\n         // info: test message first second\n         // data = {number: 123}\n      \n         //change the default log level to trace, i.e. all log levels will be persisted, note that the log level can be\n         //additionally configured in the baqend\n         db.log.level = 'trace';\n      \n         //trace will be persisted now\n         db.log.trace('test message', 'first', 'second', {number: 123});\n         // info: test message first second\n         // data = {number: 123}\n         * </pre>\n         */\n        this.log = Logger.create(this);\n        /**\n         * The connector used for requests\n         */\n        this.connection = null;\n        /**\n         * All managed and cached entity instances\n         * @type Map<String,Entity>\n         * @private\n         */\n        this.entities = {};\n        this.modules = new Modules(this);\n        /**\n         * The current logged in user object\n         */\n        this.me = null;\n        /**\n         * The current registered device object\n         */\n        this.deviceMe = null;\n        /**\n         * Returns the tokenStorage which will be used to authorize all requests.\n         */\n        this.tokenStorage = null; // is never null after em is ready\n        /**\n         * The bloom filter which contains staleness information of cached objects\n         */\n        this.bloomFilter = null;\n        /**\n         * Set of object ids that were revalidated after the Bloom filter was loaded.\n         */\n        this.cacheWhiteList = null;\n        /**\n         * Set of object ids that were updated but are not yet included in the bloom filter.\n         * This set essentially implements revalidation by side effect which does not work in Chrome.\n         */\n        this.cacheBlackList = null;\n        /**\n         * Bloom filter refresh interval in seconds.\n         */\n        this.bloomFilterRefresh = 60;\n        /**\n         * Bloom filter refresh Promise\n         */\n        this.bloomFilterLock = new Lockable();\n        /**\n         * A File factory for file objects.\n         * The file factory can be called to create new instances for files.\n         * The created instances implements the {@link File} interface\n         */\n        this.File = null; // is never null after the em is ready\n        this.entityManagerFactory = entityManagerFactory;\n        this.metamodel = entityManagerFactory.metamodel;\n        this.code = entityManagerFactory.code;\n    }\n    /**\n     * Determine whether the entity manager is open.\n     * true until the entity manager has been closed\n     */\n    get isOpen() {\n        return !!this.connection;\n    }\n    /**\n     * The authentication token if the user is logged in currently\n     */\n    get token() {\n        return this.tokenStorage.token;\n    }\n    /**\n     * Whether caching is disabled\n     * @deprecated\n     */\n    get isCachingDisabled() {\n        return !this.isCachingEnabled();\n    }\n    /**\n     * Whether caching is enabled\n     */\n    isCachingEnabled() {\n        return !!this.bloomFilter;\n    }\n    /**\n     * Returns true if the device token is already registered, otherwise false.\n     */\n    get isDeviceRegistered() {\n        return !!this.deviceMe;\n    }\n    /**\n     * The authentication token if the user is logged in currently\n     * @param value\n     */\n    set token(value) {\n        this.tokenStorage.update(value);\n    }\n    /**\n     * Connects this entityManager, used for synchronous and asynchronous initialization\n     * @param connector\n     * @param connectData\n     * @param tokenStorage The used tokenStorage for token persistence\n     */\n    connected(connector, connectData, tokenStorage) {\n        this.connection = connector;\n        this.tokenStorage = tokenStorage;\n        this.bloomFilterRefresh = this.entityManagerFactory.staleness;\n        this.File = FileFactory.create(this);\n        this._createObjectFactory(this.metamodel.embeddables);\n        this._createObjectFactory(this.metamodel.entities);\n        if (connectData) {\n            if (connectData.device) {\n                this._updateDevice(connectData.device);\n            }\n            if (connectData.user && tokenStorage.token) {\n                this._updateUser(connectData.user, true);\n            }\n            if (this.bloomFilterRefresh > 0 && connectData.bloomFilter && atob && !isNode) {\n                this._updateBloomFilter(connectData.bloomFilter);\n            }\n        }\n    }\n    /**\n     * @param types\n     * @return    * @private\n     */\n    _createObjectFactory(types) {\n        const values = Object.values(types);\n        for (let i = 0; i < values.length; i += 1) {\n            const type = values[i];\n            const { name } = type;\n            if (this[name]) {\n                type.typeConstructor = this[name];\n                Object.defineProperty(this, name, {\n                    value: type.createObjectFactory(this),\n                });\n            }\n            else {\n                Object.defineProperty(this, name, {\n                    get() {\n                        Object.defineProperty(this, name, {\n                            value: type.createObjectFactory(this),\n                        });\n                        return this[name];\n                    },\n                    set(typeConstructor) {\n                        type.typeConstructor = typeConstructor;\n                    },\n                    configurable: true,\n                });\n            }\n        }\n    }\n    send(message, ignoreCredentialError = true) {\n        if (!this.connection) {\n            throw new Error('This EntityManager is not connected.');\n        }\n        const msg = message;\n        msg.tokenStorage(this.tokenStorage);\n        let result = this.connection.send(msg);\n        if (!ignoreCredentialError) {\n            result = result.catch((e) => {\n                if (e.status === StatusCode.BAD_CREDENTIALS) {\n                    this._logout();\n                }\n                throw e;\n            });\n        }\n        return result;\n    }\n    /**\n     * Get an instance whose state may be lazily fetched\n     *\n     * If the requested instance does not exist in the database, the\n     * EntityNotFoundError is thrown when the instance state is first accessed.\n     * The application should not expect that the instance state will be available upon detachment,\n     * unless it was accessed by the application while the entity manager was open.\n     *\n     * @param entityClass\n     * @param key\n     * @return\n     */\n    getReference(entityClass, key) {\n        let id = null;\n        let type;\n        if (key) {\n            const keyAsStr = key;\n            type = this.metamodel.entity(entityClass);\n            if (keyAsStr.indexOf(DB_PREFIX) === 0) {\n                id = keyAsStr;\n            }\n            else {\n                id = `${type.ref}/${encodeURIComponent(keyAsStr)}`;\n            }\n        }\n        else if (typeof entityClass === 'string') {\n            const keyIndex = entityClass.indexOf('/', DB_PREFIX.length); // skip /db/\n            if (keyIndex !== -1) {\n                id = entityClass;\n            }\n            type = this.metamodel.entity(keyIndex !== -1 ? entityClass.substring(0, keyIndex) : entityClass);\n        }\n        else {\n            type = this.metamodel.entity(entityClass);\n        }\n        let entity = this.entities[id];\n        if (!entity) {\n            entity = type.create();\n            const metadata = Metadata.get(entity);\n            if (id) {\n                metadata.id = id;\n            }\n            metadata.setUnavailable();\n            this._attach(entity);\n        }\n        return entity;\n    }\n    /**\n     * Creates an instance of {@link Builder<T>} for query creation and execution\n     *\n     * The query results are instances of the resultClass argument.\n     *\n     * @param resultClass - the type of the query result\n     * @return A query builder to create one ore more queries for the specified class\n     */\n    createQueryBuilder(resultClass) {\n        return new Builder(this, resultClass);\n    }\n    /**\n     * Clear the persistence context, causing all managed entities to become detached\n     *\n     * Changes made to entities that have not been flushed to the database will not be persisted.\n     *\n     * @return\n     */\n    clear() {\n        this.entities = {};\n    }\n    /**\n     * Close an application-managed entity manager\n     *\n     * After the close method has been invoked, all methods on the EntityManager instance\n     * and any Query and TypedQuery objects obtained from it will throw the IllegalStateError\n     * except for transaction, and isOpen (which will return false). If this method\n     * is called when the entity manager is associated with an active transaction,\n     * the persistence context remains managed until the transaction completes.\n     *\n     * @return\n     */\n    close() {\n        this.connection = null;\n        return this.clear();\n    }\n    /**\n     * Check if the instance is a managed entity instance belonging to the current persistence context\n     *\n     * @param entity - entity instance\n     * @return boolean indicating if entity is in persistence context\n     */\n    contains(entity) {\n        return !!entity && !!entity.id && this.entities[entity.id] === entity;\n    }\n    /**\n     * Check if an object with the id from the given entity is already attached\n     *\n     * @param entity - entity instance\n     * @return boolean indicating if entity with same id is attached\n     */\n    containsById(entity) {\n        return !!(entity && entity.id && this.entities[entity.id]);\n    }\n    /**\n     * Remove the given entity from the persistence context, causing a managed entity to become detached\n     *\n     * Unflushed changes made to the entity if any (including removal of the entity),\n     * will not be synchronized to the database. Entities which previously referenced the detached entity will continue\n     * to reference it.\n     *\n     * @param entity The entity instance to detach.\n     * @return\n     */\n    detach(entity) {\n        const state = Metadata.get(entity);\n        return state.withLock(() => {\n            this.removeReference(entity);\n            return Promise.resolve(entity);\n        });\n    }\n    /**\n     * Resolve the depth by loading the referenced objects of the given entity\n     *\n     * @param entity - entity instance\n     * @param [options] The load options\n     * @return\n     */\n    resolveDepth(entity, options) {\n        if (!options || !options.depth) {\n            return Promise.resolve(entity);\n        }\n        const resolved = options.resolved || [];\n        const promises = [];\n        const subOptions = Object.assign(Object.assign({}, options), { resolved, depth: options.depth === true ? true : options.depth - 1 });\n        this.getSubEntities(entity, 1).forEach((subEntity) => {\n            if (subEntity !== null && resolved.indexOf(subEntity) === -1 && subEntity.id) {\n                resolved.push(subEntity);\n                promises.push(this.load(subEntity.id, undefined, subOptions));\n            }\n        });\n        return Promise.all(promises).then(() => entity);\n    }\n    /**\n     * Search for an entity of the specified oid\n     *\n     * If the entity instance is contained in the persistence context, it is returned from there.\n     *\n     * @param entityClass - entity class\n     * @param oid - Object ID\n     * @param [options] The load options.\n     * @return the loaded entity or null\n     */\n    load(entityClass, oid, options) {\n        const opt = options || {};\n        const entity = this.getReference(entityClass, oid);\n        const state = Metadata.get(entity);\n        if (!opt.refresh && opt.local && state.isAvailable) {\n            return this.resolveDepth(entity, opt);\n        }\n        const msg = new messages.GetObject(state.bucket, state.key);\n        this.ensureCacheHeader(entity.id, msg, opt.refresh);\n        return this.send(msg).then((response) => {\n            // refresh object if loaded older version from cache\n            // chrome doesn't using cache when ifNoneMatch is set\n            if (entity.version && entity.version > response.entity.version) {\n                opt.refresh = true;\n                return this.load(entityClass, oid, opt);\n            }\n            this.addToWhiteList(response.entity.id);\n            if (response.status !== StatusCode.NOT_MODIFIED) {\n                state.type.fromJsonValue(state, response.entity, entity, { persisting: true });\n            }\n            return this.resolveDepth(entity, opt);\n        }, (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                this.removeReference(entity);\n                state.setRemoved();\n                return null;\n            }\n            throw e;\n        });\n    }\n    /**\n     * @param entity\n     * @param options\n     * @return\n     */\n    insert(entity, options) {\n        const opt = options || {};\n        let isNew;\n        return this._save(entity, opt, (state, json) => {\n            if (state.version) {\n                throw new PersistentError('Existing objects can\\'t be inserted.');\n            }\n            isNew = !state.id;\n            return new messages.CreateObject(state.bucket, json);\n        }).then((val) => {\n            if (isNew) {\n                this._attach(entity);\n            }\n            return val;\n        });\n    }\n    /**\n     * @param entity\n     * @param options\n     * @return\n     */\n    update(entity, options) {\n        const opt = options || {};\n        return this._save(entity, opt, (state, json) => {\n            if (!state.version) {\n                throw new PersistentError('New objects can\\'t be inserted.');\n            }\n            if (opt.force) {\n                const { version } = json, jsonWithoutVersion = __rest(json, [\"version\"]);\n                return new messages.ReplaceObject(state.bucket, state.key, jsonWithoutVersion)\n                    .ifMatch('*');\n            }\n            return new messages.ReplaceObject(state.bucket, state.key, json)\n                .ifMatch(`${state.version}`);\n        });\n    }\n    /**\n     * @param entity\n     * @param options The save options\n     * @param withoutLock Set true to save the entity without locking\n     * @return\n     */\n    save(entity, options, withoutLock = false) {\n        const opt = options || {};\n        const msgFactory = (state, json) => {\n            if (opt.force) {\n                if (!state.id) {\n                    throw new PersistentError('New special objects can\\'t be forcefully saved.');\n                }\n                const { version } = json, jsonWithoutVersion = __rest(json, [\"version\"]);\n                return new messages.ReplaceObject(state.bucket, state.key, jsonWithoutVersion);\n            }\n            if (state.version) {\n                return new messages.ReplaceObject(state.bucket, state.key, json)\n                    .ifMatch(state.version);\n            }\n            return new messages.CreateObject(state.bucket, json);\n        };\n        return withoutLock ? this._locklessSave(entity, opt, msgFactory) : this._save(entity, opt, msgFactory);\n    }\n    /**\n     * @param entity\n     * @param cb pre-safe callback\n     * @return\n     */\n    optimisticSave(entity, cb) {\n        return Metadata.get(entity).withLock(() => this._optimisticSave(entity, cb));\n    }\n    /**\n     * @param entity\n     * @param cb pre-safe callback\n     * @return\n     * @private\n     */\n    _optimisticSave(entity, cb) {\n        let abort = false;\n        const abortFn = () => {\n            abort = true;\n        };\n        const promise = Promise.resolve(cb(entity, abortFn));\n        if (abort) {\n            return Promise.resolve(entity);\n        }\n        return promise.then(() => (this.save(entity, {}, true)\n            .catch((e) => {\n            if (e.status === 412) {\n                return this.refresh(entity, {})\n                    .then(() => this._optimisticSave(entity, cb));\n            }\n            throw e;\n        })));\n    }\n    /**\n     * Save the object state without locking\n     * @param entity\n     * @param options\n     * @param msgFactory\n     * @return\n     * @private\n     */\n    _locklessSave(entity, options, msgFactory) {\n        this.attach(entity);\n        const state = Metadata.get(entity);\n        let refPromises;\n        let json;\n        if (state.isAvailable) {\n            // getting json will check all collections changes, therefore we must do it before proofing the dirty state\n            json = state.type.toJsonValue(state, entity, {\n                persisting: true,\n            });\n        }\n        if (state.isDirty) {\n            if (!options.refresh) {\n                state.setPersistent();\n            }\n            const sendPromise = this.send(msgFactory(state, json)).then((response) => {\n                if (state.id && state.id !== response.entity.id) {\n                    this.removeReference(entity);\n                    state.id = response.entity.id;\n                    this._attach(entity);\n                }\n                state.type.fromJsonValue(state, response.entity, entity, {\n                    persisting: options.refresh,\n                    onlyMetadata: !options.refresh,\n                });\n                return entity;\n            }, (e) => {\n                if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                    this.removeReference(entity);\n                    state.setRemoved();\n                    return null;\n                }\n                state.setDirty();\n                throw e;\n            });\n            refPromises = [sendPromise];\n        }\n        else {\n            refPromises = [Promise.resolve(entity)];\n        }\n        const subOptions = Object.assign({}, options);\n        subOptions.depth = 0;\n        this.getSubEntities(entity, options.depth).forEach((sub) => {\n            refPromises.push(this._save(sub, subOptions, msgFactory));\n        });\n        return Promise.all(refPromises).then(() => entity);\n    }\n    /**\n     * Save and lock the object state\n     * @param entity\n     * @param options\n     * @param msgFactory\n     * @return\n     * @private\n     */\n    _save(entity, options, msgFactory) {\n        this.ensureBloomFilterFreshness();\n        const state = Metadata.get(entity);\n        if (state.version) {\n            this.addToBlackList(entity.id);\n        }\n        return state.withLock(() => this._locklessSave(entity, options, msgFactory));\n    }\n    /**\n     * Returns all referenced sub entities for the given depth and root entity\n     * @param entity\n     * @param depth\n     * @param [resolved]\n     * @param initialEntity\n     * @return\n     */\n    getSubEntities(entity, depth, resolved = [], initialEntity) {\n        if (!depth) {\n            return resolved;\n        }\n        const obj = initialEntity || entity;\n        const state = Metadata.get(entity);\n        const iter = state.type.references();\n        for (let item = iter.next(); !item.done; item = iter.next()) {\n            const { value } = item;\n            const subEntities = this.getSubEntitiesByPath(entity, value.path);\n            for (let i = 0, len = subEntities.length; i < len; i += 1) {\n                const subEntity = subEntities[i];\n                if (resolved.indexOf(subEntity) === -1 && subEntity !== obj) {\n                    resolved.push(subEntity);\n                    this.getSubEntities(subEntity, depth === true ? depth : depth - 1, resolved, obj);\n                }\n            }\n        }\n        return resolved;\n    }\n    /**\n     * Returns all referenced one level sub entities for the given path\n     * @param entity\n     * @param path\n     * @return\n     */\n    getSubEntitiesByPath(entity, path) {\n        let subEntities = [entity];\n        path.forEach((attributeName) => {\n            const tmpSubEntities = [];\n            subEntities.forEach((subEntity) => {\n                const curEntity = subEntity[attributeName];\n                if (!curEntity) {\n                    return;\n                }\n                const attribute = this.metamodel.managedType(subEntity.constructor).getAttribute(attributeName);\n                if (attribute instanceof PluralAttribute) {\n                    const iter = curEntity.entries();\n                    for (let item = iter.next(); !item.done; item = iter.next()) {\n                        const entry = item.value;\n                        tmpSubEntities.push(entry[1]);\n                        if (attribute instanceof MapAttribute && attribute.keyType.isEntity) {\n                            tmpSubEntities.push(entry[0]);\n                        }\n                    }\n                }\n                else {\n                    tmpSubEntities.push(curEntity);\n                }\n            });\n            subEntities = tmpSubEntities;\n        });\n        return subEntities;\n    }\n    /**\n     * Delete the entity instance.\n     * @param entity\n     * @param options The delete options\n     * @return\n     */\n    delete(entity, options) {\n        const opt = options || {};\n        this.attach(entity);\n        const state = Metadata.get(entity);\n        return state.withLock(() => {\n            if (!state.version && !opt.force) {\n                throw new IllegalEntityError(entity);\n            }\n            const msg = new messages.DeleteObject(state.bucket, state.key);\n            this.addToBlackList(entity.id);\n            if (!opt.force) {\n                msg.ifMatch(`${state.version}`);\n            }\n            const refPromises = [this.send(msg).then(() => {\n                    this.removeReference(entity);\n                    state.setRemoved();\n                    return entity;\n                })];\n            const subOptions = Object.assign({}, opt);\n            subOptions.depth = 0;\n            this.getSubEntities(entity, opt.depth).forEach((sub) => {\n                refPromises.push(this.delete(sub, subOptions));\n            });\n            return Promise.all(refPromises).then(() => entity);\n        });\n    }\n    /**\n     * Synchronize the persistence context to the underlying database.\n     *\n     * @return\n     */\n    flush() {\n        throw new Error('Not implemented.');\n    }\n    /**\n     * Make an instance managed and persistent.\n     * @param entity - entity instance\n     * @return\n     */\n    persist(entity) {\n        this.attach(entity);\n    }\n    /**\n     * Refresh the state of the instance from the database, overwriting changes made to the entity, if any.\n     * @param entity - entity instance\n     * @param options The refresh options\n     * @return\n     */\n    refresh(entity, options) {\n        if (!entity.id) {\n            // entity is not persisted so far\n            return Promise.resolve(entity);\n        }\n        return this.load(entity.id, undefined, Object.assign(Object.assign({}, options), { refresh: true }));\n    }\n    /**\n     * Attach the instance to this database context, if it is not already attached\n     * @param entity The entity to attach\n     * @return\n     */\n    attach(entity) {\n        if (!this.contains(entity)) {\n            const type = this.metamodel.entity(entity.constructor);\n            if (!type) {\n                throw new IllegalEntityError(entity);\n            }\n            if (this.containsById(entity)) {\n                throw new EntityExistsError(entity);\n            }\n            this._attach(entity);\n        }\n    }\n    _attach(entity) {\n        const metadata = Metadata.get(entity);\n        if (metadata.isAttached) {\n            if (metadata.db !== this) {\n                throw new EntityExistsError(entity);\n            }\n        }\n        else {\n            metadata.db = this;\n        }\n        if (!metadata.id) {\n            if (metadata.type.name !== 'User' && metadata.type.name !== 'Role' && metadata.type.name !== 'logs.AppLog') {\n                metadata.id = `${DB_PREFIX + metadata.type.name}/${uuid()}`;\n            }\n        }\n        if (metadata.id) {\n            this.entities[metadata.id] = entity;\n        }\n    }\n    removeReference(entity) {\n        const state = Metadata.get(entity);\n        if (!state || !state.id) {\n            throw new IllegalEntityError(entity);\n        }\n        delete this.entities[state.id];\n    }\n    register(user, password, loginOption) {\n        const login = loginOption > LoginOption.NO_LOGIN;\n        if (this.me && login) {\n            throw new PersistentError('User is already logged in.');\n        }\n        return this.withLock(() => {\n            const msg = new messages.Register({ user, password, login });\n            return this._userRequest(msg, loginOption);\n        });\n    }\n    login(username, password, loginOption) {\n        if (this.me) {\n            throw new PersistentError('User is already logged in.');\n        }\n        return this.withLock(() => {\n            const msg = new messages.Login({ username, password });\n            return this._userRequest(msg, loginOption);\n        });\n    }\n    logout() {\n        return this.withLock(() => this.send(new messages.Logout()).then(this._logout.bind(this)));\n    }\n    loginWithOAuth(provider, clientID, options) {\n        if (!this.connection) {\n            throw new Error('This EntityManager is not connected.');\n        }\n        if (this.me) {\n            throw new PersistentError('User is already logged in.');\n        }\n        const opt = Object.assign({ title: `Login with ${provider}`, timeout: 5 * 60 * 1000, state: {}, loginOption: true }, options);\n        if (opt.redirect) {\n            Object.assign(opt.state, { redirect: opt.redirect, loginOption: opt.loginOption });\n        }\n        let msg;\n        if (OAuthMessages[provider]) {\n            msg = new OAuthMessages[provider](clientID, opt.scope, JSON.stringify(opt.state));\n            msg.addRedirectOrigin(this.connection.origin + this.connection.basePath);\n        }\n        else {\n            throw new Error(`OAuth provider ${provider} not supported.`);\n        }\n        if (opt.path) {\n            msg.path(opt.path);\n        }\n        const windowOptions = { width: `${opt.width}`, height: `${opt.height}` };\n        if (opt.redirect) {\n            // use oauth via redirect by opening the login in the same window\n            // for app wrappers we need to open the system browser\n            const isBrowser = document.URL.indexOf('http://') !== -1 || document.URL.indexOf('https://') !== -1;\n            this.openOAuthWindow(msg.request.path, isBrowser ? '_self' : '_system', windowOptions);\n            return new Promise(() => { });\n        }\n        const req = this._userRequest(msg, opt.loginOption);\n        this.openOAuthWindow(msg.request.path, opt.title, windowOptions);\n        return new Promise((resolve, reject) => {\n            const timeout = setTimeout(() => {\n                reject(new PersistentError('OAuth login timeout.'));\n            }, opt.timeout);\n            req.then(resolve, reject).then(() => {\n                clearTimeout(timeout);\n            });\n        });\n    }\n    /**\n     * Opens a new window use for OAuth logins\n     * @param url The url to open\n     * @param targetOrTitle The target of the window, or the title of the popup\n     * @param options Additional window options\n     * @return\n     */\n    openOAuthWindow(url, targetOrTitle, options) {\n        const str = Object.keys(options)\n            .filter((key) => options[key] !== undefined)\n            .map((key) => `${key}=${options[key]}`)\n            .join(',');\n        open(url, targetOrTitle, str); // eslint-disable-line no-restricted-globals\n    }\n    renew(loginOption) {\n        return this.withLock(() => {\n            const msg = new messages.Me();\n            return this._userRequest(msg, loginOption);\n        });\n    }\n    newPassword(username, password, newPassword) {\n        return this.withLock(() => {\n            const msg = new messages.NewPassword({ username, password, newPassword });\n            return this.send(msg, true).then((response) => this._updateUser(response.entity));\n        });\n    }\n    newPasswordWithToken(token, newPassword, loginOption) {\n        return this.withLock(() => (this._userRequest(new messages.NewPassword({ token, newPassword }), loginOption)));\n    }\n    resetPassword(username) {\n        return this.send(new messages.ResetPassword({ username }));\n    }\n    changeUsername(username, newUsername, password) {\n        return this.send(new messages.ChangeUsername({ username, newUsername, password }));\n    }\n    _updateUser(obj, updateMe = false) {\n        const user = this.getReference(obj.id);\n        const metadata = Metadata.get(user);\n        metadata.type.fromJsonValue(metadata, obj, user, { persisting: true });\n        if (updateMe) {\n            this.me = user;\n        }\n        return user;\n    }\n    _logout() {\n        this.me = null;\n        this.token = null;\n    }\n    _userRequest(msg, loginOption) {\n        const opt = loginOption === undefined ? true : loginOption;\n        const login = opt > LoginOption.NO_LOGIN;\n        if (login) {\n            this.tokenStorage.temporary = opt < LoginOption.PERSIST_LOGIN;\n        }\n        return this.send(msg, !login)\n            .then((response) => (response.entity ? this._updateUser(response.entity, login) : null), (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                if (login) {\n                    this._logout();\n                }\n                return null;\n            }\n            throw e;\n        });\n    }\n    /**\n     * @param deviceType The OS of the device (IOS/Android)\n     * @param subscription WebPush subscription\n     * @param device\n     * @return\n     */\n    registerDevice(deviceType, subscription, device) {\n        const msg = new messages.DeviceRegister({ devicetype: deviceType, subscription: subscription, device });\n        msg.withCredentials = true;\n        return this.send(msg)\n            .then((response) => this._updateDevice(response.entity));\n    }\n    _updateDevice(obj) {\n        const device = this.getReference(obj.id);\n        const metadata = Metadata.get(device);\n        metadata.type.fromJsonValue(metadata, obj, device, { persisting: true });\n        this.deviceMe = device;\n        return device;\n    }\n    checkDeviceRegistration() {\n        return this.send(new messages.DeviceRegistered())\n            .then(() => true, (e) => {\n            if (e.status === StatusCode.OBJECT_NOT_FOUND) {\n                return false;\n            }\n            throw e;\n        });\n    }\n    pushDevice(pushMessage) {\n        return this.send(new messages.DevicePush(pushMessage.toJSON()));\n    }\n    /**\n     * The given entity will be checked by the validation code of the entity type.\n     *\n     * @param entity\n     * @return result\n     */\n    validate(entity) {\n        const { type } = Metadata.get(entity);\n        const result = new ValidationResult();\n        const iter = type.attributes();\n        for (let item = iter.next(); !item.done; item = iter.next()) {\n            const validate = new Validator(item.value.name, entity);\n            result.fields[validate.key] = validate;\n        }\n        const { validationCode } = type;\n        if (validationCode) {\n            validationCode(result.fields);\n        }\n        return result;\n    }\n    /**\n     * Adds the given object id to the cacheWhiteList if needed.\n     * @param objectId The id to add.\n     * @return\n     */\n    addToWhiteList(objectId) {\n        if (this.isCachingEnabled()) {\n            if (this.bloomFilter.contains(objectId)) {\n                this.cacheWhiteList.add(objectId);\n            }\n            this.cacheBlackList.delete(objectId);\n        }\n    }\n    /**\n     * Adds the given object id to the cacheBlackList if needed.\n     * @param objectId The id to add.\n     * @return\n     */\n    addToBlackList(objectId) {\n        if (this.isCachingEnabled() && objectId) {\n            if (!this.bloomFilter.contains(objectId)) {\n                this.cacheBlackList.add(objectId);\n            }\n            this.cacheWhiteList.delete(objectId);\n        }\n    }\n    refreshBloomFilter() {\n        if (!this.isCachingEnabled()) {\n            return Promise.resolve(null);\n        }\n        const msg = new messages.GetBloomFilter();\n        msg.noCache();\n        return this.send(msg).then((response) => {\n            this._updateBloomFilter(response.entity);\n            return this.bloomFilter;\n        });\n    }\n    _updateBloomFilter(bloomFilter) {\n        this.bloomFilter = new BloomFilter(bloomFilter);\n        this.cacheWhiteList = new Set();\n        this.cacheBlackList = new Set();\n    }\n    /**\n     * Checks the freshness of the bloom filter and does a reload if necessary\n     */\n    ensureBloomFilterFreshness() {\n        if (!this.isCachingEnabled()) {\n            return;\n        }\n        const now = new Date().getTime();\n        const refreshRate = this.bloomFilterRefresh * 1000;\n        if (this.bloomFilterLock.isReady && now - this.bloomFilter.creation > refreshRate) {\n            this.bloomFilterLock.withLock(() => this.refreshBloomFilter());\n        }\n    }\n    /**\n     * Checks for a given id, if revalidation is required, the resource is stale or caching was disabled\n     * @param id The object id to check\n     * @return Indicates if the resource must be revalidated\n     */\n    mustRevalidate(id) {\n        if (isNode) {\n            return false;\n        }\n        this.ensureBloomFilterFreshness();\n        if (!this.isCachingEnabled() || !this.bloomFilterLock.isReady) {\n            return true;\n        }\n        return !this.cacheWhiteList.has(id) && (this.cacheBlackList.has(id) || this.bloomFilter.contains(id));\n    }\n    /**\n     * @param id To check the bloom filter\n     * @param message To attach the headers\n     * @param refresh To force the reload headers\n     * @return\n     */\n    ensureCacheHeader(id, message, refresh) {\n        const noCache = refresh || !id || this.mustRevalidate(id);\n        if (noCache) {\n            message.noCache();\n        }\n    }\n    /**\n     * Creates a absolute url for the given relative one\n     * @param relativePath the relative url\n     * @param authorize indicates if authorization credentials should be generated and be attached to the url\n     * @return a absolute url which is optionally signed with a resource token which authenticates the currently\n     * logged in user\n     */\n    createURL(relativePath, authorize) {\n        const { connection } = this;\n        if (!connection) {\n            throw new Error('This EntityManager is not connected.');\n        }\n        return this.tokenStorage.signPath(connection.basePath + relativePath, authorize)\n            .then((path) => {\n            let url = connection.origin + path;\n            if (this.mustRevalidate(relativePath)) {\n                url += `${authorize ? '&' : '?'}BCB`;\n            }\n            return url;\n        });\n    }\n    /**\n     * Requests a perpetual token for the given user\n     *\n     * Only users with the admin role are allowed to request an API token.\n     *\n     * @param entityClass\n     * @param user The user object or id of the user object\n     * @return\n     */\n    requestAPIToken(entityClass, user) {\n        const userObj = this._getUserReference(entityClass, user);\n        const msg = new messages.UserToken(userObj.key);\n        return this.send(msg).then((resp) => resp.entity);\n    }\n    /**\n     * Revoke all created tokens for the given user\n     *\n     * This method will revoke all previously issued tokens and the user must login again.\n     *\n     * @param entityClass\n     * @param user The user object or id of the user object\n     */\n    revokeAllTokens(entityClass, user) {\n        const userObj = this._getUserReference(entityClass, user);\n        const msg = new messages.RevokeUserToken(userObj.key);\n        return this.send(msg);\n    }\n    _getUserReference(entityClass, user) {\n        if (typeof user === 'string') {\n            return this.getReference(entityClass, user);\n        }\n        return user;\n    }\n}\n__decorate([\n    deprecated('EntityManager.isCachingEnabled()')\n], EntityManager.prototype, \"isCachingDisabled\", null);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5TWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkVudGl0eU1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssUUFBUSxNQUFNLFdBQVcsQ0FBQztBQUN0QyxPQUFPLEVBQ0wsV0FBVyxFQU1YLFdBQVcsR0FDWixNQUFNLFdBQVcsQ0FBQztBQUNuQixPQUFPLEVBQ0wsSUFBSSxFQUNHLFVBQVUsRUFDakIsTUFBTSxFQUVOLFFBQVEsRUFDUixJQUFJLEdBQ0wsTUFBTSxRQUFRLENBQUM7QUFDaEIsT0FBTyxFQUNJLFVBQVUsRUFBYSxhQUFhLEdBQzlDLE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDeEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUt0QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxrQkFBa0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDakYsT0FBTyxFQUNMLFlBQVksRUFBMkIsZUFBZSxHQUN2RCxNQUFNLGFBQWEsQ0FBQztBQUVyQixPQUFPLEVBRUwsTUFBTSxFQUNOLFFBQVEsRUFDUixPQUFPLEVBR1AsZ0JBQWdCLEVBQ2hCLFNBQVMsR0FDVixNQUFNLGdCQUFnQixDQUFDO0FBRXhCLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQztBQUl6QixNQUFNLE9BQU8sYUFBYyxTQUFRLFFBQVE7SUFtTHpDOztPQUVHO0lBQ0gsWUFBWSxvQkFBMEM7UUFDcEQsS0FBSyxFQUFFLENBQUM7UUF0TFY7O1dBRUc7UUFDYSxTQUFJLEdBQUcsS0FBSyxDQUFDO1FBRTdCOztXQUVHO1FBQ2EsUUFBRyxHQUFHLEdBQUcsQ0FBQztRQUUxQjs7V0FFRztRQUNhLFFBQUcsR0FBRyxHQUFHLENBQUM7UUFF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","import { EntityManager } from './EntityManager';\nimport * as message from './message';\nimport { Connector, WebSocketConnector, } from './connector';\nimport { Lockable } from './util';\nimport { TokenStorage, Code } from './intersection';\nimport { Metamodel } from './metamodel';\nconst CONNECTED = Symbol('Connected');\nconst WS = Symbol('WebSocket');\nexport class EntityManagerFactory extends Lockable {\n    /**\n     * Creates a new EntityManagerFactory connected to the given destination\n     * @param [options] The destination to connect with, or an options object\n     * @param [options.host] The destination to connect with\n     * @param [options.port=80|443] The optional destination port to connect with\n     * @param [options.secure=false] <code>true</code> To use a secure ssl encrypted connection\n     * @param [options.basePath=\"/v1\"] The base path of the api\n     * @param [options.schema=null] The serialized schema as json used to initialize the metamodel\n     * @param [options.tokenStorage] The tokenStorage which should be used by this emf\n     * @param [options.tokenStorageFactory] The tokenStorage factory implementation which\n     * should be used for token storage\n     * @param [options.staleness=60] The maximum staleness of objects that are acceptable while reading cached\n     * data\n     */\n    constructor(options = {}) {\n        super();\n        this.connection = null;\n        this.metamodel = this.createMetamodel();\n        this.code = new Code(this.metamodel, this);\n        this.tokenStorageFactory = TokenStorage.WEB_STORAGE || TokenStorage.GLOBAL;\n        this.tokenStorage = null;\n        this.staleness = null;\n        const opt = typeof options === 'string' ? { host: options } : options || {};\n        this.configure(opt);\n        let isReady = true;\n        let ready = new Promise((success) => {\n            this[CONNECTED] = success;\n        });\n        if (opt.host) {\n            this.connect(opt.host, opt.port, opt.secure, opt.basePath);\n        }\n        else {\n            isReady = false;\n        }\n        if (!this.tokenStorage) {\n            isReady = false;\n            ready = ready\n                .then(() => this.tokenStorageFactory.create(this.connection.origin))\n                .then((tokenStorage) => {\n                this.tokenStorage = tokenStorage;\n            });\n        }\n        if (opt.schema) {\n            this.connectData = opt;\n            this.metamodel.init(opt.schema);\n        }\n        else {\n            isReady = false;\n            ready = ready.then(() => {\n                const msg = new message.Connect();\n                msg.withCredentials = true; // used for registered devices\n                if (this.staleness === 0) {\n                    msg.noCache();\n                }\n                return this.send(msg);\n            }).then((response) => {\n                this.connectData = response.entity;\n                if (this.staleness === null) {\n                    this.staleness = this.connectData.bloomFilterRefresh || 60;\n                }\n                if (!this.metamodel.isInitialized) {\n                    this.metamodel.init(this.connectData.schema);\n                }\n                this.tokenStorage.update(this.connectData.token);\n            });\n        }\n        if (!isReady) {\n            this.withLock(() => ready, true);\n        }\n    }\n    /**\n     * Retrieves the websocket connection if the websocket SDK is available\n     */\n    get websocket() {\n        if (!this[WS]) {\n            const { secure } = this.connection;\n            let url;\n            if (this.connectData.websocket) {\n                url = (secure ? 'wss:' : 'ws:') + this.connectData.websocket;\n            }\n            else {\n                url = `${this.connection.origin.replace(/^http/, 'ws') + this.connection.basePath}/events`;\n            }\n            this[WS] = WebSocketConnector.create(url);\n        }\n        return this[WS];\n    }\n    /**\n     * Apply additional configurations to this EntityManagerFactory\n     * @param options The additional configuration options\n     * @param [options.tokenStorage] The tokenStorage which should be used by this emf\n     * @param [options.tokenStorageFactory] The tokenStorage factory implementation which\n     * should be used for token storage\n     * @param [options.staleness=60] The maximum staleness of objects that are acceptable while reading cached\n     * data, <code>0</code> to always bypass the browser cache\n     * @return\n     */\n    configure(options) {\n        if (this.connection) {\n            throw new Error('The EntityManagerFactory can only be configured before is is connected.');\n        }\n        if (options.tokenStorage) {\n            this.tokenStorage = options.tokenStorage;\n        }\n        if (options.tokenStorageFactory) {\n            this.tokenStorageFactory = options.tokenStorageFactory;\n        }\n        if (options.staleness !== undefined) {\n            this.staleness = options.staleness;\n        }\n    }\n    connect(hostOrApp, port, secure, basePath) {\n        if (this.connection) {\n            throw new Error('The EntityManagerFactory is already connected.');\n        }\n        if (typeof port === 'boolean') {\n            return this.connect(hostOrApp, 0, port, secure);\n        }\n        this.connection = Connector.create(hostOrApp, port, secure, basePath);\n        this[CONNECTED]();\n        return this.ready();\n    }\n    /**\n     * Creates a new Metamodel instance, which is not connected\n     * @return A new Metamodel instance\n     */\n    createMetamodel() {\n        return new Metamodel(this);\n    }\n    /**\n     * Create a new application-managed EntityManager.\n     *\n     * @param useSharedTokenStorage The token storage to persist the authorization token, or\n     * <code>true</code> To use the shared token storage of the emf.\n     * <code>false</code> To use a instance based storage.\n     *\n     * @return a new entityManager\n     */\n    createEntityManager(useSharedTokenStorage) {\n        const em = new EntityManager(this);\n        if (this.isReady) {\n            em.connected(this.connection, this.connectData, useSharedTokenStorage ? this.tokenStorage : new TokenStorage(this.connection.origin));\n        }\n        else {\n            em.withLock(() => this.ready().then(() => {\n                em.connected(this.connection, this.connectData, useSharedTokenStorage ? this.tokenStorage : new TokenStorage(this.connection.origin));\n            }), true);\n        }\n        return em;\n    }\n    send(msg) {\n        if (!msg.tokenStorage()) {\n            msg.tokenStorage(this.tokenStorage);\n        }\n        return this.connection.send(msg);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5TWFuYWdlckZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbnRpdHlNYW5hZ2VyRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDaEQsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDckMsT0FBTyxFQUNMLFNBQVMsRUFBcUIsa0JBQWtCLEdBQ2pELE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBVyxRQUFRLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBdUIsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUV4QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDdEMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBWS9CLE1BQU0sT0FBTyxvQkFBcUIsU0FBUSxRQUFRO0lBb0NoRDs7Ozs7Ozs7Ozs7OztPQWFHO0lBQ0gsWUFBWSxVQVNDLEVBQUU7UUFDYixLQUFLLEVBQUUsQ0FBQztRQTNESCxlQUFVLEdBQXFCLElBQUksQ0FBQztRQUVwQyxjQUFTLEdBQWMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRTlDLFNBQUksR0FBUyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTVDLHdCQUFtQixHQUF3QixZQUFZLENBQUMsV0FBVyxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUM7UUFFM0YsaUJBQVksR0FBd0IsSUFBSSxDQUFDO1FBRXpDLGNBQVMsR0FBa0IsSUFBSSxDQUFDO1FBbURyQyxNQUFNLEdBQUcsR0FBRyxPQUFPLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFF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","/**\n * An abstract Query which allows retrieving results\n */\nexport class Query {\n    /**\n     * @param entityManager - The owning EntityManager of this query\n     * @param resultClass - The result class of this query\n     */\n    constructor(entityManager, resultClass) {\n        this.entityManager = entityManager;\n        this.resultClass = resultClass;\n    }\n    /**\n     * Add an ascending sort for the specified field to this query\n     * @param field The field to sort\n     * @return The resulting Query\n     */\n    ascending(field) {\n        return this.addOrder(field, 1);\n    }\n    /**\n     * Add an decending sort for the specified field to this query\n     * @param field The field to sort\n     * @return The resulting Query\n     */\n    descending(field) {\n        return this.addOrder(field, -1);\n    }\n    /**\n     * Sets the sort of the query and discard all existing paramaters\n     * @param sort The new sort of the query which is an object whose keys are fields and the\n     * values are either +1 for ascending order or -1 for descending order\n     * @return The resulting Query\n     *\n     * @see http://docs.mongodb.org/manual/reference/method/cursor.sort/\n     */\n    sort(sort) {\n        if (typeof sort !== 'object' || Object.getPrototypeOf(sort) !== Object.prototype) {\n            throw new Error('sort must be an object.');\n        }\n        return this.addOrder(sort);\n    }\n    /**\n     * Sets the offset of the query, i.e. how many elements should be skipped\n     * @param offset The offset of this query\n     * @return The resulting Query\n     *\n     * @see http://docs.mongodb.org/manual/reference/method/cursor.skip/\n     */\n    offset(offset) {\n        if (offset < 0) {\n            throw new Error('The offset can\\'t be nagative.');\n        }\n        return this.addOffset(offset);\n    }\n    /**\n     * Sets the limit of this query, i.e hox many objects should be returnd\n     * @param limit The limit of this query\n     * @return The resulting Query\n     *\n     * @see http://docs.mongodb.org/manual/reference/method/cursor.limit/\n     */\n    limit(limit) {\n        if (limit < 0) {\n            throw new Error('The limit can\\'t be nagative.');\n        }\n        return this.addLimit(limit);\n    }\n}\nQuery.MAX_URI_SIZE = 2000;\nexport function flatArgs(args) {\n    return Array.prototype.concat.apply([], args);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUXVlcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJRdWVyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFRQTs7R0FFRztBQUNILE1BQU0sT0FBZ0IsS0FBSztJQUd6Qjs7O09BR0c7SUFDSCxZQUNrQixhQUE0QixFQUM1QixXQUFxQjtRQURyQixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixnQkFBVyxHQUFYLFdBQVcsQ0FBVTtJQUNwQyxDQUFDO0lBRUo7Ozs7T0FJRztJQUNILFNBQVMsQ0FBQyxLQUFhO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxVQUFVLENBQUMsS0FBYTtRQUN0QixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxJQUFJLENBQUMsSUFBK0I7UUFDbEMsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ2hGLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztTQUM1QztRQUVELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsTUFBTSxDQUFDLE1BQWM7UUFDbkIsSUFBSSxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxLQUFLLENBQUMsS0FBYTtRQUNqQixJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUM7U0FDbEQ7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7QUF6RXNCLGtCQUFZLEdBQUcsSUFBSSxDQUFDO0FBMlE3QyxNQUFNLFVBQVUsUUFBUSxDQUFDLElBQVc7SUFDbEMsT0FBTyxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ2hELENBQUMifQ==","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { Observable } from '../util/observable';\nimport { uuid } from '../util';\nimport { Metadata } from '../intersection';\nexport class Stream {\n    /**\n     * Creates a live updating object stream for a query\n     *\n     * @param entityManager The owning entity manager of this query\n     * @param query The query options\n     * @param query.query The serialized query\n     * @param query.bucket The Bucket on which the streaming query is performed\n     * @param query.sort the sort string\n     * @param query.limit the count, i.e. the number of items in the result\n     * @param query.offset offset, i.e. the number of items to skip\n     * @param query.initial Indicates if the initial result should be returned\n     * @param options an object containing parameters\n     * @return The query result as a live updating stream of objects\n     */\n    static createEventStream(entityManager, query, options) {\n        const opt = options || {};\n        opt.reconnects = 0;\n        return Stream.streamObservable(entityManager, query, opt, (msg, next) => {\n            const { type } = msg, eventProps = __rest(msg, [\"type\"]);\n            if (msg.type === 'result') {\n                msg.data.forEach((obj, index) => {\n                    const event = Object.assign(Object.assign(Object.assign({ matchType: 'add', operation: 'none', initial: true }, eventProps), { data: Stream.resolveObject(entityManager, obj) }), (query.sort && { index }));\n                    next(event);\n                });\n            }\n            if (msg.type === 'match') {\n                next(Object.assign(Object.assign({ initial: false }, eventProps), { data: Stream.resolveObject(entityManager, msg.data) }));\n            }\n        });\n    }\n    /**\n     * Creates a live updating result stream for a query\n     *\n     * @alias query.Stream.createStreamResult<T>\n     * @param entityManager The owning entity manager of this query\n     * @param query The query options\n     * @param query.query The serialized query\n     * @param query.bucket The Bucket on which the streaming query is performed\n     * @param query.sort the sort string\n     * @param query.limit the count, i.e. the number of items in the result\n     * @param query.offset offset, i.e. the number of items to skip\n     * @param options an object containing parameters\n     * @return The query result as a live updating query result\n     */\n    static createResultStream(entityManager, query, options) {\n        const opt = options || {};\n        opt.initial = true;\n        opt.matchTypes = 'all';\n        opt.operations = 'any';\n        let result;\n        const ordered = !!query.sort;\n        return Stream.streamObservable(entityManager, query, opt, (event, next) => {\n            if (event.type === 'result') {\n                result = event.data.map((obj) => Stream.resolveObject(entityManager, obj));\n                next(result.slice());\n            }\n            if (event.type === 'match') {\n                const obj = Stream.resolveObject(entityManager, event.data);\n                if (event.matchType === 'remove' || event.matchType === 'changeIndex') {\n                    // if we have removed the instance our self, we do not have the cached instances anymore\n                    // therefore we can't find it anymore in the result by identity\n                    for (let i = 0, len = result.length; i < len; i += 1) {\n                        if (result[i].id === event.data.id) {\n                            result.splice(i, 1);\n                            break;\n                        }\n                    }\n                }\n                if (event.matchType === 'add' || event.matchType === 'changeIndex') {\n                    if (ordered) {\n                        result.splice(event.index, 0, obj);\n                    }\n                    else {\n                        result.push(obj);\n                    }\n                }\n                next(result.slice());\n            }\n        });\n    }\n    static streamObservable(entityManager, query, options, mapper) {\n        const opt = Stream.parseOptions(options);\n        const socket = entityManager.entityManagerFactory.websocket;\n        const observable = new Observable((subscriber) => {\n            const id = uuid();\n            const stream = socket.openStream(entityManager.tokenStorage, id);\n            stream.send(Object.assign(Object.assign({ type: 'subscribe' }, query), opt));\n            let closed = false;\n            const next = subscriber.next.bind(subscriber);\n            const subscription = stream.subscribe({\n                complete() {\n                    closed = true;\n                    subscriber.complete();\n                },\n                error(e) {\n                    closed = true;\n                    subscriber.error(e);\n                },\n                next(msg) {\n                    mapper(msg, next);\n                },\n            });\n            return () => {\n                if (!closed) { // send unsubscribe only when we aren't completed by the socket and call it only once\n                    stream.send({ type: 'unsubscribe' });\n                    subscription.unsubscribe();\n                    closed = true;\n                }\n            };\n        });\n        return Stream.cachedObservable(observable, opt);\n    }\n    static cachedObservable(observable, options) {\n        let subscription = null;\n        const observers = [];\n        return new Observable((observer) => {\n            if (!subscription) {\n                let remainingRetries = options.reconnects;\n                let backoff = 1;\n                const subscriptionObserver = {\n                    next(msg) {\n                        // reset the backoff if we get a message\n                        backoff = 1;\n                        observers.forEach((o) => o.next(msg));\n                    },\n                    error(e) {\n                        observers.forEach((o) => o.error(e));\n                    },\n                    complete() {\n                        if (remainingRetries !== 0) {\n                            remainingRetries = remainingRetries < 0 ? -1 : remainingRetries - 1;\n                            setTimeout(() => {\n                                subscription = observable.subscribe(subscriptionObserver);\n                            }, backoff * 1000);\n                            backoff *= 2;\n                        }\n                        else {\n                            observers.forEach((o) => o.complete());\n                        }\n                    },\n                };\n                subscription = observable.subscribe(subscriptionObserver);\n            }\n            observers.push(observer);\n            return () => {\n                observers.splice(observers.indexOf(observer), 1);\n                if (!observers.length && subscription) {\n                    subscription.unsubscribe();\n                    subscription = null;\n                }\n            };\n        });\n    }\n    /**\n     * Parses the StreamOptions\n     *\n     * @param [options] object containing partial options\n     * @returns an object containing VALID options\n     */\n    static parseOptions(options) {\n        const opt = options || {};\n        const verified = {\n            initial: opt.initial === undefined || !!opt.initial,\n            matchTypes: Stream.normalizeMatchTypes(opt.matchTypes),\n            operations: Stream.normalizeOperations(opt.operations),\n            reconnects: Stream.normalizeReconnects(opt.reconnects),\n        };\n        if (verified.matchTypes.indexOf('all') === -1 && verified.operations.indexOf('any') === -1) {\n            throw new Error('Only subscriptions for either operations or matchTypes are allowed. You cannot subscribe to a query using matchTypes and operations at the same time!');\n        }\n        return verified;\n    }\n    static normalizeMatchTypes(list) {\n        return Stream.normalizeSortedSet(list, 'all', 'match types', ['add', 'change', 'changeIndex', 'match', 'remove']);\n    }\n    static normalizeReconnects(reconnects) {\n        if (reconnects === undefined) {\n            return -1;\n        }\n        return reconnects < 0 ? -1 : Number(reconnects);\n    }\n    static normalizeOperations(list) {\n        return Stream.normalizeSortedSet(list, 'any', 'operations', ['delete', 'insert', 'none', 'update']);\n    }\n    static normalizeSortedSet(list, wildcard, itemType, allowedItems) {\n        if (!list) {\n            return [wildcard];\n        }\n        const li = Array.isArray(list) ? list : [list];\n        if (li.length === 0) { // undefined or empty list --> default value\n            return [wildcard];\n        }\n        // sort, remove duplicates and check whether all values are allowed\n        li.sort();\n        let item;\n        let lastItem = null;\n        for (let i = li.length - 1; i >= 0; i -= 1) {\n            item = li[i];\n            if (!item) { // undefined and null item in the list --> invalid!\n                throw new Error('undefined and null not allowed!');\n            }\n            if (item === lastItem) { // remove duplicates\n                li.splice(i, 1);\n            }\n            if (item === wildcard) {\n                return [wildcard];\n            }\n            if (allowedItems.indexOf(item) === -1) { // raise error on invalid elements\n                throw new Error(`${item} not allowed for ${itemType}! (permitted: ${allowedItems}.)`);\n            }\n            lastItem = item;\n        }\n        return li;\n    }\n    static resolveObject(entityManager, object) {\n        const entity = entityManager.getReference(object.id);\n        const metadata = Metadata.get(entity);\n        if (!object.version) {\n            metadata.setRemoved();\n            entityManager.removeReference(entity);\n        }\n        else if (entity.version <= object.version) {\n            metadata.type.fromJsonValue(metadata, object, entity, { persisting: true });\n        }\n        return entity;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RyZWFtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3RyZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBNEIsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsSUFBSSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBTXhDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQThEM0MsTUFBTSxPQUFPLE1BQU07SUFDakI7Ozs7Ozs7Ozs7Ozs7T0FhRztJQUNILE1BQU0sQ0FBQyxpQkFBaUIsQ0FBbUIsYUFBNEIsRUFBRSxLQUFjLEVBQ3JGLE9BQTRCO1FBQzVCLE1BQU0sR0FBRyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDMUIsR0FBRyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDbkIsT0FBTyxNQUFNLENBQUMsZ0JBQWdCLENBQXNCLGFBQWEsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO1lBQzNGLE1BQU0sRUFBRSxJQUFJLEtBQW9CLEdBQUcsRUFBbEIsVUFBVSxVQUFLLEdBQUcsRUFBN0IsUUFBdUIsQ0FBTSxDQUFDO1lBRXBDLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7Z0JBQ3pCLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO29CQUM5QixNQUFNLEtBQUssK0NBQ1QsU0FBUyxFQUFFLEtBQUssRUFDaEIsU0FBUyxFQUFFLE1BQU0sRUFDakIsT0FBTyxFQUFFLElBQUksSUFDVixVQUFVLEtBQ2IsSUFBSSxFQUFFLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxLQUMzQyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUM3QixDQUFDO29CQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQzthQUNKO1lBRUQsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRTtnQkFDeEIsSUFBSSwrQkFDRixPQUFPLEVBQUUsS0FBSyxJQUNWLFVBQXlCLEtBQzdCLElBQUksRUFBRSxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQ25ELENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7O09BYUc7SUFDSCxNQUFNLENBQUMsa0JBQWtCLENBQW1CLGFBQTRCLEVBQUUsS0FBYyxFQUN0RixPQUE2QjtRQUM3QixNQUFNLEdBQUcsR0FBdUIsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUM5QyxHQUFHLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNuQixHQUFHLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN2QixHQUFHLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUV2QixJQUFJLE1BQVcsQ0FBQztRQUNoQixNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUM3QixPQUFPLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBUyxhQUFhLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQWdCLEVBQUUsSUFBSSxFQUFFLEVBQUU7WUFDM0YsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRTtnQkFDM0IsTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUMzRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDdEI7WUFFRCxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFO2dCQUMxQixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFJLGFBQWEsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRS9ELElBQUksS0FBSyxDQUFDLFNBQVMsS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLFNBQVMsS0FBSyxhQUFhLEVBQUU7b0JBQ3JFLHdGQUF3RjtvQkFDeEYsK0RBQStEO29CQUMvRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7d0JBQ3BELElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTs0QkFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7NEJBQ3BCLE1BQU07eUJBQ1A7cUJBQ0Y7aUJBQ0Y7Z0JBRUQsSUFBSSxLQUFLLENBQUMsU0FBUyxLQUFLLEtBQUssSUFBSSxLQUFLLENBQUMsU0FBUyxLQUFLLGFBQWEsRUFBRTtvQkFDbEUsSUFBSSxPQUFPLEVBQUU7d0JBQ1gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztxQkFDcEM7eUJBQU07d0JBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDbEI7aUJBQ0Y7Z0JBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2FBQ3RCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLGdCQUFnQixDQUFzQixhQUE0QixFQUFFLEtBQWMsRUFDdkYsT0FBMkIsRUFBRSxNQUEyRDtRQUN4RixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXpDLE1BQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUM7UUFDNUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxVQUFVLENBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUNsRCxNQUFNLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQztZQUNsQixNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFakUsTUFBTSxDQUFDLElBQUksK0JBQ1QsSUFBSSxFQUFFLFdBQVcsSUFDZCxLQUFLLEdBQ0wsR0FBRyxFQUNOLENBQUM7WUFFSCxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFDbkIsTUFBTSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDOUMsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQztnQkFDcEMsUUFBUTtvQkFDTixNQUFNLEdBQUcsSUFBSSxDQUFDO29CQUNkLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDeEIsQ0FBQztnQkFDRCxLQUFLLENBQUMsQ0FBQztvQkFDTCxNQUFNLEdBQUcsSUFBSSxDQUFDO29CQUNkLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RCLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLEdBQUc7b0JBQ04sTUFBTSxDQUFDLEdBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7YUFDRixDQUFDLENBQUM7WUFFSCxPQUFPLEdBQUcsRUFBRTtnQkFDVixJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUscUZBQXFGO29CQUNsRyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUM7b0JBQ3JDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFDM0IsTUFBTSxHQUFHLElBQUksQ0FBQztpQkFDZjtZQUNILENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCxNQUFNLENBQUMsZ0JBQWdCLENBQUksVUFBeUIsRUFBRSxPQUFnQjtRQUNwRSxJQUFJLFlBQVksR0FBd0IsSUFBSSxDQUFDO1FBQzdDLE1BQU0sU0FBUyxHQUFvQixFQUFFLENBQUM7UUFDdEMsT0FBTyxJQUFJLFVBQVUsQ0FBSSxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ3BDLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ2pCLElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLFVBQW9CLENBQUM7Z0JBQ3BELElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsTUFBTSxvQkFBb0IsR0FBRztvQkFDM0IsSUFBSSxDQUFDLEdBQU07d0JBQ1Qsd0NBQXdDO3dCQUN4QyxPQUFPLEdBQUcsQ0FBQyxDQUFDO3dCQUNaLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDeEMsQ0FBQztvQkFDRCxLQUFLLENBQUMsQ0FBUTt3QkFDWixTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZDLENBQUM7b0JBQ0QsUUFBUTt3QkFDTixJQUFJLGdCQUFnQixLQUFLLENBQUMsRUFBRTs0QkFDMUIsZ0JBQWdCLEdBQUcsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDOzRCQUVwRSxVQUFVLENBQUMsR0FBRyxFQUFFO2dDQUNkLFlBQVksR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUM7NEJBQzVELENBQUMsRUFBRSxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7NEJBRW5CLE9BQU8sSUFBSSxDQUFDLENBQUM7eUJBQ2Q7NkJBQU07NEJBQ0wsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7eUJBQ3hDO29CQUNILENBQUM7aUJBQ0YsQ0FBQztnQkFDRixZQUFZLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO2FBQzNEO1lBQ0QsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN6QixPQUFPLEdBQUcsRUFBRTtnQkFDVixTQUFTLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLFlBQVksRUFBRTtvQkFDckMsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO29CQUMzQixZQUFZLEdBQUcsSUFBSSxDQUFDO2lCQUNyQjtZQUNILENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUE0QjtRQUM5QyxNQUFNLEdBQUcsR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBRTFCLE1BQU0sUUFBUSxHQUFHO1lBQ2YsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFPLEtBQUssU0FBUyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTztZQUNuRCxVQUFVLEVBQUUsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7WUFDdEQsVUFBVSxFQUFFLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDO1lBQ3RELFVBQVUsRUFBRSxNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztTQUN2RCxDQUFDO1FBRUYsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUMxRixNQUFNLElBQUksS0FBSyxDQUFDLHVKQUF1SixDQUFDLENBQUM7U0FDMUs7UUFFRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQsTUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQW1DO1FBQzVELE9BQU8sTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDcEgsQ0FBQztJQUVELE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxVQUF1QztRQUNoRSxJQUFJLFVBQVUsS0FBSyxTQUFTLEVBQUU7WUFDNUIsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUNYO1FBQ0QsT0FBTyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCxNQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBbUM7UUFDNUQsT0FBTyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ3RHLENBQUM7SUFFRCxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBbUMsRUFBRSxRQUFnQixFQUFFLFFBQWdCLEVBQy9GLFlBQXNCO1FBQ3RCLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbkI7UUFFRCxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFL0MsSUFBSSxFQUFFLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxFQUFFLDRDQUE0QztZQUNqRSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbkI7UUFFRCxtRUFBbUU7UUFDbkUsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1YsSUFBSSxJQUFJLENBQUM7UUFDVCxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDcEIsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDMUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNiLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxtREFBbUQ7Z0JBQzlELE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQzthQUNwRDtZQUNELElBQUksSUFBSSxLQUFLLFFBQVEsRUFBRSxFQUFFLG9CQUFvQjtnQkFDM0MsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDakI7WUFDRCxJQUFJLElBQUksS0FBSyxRQUFRLEVBQUU7Z0JBQ3JCLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNuQjtZQUNELElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLGtDQUFrQztnQkFDekUsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLElBQUksb0JBQW9CLFFBQVEsaUJBQWlCLFlBQVksSUFBSSxDQUFDLENBQUM7YUFDdkY7WUFDRCxRQUFRLEdBQUcsSUFBSSxDQUFDO1NBQ2pCO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRUQsTUFBTSxDQUFDLGFBQWEsQ0FBbUIsYUFBNEIsRUFBRSxNQUFlO1FBQ2xGLE1BQU0sTUFBTSxHQUFNLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQVksQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDbkIsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3RCLGFBQWEsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDdkM7YUFBTSxJQUFJLE1BQU0sQ0FBQyxPQUFRLElBQUksTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUM1QyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQzdFO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztDQUNGIn0=","import { Entity } from '../binding';\nimport { Query, } from './Query';\nimport * as message from '../message';\nimport { Metadata } from '../intersection';\nimport { Stream } from './Stream';\n/**\n * A Query Node saves the state of the query being built\n */\nexport class Node extends Query {\n    constructor() {\n        super(...arguments);\n        /**\n         * The offset how many results should be skipped\n         */\n        this.firstResult = 0;\n        /**\n         * The limit how many objects should be returned\n         * @type number\n         * @readonly\n         */\n        this.maxResults = -1;\n        /**\n         * The properties which should be used sort the result\n         */\n        this.order = {};\n    }\n    eventStream(options, onNext, onError, onComplete) {\n        if (options instanceof Function) {\n            return this.eventStream({}, options, onNext, onError);\n        }\n        const observable = Stream.createEventStream(this.entityManager, this.createRealTimeQuery(), options);\n        if (onNext instanceof Function) {\n            return observable.subscribe(onNext, onError, onComplete);\n        }\n        return observable;\n    }\n    resultStream(options, onNext, onError, onComplete) {\n        if (options instanceof Function) {\n            return this.resultStream({}, options, onNext, onError);\n        }\n        const observable = Stream.createResultStream(this.entityManager, this.createRealTimeQuery(), options);\n        if (onNext instanceof Function) {\n            return observable.subscribe(onNext, onError, onComplete);\n        }\n        return observable;\n    }\n    /**\n     * @inheritDoc\n     */\n    resultList(options, doneCallback, failCallback) {\n        var _a;\n        if (options instanceof Function) {\n            return this.resultList({}, options, doneCallback);\n        }\n        const type = this.resultClass ? this.entityManager.metamodel.entity(this.resultClass) : null;\n        if (!type) {\n            throw new Error('Only typed queries can be executed.');\n        }\n        const query = this.serializeQuery();\n        const sort = this.serializeSort();\n        const uriSize = (((_a = this.entityManager.connection) === null || _a === void 0 ? void 0 : _a.host.length) || 0) + query.length + sort.length;\n        let msg;\n        if (uriSize > Query.MAX_URI_SIZE) {\n            msg = new message.AdhocQueryPOST(type.name, this.firstResult, this.maxResults, sort)\n                .entity(query, 'text');\n        }\n        else {\n            msg = new message.AdhocQuery(type.name, query, this.firstResult, this.maxResults, sort);\n        }\n        return this.entityManager.send(msg)\n            .then((response) => this.createResultList(response.entity, options))\n            .then(doneCallback, failCallback);\n    }\n    /**\n     * @inheritDoc\n     */\n    singleResult(options, doneCallback, failCallback) {\n        var _a;\n        if (options instanceof Function) {\n            return this.singleResult({}, options, doneCallback);\n        }\n        const type = this.resultClass ? this.entityManager.metamodel.entity(this.resultClass) : null;\n        if (!type) {\n            throw new Error('Only typed queries can be executed.');\n        }\n        const query = this.serializeQuery();\n        const sort = this.serializeSort();\n        const uriSize = (((_a = this.entityManager.connection) === null || _a === void 0 ? void 0 : _a.host.length) || 0) + query.length;\n        let msg;\n        if (uriSize > Query.MAX_URI_SIZE) {\n            msg = new message.AdhocQueryPOST(type.name, this.firstResult, 1, sort)\n                .entity(query, 'text');\n        }\n        else {\n            msg = new message.AdhocQuery(type.name, query, this.firstResult, 1, sort);\n        }\n        return this.entityManager.send(msg)\n            .then((response) => this.createResultList(response.entity, options))\n            .then((list) => (list.length ? list[0] : null))\n            .then(doneCallback, failCallback);\n    }\n    /**\n     * @inheritDoc\n     */\n    count(doneCallback, failCallback) {\n        var _a;\n        const type = this.resultClass ? this.entityManager.metamodel.entity(this.resultClass) : null;\n        if (!type) {\n            throw new Error('Only typed queries can be executed.');\n        }\n        const query = this.serializeQuery();\n        const uriSize = (((_a = this.entityManager.connection) === null || _a === void 0 ? void 0 : _a.host.length) || 0) + query.length;\n        let msg;\n        if (uriSize > Query.MAX_URI_SIZE) {\n            msg = new message.AdhocCountQueryPOST(type.name)\n                .entity(query, 'text');\n        }\n        else {\n            msg = new message.AdhocCountQuery(type.name, query);\n        }\n        return this.entityManager.send(msg)\n            .then((response) => response.entity.count)\n            .then(doneCallback, failCallback);\n    }\n    serializeQuery() {\n        return JSON.stringify(this, function argSerializer(k, v) {\n            // this referees here to the object which owns the key k\n            const typedValue = this[k];\n            if (typedValue instanceof Date) {\n                return { $date: v };\n            }\n            if (typedValue instanceof Entity) {\n                return typedValue.id;\n            }\n            return v;\n        });\n    }\n    serializeSort() {\n        return JSON.stringify(this.order);\n    }\n    createResultList(result, options) {\n        if (result.length) {\n            return Promise.all(result.map((el) => {\n                if (el.id) {\n                    const entity = this.entityManager.getReference(this.resultClass, el.id);\n                    const metadata = Metadata.get(entity);\n                    metadata.type.fromJsonValue(metadata, el, entity, { persisting: true });\n                    return this.entityManager.resolveDepth(entity, options);\n                }\n                return this.entityManager.load(Object.keys(el)[0]);\n            }))\n                .then((objects) => objects.filter((val) => !!val));\n        }\n        return Promise.resolve([]);\n    }\n    createRealTimeQuery() {\n        const type = this.resultClass ? this.entityManager.metamodel.entity(this.resultClass) : null;\n        if (!type) {\n            throw new Error('Only typed queries can be executed.');\n        }\n        const query = {\n            bucket: type.name,\n            query: this.serializeQuery(),\n        };\n        const sort = this.serializeSort();\n        if (sort && sort !== '{}') {\n            query.sort = sort;\n        }\n        if (this.maxResults > 0) {\n            query.limit = this.maxResults;\n        }\n        if (this.firstResult > 0) {\n            query.offset = this.firstResult;\n        }\n        return query;\n    }\n    addOrder(fieldOrSort, order) {\n        if (typeof fieldOrSort === 'string') {\n            this.order[fieldOrSort] = order;\n        }\n        else {\n            this.order = fieldOrSort;\n        }\n        return this;\n    }\n    addOffset(offset) {\n        this.firstResult = offset;\n        return this;\n    }\n    addLimit(limit) {\n        this.maxResults = limit;\n        return this;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUdwQyxPQUFPLEVBT0wsS0FBSyxHQUtOLE1BQU0sU0FBUyxDQUFDO0FBQ2pCLE9BQU8sS0FBSyxPQUFPLE1BQU0sWUFBWSxDQUFDO0FBR3RDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLElBQXVCLFNBQVEsS0FBUTtJQUFwRDs7UUFDRTs7V0FFRztRQUNJLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBRS9COzs7O1dBSUc7UUFDSSxlQUFVLEdBQVcsQ0FBQyxDQUFDLENBQUM7UUFFL0I7O1dBRUc7UUFDSSxVQUFLLEdBQWdDLEVBQUUsQ0FBQztJQXFOakQsQ0FBQztJQWhOQyxXQUFXLENBQUMsT0FBbUQsRUFBRSxNQUE0QyxFQUMzRyxPQUF5QyxFQUFFLFVBQTZCO1FBRXhFLElBQUksT0FBTyxZQUFZLFFBQVEsRUFBRTtZQUMvQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUFFLE9BQStCLEVBQUUsTUFBc0IsRUFBRSxPQUEyQixDQUFDLENBQUM7U0FDbkg7UUFFRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsaUJBQWlCLENBQUksSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV4RyxJQUFJLE1BQU0sWUFBWSxRQUFRLEVBQUU7WUFDOUIsT0FBTyxVQUFVLENBQUMsU0FBUyxDQUFDLE1BQThCLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQ2xGO1FBRUQsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUtELFlBQVksQ0FBQyxP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","import { flatArgs } from './Query';\nexport const Condition = {\n    where(conditions) {\n        return this.addFilter(null, null, conditions);\n    },\n    equal(field, value) {\n        return this.addFilter(field, null, value);\n    },\n    notEqual(field, value) {\n        return this.addFilter(field, '$ne', value);\n    },\n    greaterThan(field, value) {\n        return this.addFilter(field, '$gt', value);\n    },\n    greaterThanOrEqualTo(field, value) {\n        return this.addFilter(field, '$gte', value);\n    },\n    lessThan(field, value) {\n        return this.addFilter(field, '$lt', value);\n    },\n    lessThanOrEqualTo(field, value) {\n        return this.addFilter(field, '$lte', value);\n    },\n    between(field, greaterValue, lessValue) {\n        return this\n            .addFilter(field, '$gt', greaterValue)\n            .addFilter(field, '$lt', lessValue);\n    },\n    in(field, ...args) {\n        return this.addFilter(field, '$in', flatArgs(args));\n    },\n    notIn(field, ...args) {\n        return this.addFilter(field, '$nin', flatArgs(args));\n    },\n    isNull(field) {\n        return this.equal(field, null);\n    },\n    isNotNull(field) {\n        return this.addFilter(field, '$exists', true)\n            .addFilter(field, '$ne', null);\n    },\n    containsAll(field, ...args) {\n        return this.addFilter(field, '$all', flatArgs(args));\n    },\n    mod(field, divisor, remainder) {\n        return this.addFilter(field, '$mod', [divisor, remainder]);\n    },\n    matches(field, regExp) {\n        const reg = regExp instanceof RegExp ? regExp : new RegExp(regExp);\n        if (reg.ignoreCase) {\n            throw new Error('RegExp.ignoreCase flag is not supported.');\n        }\n        if (reg.global) {\n            throw new Error('RegExp.global flag is not supported.');\n        }\n        if (reg.source.indexOf('^') !== 0) {\n            throw new Error('regExp must be an anchored expression, i.e. it must be started with a ^.');\n        }\n        const result = this.addFilter(field, '$regex', reg.source);\n        if (reg.multiline) {\n            result.addFilter(field, '$options', 'm');\n        }\n        return result;\n    },\n    size(field, size) {\n        return this.addFilter(field, '$size', size);\n    },\n    near(field, geoPoint, maxDistance) {\n        return this.addFilter(field, '$nearSphere', {\n            $geometry: {\n                type: 'Point',\n                coordinates: [geoPoint.longitude, geoPoint.latitude],\n            },\n            $maxDistance: maxDistance,\n        });\n    },\n    withinPolygon(field, ...args) {\n        const geoPoints = flatArgs(args);\n        return this.addFilter(field, '$geoWithin', {\n            $geometry: {\n                type: 'Polygon',\n                coordinates: [geoPoints.map((geoPoint) => [geoPoint.longitude, geoPoint.latitude])],\n            },\n        });\n    },\n};\n// aliases\nObject.assign(Condition, {\n    eq: Condition.equal,\n    ne: Condition.notEqual,\n    lt: Condition.lessThan,\n    le: Condition.lessThanOrEqualTo,\n    gt: Condition.greaterThan,\n    ge: Condition.greaterThanOrEqualTo,\n    containsAny: Condition.in,\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uZGl0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ29uZGl0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxTQUFTLENBQUM7QUE0VW5DLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBNEI7SUFDaEQsS0FBSyxDQUF1QixVQUFVO1FBQ3BDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxLQUFLLENBQXVCLEtBQUssRUFBRSxLQUFLO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxRQUFRLENBQXVCLEtBQUssRUFBRSxLQUFLO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxXQUFXLENBQXVCLEtBQUssRUFBRSxLQUFLO1FBQzVDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxvQkFBb0IsQ0FBdUIsS0FBSyxFQUFFLEtBQUs7UUFDckQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELFFBQVEsQ0FBdUIsS0FBSyxFQUFFLEtBQUs7UUFDekMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELGlCQUFpQixDQUF1QixLQUFLLEVBQUUsS0FBSztRQUNsRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxL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","import { Node } from './Node';\nimport { Condition } from './Condition';\nexport class Filter extends Node {\n    constructor() {\n        super(...arguments);\n        /**\n         * The actual filters of this node\n         */\n        this.filter = {};\n    }\n    /**\n     * @inheritDoc\n     */\n    addFilter(field, filter, value) {\n        if (field !== null) {\n            if (typeof field !== 'string') {\n                throw new Error('Field must be a string.');\n            }\n            if (filter) {\n                const currentFilter = this.filter[field];\n                let fieldFilter;\n                if (typeof currentFilter === 'object' && Object.getPrototypeOf(currentFilter) === Object.prototype) {\n                    fieldFilter = currentFilter;\n                }\n                else {\n                    fieldFilter = {};\n                    this.filter[field] = fieldFilter;\n                }\n                fieldFilter[filter] = value;\n            }\n            else {\n                this.filter[field] = value;\n            }\n        }\n        else {\n            Object.assign(this.filter, value);\n        }\n        return this;\n    }\n    toJSON() {\n        return this.filter;\n    }\n}\nObject.assign(Filter.prototype, Condition);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRmlsdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDOUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQVd4QyxNQUFNLE9BQU8sTUFBeUIsU0FBUSxJQUFPO0lBQXJEOztRQUNFOztXQUVHO1FBQ2EsV0FBTSxHQUFpQixFQUFFLENBQUM7SUFtQzVDLENBQUM7SUFqQ0M7O09BRUc7SUFDSCxTQUFTLENBQUMsS0FBb0IsRUFBRSxNQUFxQixFQUFFLEtBQVU7UUFDL0QsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO1lBQ2xCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO2dCQUM3QixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7YUFDNUM7WUFFRCxJQUFJLE1BQU0sRUFBRTtnQkFDVixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN6QyxJQUFJLFdBQXlCLENBQUM7Z0JBQzlCLElBQUksT0FBTyxhQUFhLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEtBQUssTUFBTSxDQUFDLFNBQVMsRUFBRTtvQkFDbEcsV0FBVyxHQUFHLGFBQTZCLENBQUM7aUJBQzdDO3FCQUFNO29CQUNMLFdBQVcsR0FBRyxFQUFFLENBQUM7b0JBQ2pCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsV0FBVyxDQUFDO2lCQUNsQztnQkFFRCxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDO2FBQzdCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDO2FBQzVCO1NBQ0Y7YUFBTTtZQUNMLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNuQztRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELE1BQU07UUFDSixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztDQUNGO0FBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDIn0=","import { Node } from './Node';\n/**\n * An Operator saves the state of a combined query\n */\nexport class Operator extends Node {\n    /**\n     * @param entityManager The owning entity manager of this query\n     * @param resultClass The query result class\n     * @param operator The operator used to join the childes\n     * @param childes The childes to join\n     */\n    constructor(entityManager, resultClass, operator, childes) {\n        super(entityManager, resultClass);\n        this.operator = operator;\n        this.childes = childes;\n    }\n    toJSON() {\n        const json = {};\n        json[this.operator] = this.childes;\n        return json;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3BlcmF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJPcGVyYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBSTlCOztHQUVHO0FBQ0gsTUFBTSxPQUFPLFFBQTJCLFNBQVEsSUFBTztJQVdyRDs7Ozs7T0FLRztJQUNILFlBQVksYUFBNEIsRUFBRSxXQUFxQixFQUFFLFFBQWdCLEVBQUUsT0FBa0I7UUFDbkcsS0FBSyxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sSUFBSSxHQUFzQyxFQUFFLENBQUM7UUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ25DLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGIn0=","import { Filter } from './Filter';\nimport { Condition } from './Condition';\nimport { Operator } from './Operator';\nimport { Query, flatArgs, } from './Query';\nimport { Node } from './Node';\nexport class Builder extends Query {\n    /**\n     * Joins the conditions by an logical AND\n     * @param args The query nodes to join\n     * @return Returns a new query which joins the given queries by a logical AND\n     */\n    and(...args) {\n        return this.addOperator('$and', flatArgs(args));\n    }\n    /**\n     * Joins the conditions by an logical OR\n     * @param args The query nodes to join\n     * @return Returns a new query which joins the given queries by a logical OR\n     */\n    or(...args) {\n        return this.addOperator('$or', flatArgs(args));\n    }\n    /**\n     * Joins the conditions by an logical NOR\n     * @param args The query nodes to join\n     * @return Returns a new query which joins the given queries by a logical NOR\n     */\n    nor(...args) {\n        return this.addOperator('$nor', flatArgs(args));\n    }\n    eventStream(options, onNext, onError, onComplete) {\n        return this.where({}).eventStream(options, onNext, onError, onComplete);\n    }\n    resultStream(options, onNext, onError, onComplete) {\n        return this.where({}).resultStream(options, onNext, onError, onComplete);\n    }\n    /**\n     * @inheritDoc\n     */\n    resultList(options, doneCallback, failCallback) {\n        return this.where({}).resultList(options, doneCallback, failCallback);\n    }\n    /**\n     * @inheritDoc\n     */\n    singleResult(options, doneCallback, failCallback) {\n        return this.where({}).singleResult(options, doneCallback, failCallback);\n    }\n    /**\n     * @inheritDoc\n     */\n    count(doneCallback, failCallback) {\n        return this.where({}).count(doneCallback, failCallback);\n    }\n    addOperator(operator, args) {\n        if (args.length < 2) {\n            throw new Error(`Only two or more queries can be joined with an ${operator} operator.`);\n        }\n        args.forEach((arg, index) => {\n            if (!(arg instanceof Node)) {\n                throw new Error(`Argument at index ${index} is not a query.`);\n            }\n        });\n        return new Operator(this.entityManager, this.resultClass, operator, args);\n    }\n    addOrder(fieldOrSort, order) {\n        return new Filter(this.entityManager, this.resultClass).addOrder(fieldOrSort, order);\n    }\n    addFilter(field, filter, value) {\n        return new Filter(this.entityManager, this.resultClass).addFilter(field, filter, value);\n    }\n    addOffset(offset) {\n        return new Filter(this.entityManager, this.resultClass).addOffset(offset);\n    }\n    addLimit(limit) {\n        return new Filter(this.entityManager, this.resultClass).addLimit(limit);\n    }\n}\nObject.assign(Builder.prototype, Condition);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkJ1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUtMLEtBQUssRUFFd0YsUUFBUSxHQUN0RyxNQUFNLFNBQVMsQ0FBQztBQUVqQixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBTzlCLE1BQU0sT0FBTyxPQUEwQixTQUFRLEtBQVE7SUFDckQ7Ozs7T0FJRztJQUNILEdBQUcsQ0FBQyxHQUFHLElBQWtDO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxFQUFFLENBQUMsR0FBRyxJQUFrQztRQUN0QyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsSUFBa0M7UUFDdkMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBUUQsV0FBVyxDQUFDLE9BQW1ELEVBQUUsTUFBNEMsRUFDM0csT0FBeUMsRUFDekMsVUFBNkI7UUFDN0IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBUUQsWUFBWSxDQUFDLE9BQXFELEVBQUUsTUFBNkMsRUFDL0csT0FBeUMsRUFBRSxVQUE2QjtRQUN4RSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVUsQ0FBQyxPQUErQyxFQUN4RCxZQUFtRCxFQUFFLFlBQTJCO1FBQ2hGLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZLENBQUMsT0FBaUQsRUFDNUQsWUFBcUQsRUFBRSxZQUEyQjtRQUNsRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDMUUsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLFlBQTRCLEVBQUUsWUFBMkI7UUFDN0QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVELFdBQVcsQ0FBQyxRQUFnQixFQUFFLElBQWU7UUFDM0MsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLGtEQUFrRCxRQUFRLFlBQVksQ0FBQyxDQUFDO1NBQ3pGO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUMxQixJQUFJLENBQUMsQ0FBQyxHQUFHLFlBQVksSUFBSSxDQUFDLEVBQUU7Z0JBQzFCLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLEtBQUssa0JBQWtCLENBQUMsQ0FBQzthQUMvRDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxRQUFRLENBQUMsV0FBK0MsRUFBRSxLQUFjO1FBQ3RFLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQW9CLEVBQUUsTUFBcUIsRUFBRSxLQUFVO1FBQy9ELE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDMUYsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFjO1FBQ3RCLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYTtRQUNwQixPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxRSxDQUFDO0NBQ0Y7QUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUMifQ==","export class UpdateOperation {\n    /**\n     * @param name\n     * @param path\n     * @param [value]\n     */\n    constructor(name, path, value) {\n        this.name = name;\n        this.path = path;\n        this.value = value;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXBkYXRlT3BlcmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXBkYXRlT3BlcmF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxlQUFlO0lBQzFCOzs7O09BSUc7SUFDSCxZQUFtQixJQUFZLEVBQVMsSUFBWSxFQUFTLEtBQVc7UUFBckQsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFTLFNBQUksR0FBSixJQUFJLENBQVE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFNO0lBQUcsQ0FBQztDQUM3RSJ9","import { UpdateOperation } from './UpdateOperation';\nconst ALLOWED_OPERATIONS = [\n    '$add',\n    '$and',\n    '$currentDate',\n    '$dec',\n    '$inc',\n    '$max',\n    '$min',\n    '$mul',\n    '$or',\n    '$pop',\n    '$push',\n    '$put',\n    '$remove',\n    '$rename',\n    '$replace',\n    '$set',\n    '$shift',\n    '$unshift',\n    '$xor',\n];\nexport class PartialUpdateBuilder {\n    /**\n     * @param operations\n     */\n    constructor(operations) {\n        this.operations = [];\n        if (operations) {\n            this.addOperations(operations);\n        }\n    }\n    /**\n     * Sets a field to a given value\n     *\n     * @param field The field to set\n     * @param value The value to set to\n     * @return\n     */\n    set(field, value) {\n        let val = value;\n        if (val instanceof Set) {\n            val = Array.from(val);\n        }\n        else if (val instanceof Map) {\n            const newValue = {};\n            val.forEach((v, k) => {\n                newValue[k] = v;\n            });\n            val = newValue;\n        }\n        return this.addOperation(field, '$set', val);\n    }\n    /**\n     * Increments a field by a given value\n     *\n     * @param field The field to increment\n     * @param by The number to increment by, defaults to 1\n     * @return\n     */\n    inc(field, by) {\n        return this.addOperation(field, '$inc', typeof by === 'number' ? by : 1);\n    }\n    /**\n     * Decrements a field by a given value\n     *\n     * @param field The field to decrement\n     * @param by The number to decrement by, defaults to 1\n     * @return\n     */\n    dec(field, by) {\n        return this.inc(field, typeof by === 'number' ? -by : -1);\n    }\n    /**\n     * Multiplies a field by a given number\n     *\n     * @param field The field to multiply\n     * @param multiplicator The number to multiply by\n     * @return\n     */\n    mul(field, multiplicator) {\n        if (typeof multiplicator !== 'number') {\n            throw new Error('Multiplicator must be a number.');\n        }\n        return this.addOperation(field, '$mul', multiplicator);\n    }\n    /**\n     * Divides a field by a given number\n     *\n     * @param field The field to divide\n     * @param divisor The number to divide by\n     * @return\n     */\n    div(field, divisor) {\n        if (typeof divisor !== 'number') {\n            throw new Error('Divisor must be a number.');\n        }\n        return this.addOperation(field, '$mul', 1 / divisor);\n    }\n    /**\n     * Sets the highest possible value of a field\n     *\n     * @param field The field to compare with\n     * @param value The highest possible value\n     * @return\n     */\n    min(field, value) {\n        if (typeof value !== 'number') {\n            throw new Error('Value must be a number');\n        }\n        return this.addOperation(field, '$min', value);\n    }\n    /**\n     * Sets the smallest possible value of a field\n     *\n     * @param field The field to compare with\n     * @param value The smalles possible value\n     * @return\n     */\n    max(field, value) {\n        if (typeof value !== 'number') {\n            throw new Error('Value must be a number');\n        }\n        return this.addOperation(field, '$max', value);\n    }\n    /**\n     * Removes an item from an array or map\n     *\n     * @param field The field to perform the operation on\n     * @param item The item to add\n     * @return\n     */\n    remove(field, item) {\n        return this.addOperation(field, '$remove', item);\n    }\n    /**\n     * Puts an item from an array or map\n     *\n     * @param field The field to perform the operation on\n     * @param key The map key to put the value to or an object of arguments\n     * @param [value] The value to put if a key was used\n     * @return\n     */\n    put(field, key, value) {\n        const obj = {};\n        if (typeof key === 'string' || typeof key === 'number') {\n            obj[key] = value;\n        }\n        else if (typeof key === 'object') {\n            Object.assign(obj, key);\n        }\n        return this.addOperation(field, '$put', obj);\n    }\n    /**\n     * Pushes an item into a list\n     *\n     * @param field The field to perform the operation on\n     * @param item The item to add\n     * @return\n     */\n    push(field, item) {\n        return this.addOperation(field, '$push', item);\n    }\n    /**\n     * Unshifts an item into a list\n     *\n     * @param field The field to perform the operation on\n     * @param item The item to add\n     * @return\n     */\n    unshift(field, item) {\n        return this.addOperation(field, '$unshift', item);\n    }\n    /**\n     * Pops the last item out of a list\n     *\n     * @param field The field to perform the operation on\n     * @return\n     */\n    pop(field) {\n        return this.addOperation(field, '$pop');\n    }\n    /**\n     * Shifts the first item out of a list\n     *\n     * @param field The field to perform the operation on\n     * @return\n     */\n    shift(field) {\n        return this.addOperation(field, '$shift');\n    }\n    /**\n     * Adds an item to a set\n     *\n     * @param field The field to perform the operation on\n     * @param item The item to add\n     * @return\n     */\n    add(field, item) {\n        return this.addOperation(field, '$add', item);\n    }\n    /**\n     * Replaces an item at a given index\n     *\n     * @param path The path to perform the operation on\n     * @param index The index where the item will be replaced\n     * @param item The item to replace with\n     * @return\n     */\n    replace(path, index, item) {\n        if (this.hasOperationOnPath(path)) {\n            throw new Error(`You cannot update ${path} multiple times`);\n        }\n        return this.addOperation(`${path}.${index}`, '$replace', item);\n    }\n    /**\n     * Sets a datetime field to the current moment\n     *\n     * @param field The field to perform the operation on\n     * @return\n     */\n    currentDate(field) {\n        return this.addOperation(field, '$currentDate');\n    }\n    /**\n     * Performs a bitwise AND on a path\n     *\n     * @param path The path to perform the operation on\n     * @param bitmask The bitmask taking part in the operation\n     * @return\n     */\n    and(path, bitmask) {\n        return this.addOperation(path, '$and', bitmask);\n    }\n    /**\n     * Performs a bitwise OR on a path\n     *\n     * @param path The path to perform the operation on\n     * @param bitmask The bitmask taking part in the operation\n     * @return\n     */\n    or(path, bitmask) {\n        return this.addOperation(path, '$or', bitmask);\n    }\n    /**\n     * Performs a bitwise XOR on a path\n     *\n     * @param path The path to perform the operation on\n     * @param bitmask The bitmask taking part in the operation\n     * @return\n     */\n    xor(path, bitmask) {\n        return this.addOperation(path, '$xor', bitmask);\n    }\n    /**\n     * Renames a field\n     *\n     * @param oldPath The old field name\n     * @param newPath The new field name\n     * @return\n     */\n    rename(oldPath, newPath) {\n        return this.addOperation(oldPath, '$rename', newPath);\n    }\n    /**\n     * Returns a JSON representation of this partial update\n     *\n     * @return\n     */\n    toJSON() {\n        return this.operations.reduce((json, operation) => (Object.assign(Object.assign({}, json), { [operation.name]: Object.assign(Object.assign({}, json[operation.name]), { [operation.path]: operation.value }) })), {});\n    }\n    /**\n     * Executes the partial update\n     *\n     * @return The promise resolves when the partial update has been executed successfully\n     * @abstract\n     */\n    execute() {\n        throw new Error('Cannot call \"execute\" on abstract PartialUpdateBuilder');\n    }\n    /**\n     * Adds an update operation on the partial update\n     *\n     * @param path The path which gets modified by the operation\n     * @param operator The operator of the operation to add\n     * @param [value] The value used to execute the operation\n     * @return\n     * @private\n     */\n    addOperation(path, operator, value) {\n        if (typeof path !== 'string') {\n            throw new Error('Path must be a string');\n        }\n        if (ALLOWED_OPERATIONS.indexOf(operator) === -1) {\n            throw new Error(`Operation invalid: ${operator}`);\n        }\n        if (this.hasOperationOnPath(path)) {\n            throw new Error(`You cannot update ${path} multiple times`);\n        }\n        // Check for illegal values\n        if (typeof value === 'number') {\n            if (Number.isNaN(value)) {\n                throw new Error('NaN is not a supported value');\n            }\n            if (!Number.isFinite(value)) {\n                throw new Error('Infinity is not a supported value');\n            }\n        }\n        // Add the new operation\n        const normalizedValue = typeof value === 'undefined' ? null : value;\n        const updateOperation = new UpdateOperation(operator, path, normalizedValue);\n        this.operations.push(updateOperation);\n        return this;\n    }\n    /**\n     * Adds initial operations\n     *\n     * @param json\n     * @private\n     */\n    addOperations(json) {\n        Object.keys(json).forEach((key) => {\n            const pathValueDictionary = json[key];\n            Object.keys(pathValueDictionary).forEach((path) => {\n                const value = pathValueDictionary[path];\n                this.operations.push(new UpdateOperation(key, path, value));\n            });\n        });\n    }\n    /**\n     * Checks whether an operation on the field exists already\n     *\n     * @param path The path where the operation is executed on\n     * @return True, if the operation does exist\n     * @private\n     */\n    hasOperationOnPath(path) {\n        return this.operations.some((op) => op.path === path);\n    }\n}\n// aliases\nObject.assign(PartialUpdateBuilder.prototype, {\n    increment: PartialUpdateBuilder.prototype.inc,\n    decrement: PartialUpdateBuilder.prototype.dec,\n    multiply: PartialUpdateBuilder.prototype.mul,\n    divide: PartialUpdateBuilder.prototype.div,\n    atMost: PartialUpdateBuilder.prototype.min,\n    atLeast: PartialUpdateBuilder.prototype.max,\n    toNow: PartialUpdateBuilder.prototype.currentDate,\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGFydGlhbFVwZGF0ZUJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJQYXJ0aWFsVXBkYXRlQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJcEQsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixNQUFNO0lBQ04sTUFBTTtJQUNOLGNBQWM7SUFDZCxNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0lBQ04sTUFBTTtJQUNOLEtBQUs7SUFDTCxNQUFNO0lBQ04sT0FBTztJQUNQLE1BQU07SUFDTixTQUFTO0lBQ1QsU0FBUztJQUNULFVBQVU7SUFDVixNQUFNO0lBQ04sUUFBUTtJQUNSLFVBQVU7SUFDVixNQUFNO0NBQ1AsQ0FBQztBQW1FRixNQUFNLE9BQU8sb0JBQW9CO0lBRy9COztPQUVHO0lBQ0gsWUFBWSxVQUFtQjtRQUx4QixlQUFVLEdBQXNCLEVBQUUsQ0FBQztRQU14QyxJQUFJLFVBQVUsRUFBRTtZQUNkLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDaEM7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsR0FBRyxDQUFDLEtBQWEsRUFBRSxLQUFVO1FBQzNCLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQztRQUNoQixJQUFJLEdBQUcsWUFBWSxHQUFHLEVBQUU7WUFDdEIsR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDdkI7YUFBTSxJQUFJLEdBQUcsWUFBWSxHQUFHLEVBQUU7WUFDN0IsTUFBTSxRQUFRLEdBQXlCLEVBQUUsQ0FBQztZQUMxQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBTSxFQUFFLENBQVMsRUFBRSxFQUFFO2dCQUNoQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsR0FBRyxH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","import { PartialUpdateBuilder } from './PartialUpdateBuilder';\nimport * as message from '../message';\nimport { Metadata } from '../intersection';\nexport class EntityPartialUpdateBuilder extends PartialUpdateBuilder {\n    /**\n     * @param entity\n     * @param operations\n     */\n    constructor(entity, operations) {\n        super(operations);\n        this.entity = entity;\n    }\n    /**\n     * @inheritDoc\n     */\n    execute() {\n        const state = Metadata.get(this.entity);\n        const body = JSON.stringify(this);\n        const msg = new message.UpdatePartially(state.bucket, state.key, body);\n        return state.withLock(() => (state.db.send(msg).then((response) => {\n            // Update the entitys values\n            state.type.fromJsonValue(state, response.entity, this.entity, { persisting: true });\n            return this.entity;\n        })));\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5UGFydGlhbFVwZGF0ZUJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFbnRpdHlQYXJ0aWFsVXBkYXRlQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUU5RCxPQUFPLEtBQUssT0FBTyxNQUFNLFlBQVksQ0FBQztBQUV0QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFM0MsTUFBTSxPQUFPLDBCQUE2QyxTQUFRLG9CQUF1QjtJQUN2Rjs7O09BR0c7SUFDSCxZQUE0QixNQUFTLEVBQUUsVUFBbUI7UUFDeEQsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRFEsV0FBTSxHQUFOLE1BQU0sQ0FBRztJQUVyQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ0wsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXZFLE9BQU8sS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUMxQixLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNuQyw2QkFBNkI7WUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3BGLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FDSCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YifQ==","/* eslint-disable no-bitwise,default-case,no-fallthrough */\nimport { atob } from '../util';\n/**\n * A Bloom Filter is a client-side kept cache sketch of the server cache\n */\nexport class BloomFilter {\n    /**\n     * @param bloomFilter The raw Bloom filter.\n     * @param bloomFilter.m The raw Bloom filter bits.\n     * @param bloomFilter.h The raw Bloom filter hashes.\n     * @param bloomFilter.b The Base64-encoded raw Bloom filter bytes.\n     */\n    constructor(bloomFilter) {\n        this.bytes = atob(bloomFilter.b);\n        this.bits = bloomFilter.m;\n        this.hashes = bloomFilter.h;\n        this.creation = Date.now();\n    }\n    /**\n     * Returns whether this Bloom filter contains the given element.\n     *\n     * @param element The element to check if it is contained.\n     * @return True, if the element is contained in this Bloom filter.\n     */\n    contains(element) {\n        const hashes = BloomFilter.getHashes(element, this.bits, this.hashes);\n        for (let i = 0, len = hashes.length; i < len; i += 1) {\n            if (!this.isSet(hashes[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Checks whether a bit is set at a given position.\n     *\n     * @param index The position index to check.\n     * @return True, if the bit is set at the given position.\n     */\n    isSet(index) {\n        const pos = Math.floor(index / 8);\n        const bit = 1 << (index % 8);\n        // Extract byte as int or NaN if out of range\n        const byte = this.bytes.charCodeAt(pos);\n        // Bit-wise AND should be non-zero (NaN always yields false)\n        return (byte & bit) !== 0;\n    }\n    /**\n     * Returns the hases of a given element in the Bloom filter.\n     *\n     * @param element The element to check.\n     * @param bits The amount of bits.\n     * @param hashes The amount of hashes.\n     * @return The hashes of an element in the Bloom filter.\n     */\n    static getHashes(element, bits, hashes) {\n        const hashValues = new Array(hashes);\n        const hash1 = BloomFilter.murmur3(0, element);\n        const hash2 = BloomFilter.murmur3(hash1, element);\n        for (let i = 0; i < hashes; i += 1) {\n            hashValues[i] = (hash1 + (i * hash2)) % bits;\n        }\n        return hashValues;\n    }\n    /**\n     * Calculate a Murmur3 hash.\n     *\n     * @param seed A seed to use for the hashing.\n     * @param key A key to check.\n     * @return A hashed value of key.\n     */\n    static murmur3(seed, key) {\n        const remainder = key.length & 3;\n        const bytes = key.length - remainder;\n        const c1 = 0xcc9e2d51;\n        const c2 = 0x1b873593;\n        let h1;\n        let h1b;\n        let k1;\n        let i;\n        h1 = seed;\n        i = 0;\n        while (i < bytes) {\n            k1 = ((key.charCodeAt(i) & 0xff))\n                | ((key.charCodeAt(i += 1) & 0xff) << 8)\n                | ((key.charCodeAt(i += 1) & 0xff) << 16)\n                | ((key.charCodeAt(i += 1) & 0xff) << 24);\n            i += 1;\n            k1 = ((((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16))) & 0xffffffff;\n            k1 = (k1 << 15) | (k1 >>> 17);\n            k1 = ((((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16))) & 0xffffffff;\n            h1 ^= k1;\n            h1 = (h1 << 13) | (h1 >>> 19);\n            h1b = ((((h1 & 0xffff) * 5) + ((((h1 >>> 16) * 5) & 0xffff) << 16))) & 0xffffffff;\n            h1 = (((h1b & 0xffff) + 0x6b64) + ((((h1b >>> 16) + 0xe654) & 0xffff) << 16));\n        }\n        k1 = 0;\n        switch (remainder) {\n            case 3:\n                k1 ^= (key.charCodeAt(i + 2) & 0xff) << 16;\n            case 2:\n                k1 ^= (key.charCodeAt(i + 1) & 0xff) << 8;\n            case 1:\n                k1 ^= (key.charCodeAt(i) & 0xff);\n                k1 = (((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16)) & 0xffffffff;\n                k1 = (k1 << 15) | (k1 >>> 17);\n                k1 = (((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16)) & 0xffffffff;\n                h1 ^= k1;\n        }\n        h1 ^= key.length;\n        h1 ^= h1 >>> 16;\n        h1 = (((h1 & 0xffff) * 0x85ebca6b) + ((((h1 >>> 16) * 0x85ebca6b) & 0xffff) << 16)) & 0xffffffff;\n        h1 ^= h1 >>> 13;\n        h1 = ((((h1 & 0xffff) * 0xc2b2ae35) + ((((h1 >>> 16) * 0xc2b2ae35) & 0xffff) << 16))) & 0xffffffff;\n        h1 ^= h1 >>> 16;\n        return h1 >>> 0;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmxvb21GaWx0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJCbG9vbUZpbHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwyREFBMkQ7QUFFM0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUUvQjs7R0FFRztBQUNILE1BQU0sT0FBTyxXQUFXO0lBNkJ0Qjs7Ozs7T0FLRztJQUNILFlBQVksV0FBZ0Q7UUFDMUQsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsUUFBUSxDQUFDLE9BQWU7UUFDdEIsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3BELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUMxQixPQUFPLEtBQUssQ0FBQzthQUNkO1NBQ0Y7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNLLEtBQUssQ0FBQyxLQUFhO1FBQ3pCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFD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","/**\n * An aggregation of access rules for given object metadata.\n */\nexport class Permission {\n    constructor() {\n        this.rules = {};\n    }\n    /**\n     * Returns a list of user and role references of all rules\n     * @return a list of references\n     */\n    allRules() {\n        return Object.keys(this.rules);\n    }\n    /**\n     * Removes all rules from this permission object\n     * @return\n     */\n    clear() {\n        this.rules = {};\n    }\n    /**\n     * Copies permissions from another permission object\n     * @param permission The permission to copy from\n     * @return\n     */\n    copy(permission) {\n        this.rules = Object.assign({}, permission.rules);\n        return this;\n    }\n    /**\n     * Gets whenever all users and roles have the permission to perform the operation\n     * @return <code>true</code> If public access is allowed\n     */\n    isPublicAllowed() {\n        if ('*' in this.rules) {\n            return false;\n        }\n        return !this.allRules().some((ref) => this.rules[ref] === 'allow');\n    }\n    /**\n     * Sets whenever all users and roles should have the permission to perform the operation\n     *\n     * Note: All other allow rules will be removed.\n     *\n     * @return\n     */\n    setPublicAllowed() {\n        this.allRules().forEach((ref) => {\n            if (this.rules[ref] === 'allow') {\n                delete this.rules[ref];\n            }\n        });\n    }\n    /**\n     * Returns the actual rule of the given user or role.\n     * @param userOrRole The user or role to check for\n     * @return The actual access rule or undefined if no rule was found\n     */\n    getRule(userOrRole) {\n        return this.rules[this.ref(userOrRole)];\n    }\n    /**\n     * Checks whenever the user or role is explicit allowed to perform the operation.\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> If the given user or role is allowed\n     */\n    isAllowed(userOrRole) {\n        return this.rules[this.ref(userOrRole)] === 'allow';\n    }\n    /**\n     * Checks whenever the user or role is explicit denied to perform the operation.\n     *\n     * @param userOrRole The user or role to check for\n     * @return <code>true</code> If the given user or role is denied\n     */\n    isDenied(userOrRole) {\n        return this.rules[this.ref(userOrRole)] === 'deny';\n    }\n    /**\n     * Allows the given users or rules to perform the operation\n     * @param userOrRole The users or roles to allow\n     * @return this permission object\n     */\n    allowAccess(...userOrRole) {\n        for (let i = 0; i < userOrRole.length; i += 1) {\n            this.rules[this.ref(userOrRole[i])] = 'allow';\n        }\n        return this;\n    }\n    /**\n     * Denies the given users or rules to perform the operation\n     * @param userOrRole The users or roles to deny\n     * @return this permission object\n     */\n    denyAccess(...userOrRole) {\n        for (let i = 0; i < userOrRole.length; i += 1) {\n            this.rules[this.ref(userOrRole[i])] = 'deny';\n        }\n        return this;\n    }\n    /**\n     * Deletes any allow/deny rules for the given users or roles\n     * @param userOrRole The users or roles to delete rules for\n     * @return this permission object\n     */\n    deleteAccess(...userOrRole) {\n        for (let i = 0; i < userOrRole.length; i += 1) {\n            delete this.rules[this.ref(userOrRole[i])];\n        }\n        return this;\n    }\n    /**\n     * A Json representation of the set of rules\n     * @return\n     */\n    toJSON() {\n        return Object.assign({}, this.rules);\n    }\n    /**\n     * Sets the permission rules from json\n     * @param json The permission json representation\n     * @return\n     */\n    fromJSON(json) {\n        this.rules = json;\n    }\n    /**\n     * Creates a permission from the given rules.\n     * @param json The rules.\n     * @return The permission.\n     */\n    static fromJSON(json) {\n        const permission = new this();\n        permission.fromJSON(json);\n        return permission;\n    }\n    /**\n     * Resolves user and role references and validate given references\n     * @param userOrRole The user, role or reference\n     * @return The resolved and validated reference\n     */\n    ref(userOrRole) {\n        const ref = typeof userOrRole === 'string' ? userOrRole : userOrRole.id;\n        if (ref.indexOf('/db/User/') === 0 || ref.indexOf('/db/Role/') === 0) {\n            return ref;\n        }\n        throw new TypeError('The given object isn\\'t a user, role or a valid reference.');\n    }\n}\nPermission.BASE_PERMISSIONS = ['load', 'update', 'delete', 'query', 'insert'];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGVybWlzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlBlcm1pc3Npb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUE7O0dBRUc7QUFDSCxNQUFNLE9BQU8sVUFBVTtJQUF2QjtRQUdTLFVBQUssR0FBNEIsRUFBRSxDQUFDO0lBcUs3QyxDQUFDO0lBbktDOzs7T0FHRztJQUNILFFBQVE7UUFDTixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLO1FBQ0gsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxJQUFJLENBQUMsVUFBc0I7UUFDekIsSUFBSSxDQUFDLEtBQUsscUJBQVEsVUFBVSxDQUFDLEtBQUssQ0FBRSxDQUFDO1FBQ3JDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7T0FHRztJQUNILGVBQWU7UUFDYixJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxPQUFPLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsZ0JBQWdCO1FBQ2QsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzlCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxPQUFPLEVBQUU7Z0JBQy9CLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUN4QjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FB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","function optionalRxjsDependency() {\n    throw new Error('This functionality is only available, if the optional rxjs dependency is also provided.');\n}\nlet rxjs = {\n    Observable: optionalRxjsDependency,\n    Subscription: optionalRxjsDependency,\n    Subscriber: optionalRxjsDependency,\n};\ntry {\n    // we load this module as an optional external dependency\n    // eslint-disable-next-line global-require\n    rxjs = require('rxjs');\n}\ncatch (e) {\n    // ignore loading optional module error\n}\nconst { Observable, Subscription, Subscriber } = rxjs;\nexport { Observable, Subscription, Subscriber };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JzZXJ2YWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm9ic2VydmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsU0FBUyxzQkFBc0I7SUFDN0IsTUFBTSxJQUFJLEtBQUssQ0FBQyx5RkFBeUYsQ0FBQyxDQUFDO0FBQzdHLENBQUM7QUFFRCxJQUFJLElBQUksR0FBRztJQUNULFVBQVUsRUFBRSxzQkFBc0Q7SUFDbEUsWUFBWSxFQUFFLHNCQUFzRDtJQUNwRSxVQUFVLEVBQUUsc0JBQXNEO0NBQ25FLENBQUM7QUFFRixJQUFJO0lBQ0YseURBQXlEO0lBQ3pELDBDQUEwQztJQUMxQyxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQ3hCO0FBQUMsT0FBTyxDQUFDLEVBQUU7SUFDVix1Q0FBdUM7Q0FDeEM7QUFNRCxNQUFNLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFFdEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLENBQUMifQ==","if(typeof rxjs === 'undefined') {var e = new Error(\"Cannot find module 'rxjs'\"); e.code = 'MODULE_NOT_FOUND'; throw e;}\nmodule.exports = rxjs;","if(typeof validator === 'undefined') {var e = new Error(\"Cannot find module 'validator'\"); e.code = 'MODULE_NOT_FOUND'; throw e;}\nmodule.exports = validator;","import * as binding from './binding';\nimport * as connector from './connector';\nimport * as error from './error';\nimport * as message from './message';\nimport * as util from './util';\nimport * as caching from './caching';\nimport * as query from './query';\nimport * as partialupdate from './partialupdate';\nimport * as intersection from './intersection';\nimport * as metamodel from './metamodel';\nimport { Permission, Metadata, TokenStorage, Validator, PushMessage, Code, Modules, Logger, } from './intersection';\nimport { Metamodel } from './metamodel';\nimport { EntityManagerFactory } from './EntityManagerFactory';\nimport { EntityManager } from './EntityManager';\nimport { Acl } from './Acl';\nimport { db } from './baqend';\nimport { deprecated } from './util';\nfunction deprecateExports(target, targetName, newImportSignature, exports) {\n    Object.keys(exports).forEach((exported) => {\n        const decorate = deprecated(newImportSignature.replace('$export', exported));\n        Object.defineProperty(target, exported, decorate(targetName, exported, {\n            get() {\n                return exports[exported];\n            },\n        }));\n    });\n}\ndeprecateExports(util, 'util', 'intersection.$export', {\n    Permission, Metadata, TokenStorage, Validator, PushMessage, Code, Modules, Logger,\n});\ndeprecateExports(EntityManager.prototype, 'db', 'import { $export } from \\'baqend\\'', {\n    db,\n    binding,\n    connector,\n    error,\n    message,\n    util,\n    caching,\n    query,\n    partialupdate,\n    intersection,\n    EntityManagerFactory,\n    EntityManager,\n    Acl,\n});\ndeprecateExports(Metamodel.prototype, 'metamodel', 'import { metamodel } from \\'baqend\\';', metamodel);\nexport function configure() {\n    throw new Error('Please use Baqend.db.configure() or import { db } from \\'baqend\\' instead.');\n}\nexport function connect() {\n    throw new Error('Please use Baqend.db.connect() or import { db } from \\'baqend\\' instead.');\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVwZXJlY2F0ZWQtZXhwb3J0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRlcGVyZWNhdGVkLWV4cG9ydHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDckMsT0FBTyxLQUFLLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDekMsT0FBTyxLQUFLLEtBQUssTUFBTSxTQUFTLENBQUM7QUFDakMsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDckMsT0FBTyxLQUFLLElBQUksTUFBTSxRQUFRLENBQUM7QUFDL0IsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDckMsT0FBTyxLQUFLLEtBQUssTUFBTSxTQUFTLENBQUM7QUFDakMsT0FBTyxLQUFLLGFBQWEsTUFBTSxpQkFBaUIsQ0FBQztBQUNqRCxPQUFPLEtBQUssWUFBWSxNQUFNLGdCQUFnQixDQUFDO0FBQy9DLE9BQU8sS0FBSyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBRXpDLE9BQU8sRUFDTCxVQUFVLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxHQUNsRixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFFNUIsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM5QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRXBDLFNBQVMsZ0JBQWdCLENBQUMsTUFBYyxFQUFFLFVBQWtCLEVBQUUsa0JBQTBCLEVBQUUsT0FFekY7SUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1FBQ3hDLE1BQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0UsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFO1lBQ3JFLEdBQUc7Z0JBQ0QsT0FBUSxPQUFlLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEMsQ0FBQztTQUNGLENBQUMsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxzQkFBc0IsRUFBRTtJQUNyRCxVQUFVLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTTtDQUNsRixDQUFDLENBQUM7QUFFSCxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxvQ0FBb0MsRUFBRTtJQUNwRixFQUFFO0lBQ0YsT0FBTztJQUNQLFNBQVM7SUFDVCxLQUFLO0lBQ0wsT0FBTztJQUNQLElBQUk7SUFDSixPQUFPO0lBQ1AsS0FBSztJQUNMLGFBQWE7SUFDYixZQUFZO0lBRVosb0JBQW9CO0lBQ3BCLGFBQWE7SUFDYixHQUFHO0NBQ0osQ0FBQyxDQUFDO0FBRUgsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxXQUFXLEVBQUUsdUNBQXVDLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFFdkcsTUFBTSxVQUFVLFNBQVM7SUFDdkIsTUFBTSxJQUFJLEtBQUssQ0FBQyw0RUFBNEUsQ0FBQyxDQUFDO0FBQ2hHLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTztJQUNyQixNQUFNLElBQUksS0FBSyxDQUFDLDBFQUEwRSxDQUFDLENBQUM7QUFDOUYsQ0FBQyJ9","import { db } from './baqend';\nimport * as binding_1 from './binding';\nexport { binding_1 as binding };\nimport * as connector_1 from './connector';\nexport { connector_1 as connector };\nimport * as error_1 from './error';\nexport { error_1 as error };\nimport * as message_1 from './message';\nexport { message_1 as message };\nimport * as metamodel_1 from './metamodel';\nexport { metamodel_1 as metamodel };\nimport * as util_1 from './util';\nexport { util_1 as util };\nimport * as intersection_1 from './intersection';\nexport { intersection_1 as intersection };\nimport * as caching_1 from './caching';\nexport { caching_1 as caching };\nimport * as query_1 from './query';\nexport { query_1 as query };\nimport * as partialupdate_1 from './partialupdate';\nexport { partialupdate_1 as partialupdate };\nimport * as model_1 from './model';\nexport { model_1 as model };\nexport { EntityManagerFactory } from './EntityManagerFactory';\nexport { EntityManager } from './EntityManager';\nexport { Acl } from './Acl';\nexport { GeoPoint } from './GeoPoint';\nexport { db } from './baqend';\nexport { connect, configure } from './deperecated-exports';\nconst SetType = Set;\nconst MapType = Map;\nconst ListType = Array;\nexport { SetType as Set, ListType as List, MapType as Map };\n// Use one global default export of this module\n// eslint-disable-next-line import/no-default-export\nexport default db;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sVUFBVSxDQUFDOzJCQUVMLFdBQVc7c0JBQXhCLE9BQU87NkJBQ1EsYUFBYTt3QkFBNUIsU0FBUzt5QkFDRSxTQUFTO29CQUFwQixLQUFLOzJCQUNRLFdBQVc7c0JBQXhCLE9BQU87NkJBQ1EsYUFBYTt3QkFBNUIsU0FBUzt3QkFDQyxRQUFRO21CQUFsQixJQUFJO2dDQUNjLGdCQUFnQjsyQkFBbEMsWUFBWTsyQkFDQyxXQUFXO3NCQUF4QixPQUFPO3lCQUNJLFNBQVM7b0JBQXBCLEtBQUs7aUNBQ2MsaUJBQWlCOzRCQUFwQyxhQUFhO3lCQUNGLFNBQVM7b0JBQXBCLEtBQUs7QUFFakIsT0FBTyxFQUFFLG9CQUFvQixFQUFlLE1BQU0sd0JBQXdCLENBQUM7QUFDM0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDNUIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLEVBQUUsRUFBRSxFQUFVLE1BQU0sVUFBVSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFM0QsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDO0FBQ3BCLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQztBQUNwQixNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUM7QUFFdkIsT0FBTyxFQUFFLE9BQU8sSUFBSSxHQUFHLEVBQUUsUUFBUSxJQUFJLElBQUksRUFBRSxPQUFPLElBQUksR0FBRyxFQUFFLENBQUM7QUFFNUQsK0NBQStDO0FBQy9DLG9EQUFvRDtBQUNwRCxlQUFlLEVBQUUsQ0FBQyJ9"],"sourceRoot":""}